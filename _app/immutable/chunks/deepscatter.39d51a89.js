var Km="http://www.w3.org/1999/xhtml";const ab={svg:"http://www.w3.org/2000/svg",xhtml:Km,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function pp(n){var t=n+="",e=t.indexOf(":");return e>=0&&(t=n.slice(0,e))!=="xmlns"&&(n=n.slice(e+1)),ab.hasOwnProperty(t)?{space:ab[t],local:n}:n}function x6(n){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===Km&&t.documentElement.namespaceURI===Km?t.createElement(n):t.createElementNS(e,n)}}function S6(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function Sy(n){var t=pp(n);return(t.local?S6:x6)(t)}function A6(){}function z0(n){return n==null?A6:function(){return this.querySelector(n)}}function E6(n){typeof n!="function"&&(n=z0(n));for(var t=this._groups,e=t.length,r=new Array(e),a=0;a<e;++a)for(var o=t[a],f=o.length,c=r[a]=new Array(f),l,_,m=0;m<f;++m)(l=o[m])&&(_=n.call(l,l.__data__,m,o))&&("__data__"in l&&(_.__data__=l.__data__),c[m]=_);return new Si(r,this._parents)}function T6(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function I6(){return[]}function Ay(n){return n==null?I6:function(){return this.querySelectorAll(n)}}function O6(n){return function(){return T6(n.apply(this,arguments))}}function B6(n){typeof n=="function"?n=O6(n):n=Ay(n);for(var t=this._groups,e=t.length,r=[],a=[],o=0;o<e;++o)for(var f=t[o],c=f.length,l,_=0;_<c;++_)(l=f[_])&&(r.push(n.call(l,l.__data__,_,f)),a.push(l));return new Si(r,a)}function Ey(n){return function(){return this.matches(n)}}function Ty(n){return function(t){return t.matches(n)}}var R6=Array.prototype.find;function M6(n){return function(){return R6.call(this.children,n)}}function L6(){return this.firstElementChild}function N6(n){return this.select(n==null?L6:M6(typeof n=="function"?n:Ty(n)))}var D6=Array.prototype.filter;function F6(){return Array.from(this.children)}function C6(n){return function(){return D6.call(this.children,n)}}function k6(n){return this.selectAll(n==null?F6:C6(typeof n=="function"?n:Ty(n)))}function P6(n){typeof n!="function"&&(n=Ey(n));for(var t=this._groups,e=t.length,r=new Array(e),a=0;a<e;++a)for(var o=t[a],f=o.length,c=r[a]=[],l,_=0;_<f;++_)(l=o[_])&&n.call(l,l.__data__,_,o)&&c.push(l);return new Si(r,this._parents)}function Iy(n){return new Array(n.length)}function z6(){return new Si(this._enter||this._groups.map(Iy),this._parents)}function b_(n,t){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=t}b_.prototype={constructor:b_,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,t){return this._parent.insertBefore(n,t)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function U6(n){return function(){return n}}function G6(n,t,e,r,a,o){for(var f=0,c,l=t.length,_=o.length;f<_;++f)(c=t[f])?(c.__data__=o[f],r[f]=c):e[f]=new b_(n,o[f]);for(;f<l;++f)(c=t[f])&&(a[f]=c)}function $6(n,t,e,r,a,o,f){var c,l,_=new Map,m=t.length,A=o.length,R=new Array(m),C;for(c=0;c<m;++c)(l=t[c])&&(R[c]=C=f.call(l,l.__data__,c,t)+"",_.has(C)?a[c]=l:_.set(C,l));for(c=0;c<A;++c)C=f.call(n,o[c],c,o)+"",(l=_.get(C))?(r[c]=l,l.__data__=o[c],_.delete(C)):e[c]=new b_(n,o[c]);for(c=0;c<m;++c)(l=t[c])&&_.get(R[c])===l&&(a[c]=l)}function j6(n){return n.__data__}function V6(n,t){if(!arguments.length)return Array.from(this,j6);var e=t?$6:G6,r=this._parents,a=this._groups;typeof n!="function"&&(n=U6(n));for(var o=a.length,f=new Array(o),c=new Array(o),l=new Array(o),_=0;_<o;++_){var m=r[_],A=a[_],R=A.length,C=W6(n.call(m,m&&m.__data__,_,r)),G=C.length,$t=c[_]=new Array(G),Kt=f[_]=new Array(G),Mt=l[_]=new Array(R);e(m,A,$t,Kt,Mt,C,t);for(var ie=0,Xt=0,it,Ct;ie<G;++ie)if(it=$t[ie]){for(ie>=Xt&&(Xt=ie+1);!(Ct=Kt[Xt])&&++Xt<G;);it._next=Ct||null}}return f=new Si(f,r),f._enter=c,f._exit=l,f}function W6(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function Y6(){return new Si(this._exit||this._groups.map(Iy),this._parents)}function H6(n,t,e){var r=this.enter(),a=this,o=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),t!=null&&(a=t(a),a&&(a=a.selection())),e==null?o.remove():e(o),r&&a?r.merge(a).order():a}function X6(n){for(var t=n.selection?n.selection():n,e=this._groups,r=t._groups,a=e.length,o=r.length,f=Math.min(a,o),c=new Array(a),l=0;l<f;++l)for(var _=e[l],m=r[l],A=_.length,R=c[l]=new Array(A),C,G=0;G<A;++G)(C=_[G]||m[G])&&(R[G]=C);for(;l<a;++l)c[l]=e[l];return new Si(c,this._parents)}function q6(){for(var n=this._groups,t=-1,e=n.length;++t<e;)for(var r=n[t],a=r.length-1,o=r[a],f;--a>=0;)(f=r[a])&&(o&&f.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(f,o),o=f);return this}function Z6(n){n||(n=K6);function t(A,R){return A&&R?n(A.__data__,R.__data__):!A-!R}for(var e=this._groups,r=e.length,a=new Array(r),o=0;o<r;++o){for(var f=e[o],c=f.length,l=a[o]=new Array(c),_,m=0;m<c;++m)(_=f[m])&&(l[m]=_);l.sort(t)}return new Si(a,this._parents).order()}function K6(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function J6(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function Q6(){return Array.from(this)}function tA(){for(var n=this._groups,t=0,e=n.length;t<e;++t)for(var r=n[t],a=0,o=r.length;a<o;++a){var f=r[a];if(f)return f}return null}function eA(){let n=0;for(const t of this)++n;return n}function nA(){return!this.node()}function rA(n){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var a=t[e],o=0,f=a.length,c;o<f;++o)(c=a[o])&&n.call(c,c.__data__,o,a);return this}function iA(n){return function(){this.removeAttribute(n)}}function aA(n){return function(){this.removeAttributeNS(n.space,n.local)}}function sA(n,t){return function(){this.setAttribute(n,t)}}function oA(n,t){return function(){this.setAttributeNS(n.space,n.local,t)}}function fA(n,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(n):this.setAttribute(n,e)}}function uA(n,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}}function cA(n,t){var e=pp(n);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((t==null?e.local?aA:iA:typeof t=="function"?e.local?uA:fA:e.local?oA:sA)(e,t))}function Oy(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function lA(n){return function(){this.style.removeProperty(n)}}function hA(n,t,e){return function(){this.style.setProperty(n,t,e)}}function dA(n,t,e){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,e)}}function _A(n,t,e){return arguments.length>1?this.each((t==null?lA:typeof t=="function"?dA:hA)(n,t,e??"")):Dc(this.node(),n)}function Dc(n,t){return n.style.getPropertyValue(t)||Oy(n).getComputedStyle(n,null).getPropertyValue(t)}function pA(n){return function(){delete this[n]}}function mA(n,t){return function(){this[n]=t}}function gA(n,t){return function(){var e=t.apply(this,arguments);e==null?delete this[n]:this[n]=e}}function bA(n,t){return arguments.length>1?this.each((t==null?pA:typeof t=="function"?gA:mA)(n,t)):this.node()[n]}function By(n){return n.trim().split(/^|\s+/)}function U0(n){return n.classList||new Ry(n)}function Ry(n){this._node=n,this._names=By(n.getAttribute("class")||"")}Ry.prototype={add:function(n){var t=this._names.indexOf(n);t<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var t=this._names.indexOf(n);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function My(n,t){for(var e=U0(n),r=-1,a=t.length;++r<a;)e.add(t[r])}function Ly(n,t){for(var e=U0(n),r=-1,a=t.length;++r<a;)e.remove(t[r])}function yA(n){return function(){My(this,n)}}function vA(n){return function(){Ly(this,n)}}function wA(n,t){return function(){(t.apply(this,arguments)?My:Ly)(this,n)}}function xA(n,t){var e=By(n+"");if(arguments.length<2){for(var r=U0(this.node()),a=-1,o=e.length;++a<o;)if(!r.contains(e[a]))return!1;return!0}return this.each((typeof t=="function"?wA:t?yA:vA)(e,t))}function SA(){this.textContent=""}function AA(n){return function(){this.textContent=n}}function EA(n){return function(){var t=n.apply(this,arguments);this.textContent=t??""}}function TA(n){return arguments.length?this.each(n==null?SA:(typeof n=="function"?EA:AA)(n)):this.node().textContent}function IA(){this.innerHTML=""}function OA(n){return function(){this.innerHTML=n}}function BA(n){return function(){var t=n.apply(this,arguments);this.innerHTML=t??""}}function RA(n){return arguments.length?this.each(n==null?IA:(typeof n=="function"?BA:OA)(n)):this.node().innerHTML}function MA(){this.nextSibling&&this.parentNode.appendChild(this)}function LA(){return this.each(MA)}function NA(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function DA(){return this.each(NA)}function FA(n){var t=typeof n=="function"?n:Sy(n);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function CA(){return null}function kA(n,t){var e=typeof n=="function"?n:Sy(n),r=t==null?CA:typeof t=="function"?t:z0(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})}function PA(){var n=this.parentNode;n&&n.removeChild(this)}function zA(){return this.each(PA)}function UA(){var n=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(n,this.nextSibling):n}function GA(){var n=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(n,this.nextSibling):n}function $A(n){return this.select(n?GA:UA)}function jA(n){return arguments.length?this.property("__data__",n):this.node().__data__}function VA(n){return function(t){n.call(this,t,this.__data__)}}function WA(n){return n.trim().split(/^|\s+/).map(function(t){var e="",r=t.indexOf(".");return r>=0&&(e=t.slice(r+1),t=t.slice(0,r)),{type:t,name:e}})}function YA(n){return function(){var t=this.__on;if(t){for(var e=0,r=-1,a=t.length,o;e<a;++e)o=t[e],(!n.type||o.type===n.type)&&o.name===n.name?this.removeEventListener(o.type,o.listener,o.options):t[++r]=o;++r?t.length=r:delete this.__on}}}function HA(n,t,e){return function(){var r=this.__on,a,o=VA(t);if(r){for(var f=0,c=r.length;f<c;++f)if((a=r[f]).type===n.type&&a.name===n.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=o,a.options=e),a.value=t;return}}this.addEventListener(n.type,o,e),a={type:n.type,name:n.name,value:t,listener:o,options:e},r?r.push(a):this.__on=[a]}}function XA(n,t,e){var r=WA(n+""),a,o=r.length,f;if(arguments.length<2){var c=this.node().__on;if(c){for(var l=0,_=c.length,m;l<_;++l)for(a=0,m=c[l];a<o;++a)if((f=r[a]).type===m.type&&f.name===m.name)return m.value}return}for(c=t?HA:YA,a=0;a<o;++a)this.each(c(r[a],t,e));return this}function Ny(n,t,e){var r=Oy(n),a=r.CustomEvent;typeof a=="function"?a=new a(t,e):(a=r.document.createEvent("Event"),e?(a.initEvent(t,e.bubbles,e.cancelable),a.detail=e.detail):a.initEvent(t,!1,!1)),n.dispatchEvent(a)}function qA(n,t){return function(){return Ny(this,n,t)}}function ZA(n,t){return function(){return Ny(this,n,t.apply(this,arguments))}}function KA(n,t){return this.each((typeof t=="function"?ZA:qA)(n,t))}function*JA(){for(var n=this._groups,t=0,e=n.length;t<e;++t)for(var r=n[t],a=0,o=r.length,f;a<o;++a)(f=r[a])&&(yield f)}var Dy=[null];function Si(n,t){this._groups=n,this._parents=t}function Vh(){return new Si([[document.documentElement]],Dy)}function QA(){return this}Si.prototype=Vh.prototype={constructor:Si,select:E6,selectAll:B6,selectChild:N6,selectChildren:k6,filter:P6,data:V6,enter:z6,exit:Y6,join:H6,merge:X6,selection:QA,order:q6,sort:Z6,call:J6,nodes:Q6,node:tA,size:eA,empty:nA,each:rA,attr:cA,style:_A,property:bA,classed:xA,text:TA,html:RA,raise:LA,lower:DA,append:FA,insert:kA,remove:zA,clone:$A,datum:jA,on:XA,dispatch:KA,[Symbol.iterator]:JA};function Wn(n){return typeof n=="string"?new Si([[document.querySelector(n)]],[document.documentElement]):new Si([[n]],Dy)}function t4(n){let t;for(;t=n.sourceEvent;)n=t;return n}function js(n,t){if(n=t4(n),t===void 0&&(t=n.currentTarget),t){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var r=e.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var a=t.getBoundingClientRect();return[n.clientX-a.left-t.clientLeft,n.clientY-a.top-t.clientTop]}}return[n.pageX,n.pageY]}function s_(n,t){return n==null||t==null?NaN:n<t?-1:n>t?1:n>=t?0:NaN}function e4(n,t){return n==null||t==null?NaN:t<n?-1:t>n?1:t>=n?0:NaN}function Fy(n){let t,e,r;n.length!==2?(t=s_,e=(c,l)=>s_(n(c),l),r=(c,l)=>n(c)-l):(t=n===s_||n===e4?n:n4,e=n,r=n);function a(c,l,_=0,m=c.length){if(_<m){if(t(l,l)!==0)return m;do{const A=_+m>>>1;e(c[A],l)<0?_=A+1:m=A}while(_<m)}return _}function o(c,l,_=0,m=c.length){if(_<m){if(t(l,l)!==0)return m;do{const A=_+m>>>1;e(c[A],l)<=0?_=A+1:m=A}while(_<m)}return _}function f(c,l,_=0,m=c.length){const A=a(c,l,_,m-1);return A>_&&r(c[A-1],l)>-r(c[A],l)?A-1:A}return{left:a,center:f,right:o}}function n4(){return 0}function r4(n){return n===null?NaN:+n}const Cy=Fy(s_),i4=Cy.right,a4=Cy.left;Fy(r4).center;function Lh(n,t){let e,r;if(t===void 0)for(const a of n)a!=null&&(e===void 0?a>=a&&(e=r=a):(e>a&&(e=a),r<a&&(r=a)));else{let a=-1;for(let o of n)(o=t(o,++a,n))!=null&&(e===void 0?o>=o&&(e=r=o):(e>o&&(e=o),r<o&&(r=o)))}return[e,r]}class Fc{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let r=0;for(let a=0;a<this._n&&a<32;a++){const o=e[a],f=t+o,c=Math.abs(t)<Math.abs(o)?t-(f-o):o-(f-t);c&&(e[r++]=c),t=f}return e[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let e=this._n,r,a,o,f=0;if(e>0){for(f=t[--e];e>0&&(r=f,a=t[--e],f=r+a,o=a-(f-r),!o););e>0&&(o<0&&t[e-1]<0||o>0&&t[e-1]>0)&&(a=o*2,r=f+a,a==r-f&&(f=r))}return f}}class sb extends Map{constructor(t,e=f4){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),t!=null)for(const[r,a]of t)this.set(r,a)}get(t){return super.get(ob(this,t))}has(t){return super.has(ob(this,t))}set(t,e){return super.set(s4(this,t),e)}delete(t){return super.delete(o4(this,t))}}function ob({_intern:n,_key:t},e){const r=t(e);return n.has(r)?n.get(r):e}function s4({_intern:n,_key:t},e){const r=t(e);return n.has(r)?n.get(r):(n.set(r,e),e)}function o4({_intern:n,_key:t},e){const r=t(e);return n.has(r)&&(e=n.get(e),n.delete(r)),e}function f4(n){return n!==null&&typeof n=="object"?n.valueOf():n}const u4=Math.sqrt(50),c4=Math.sqrt(10),l4=Math.sqrt(2);function y_(n,t,e){const r=(t-n)/Math.max(0,e),a=Math.floor(Math.log10(r)),o=r/Math.pow(10,a),f=o>=u4?10:o>=c4?5:o>=l4?2:1;let c,l,_;return a<0?(_=Math.pow(10,-a)/f,c=Math.round(n*_),l=Math.round(t*_),c/_<n&&++c,l/_>t&&--l,_=-_):(_=Math.pow(10,a)*f,c=Math.round(n/_),l=Math.round(t/_),c*_<n&&++c,l*_>t&&--l),l<c&&.5<=e&&e<2?y_(n,t,e*2):[c,l,_]}function Jm(n,t,e){if(t=+t,n=+n,e=+e,!(e>0))return[];if(n===t)return[n];const r=t<n,[a,o,f]=r?y_(t,n,e):y_(n,t,e);if(!(o>=a))return[];const c=o-a+1,l=new Array(c);if(r)if(f<0)for(let _=0;_<c;++_)l[_]=(o-_)/-f;else for(let _=0;_<c;++_)l[_]=(o-_)*f;else if(f<0)for(let _=0;_<c;++_)l[_]=(a+_)/-f;else for(let _=0;_<c;++_)l[_]=(a+_)*f;return l}function Qm(n,t,e){return t=+t,n=+n,e=+e,y_(n,t,e)[2]}function h4(n,t,e){t=+t,n=+n,e=+e;const r=t<n,a=r?Qm(t,n,e):Qm(n,t,e);return(r?-1:1)*(a<0?1/-a:a)}function t0(n,t){let e;if(t===void 0)for(const r of n)r!=null&&(e<r||e===void 0&&r>=r)&&(e=r);else{let r=-1;for(let a of n)(a=t(a,++r,n))!=null&&(e<a||e===void 0&&a>=a)&&(e=a)}return e}function e0(n,t){let e;if(t===void 0)for(const r of n)r!=null&&(e>r||e===void 0&&r>=r)&&(e=r);else{let r=-1;for(let a of n)(a=t(a,++r,n))!=null&&(e>a||e===void 0&&a>=a)&&(e=a)}return e}function Wd(n,t){let e=0,r=0;if(t===void 0)for(let a of n)a!=null&&(a=+a)>=a&&(++e,r+=a);else{let a=-1;for(let o of n)(o=t(o,++a,n))!=null&&(o=+o)>=o&&(++e,r+=o)}if(e)return r/e}function*d4(n){for(const t of n)yield*t}function _4(n){return Array.from(d4(n))}function nu(n,t,e){n=+n,t=+t,e=(a=arguments.length)<2?(t=n,n=0,1):a<3?1:+e;for(var r=-1,a=Math.max(0,Math.ceil((t-n)/e))|0,o=new Array(a);++r<a;)o[r]=n+r*e;return o}function p4(n){return function(e,r=0,a=e.length){let o=a-(r=+r);for(;o;){const f=n()*o--|0,c=e[o+r];e[o+r]=e[f+r],e[f+r]=c}return e}}function m4(n,t){let e=0;if(t===void 0)for(let r of n)(r=+r)&&(e+=r);else{let r=-1;for(let a of n)(a=+t(a,++r,n))&&(e+=a)}return e}var xc=1e-6,G0=Math.PI,g4=G0*2,b4=180/G0,y4=G0/180,Sc=Math.abs,v4=Math.cos,w4=Math.sin,$0=Math.sqrt;function Ui(){}function v_(n,t){n&&ub.hasOwnProperty(n.type)&&ub[n.type](n,t)}var fb={Feature:function(n,t){v_(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,a=e.length;++r<a;)v_(e[r].geometry,t)}},ub={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,a=e.length;++r<a;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){n0(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,a=e.length;++r<a;)n0(e[r],t,0)},Polygon:function(n,t){cb(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,a=e.length;++r<a;)cb(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,a=e.length;++r<a;)v_(e[r],t)}};function n0(n,t,e){var r=-1,a=n.length-e,o;for(t.lineStart();++r<a;)o=n[r],t.point(o[0],o[1],o[2]);t.lineEnd()}function cb(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)n0(n[e],t,1);t.polygonEnd()}function pc(n,t){n&&fb.hasOwnProperty(n.type)?fb[n.type](n,t):v_(n,t)}function x4(){var n=[],t;return{point:function(e,r,a){t.push([e,r,a])},lineStart:function(){n.push(t=[])},lineEnd:Ui,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],t=null,e}}}function S4(n,t){return Sc(n[0]-t[0])<xc&&Sc(n[1]-t[1])<xc}function Yd(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function A4(n,t,e,r,a){var o=[],f=[],c,l;if(n.forEach(function(G){if(!(($t=G.length-1)<=0)){var $t,Kt=G[0],Mt=G[$t],ie;if(S4(Kt,Mt)){if(!Kt[2]&&!Mt[2]){for(a.lineStart(),c=0;c<$t;++c)a.point((Kt=G[c])[0],Kt[1]);a.lineEnd();return}Mt[0]+=2*xc}o.push(ie=new Yd(Kt,G,null,!0)),f.push(ie.o=new Yd(Kt,null,ie,!1)),o.push(ie=new Yd(Mt,G,null,!1)),f.push(ie.o=new Yd(Mt,null,ie,!0))}}),!!o.length){for(f.sort(t),lb(o),lb(f),c=0,l=f.length;c<l;++c)f[c].e=e=!e;for(var _=o[0],m,A;;){for(var R=_,C=!0;R.v;)if((R=R.n)===_)return;m=R.z,a.lineStart();do{if(R.v=R.o.v=!0,R.e){if(C)for(c=0,l=m.length;c<l;++c)a.point((A=m[c])[0],A[1]);else r(R.x,R.n.x,1,a);R=R.n}else{if(C)for(m=R.p.z,c=m.length-1;c>=0;--c)a.point((A=m[c])[0],A[1]);else r(R.x,R.p.x,-1,a);R=R.p}R=R.o,m=R.z,C=!C}while(!R.v);a.lineEnd()}}}function lb(n){if(t=n.length){for(var t,e=0,r=n[0],a;++e<t;)r.n=a=n[e],a.p=r,r=a;r.n=a=n[0],a.p=r}}function E4(n,t,e,r,a,o){var f=n[0],c=n[1],l=t[0],_=t[1],m=0,A=1,R=l-f,C=_-c,G;if(G=e-f,!(!R&&G>0)){if(G/=R,R<0){if(G<m)return;G<A&&(A=G)}else if(R>0){if(G>A)return;G>m&&(m=G)}if(G=a-f,!(!R&&G<0)){if(G/=R,R<0){if(G>A)return;G>m&&(m=G)}else if(R>0){if(G<m)return;G<A&&(A=G)}if(G=r-c,!(!C&&G>0)){if(G/=C,C<0){if(G<m)return;G<A&&(A=G)}else if(C>0){if(G>A)return;G>m&&(m=G)}if(G=o-c,!(!C&&G<0)){if(G/=C,C<0){if(G>A)return;G>m&&(m=G)}else if(C>0){if(G<m)return;G<A&&(A=G)}return m>0&&(n[0]=f+m*R,n[1]=c+m*C),A<1&&(t[0]=f+A*R,t[1]=c+A*C),!0}}}}}var wh=1e9,Hd=-wh;function T4(n,t,e,r){function a(_,m){return n<=_&&_<=e&&t<=m&&m<=r}function o(_,m,A,R){var C=0,G=0;if(_==null||(C=f(_,A))!==(G=f(m,A))||l(_,m)<0^A>0)do R.point(C===0||C===3?n:e,C>1?r:t);while((C=(C+A+4)%4)!==G);else R.point(m[0],m[1])}function f(_,m){return Sc(_[0]-n)<xc?m>0?0:3:Sc(_[0]-e)<xc?m>0?2:1:Sc(_[1]-t)<xc?m>0?1:0:m>0?3:2}function c(_,m){return l(_.x,m.x)}function l(_,m){var A=f(_,1),R=f(m,1);return A!==R?A-R:A===0?m[1]-_[1]:A===1?_[0]-m[0]:A===2?_[1]-m[1]:m[0]-_[0]}return function(_){var m=_,A=x4(),R,C,G,$t,Kt,Mt,ie,Xt,it,Ct,fe,be={point:sn,lineStart:Bt,lineEnd:Dt,polygonStart:Y,polygonEnd:rt};function sn(ft,H){a(ft,H)&&m.point(ft,H)}function st(){for(var ft=0,H=0,bt=C.length;H<bt;++H)for(var Lt=C[H],Jt=1,ee=Lt.length,de=Lt[0],Te,ye,Ze=de[0],on=de[1];Jt<ee;++Jt)Te=Ze,ye=on,de=Lt[Jt],Ze=de[0],on=de[1],ye<=r?on>r&&(Ze-Te)*(r-ye)>(on-ye)*(n-Te)&&++ft:on<=r&&(Ze-Te)*(r-ye)<(on-ye)*(n-Te)&&--ft;return ft}function Y(){m=A,R=[],C=[],fe=!0}function rt(){var ft=st(),H=fe&&ft,bt=(R=_4(R)).length;(H||bt)&&(_.polygonStart(),H&&(_.lineStart(),o(null,null,1,_),_.lineEnd()),bt&&A4(R,c,ft,o,_),_.polygonEnd()),m=_,R=C=G=null}function Bt(){be.point=F,C&&C.push(G=[]),Ct=!0,it=!1,ie=Xt=NaN}function Dt(){R&&(F($t,Kt),Mt&&it&&A.rejoin(),R.push(A.result())),be.point=sn,it&&m.lineEnd()}function F(ft,H){var bt=a(ft,H);if(C&&G.push([ft,H]),Ct)$t=ft,Kt=H,Mt=bt,Ct=!1,bt&&(m.lineStart(),m.point(ft,H));else if(bt&&it)m.point(ft,H);else{var Lt=[ie=Math.max(Hd,Math.min(wh,ie)),Xt=Math.max(Hd,Math.min(wh,Xt))],Jt=[ft=Math.max(Hd,Math.min(wh,ft)),H=Math.max(Hd,Math.min(wh,H))];E4(Lt,Jt,n,t,e,r)?(it||(m.lineStart(),m.point(Lt[0],Lt[1])),m.point(Jt[0],Jt[1]),bt||m.lineEnd(),fe=!1):bt&&(m.lineStart(),m.point(ft,H),fe=!1)}ie=ft,Xt=H,it=bt}return be}}const r0=n=>n;var Fm=new Fc,i0=new Fc,ky,Py,a0,s0,Wo={point:Ui,lineStart:Ui,lineEnd:Ui,polygonStart:function(){Wo.lineStart=I4,Wo.lineEnd=B4},polygonEnd:function(){Wo.lineStart=Wo.lineEnd=Wo.point=Ui,Fm.add(Sc(i0)),i0=new Fc},result:function(){var n=Fm/2;return Fm=new Fc,n}};function I4(){Wo.point=O4}function O4(n,t){Wo.point=zy,ky=a0=n,Py=s0=t}function zy(n,t){i0.add(s0*n-a0*t),a0=n,s0=t}function B4(){zy(ky,Py)}const hb=Wo;var Cc=1/0,w_=Cc,Nh=-Cc,x_=Nh,R4={point:M4,lineStart:Ui,lineEnd:Ui,polygonStart:Ui,polygonEnd:Ui,result:function(){var n=[[Cc,w_],[Nh,x_]];return Nh=x_=-(w_=Cc=1/0),n}};function M4(n,t){n<Cc&&(Cc=n),n>Nh&&(Nh=n),t<w_&&(w_=t),t>x_&&(x_=t)}const S_=R4;var o0=0,f0=0,xh=0,A_=0,E_=0,vc=0,u0=0,c0=0,Sh=0,Uy,Gy,$a,ja,ua={point:su,lineStart:db,lineEnd:_b,polygonStart:function(){ua.lineStart=D4,ua.lineEnd=F4},polygonEnd:function(){ua.point=su,ua.lineStart=db,ua.lineEnd=_b},result:function(){var n=Sh?[u0/Sh,c0/Sh]:vc?[A_/vc,E_/vc]:xh?[o0/xh,f0/xh]:[NaN,NaN];return o0=f0=xh=A_=E_=vc=u0=c0=Sh=0,n}};function su(n,t){o0+=n,f0+=t,++xh}function db(){ua.point=L4}function L4(n,t){ua.point=N4,su($a=n,ja=t)}function N4(n,t){var e=n-$a,r=t-ja,a=$0(e*e+r*r);A_+=a*($a+n)/2,E_+=a*(ja+t)/2,vc+=a,su($a=n,ja=t)}function _b(){ua.point=su}function D4(){ua.point=C4}function F4(){$y(Uy,Gy)}function C4(n,t){ua.point=$y,su(Uy=$a=n,Gy=ja=t)}function $y(n,t){var e=n-$a,r=t-ja,a=$0(e*e+r*r);A_+=a*($a+n)/2,E_+=a*(ja+t)/2,vc+=a,a=ja*n-$a*t,u0+=a*($a+n),c0+=a*(ja+t),Sh+=a*3,su($a=n,ja=t)}const pb=ua;function jy(n){this._context=n}jy.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:{this._context.moveTo(n,t),this._point=1;break}case 1:{this._context.lineTo(n,t);break}default:{this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,g4);break}}},result:Ui};var l0=new Fc,Cm,Vy,Wy,Ah,Eh,T_={point:Ui,lineStart:function(){T_.point=k4},lineEnd:function(){Cm&&Yy(Vy,Wy),T_.point=Ui},polygonStart:function(){Cm=!0},polygonEnd:function(){Cm=null},result:function(){var n=+l0;return l0=new Fc,n}};function k4(n,t){T_.point=Yy,Vy=Ah=n,Wy=Eh=t}function Yy(n,t){Ah-=n,Eh-=t,l0.add($0(Ah*Ah+Eh*Eh)),Ah=n,Eh=t}const mb=T_;let gb,I_,bb,yb;class vb{constructor(t){this._append=t==null?Hy:P4(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,e){switch(this._point){case 0:{this._append`M${t},${e}`,this._point=1;break}case 1:{this._append`L${t},${e}`;break}default:{if(this._append`M${t},${e}`,this._radius!==bb||this._append!==I_){const r=this._radius,a=this._;this._="",this._append`m0,${r}a${r},${r} 0 1,1 0,${-2*r}a${r},${r} 0 1,1 0,${2*r}z`,bb=r,I_=this._append,yb=this._,this._=a}this._+=yb;break}}}result(){const t=this._;return this._="",t.length?t:null}}function Hy(n){let t=1;this._+=n[0];for(const e=n.length;t<e;++t)this._+=arguments[t]+n[t]}function P4(n){const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);if(t>15)return Hy;if(t!==gb){const e=10**t;gb=t,I_=function(a){let o=1;this._+=a[0];for(const f=a.length;o<f;++o)this._+=Math.round(arguments[o]*e)/e+a[o]}}return I_}function z4(n,t){let e=3,r=4.5,a,o;function f(c){return c&&(typeof r=="function"&&o.pointRadius(+r.apply(this,arguments)),pc(c,a(o))),o.result()}return f.area=function(c){return pc(c,a(hb)),hb.result()},f.measure=function(c){return pc(c,a(mb)),mb.result()},f.bounds=function(c){return pc(c,a(S_)),S_.result()},f.centroid=function(c){return pc(c,a(pb)),pb.result()},f.projection=function(c){return arguments.length?(a=c==null?(n=null,r0):(n=c).stream,f):n},f.context=function(c){return arguments.length?(o=c==null?(t=null,new vb(e)):new jy(t=c),typeof r!="function"&&o.pointRadius(r),f):t},f.pointRadius=function(c){return arguments.length?(r=typeof c=="function"?c:(o.pointRadius(+c),+c),f):r},f.digits=function(c){if(!arguments.length)return e;if(c==null)e=null;else{const l=Math.floor(c);if(!(l>=0))throw new RangeError(`invalid digits: ${c}`);e=l}return t===null&&(o=new vb(e)),f},f.projection(n).digits(e).context(t)}function U4(n){return function(t){var e=new h0;for(var r in n)e[r]=n[r];return e.stream=t,e}}function h0(){}h0.prototype={constructor:h0,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function j0(n,t,e){var r=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),r!=null&&n.clipExtent(null),pc(e,n.stream(S_)),t(S_.result()),r!=null&&n.clipExtent(r),n}function Xy(n,t,e){return j0(n,function(r){var a=t[1][0]-t[0][0],o=t[1][1]-t[0][1],f=Math.min(a/(r[1][0]-r[0][0]),o/(r[1][1]-r[0][1])),c=+t[0][0]+(a-f*(r[1][0]+r[0][0]))/2,l=+t[0][1]+(o-f*(r[1][1]+r[0][1]))/2;n.scale(150*f).translate([c,l])},e)}function G4(n,t,e){return Xy(n,[[0,0],t],e)}function $4(n,t,e){return j0(n,function(r){var a=+t,o=a/(r[1][0]-r[0][0]),f=(a-o*(r[1][0]+r[0][0]))/2,c=-o*r[0][1];n.scale(150*o).translate([f,c])},e)}function j4(n,t,e){return j0(n,function(r){var a=+t,o=a/(r[1][1]-r[0][1]),f=-o*r[0][0],c=(a-o*(r[1][1]+r[0][1]))/2;n.scale(150*o).translate([f,c])},e)}function V4(){var n=1,t=0,e=0,r=1,a=1,o=0,f,c,l=null,_,m,A,R=1,C=1,G=U4({point:function(it,Ct){var fe=Xt([it,Ct]);this.stream.point(fe[0],fe[1])}}),$t=r0,Kt,Mt;function ie(){return R=n*r,C=n*a,Kt=Mt=null,Xt}function Xt(it){var Ct=it[0]*R,fe=it[1]*C;if(o){var be=fe*f-Ct*c;Ct=Ct*f+fe*c,fe=be}return[Ct+t,fe+e]}return Xt.invert=function(it){var Ct=it[0]-t,fe=it[1]-e;if(o){var be=fe*f+Ct*c;Ct=Ct*f-fe*c,fe=be}return[Ct/R,fe/C]},Xt.stream=function(it){return Kt&&Mt===it?Kt:Kt=G($t(Mt=it))},Xt.postclip=function(it){return arguments.length?($t=it,l=_=m=A=null,ie()):$t},Xt.clipExtent=function(it){return arguments.length?($t=it==null?(l=_=m=A=null,r0):T4(l=+it[0][0],_=+it[0][1],m=+it[1][0],A=+it[1][1]),ie()):l==null?null:[[l,_],[m,A]]},Xt.scale=function(it){return arguments.length?(n=+it,ie()):n},Xt.translate=function(it){return arguments.length?(t=+it[0],e=+it[1],ie()):[t,e]},Xt.angle=function(it){return arguments.length?(o=it%360*y4,c=w4(o),f=v4(o),ie()):o*b4},Xt.reflectX=function(it){return arguments.length?(r=it?-1:1,ie()):r<0},Xt.reflectY=function(it){return arguments.length?(a=it?-1:1,ie()):a<0},Xt.fitExtent=function(it,Ct){return Xy(Xt,it,Ct)},Xt.fitSize=function(it,Ct){return G4(Xt,it,Ct)},Xt.fitWidth=function(it,Ct){return $4(Xt,it,Ct)},Xt.fitHeight=function(it,Ct){return j4(Xt,it,Ct)},Xt}var ca=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},O_={},W4={get exports(){return O_},set exports(n){O_=n}};(function(n,t){var e=200,r="__lodash_hash_undefined__",a=800,o=16,f=9007199254740991,c="[object Arguments]",l="[object Array]",_="[object AsyncFunction]",m="[object Boolean]",A="[object Date]",R="[object Error]",C="[object Function]",G="[object GeneratorFunction]",$t="[object Map]",Kt="[object Number]",Mt="[object Null]",ie="[object Object]",Xt="[object Proxy]",it="[object RegExp]",Ct="[object Set]",fe="[object String]",be="[object Undefined]",sn="[object WeakMap]",st="[object ArrayBuffer]",Y="[object DataView]",rt="[object Float32Array]",Bt="[object Float64Array]",Dt="[object Int8Array]",F="[object Int16Array]",ft="[object Int32Array]",H="[object Uint8Array]",bt="[object Uint8ClampedArray]",Lt="[object Uint16Array]",Jt="[object Uint32Array]",ee=/[\\^$.*+?()[\]{}|]/g,de=/^\[object .+?Constructor\]$/,Te=/^(?:0|[1-9]\d*)$/,ye={};ye[rt]=ye[Bt]=ye[Dt]=ye[F]=ye[ft]=ye[H]=ye[bt]=ye[Lt]=ye[Jt]=!0,ye[c]=ye[l]=ye[st]=ye[m]=ye[Y]=ye[A]=ye[R]=ye[C]=ye[$t]=ye[Kt]=ye[ie]=ye[it]=ye[Ct]=ye[fe]=ye[sn]=!1;var Ze=typeof ca=="object"&&ca&&ca.Object===Object&&ca,on=typeof self=="object"&&self&&self.Object===Object&&self,An=Ze||on||Function("return this")(),Nn=t&&!t.nodeType&&t,ln=Nn&&!0&&n&&!n.nodeType&&n,Dn=ln&&ln.exports===Nn,ir=Dn&&Ze.process,Kn=function(){try{var O=ln&&ln.require&&ln.require("util").types;return O||ir&&ir.binding&&ir.binding("util")}catch{}}(),Yr=Kn&&Kn.isTypedArray;function Qo(O,$,at){switch(at.length){case 0:return O.call($);case 1:return O.call($,at[0]);case 2:return O.call($,at[0],at[1]);case 3:return O.call($,at[0],at[1],at[2])}return O.apply($,at)}function Mr(O,$){for(var at=-1,ae=Array(O);++at<O;)ae[at]=$(at);return ae}function ba(O){return function($){return O($)}}function hu(O,$){return O==null?void 0:O[$]}function si(O,$){return function(at){return O($(at))}}var br=Array.prototype,du=Function.prototype,Cr=Object.prototype,Ir=An["__core-js_shared__"],Ai=du.toString,v=Cr.hasOwnProperty,_u=function(){var O=/[^.]+$/.exec(Ir&&Ir.keys&&Ir.keys.IE_PROTO||"");return O?"Symbol(src)_1."+O:""}(),ya=Cr.toString,Qc=Ai.call(Object),rs=RegExp("^"+Ai.call(v).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),lr=Dn?An.Buffer:void 0,is=An.Symbol,Ei=An.Uint8Array,as=lr?lr.allocUnsafe:void 0,ao=si(Object.getPrototypeOf,Object),so=Object.create,oo=Cr.propertyIsEnumerable,hr=br.splice,kr=is?is.toStringTag:void 0,ji=function(){try{var O=xa(Object,"defineProperty");return O({},"",{}),O}catch{}}(),tl=lr?lr.isBuffer:void 0,pu=Math.max,el=Date.now,tf=xa(An,"Map"),va=xa(Object,"create"),mu=function(){function O(){}return function($){if(!fi($))return{};if(so)return so($);O.prototype=$;var at=new O;return O.prototype=void 0,at}}();function Ti(O){var $=-1,at=O==null?0:O.length;for(this.clear();++$<at;){var ae=O[$];this.set(ae[0],ae[1])}}function nl(){this.__data__=va?va(null):{},this.size=0}function rl(O){var $=this.has(O)&&delete this.__data__[O];return this.size-=$?1:0,$}function yr(O){var $=this.__data__;if(va){var at=$[O];return at===r?void 0:at}return v.call($,O)?$[O]:void 0}function il(O){var $=this.__data__;return va?$[O]!==void 0:v.call($,O)}function al(O,$){var at=this.__data__;return this.size+=this.has(O)?0:1,at[O]=va&&$===void 0?r:$,this}Ti.prototype.clear=nl,Ti.prototype.delete=rl,Ti.prototype.get=yr,Ti.prototype.has=il,Ti.prototype.set=al;function oi(O){var $=-1,at=O==null?0:O.length;for(this.clear();++$<at;){var ae=O[$];this.set(ae[0],ae[1])}}function ef(){this.__data__=[],this.size=0}function sl(O){var $=this.__data__,at=Yi($,O);if(at<0)return!1;var ae=$.length-1;return at==ae?$.pop():hr.call($,at,1),--this.size,!0}function nf(O){var $=this.__data__,at=Yi($,O);return at<0?void 0:$[at][1]}function ol(O){return Yi(this.__data__,O)>-1}function fl(O,$){var at=this.__data__,ae=Yi(at,O);return ae<0?(++this.size,at.push([O,$])):at[ae][1]=$,this}oi.prototype.clear=ef,oi.prototype.delete=sl,oi.prototype.get=nf,oi.prototype.has=ol,oi.prototype.set=fl;function Vi(O){var $=-1,at=O==null?0:O.length;for(this.clear();++$<at;){var ae=O[$];this.set(ae[0],ae[1])}}function gu(){this.size=0,this.__data__={hash:new Ti,map:new(tf||oi),string:new Ti}}function Fn(O){var $=Ii(this,O).delete(O);return this.size-=$?1:0,$}function ul(O){return Ii(this,O).get(O)}function cl(O){return Ii(this,O).has(O)}function ll(O,$){var at=Ii(this,O),ae=at.size;return at.set(O,$),this.size+=at.size==ae?0:1,this}Vi.prototype.clear=gu,Vi.prototype.delete=Fn,Vi.prototype.get=ul,Vi.prototype.has=cl,Vi.prototype.set=ll;function Wi(O){var $=this.__data__=new oi(O);this.size=$.size}function hl(){this.__data__=new oi,this.size=0}function dl(O){var $=this.__data__,at=$.delete(O);return this.size=$.size,at}function _l(O){return this.__data__.get(O)}function pl(O){return this.__data__.has(O)}function ml(O,$){var at=this.__data__;if(at instanceof oi){var ae=at.__data__;if(!tf||ae.length<e-1)return ae.push([O,$]),this.size=++at.size,this;at=this.__data__=new Vi(ae)}return at.set(O,$),this.size=at.size,this}Wi.prototype.clear=hl,Wi.prototype.delete=dl,Wi.prototype.get=_l,Wi.prototype.has=pl,Wi.prototype.set=ml;function gl(O,$){var at=df(O),ae=!at&&fs(O),Ke=!at&&!ae&&Ou(O),_n=!at&&!ae&&!Ke&&Ru(O),Le=at||ae||Ke||_n,We=Le?Mr(O.length,String):[],hn=We.length;for(var Or in O)($||v.call(O,Or))&&!(Le&&(Or=="length"||Ke&&(Or=="offset"||Or=="parent")||_n&&(Or=="buffer"||Or=="byteLength"||Or=="byteOffset")||Eu(Or,hn)))&&We.push(Or);return We}function wa(O,$,at){(at!==void 0&&!ho(O[$],at)||at===void 0&&!($ in O))&&rf(O,$,at)}function bl(O,$,at){var ae=O[$];(!(v.call(O,$)&&ho(ae,at))||at===void 0&&!($ in O))&&rf(O,$,at)}function Yi(O,$){for(var at=O.length;at--;)if(ho(O[at][0],$))return at;return-1}function rf(O,$,at){$=="__proto__"&&ji?ji(O,$,{configurable:!0,enumerable:!0,value:at,writable:!0}):O[$]=at}var yl=Au();function fo(O){return O==null?O===void 0?be:Mt:kr&&kr in Object(O)?ff(O):os(O)}function af(O){return us(O)&&fo(O)==c}function bu(O){if(!fi(O)||cf(O))return!1;var $=_f(O)?rs:de;return $.test(Iu(O))}function yu(O){return us(O)&&Bu(O.length)&&!!ye[fo(O)]}function vl(O){if(!fi(O))return vr(O);var $=Jn(O),at=[];for(var ae in O)ae=="constructor"&&($||!v.call(O,ae))||at.push(ae);return at}function vu(O,$,at,ae,Ke){O!==$&&yl($,function(_n,Le){if(Ke||(Ke=new Wi),fi(_n))wl(O,$,Le,at,vu,ae,Ke);else{var We=ae?ae(lo(O,Le),_n,Le+"",O,$,Ke):void 0;We===void 0&&(We=_n),wa(O,Le,We)}},cs)}function wl(O,$,at,ae,Ke,_n,Le){var We=lo(O,at),hn=lo($,at),Or=Le.get(hn);if(Or){wa(O,at,Or);return}var dr=_n?_n(We,hn,at+"",O,$,Le):void 0,ar=dr===void 0;if(ar){var po=df(hn),Pr=!po&&Ou(hn),mf=!po&&!Pr&&Ru(hn);dr=hn,po||Pr||mf?df(We)?dr=We:Al(We)?dr=uo(We):Pr?(ar=!1,dr=xu(hn,!0)):mf?(ar=!1,dr=sf(hn,!0)):dr=[]:Hi(hn)||fs(hn)?(dr=We,fs(We)?dr=El(We):(!fi(We)||_f(We))&&(dr=ss(hn))):ar=!1}ar&&(Le.set(hn,dr),Ke(dr,hn,ae,_n,Le),Le.delete(hn)),wa(O,at,dr)}function xl(O,$){return lf(Sl(O,$,pf),O+"")}var wu=ji?function(O,$){return ji(O,"toString",{configurable:!0,enumerable:!1,value:bn($),writable:!0})}:pf;function xu(O,$){if($)return O.slice();var at=O.length,ae=as?as(at):new O.constructor(at);return O.copy(ae),ae}function Su(O){var $=new O.constructor(O.byteLength);return new Ei($).set(new Ei(O)),$}function sf(O,$){var at=$?Su(O.buffer):O.buffer;return new O.constructor(at,O.byteOffset,O.length)}function uo(O,$){var at=-1,ae=O.length;for($||($=Array(ae));++at<ae;)$[at]=O[at];return $}function of(O,$,at,ae){var Ke=!at;at||(at={});for(var _n=-1,Le=$.length;++_n<Le;){var We=$[_n],hn=ae?ae(at[We],O[We],We,at,O):void 0;hn===void 0&&(hn=O[We]),Ke?rf(at,We,hn):bl(at,We,hn)}return at}function co(O){return xl(function($,at){var ae=-1,Ke=at.length,_n=Ke>1?at[Ke-1]:void 0,Le=Ke>2?at[2]:void 0;for(_n=O.length>3&&typeof _n=="function"?(Ke--,_n):void 0,Le&&Tu(at[0],at[1],Le)&&(_n=Ke<3?void 0:_n,Ke=1),$=Object($);++ae<Ke;){var We=at[ae];We&&O($,We,ae,_n)}return $})}function Au(O){return function($,at,ae){for(var Ke=-1,_n=Object($),Le=ae($),We=Le.length;We--;){var hn=Le[O?We:++Ke];if(at(_n[hn],hn,_n)===!1)break}return $}}function Ii(O,$){var at=O.__data__;return uf($)?at[typeof $=="string"?"string":"hash"]:at.map}function xa(O,$){var at=hu(O,$);return bu(at)?at:void 0}function ff(O){var $=v.call(O,kr),at=O[kr];try{O[kr]=void 0;var ae=!0}catch{}var Ke=ya.call(O);return ae&&($?O[kr]=at:delete O[kr]),Ke}function ss(O){return typeof O.constructor=="function"&&!Jn(O)?mu(ao(O)):{}}function Eu(O,$){var at=typeof O;return $=$??f,!!$&&(at=="number"||at!="symbol"&&Te.test(O))&&O>-1&&O%1==0&&O<$}function Tu(O,$,at){if(!fi(at))return!1;var ae=typeof $;return(ae=="number"?_o(at)&&Eu($,at.length):ae=="string"&&$ in at)?ho(at[$],O):!1}function uf(O){var $=typeof O;return $=="string"||$=="number"||$=="symbol"||$=="boolean"?O!=="__proto__":O===null}function cf(O){return!!_u&&_u in O}function Jn(O){var $=O&&O.constructor,at=typeof $=="function"&&$.prototype||Cr;return O===at}function vr(O){var $=[];if(O!=null)for(var at in Object(O))$.push(at);return $}function os(O){return ya.call(O)}function Sl(O,$,at){return $=pu($===void 0?O.length-1:$,0),function(){for(var ae=arguments,Ke=-1,_n=pu(ae.length-$,0),Le=Array(_n);++Ke<_n;)Le[Ke]=ae[$+Ke];Ke=-1;for(var We=Array($+1);++Ke<$;)We[Ke]=ae[Ke];return We[$]=at(Le),Qo(O,this,We)}}function lo(O,$){if(!($==="constructor"&&typeof O[$]=="function")&&$!="__proto__")return O[$]}var lf=hf(wu);function hf(O){var $=0,at=0;return function(){var ae=el(),Ke=o-(ae-at);if(at=ae,Ke>0){if(++$>=a)return arguments[0]}else $=0;return O.apply(void 0,arguments)}}function Iu(O){if(O!=null){try{return Ai.call(O)}catch{}try{return O+""}catch{}}return""}function ho(O,$){return O===$||O!==O&&$!==$}var fs=af(function(){return arguments}())?af:function(O){return us(O)&&v.call(O,"callee")&&!oo.call(O,"callee")},df=Array.isArray;function _o(O){return O!=null&&Bu(O.length)&&!_f(O)}function Al(O){return us(O)&&_o(O)}var Ou=tl||Tl;function _f(O){if(!fi(O))return!1;var $=fo(O);return $==C||$==G||$==_||$==Xt}function Bu(O){return typeof O=="number"&&O>-1&&O%1==0&&O<=f}function fi(O){var $=typeof O;return O!=null&&($=="object"||$=="function")}function us(O){return O!=null&&typeof O=="object"}function Hi(O){if(!us(O)||fo(O)!=ie)return!1;var $=ao(O);if($===null)return!0;var at=v.call($,"constructor")&&$.constructor;return typeof at=="function"&&at instanceof at&&Ai.call(at)==Qc}var Ru=Yr?ba(Yr):yu;function El(O){return of(O,cs(O))}function cs(O){return _o(O)?gl(O,!0):vl(O)}var gn=co(function(O,$,at){vu(O,$,at)});function bn(O){return function(){return O}}function pf(O){return O}function Tl(){return!1}n.exports=gn})(W4,O_);var kc=0,Th=0,bh=0,qy=1e3,B_,Ih,R_=0,ou=0,mp=0,Dh=typeof performance=="object"&&performance.now?performance:Date,Zy=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function V0(){return ou||(Zy(Y4),ou=Dh.now()+mp)}function Y4(){ou=0}function M_(){this._call=this._time=this._next=null}M_.prototype=Wh.prototype={constructor:M_,restart:function(n,t,e){if(typeof n!="function")throw new TypeError("callback is not a function");e=(e==null?V0():+e)+(t==null?0:+t),!this._next&&Ih!==this&&(Ih?Ih._next=this:B_=this,Ih=this),this._call=n,this._time=e,d0()},stop:function(){this._call&&(this._call=null,this._time=1/0,d0())}};function Wh(n,t,e){var r=new M_;return r.restart(n,t,e),r}function H4(){V0(),++kc;for(var n=B_,t;n;)(t=ou-n._time)>=0&&n._call.call(void 0,t),n=n._next;--kc}function wb(){ou=(R_=Dh.now())+mp,kc=Th=0;try{H4()}finally{kc=0,q4(),ou=0}}function X4(){var n=Dh.now(),t=n-R_;t>qy&&(mp-=t,R_=n)}function q4(){for(var n,t=B_,e,r=1/0;t;)t._call?(r>t._time&&(r=t._time),n=t,t=t._next):(e=t._next,t._next=null,t=n?n._next=e:B_=e);Ih=n,d0(r)}function d0(n){if(!kc){Th&&(Th=clearTimeout(Th));var t=n-ou;t>24?(n<1/0&&(Th=setTimeout(wb,n-Dh.now()-mp)),bh&&(bh=clearInterval(bh))):(bh||(R_=Dh.now(),bh=setInterval(X4,qy)),kc=1,Zy(wb))}}function xb(n,t,e){var r=new M_;return t=t==null?0:+t,r.restart(a=>{r.stop(),n(a+t)},t,e),r}var Z4={value:()=>{}};function gp(){for(var n=0,t=arguments.length,e={},r;n<t;++n){if(!(r=arguments[n]+"")||r in e||/[\s.]/.test(r))throw new Error("illegal type: "+r);e[r]=[]}return new o_(e)}function o_(n){this._=n}function K4(n,t){return n.trim().split(/^|\s+/).map(function(e){var r="",a=e.indexOf(".");if(a>=0&&(r=e.slice(a+1),e=e.slice(0,a)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}o_.prototype=gp.prototype={constructor:o_,on:function(n,t){var e=this._,r=K4(n+"",e),a,o=-1,f=r.length;if(arguments.length<2){for(;++o<f;)if((a=(n=r[o]).type)&&(a=J4(e[a],n.name)))return a;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<f;)if(a=(n=r[o]).type)e[a]=Sb(e[a],n.name,t);else if(t==null)for(a in e)e[a]=Sb(e[a],n.name,null);return this},copy:function(){var n={},t=this._;for(var e in t)n[e]=t[e].slice();return new o_(n)},call:function(n,t){if((a=arguments.length-2)>0)for(var e=new Array(a),r=0,a,o;r<a;++r)e[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(o=this._[n],r=0,a=o.length;r<a;++r)o[r].value.apply(t,e)},apply:function(n,t,e){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],a=0,o=r.length;a<o;++a)r[a].value.apply(t,e)}};function J4(n,t){for(var e=0,r=n.length,a;e<r;++e)if((a=n[e]).name===t)return a.value}function Sb(n,t,e){for(var r=0,a=n.length;r<a;++r)if(n[r].name===t){n[r]=Z4,n=n.slice(0,r).concat(n.slice(r+1));break}return e!=null&&n.push({name:t,value:e}),n}const Q4={passive:!1},Fh={capture:!0,passive:!1};function km(n){n.stopImmediatePropagation()}function Ac(n){n.preventDefault(),n.stopImmediatePropagation()}function Ky(n){var t=n.document.documentElement,e=Wn(n).on("dragstart.drag",Ac,Fh);"onselectstart"in t?e.on("selectstart.drag",Ac,Fh):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Jy(n,t){var e=n.document.documentElement,r=Wn(n).on("dragstart.drag",null);t&&(r.on("click.drag",Ac,Fh),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in e?r.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}const Xd=n=>()=>n;function _0(n,{sourceEvent:t,subject:e,target:r,identifier:a,active:o,x:f,y:c,dx:l,dy:_,dispatch:m}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:e,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:f,enumerable:!0,configurable:!0},y:{value:c,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:_,enumerable:!0,configurable:!0},_:{value:m}})}_0.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function t5(n){return!n.ctrlKey&&!n.button}function e5(){return this.parentNode}function n5(n,t){return t??{x:n.x,y:n.y}}function r5(){return navigator.maxTouchPoints||"ontouchstart"in this}function i5(){var n=t5,t=e5,e=n5,r=r5,a={},o=gp("start","drag","end"),f=0,c,l,_,m,A=0;function R(it){it.on("mousedown.drag",C).filter(r).on("touchstart.drag",Kt).on("touchmove.drag",Mt,Q4).on("touchend.drag touchcancel.drag",ie).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function C(it,Ct){if(!(m||!n.call(this,it,Ct))){var fe=Xt(this,t.call(this,it,Ct),it,Ct,"mouse");fe&&(Wn(it.view).on("mousemove.drag",G,Fh).on("mouseup.drag",$t,Fh),Ky(it.view),km(it),_=!1,c=it.clientX,l=it.clientY,fe("start",it))}}function G(it){if(Ac(it),!_){var Ct=it.clientX-c,fe=it.clientY-l;_=Ct*Ct+fe*fe>A}a.mouse("drag",it)}function $t(it){Wn(it.view).on("mousemove.drag mouseup.drag",null),Jy(it.view,_),Ac(it),a.mouse("end",it)}function Kt(it,Ct){if(n.call(this,it,Ct)){var fe=it.changedTouches,be=t.call(this,it,Ct),sn=fe.length,st,Y;for(st=0;st<sn;++st)(Y=Xt(this,be,it,Ct,fe[st].identifier,fe[st]))&&(km(it),Y("start",it,fe[st]))}}function Mt(it){var Ct=it.changedTouches,fe=Ct.length,be,sn;for(be=0;be<fe;++be)(sn=a[Ct[be].identifier])&&(Ac(it),sn("drag",it,Ct[be]))}function ie(it){var Ct=it.changedTouches,fe=Ct.length,be,sn;for(m&&clearTimeout(m),m=setTimeout(function(){m=null},500),be=0;be<fe;++be)(sn=a[Ct[be].identifier])&&(km(it),sn("end",it,Ct[be]))}function Xt(it,Ct,fe,be,sn,st){var Y=o.copy(),rt=js(st||fe,Ct),Bt,Dt,F;if((F=e.call(it,new _0("beforestart",{sourceEvent:fe,target:R,identifier:sn,active:f,x:rt[0],y:rt[1],dx:0,dy:0,dispatch:Y}),be))!=null)return Bt=F.x-rt[0]||0,Dt=F.y-rt[1]||0,function ft(H,bt,Lt){var Jt=rt,ee;switch(H){case"start":a[sn]=ft,ee=f++;break;case"end":delete a[sn],--f;case"drag":rt=js(Lt||bt,Ct),ee=f;break}Y.call(H,it,new _0(H,{sourceEvent:bt,subject:F,target:R,identifier:sn,active:ee,x:rt[0]+Bt,y:rt[1]+Dt,dx:rt[0]-Jt[0],dy:rt[1]-Jt[1],dispatch:Y}),be)}}return R.filter=function(it){return arguments.length?(n=typeof it=="function"?it:Xd(!!it),R):n},R.container=function(it){return arguments.length?(t=typeof it=="function"?it:Xd(it),R):t},R.subject=function(it){return arguments.length?(e=typeof it=="function"?it:Xd(it),R):e},R.touchable=function(it){return arguments.length?(r=typeof it=="function"?it:Xd(!!it),R):r},R.on=function(){var it=o.on.apply(o,arguments);return it===o?R:it},R.clickDistance=function(it){return arguments.length?(A=(it=+it)*it,R):Math.sqrt(A)},R}function bp(n,t,e){n.prototype=t.prototype=e,e.constructor=n}function W0(n,t){var e=Object.create(n.prototype);for(var r in t)e[r]=t[r];return e}function Zc(){}var fu=.7,Pc=1/fu,Ec="\\s*([+-]?\\d+)\\s*",Ch="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ja="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",a5=/^#([0-9a-f]{3,8})$/,s5=new RegExp(`^rgb\\(${Ec},${Ec},${Ec}\\)$`),o5=new RegExp(`^rgb\\(${Ja},${Ja},${Ja}\\)$`),f5=new RegExp(`^rgba\\(${Ec},${Ec},${Ec},${Ch}\\)$`),u5=new RegExp(`^rgba\\(${Ja},${Ja},${Ja},${Ch}\\)$`),c5=new RegExp(`^hsl\\(${Ch},${Ja},${Ja}\\)$`),l5=new RegExp(`^hsla\\(${Ch},${Ja},${Ja},${Ch}\\)$`),Ab={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};bp(Zc,uu,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Eb,formatHex:Eb,formatHex8:h5,formatHsl:d5,formatRgb:Tb,toString:Tb});function Eb(){return this.rgb().formatHex()}function h5(){return this.rgb().formatHex8()}function d5(){return tv(this).formatHsl()}function Tb(){return this.rgb().formatRgb()}function uu(n){var t,e;return n=(n+"").trim().toLowerCase(),(t=a5.exec(n))?(e=t[1].length,t=parseInt(t[1],16),e===6?Ib(t):e===3?new Dr(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?qd(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?qd(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=s5.exec(n))?new Dr(t[1],t[2],t[3],1):(t=o5.exec(n))?new Dr(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=f5.exec(n))?qd(t[1],t[2],t[3],t[4]):(t=u5.exec(n))?qd(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=c5.exec(n))?Rb(t[1],t[2]/100,t[3]/100,1):(t=l5.exec(n))?Rb(t[1],t[2]/100,t[3]/100,t[4]):Ab.hasOwnProperty(n)?Ib(Ab[n]):n==="transparent"?new Dr(NaN,NaN,NaN,0):null}function Ib(n){return new Dr(n>>16&255,n>>8&255,n&255,1)}function qd(n,t,e,r){return r<=0&&(n=t=e=NaN),new Dr(n,t,e,r)}function Qy(n){return n instanceof Zc||(n=uu(n)),n?(n=n.rgb(),new Dr(n.r,n.g,n.b,n.opacity)):new Dr}function Qs(n,t,e,r){return arguments.length===1?Qy(n):new Dr(n,t,e,r??1)}function Dr(n,t,e,r){this.r=+n,this.g=+t,this.b=+e,this.opacity=+r}bp(Dr,Qs,W0(Zc,{brighter(n){return n=n==null?Pc:Math.pow(Pc,n),new Dr(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?fu:Math.pow(fu,n),new Dr(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Dr(ru(this.r),ru(this.g),ru(this.b),L_(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ob,formatHex:Ob,formatHex8:_5,formatRgb:Bb,toString:Bb}));function Ob(){return`#${qf(this.r)}${qf(this.g)}${qf(this.b)}`}function _5(){return`#${qf(this.r)}${qf(this.g)}${qf(this.b)}${qf((isNaN(this.opacity)?1:this.opacity)*255)}`}function Bb(){const n=L_(this.opacity);return`${n===1?"rgb(":"rgba("}${ru(this.r)}, ${ru(this.g)}, ${ru(this.b)}${n===1?")":`, ${n})`}`}function L_(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function ru(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function qf(n){return n=ru(n),(n<16?"0":"")+n.toString(16)}function Rb(n,t,e,r){return r<=0?n=t=e=NaN:e<=0||e>=1?n=t=NaN:t<=0&&(n=NaN),new la(n,t,e,r)}function tv(n){if(n instanceof la)return new la(n.h,n.s,n.l,n.opacity);if(n instanceof Zc||(n=uu(n)),!n)return new la;if(n instanceof la)return n;n=n.rgb();var t=n.r/255,e=n.g/255,r=n.b/255,a=Math.min(t,e,r),o=Math.max(t,e,r),f=NaN,c=o-a,l=(o+a)/2;return c?(t===o?f=(e-r)/c+(e<r)*6:e===o?f=(r-t)/c+2:f=(t-e)/c+4,c/=l<.5?o+a:2-o-a,f*=60):c=l>0&&l<1?0:f,new la(f,c,l,n.opacity)}function p5(n,t,e,r){return arguments.length===1?tv(n):new la(n,t,e,r??1)}function la(n,t,e,r){this.h=+n,this.s=+t,this.l=+e,this.opacity=+r}bp(la,p5,W0(Zc,{brighter(n){return n=n==null?Pc:Math.pow(Pc,n),new la(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?fu:Math.pow(fu,n),new la(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,t=isNaN(n)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*t,a=2*e-r;return new Dr(Pm(n>=240?n-240:n+120,a,r),Pm(n,a,r),Pm(n<120?n+240:n-120,a,r),this.opacity)},clamp(){return new la(Mb(this.h),Zd(this.s),Zd(this.l),L_(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=L_(this.opacity);return`${n===1?"hsl(":"hsla("}${Mb(this.h)}, ${Zd(this.s)*100}%, ${Zd(this.l)*100}%${n===1?")":`, ${n})`}`}}));function Mb(n){return n=(n||0)%360,n<0?n+360:n}function Zd(n){return Math.max(0,Math.min(1,n||0))}function Pm(n,t,e){return(n<60?t+(e-t)*n/60:n<180?e:n<240?t+(e-t)*(240-n)/60:t)*255}const m5=Math.PI/180,g5=180/Math.PI;var ev=-.14861,Y0=1.78277,H0=-.29227,yp=-.90649,kh=1.97294,Lb=kh*yp,Nb=kh*Y0,Db=Y0*H0-yp*ev;function b5(n){if(n instanceof iu)return new iu(n.h,n.s,n.l,n.opacity);n instanceof Dr||(n=Qy(n));var t=n.r/255,e=n.g/255,r=n.b/255,a=(Db*r+Lb*t-Nb*e)/(Db+Lb-Nb),o=r-a,f=(kh*(e-a)-H0*o)/yp,c=Math.sqrt(f*f+o*o)/(kh*a*(1-a)),l=c?Math.atan2(f,o)*g5-120:NaN;return new iu(l<0?l+360:l,c,a,n.opacity)}function Qa(n,t,e,r){return arguments.length===1?b5(n):new iu(n,t,e,r??1)}function iu(n,t,e,r){this.h=+n,this.s=+t,this.l=+e,this.opacity=+r}bp(iu,Qa,W0(Zc,{brighter(n){return n=n==null?Pc:Math.pow(Pc,n),new iu(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?fu:Math.pow(fu,n),new iu(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=isNaN(this.h)?0:(this.h+120)*m5,t=+this.l,e=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(n),a=Math.sin(n);return new Dr(255*(t+e*(ev*r+Y0*a)),255*(t+e*(H0*r+yp*a)),255*(t+e*(kh*r)),this.opacity)}}));function y5(n,t,e,r,a){var o=n*n,f=o*n;return((1-3*n+3*o-f)*t+(4-6*o+3*f)*e+(1+3*n+3*o-3*f)*r+f*a)/6}function v5(n){var t=n.length-1;return function(e){var r=e<=0?e=0:e>=1?(e=1,t-1):Math.floor(e*t),a=n[r],o=n[r+1],f=r>0?n[r-1]:2*a-o,c=r<t-1?n[r+2]:2*o-a;return y5((e-r/t)*t,f,a,o,c)}}const vp=n=>()=>n;function nv(n,t){return function(e){return n+e*t}}function w5(n,t,e){return n=Math.pow(n,e),t=Math.pow(t,e)-n,e=1/e,function(r){return Math.pow(n+r*t,e)}}function x5(n,t){var e=t-n;return e?nv(n,e>180||e<-180?e-360*Math.round(e/360):e):vp(isNaN(n)?t:n)}function S5(n){return(n=+n)==1?Tc:function(t,e){return e-t?w5(t,e,n):vp(isNaN(t)?e:t)}}function Tc(n,t){var e=t-n;return e?nv(n,e):vp(isNaN(n)?t:n)}const N_=function n(t){var e=S5(t);function r(a,o){var f=e((a=Qs(a)).r,(o=Qs(o)).r),c=e(a.g,o.g),l=e(a.b,o.b),_=Tc(a.opacity,o.opacity);return function(m){return a.r=f(m),a.g=c(m),a.b=l(m),a.opacity=_(m),a+""}}return r.gamma=n,r}(1);function A5(n){return function(t){var e=t.length,r=new Array(e),a=new Array(e),o=new Array(e),f,c;for(f=0;f<e;++f)c=Qs(t[f]),r[f]=c.r||0,a[f]=c.g||0,o[f]=c.b||0;return r=n(r),a=n(a),o=n(o),c.opacity=1,function(l){return c.r=r(l),c.g=a(l),c.b=o(l),c+""}}}var E5=A5(v5);function T5(n,t){t||(t=[]);var e=n?Math.min(t.length,n.length):0,r=t.slice(),a;return function(o){for(a=0;a<e;++a)r[a]=n[a]*(1-o)+t[a]*o;return r}}function I5(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function O5(n,t){var e=t?t.length:0,r=n?Math.min(e,n.length):0,a=new Array(r),o=new Array(e),f;for(f=0;f<r;++f)a[f]=wp(n[f],t[f]);for(;f<e;++f)o[f]=t[f];return function(c){for(f=0;f<r;++f)o[f]=a[f](c);return o}}function B5(n,t){var e=new Date;return n=+n,t=+t,function(r){return e.setTime(n*(1-r)+t*r),e}}function fa(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function R5(n,t){var e={},r={},a;(n===null||typeof n!="object")&&(n={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in n?e[a]=wp(n[a],t[a]):r[a]=t[a];return function(o){for(a in e)r[a]=e[a](o);return r}}var p0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zm=new RegExp(p0.source,"g");function M5(n){return function(){return n}}function L5(n){return function(t){return n(t)+""}}function rv(n,t){var e=p0.lastIndex=zm.lastIndex=0,r,a,o,f=-1,c=[],l=[];for(n=n+"",t=t+"";(r=p0.exec(n))&&(a=zm.exec(t));)(o=a.index)>e&&(o=t.slice(e,o),c[f]?c[f]+=o:c[++f]=o),(r=r[0])===(a=a[0])?c[f]?c[f]+=a:c[++f]=a:(c[++f]=null,l.push({i:f,x:fa(r,a)})),e=zm.lastIndex;return e<t.length&&(o=t.slice(e),c[f]?c[f]+=o:c[++f]=o),c.length<2?l[0]?L5(l[0].x):M5(t):(t=l.length,function(_){for(var m=0,A;m<t;++m)c[(A=l[m]).i]=A.x(_);return c.join("")})}function wp(n,t){var e=typeof t,r;return t==null||e==="boolean"?vp(t):(e==="number"?fa:e==="string"?(r=uu(t))?(t=r,N_):rv:t instanceof uu?N_:t instanceof Date?B5:I5(t)?T5:Array.isArray(t)?O5:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?R5:fa)(n,t)}function iv(n,t){return n=+n,t=+t,function(e){return Math.round(n*(1-e)+t*e)}}var Fb=180/Math.PI,m0={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function av(n,t,e,r,a,o){var f,c,l;return(f=Math.sqrt(n*n+t*t))&&(n/=f,t/=f),(l=n*e+t*r)&&(e-=n*l,r-=t*l),(c=Math.sqrt(e*e+r*r))&&(e/=c,r/=c,l/=c),n*r<t*e&&(n=-n,t=-t,l=-l,f=-f),{translateX:a,translateY:o,rotate:Math.atan2(t,n)*Fb,skewX:Math.atan(l)*Fb,scaleX:f,scaleY:c}}var Kd;function N5(n){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return t.isIdentity?m0:av(t.a,t.b,t.c,t.d,t.e,t.f)}function D5(n){return n==null||(Kd||(Kd=document.createElementNS("http://www.w3.org/2000/svg","g")),Kd.setAttribute("transform",n),!(n=Kd.transform.baseVal.consolidate()))?m0:(n=n.matrix,av(n.a,n.b,n.c,n.d,n.e,n.f))}function sv(n,t,e,r){function a(_){return _.length?_.pop()+" ":""}function o(_,m,A,R,C,G){if(_!==A||m!==R){var $t=C.push("translate(",null,t,null,e);G.push({i:$t-4,x:fa(_,A)},{i:$t-2,x:fa(m,R)})}else(A||R)&&C.push("translate("+A+t+R+e)}function f(_,m,A,R){_!==m?(_-m>180?m+=360:m-_>180&&(_+=360),R.push({i:A.push(a(A)+"rotate(",null,r)-2,x:fa(_,m)})):m&&A.push(a(A)+"rotate("+m+r)}function c(_,m,A,R){_!==m?R.push({i:A.push(a(A)+"skewX(",null,r)-2,x:fa(_,m)}):m&&A.push(a(A)+"skewX("+m+r)}function l(_,m,A,R,C,G){if(_!==A||m!==R){var $t=C.push(a(C)+"scale(",null,",",null,")");G.push({i:$t-4,x:fa(_,A)},{i:$t-2,x:fa(m,R)})}else(A!==1||R!==1)&&C.push(a(C)+"scale("+A+","+R+")")}return function(_,m){var A=[],R=[];return _=n(_),m=n(m),o(_.translateX,_.translateY,m.translateX,m.translateY,A,R),f(_.rotate,m.rotate,A,R),c(_.skewX,m.skewX,A,R),l(_.scaleX,_.scaleY,m.scaleX,m.scaleY,A,R),_=m=null,function(C){for(var G=-1,$t=R.length,Kt;++G<$t;)A[(Kt=R[G]).i]=Kt.x(C);return A.join("")}}}var F5=sv(N5,"px, ","px)","deg)"),C5=sv(D5,", ",")",")"),k5=1e-12;function Cb(n){return((n=Math.exp(n))+1/n)/2}function P5(n){return((n=Math.exp(n))-1/n)/2}function z5(n){return((n=Math.exp(2*n))-1)/(n+1)}const U5=function n(t,e,r){function a(o,f){var c=o[0],l=o[1],_=o[2],m=f[0],A=f[1],R=f[2],C=m-c,G=A-l,$t=C*C+G*G,Kt,Mt;if($t<k5)Mt=Math.log(R/_)/t,Kt=function(be){return[c+be*C,l+be*G,_*Math.exp(t*be*Mt)]};else{var ie=Math.sqrt($t),Xt=(R*R-_*_+r*$t)/(2*_*e*ie),it=(R*R-_*_-r*$t)/(2*R*e*ie),Ct=Math.log(Math.sqrt(Xt*Xt+1)-Xt),fe=Math.log(Math.sqrt(it*it+1)-it);Mt=(fe-Ct)/t,Kt=function(be){var sn=be*Mt,st=Cb(Ct),Y=_/(e*ie)*(st*z5(t*sn+Ct)-P5(Ct));return[c+Y*C,l+Y*G,_*st/Cb(t*sn+Ct)]}}return Kt.duration=Mt*1e3*t/Math.SQRT2,Kt}return a.rho=function(o){var f=Math.max(.001,+o),c=f*f,l=c*c;return n(f,c,l)},a}(Math.SQRT2,2,4);function ov(n){return function t(e){e=+e;function r(a,o){var f=n((a=Qa(a)).h,(o=Qa(o)).h),c=Tc(a.s,o.s),l=Tc(a.l,o.l),_=Tc(a.opacity,o.opacity);return function(m){return a.h=f(m),a.s=c(m),a.l=l(Math.pow(m,e)),a.opacity=_(m),a+""}}return r.gamma=t,r}(1)}ov(x5);var X0=ov(Tc),G5=gp("start","end","cancel","interrupt"),$5=[],fv=0,kb=1,g0=2,f_=3,Pb=4,b0=5,u_=6;function xp(n,t,e,r,a,o){var f=n.__transition;if(!f)n.__transition={};else if(e in f)return;j5(n,e,{name:t,index:r,group:a,on:G5,tween:$5,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:fv})}function q0(n,t){var e=ma(n,t);if(e.state>fv)throw new Error("too late; already scheduled");return e}function ns(n,t){var e=ma(n,t);if(e.state>f_)throw new Error("too late; already running");return e}function ma(n,t){var e=n.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function j5(n,t,e){var r=n.__transition,a;r[t]=e,e.timer=Wh(o,0,e.time);function o(_){e.state=kb,e.timer.restart(f,e.delay,e.time),e.delay<=_&&f(_-e.delay)}function f(_){var m,A,R,C;if(e.state!==kb)return l();for(m in r)if(C=r[m],C.name===e.name){if(C.state===f_)return xb(f);C.state===Pb?(C.state=u_,C.timer.stop(),C.on.call("interrupt",n,n.__data__,C.index,C.group),delete r[m]):+m<t&&(C.state=u_,C.timer.stop(),C.on.call("cancel",n,n.__data__,C.index,C.group),delete r[m])}if(xb(function(){e.state===f_&&(e.state=Pb,e.timer.restart(c,e.delay,e.time),c(_))}),e.state=g0,e.on.call("start",n,n.__data__,e.index,e.group),e.state===g0){for(e.state=f_,a=new Array(R=e.tween.length),m=0,A=-1;m<R;++m)(C=e.tween[m].value.call(n,n.__data__,e.index,e.group))&&(a[++A]=C);a.length=A+1}}function c(_){for(var m=_<e.duration?e.ease.call(null,_/e.duration):(e.timer.restart(l),e.state=b0,1),A=-1,R=a.length;++A<R;)a[A].call(n,m);e.state===b0&&(e.on.call("end",n,n.__data__,e.index,e.group),l())}function l(){e.state=u_,e.timer.stop(),delete r[t];for(var _ in r)return;delete n.__transition}}function c_(n,t){var e=n.__transition,r,a,o=!0,f;if(e){t=t==null?null:t+"";for(f in e){if((r=e[f]).name!==t){o=!1;continue}a=r.state>g0&&r.state<b0,r.state=u_,r.timer.stop(),r.on.call(a?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete e[f]}o&&delete n.__transition}}function V5(n){return this.each(function(){c_(this,n)})}function W5(n,t){var e,r;return function(){var a=ns(this,n),o=a.tween;if(o!==e){r=e=o;for(var f=0,c=r.length;f<c;++f)if(r[f].name===t){r=r.slice(),r.splice(f,1);break}}a.tween=r}}function Y5(n,t,e){var r,a;if(typeof e!="function")throw new Error;return function(){var o=ns(this,n),f=o.tween;if(f!==r){a=(r=f).slice();for(var c={name:t,value:e},l=0,_=a.length;l<_;++l)if(a[l].name===t){a[l]=c;break}l===_&&a.push(c)}o.tween=a}}function H5(n,t){var e=this._id;if(n+="",arguments.length<2){for(var r=ma(this.node(),e).tween,a=0,o=r.length,f;a<o;++a)if((f=r[a]).name===n)return f.value;return null}return this.each((t==null?W5:Y5)(e,n,t))}function Z0(n,t,e){var r=n._id;return n.each(function(){var a=ns(this,r);(a.value||(a.value={}))[t]=e.apply(this,arguments)}),function(a){return ma(a,r).value[t]}}function uv(n,t){var e;return(typeof t=="number"?fa:t instanceof uu?N_:(e=uu(t))?(t=e,N_):rv)(n,t)}function X5(n){return function(){this.removeAttribute(n)}}function q5(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Z5(n,t,e){var r,a=e+"",o;return function(){var f=this.getAttribute(n);return f===a?null:f===r?o:o=t(r=f,e)}}function K5(n,t,e){var r,a=e+"",o;return function(){var f=this.getAttributeNS(n.space,n.local);return f===a?null:f===r?o:o=t(r=f,e)}}function J5(n,t,e){var r,a,o;return function(){var f,c=e(this),l;return c==null?void this.removeAttribute(n):(f=this.getAttribute(n),l=c+"",f===l?null:f===r&&l===a?o:(a=l,o=t(r=f,c)))}}function Q5(n,t,e){var r,a,o;return function(){var f,c=e(this),l;return c==null?void this.removeAttributeNS(n.space,n.local):(f=this.getAttributeNS(n.space,n.local),l=c+"",f===l?null:f===r&&l===a?o:(a=l,o=t(r=f,c)))}}function t8(n,t){var e=pp(n),r=e==="transform"?C5:uv;return this.attrTween(n,typeof t=="function"?(e.local?Q5:J5)(e,r,Z0(this,"attr."+n,t)):t==null?(e.local?q5:X5)(e):(e.local?K5:Z5)(e,r,t))}function e8(n,t){return function(e){this.setAttribute(n,t.call(this,e))}}function n8(n,t){return function(e){this.setAttributeNS(n.space,n.local,t.call(this,e))}}function r8(n,t){var e,r;function a(){var o=t.apply(this,arguments);return o!==r&&(e=(r=o)&&n8(n,o)),e}return a._value=t,a}function i8(n,t){var e,r;function a(){var o=t.apply(this,arguments);return o!==r&&(e=(r=o)&&e8(n,o)),e}return a._value=t,a}function a8(n,t){var e="attr."+n;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var r=pp(n);return this.tween(e,(r.local?r8:i8)(r,t))}function s8(n,t){return function(){q0(this,n).delay=+t.apply(this,arguments)}}function o8(n,t){return t=+t,function(){q0(this,n).delay=t}}function f8(n){var t=this._id;return arguments.length?this.each((typeof n=="function"?s8:o8)(t,n)):ma(this.node(),t).delay}function u8(n,t){return function(){ns(this,n).duration=+t.apply(this,arguments)}}function c8(n,t){return t=+t,function(){ns(this,n).duration=t}}function l8(n){var t=this._id;return arguments.length?this.each((typeof n=="function"?u8:c8)(t,n)):ma(this.node(),t).duration}function h8(n,t){if(typeof t!="function")throw new Error;return function(){ns(this,n).ease=t}}function d8(n){var t=this._id;return arguments.length?this.each(h8(t,n)):ma(this.node(),t).ease}function _8(n,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;ns(this,n).ease=e}}function p8(n){if(typeof n!="function")throw new Error;return this.each(_8(this._id,n))}function m8(n){typeof n!="function"&&(n=Ey(n));for(var t=this._groups,e=t.length,r=new Array(e),a=0;a<e;++a)for(var o=t[a],f=o.length,c=r[a]=[],l,_=0;_<f;++_)(l=o[_])&&n.call(l,l.__data__,_,o)&&c.push(l);return new to(r,this._parents,this._name,this._id)}function g8(n){if(n._id!==this._id)throw new Error;for(var t=this._groups,e=n._groups,r=t.length,a=e.length,o=Math.min(r,a),f=new Array(r),c=0;c<o;++c)for(var l=t[c],_=e[c],m=l.length,A=f[c]=new Array(m),R,C=0;C<m;++C)(R=l[C]||_[C])&&(A[C]=R);for(;c<r;++c)f[c]=t[c];return new to(f,this._parents,this._name,this._id)}function b8(n){return(n+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function y8(n,t,e){var r,a,o=b8(t)?q0:ns;return function(){var f=o(this,n),c=f.on;c!==r&&(a=(r=c).copy()).on(t,e),f.on=a}}function v8(n,t){var e=this._id;return arguments.length<2?ma(this.node(),e).on.on(n):this.each(y8(e,n,t))}function w8(n){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==n)return;t&&t.removeChild(this)}}function x8(){return this.on("end.remove",w8(this._id))}function S8(n){var t=this._name,e=this._id;typeof n!="function"&&(n=z0(n));for(var r=this._groups,a=r.length,o=new Array(a),f=0;f<a;++f)for(var c=r[f],l=c.length,_=o[f]=new Array(l),m,A,R=0;R<l;++R)(m=c[R])&&(A=n.call(m,m.__data__,R,c))&&("__data__"in m&&(A.__data__=m.__data__),_[R]=A,xp(_[R],t,e,R,_,ma(m,e)));return new to(o,this._parents,t,e)}function A8(n){var t=this._name,e=this._id;typeof n!="function"&&(n=Ay(n));for(var r=this._groups,a=r.length,o=[],f=[],c=0;c<a;++c)for(var l=r[c],_=l.length,m,A=0;A<_;++A)if(m=l[A]){for(var R=n.call(m,m.__data__,A,l),C,G=ma(m,e),$t=0,Kt=R.length;$t<Kt;++$t)(C=R[$t])&&xp(C,t,e,$t,R,G);o.push(R),f.push(m)}return new to(o,f,t,e)}var E8=Vh.prototype.constructor;function T8(){return new E8(this._groups,this._parents)}function I8(n,t){var e,r,a;return function(){var o=Dc(this,n),f=(this.style.removeProperty(n),Dc(this,n));return o===f?null:o===e&&f===r?a:a=t(e=o,r=f)}}function cv(n){return function(){this.style.removeProperty(n)}}function O8(n,t,e){var r,a=e+"",o;return function(){var f=Dc(this,n);return f===a?null:f===r?o:o=t(r=f,e)}}function B8(n,t,e){var r,a,o;return function(){var f=Dc(this,n),c=e(this),l=c+"";return c==null&&(l=c=(this.style.removeProperty(n),Dc(this,n))),f===l?null:f===r&&l===a?o:(a=l,o=t(r=f,c))}}function R8(n,t){var e,r,a,o="style."+t,f="end."+o,c;return function(){var l=ns(this,n),_=l.on,m=l.value[o]==null?c||(c=cv(t)):void 0;(_!==e||a!==m)&&(r=(e=_).copy()).on(f,a=m),l.on=r}}function M8(n,t,e){var r=(n+="")=="transform"?F5:uv;return t==null?this.styleTween(n,I8(n,r)).on("end.style."+n,cv(n)):typeof t=="function"?this.styleTween(n,B8(n,r,Z0(this,"style."+n,t))).each(R8(this._id,n)):this.styleTween(n,O8(n,r,t),e).on("end.style."+n,null)}function L8(n,t,e){return function(r){this.style.setProperty(n,t.call(this,r),e)}}function N8(n,t,e){var r,a;function o(){var f=t.apply(this,arguments);return f!==a&&(r=(a=f)&&L8(n,f,e)),r}return o._value=t,o}function D8(n,t,e){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,N8(n,t,e??""))}function F8(n){return function(){this.textContent=n}}function C8(n){return function(){var t=n(this);this.textContent=t??""}}function k8(n){return this.tween("text",typeof n=="function"?C8(Z0(this,"text",n)):F8(n==null?"":n+""))}function P8(n){return function(t){this.textContent=n.call(this,t)}}function z8(n){var t,e;function r(){var a=n.apply(this,arguments);return a!==e&&(t=(e=a)&&P8(a)),t}return r._value=n,r}function U8(n){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(n==null)return this.tween(t,null);if(typeof n!="function")throw new Error;return this.tween(t,z8(n))}function G8(){for(var n=this._name,t=this._id,e=lv(),r=this._groups,a=r.length,o=0;o<a;++o)for(var f=r[o],c=f.length,l,_=0;_<c;++_)if(l=f[_]){var m=ma(l,t);xp(l,n,e,_,f,{time:m.time+m.delay+m.duration,delay:0,duration:m.duration,ease:m.ease})}return new to(r,this._parents,n,e)}function $8(){var n,t,e=this,r=e._id,a=e.size();return new Promise(function(o,f){var c={value:f},l={value:function(){--a===0&&o()}};e.each(function(){var _=ns(this,r),m=_.on;m!==n&&(t=(n=m).copy(),t._.cancel.push(c),t._.interrupt.push(c),t._.end.push(l)),_.on=t}),a===0&&o()})}var j8=0;function to(n,t,e,r){this._groups=n,this._parents=t,this._name=e,this._id=r}function lv(){return++j8}var Gs=Vh.prototype;to.prototype={constructor:to,select:S8,selectAll:A8,selectChild:Gs.selectChild,selectChildren:Gs.selectChildren,filter:m8,merge:g8,selection:T8,transition:G8,call:Gs.call,nodes:Gs.nodes,node:Gs.node,size:Gs.size,empty:Gs.empty,each:Gs.each,on:v8,attr:t8,attrTween:a8,style:M8,styleTween:D8,text:k8,textTween:U8,remove:x8,tween:H5,delay:f8,duration:l8,ease:d8,easeVarying:p8,end:$8,[Symbol.iterator]:Gs[Symbol.iterator]};function V8(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var W8={time:null,delay:0,duration:250,ease:V8};function Y8(n,t){for(var e;!(e=n.__transition)||!(e=e[t]);)if(!(n=n.parentNode))throw new Error(`transition ${t} not found`);return e}function H8(n){var t,e;n instanceof to?(t=n._id,n=n._name):(t=lv(),(e=W8).time=V0(),n=n==null?null:n+"");for(var r=this._groups,a=r.length,o=0;o<a;++o)for(var f=r[o],c=f.length,l,_=0;_<c;++_)(l=f[_])&&xp(l,n,t,_,f,e||Y8(l,t));return new to(r,this._parents,n,t)}Vh.prototype.interrupt=V5;Vh.prototype.transition=H8;const Jd=n=>()=>n;function X8(n,{sourceEvent:t,target:e,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function qs(n,t,e){this.k=n,this.x=t,this.y=e}qs.prototype={constructor:qs,scale:function(n){return n===1?this:new qs(this.k*n,this.x,this.y)},translate:function(n,t){return n===0&t===0?this:new qs(this.k,this.x+this.k*n,this.y+this.k*t)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Rh=new qs(1,0,0);qs.prototype;function Um(n){n.stopImmediatePropagation()}function yh(n){n.preventDefault(),n.stopImmediatePropagation()}function q8(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function Z8(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function zb(){return this.__zoom||Rh}function K8(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function J8(){return navigator.maxTouchPoints||"ontouchstart"in this}function Q8(n,t,e){var r=n.invertX(t[0][0])-e[0][0],a=n.invertX(t[1][0])-e[1][0],o=n.invertY(t[0][1])-e[0][1],f=n.invertY(t[1][1])-e[1][1];return n.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),f>o?(o+f)/2:Math.min(0,o)||Math.max(0,f))}function tE(){var n=q8,t=Z8,e=Q8,r=K8,a=J8,o=[0,1/0],f=[[-1/0,-1/0],[1/0,1/0]],c=250,l=U5,_=gp("start","zoom","end"),m,A,R,C=500,G=150,$t=0,Kt=10;function Mt(F){F.property("__zoom",zb).on("wheel.zoom",sn,{passive:!1}).on("mousedown.zoom",st).on("dblclick.zoom",Y).filter(a).on("touchstart.zoom",rt).on("touchmove.zoom",Bt).on("touchend.zoom touchcancel.zoom",Dt).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}Mt.transform=function(F,ft,H,bt){var Lt=F.selection?F.selection():F;Lt.property("__zoom",zb),F!==Lt?Ct(F,ft,H,bt):Lt.interrupt().each(function(){fe(this,arguments).event(bt).start().zoom(null,typeof ft=="function"?ft.apply(this,arguments):ft).end()})},Mt.scaleBy=function(F,ft,H,bt){Mt.scaleTo(F,function(){var Lt=this.__zoom.k,Jt=typeof ft=="function"?ft.apply(this,arguments):ft;return Lt*Jt},H,bt)},Mt.scaleTo=function(F,ft,H,bt){Mt.transform(F,function(){var Lt=t.apply(this,arguments),Jt=this.__zoom,ee=H==null?it(Lt):typeof H=="function"?H.apply(this,arguments):H,de=Jt.invert(ee),Te=typeof ft=="function"?ft.apply(this,arguments):ft;return e(Xt(ie(Jt,Te),ee,de),Lt,f)},H,bt)},Mt.translateBy=function(F,ft,H,bt){Mt.transform(F,function(){return e(this.__zoom.translate(typeof ft=="function"?ft.apply(this,arguments):ft,typeof H=="function"?H.apply(this,arguments):H),t.apply(this,arguments),f)},null,bt)},Mt.translateTo=function(F,ft,H,bt,Lt){Mt.transform(F,function(){var Jt=t.apply(this,arguments),ee=this.__zoom,de=bt==null?it(Jt):typeof bt=="function"?bt.apply(this,arguments):bt;return e(Rh.translate(de[0],de[1]).scale(ee.k).translate(typeof ft=="function"?-ft.apply(this,arguments):-ft,typeof H=="function"?-H.apply(this,arguments):-H),Jt,f)},bt,Lt)};function ie(F,ft){return ft=Math.max(o[0],Math.min(o[1],ft)),ft===F.k?F:new qs(ft,F.x,F.y)}function Xt(F,ft,H){var bt=ft[0]-H[0]*F.k,Lt=ft[1]-H[1]*F.k;return bt===F.x&&Lt===F.y?F:new qs(F.k,bt,Lt)}function it(F){return[(+F[0][0]+ +F[1][0])/2,(+F[0][1]+ +F[1][1])/2]}function Ct(F,ft,H,bt){F.on("start.zoom",function(){fe(this,arguments).event(bt).start()}).on("interrupt.zoom end.zoom",function(){fe(this,arguments).event(bt).end()}).tween("zoom",function(){var Lt=this,Jt=arguments,ee=fe(Lt,Jt).event(bt),de=t.apply(Lt,Jt),Te=H==null?it(de):typeof H=="function"?H.apply(Lt,Jt):H,ye=Math.max(de[1][0]-de[0][0],de[1][1]-de[0][1]),Ze=Lt.__zoom,on=typeof ft=="function"?ft.apply(Lt,Jt):ft,An=l(Ze.invert(Te).concat(ye/Ze.k),on.invert(Te).concat(ye/on.k));return function(Nn){if(Nn===1)Nn=on;else{var ln=An(Nn),Dn=ye/ln[2];Nn=new qs(Dn,Te[0]-ln[0]*Dn,Te[1]-ln[1]*Dn)}ee.zoom(null,Nn)}})}function fe(F,ft,H){return!H&&F.__zooming||new be(F,ft)}function be(F,ft){this.that=F,this.args=ft,this.active=0,this.sourceEvent=null,this.extent=t.apply(F,ft),this.taps=0}be.prototype={event:function(F){return F&&(this.sourceEvent=F),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(F,ft){return this.mouse&&F!=="mouse"&&(this.mouse[1]=ft.invert(this.mouse[0])),this.touch0&&F!=="touch"&&(this.touch0[1]=ft.invert(this.touch0[0])),this.touch1&&F!=="touch"&&(this.touch1[1]=ft.invert(this.touch1[0])),this.that.__zoom=ft,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(F){var ft=Wn(this.that).datum();_.call(F,this.that,new X8(F,{sourceEvent:this.sourceEvent,target:Mt,type:F,transform:this.that.__zoom,dispatch:_}),ft)}};function sn(F,...ft){if(!n.apply(this,arguments))return;var H=fe(this,ft).event(F),bt=this.__zoom,Lt=Math.max(o[0],Math.min(o[1],bt.k*Math.pow(2,r.apply(this,arguments)))),Jt=js(F);if(H.wheel)(H.mouse[0][0]!==Jt[0]||H.mouse[0][1]!==Jt[1])&&(H.mouse[1]=bt.invert(H.mouse[0]=Jt)),clearTimeout(H.wheel);else{if(bt.k===Lt)return;H.mouse=[Jt,bt.invert(Jt)],c_(this),H.start()}yh(F),H.wheel=setTimeout(ee,G),H.zoom("mouse",e(Xt(ie(bt,Lt),H.mouse[0],H.mouse[1]),H.extent,f));function ee(){H.wheel=null,H.end()}}function st(F,...ft){if(R||!n.apply(this,arguments))return;var H=F.currentTarget,bt=fe(this,ft,!0).event(F),Lt=Wn(F.view).on("mousemove.zoom",Te,!0).on("mouseup.zoom",ye,!0),Jt=js(F,H),ee=F.clientX,de=F.clientY;Ky(F.view),Um(F),bt.mouse=[Jt,this.__zoom.invert(Jt)],c_(this),bt.start();function Te(Ze){if(yh(Ze),!bt.moved){var on=Ze.clientX-ee,An=Ze.clientY-de;bt.moved=on*on+An*An>$t}bt.event(Ze).zoom("mouse",e(Xt(bt.that.__zoom,bt.mouse[0]=js(Ze,H),bt.mouse[1]),bt.extent,f))}function ye(Ze){Lt.on("mousemove.zoom mouseup.zoom",null),Jy(Ze.view,bt.moved),yh(Ze),bt.event(Ze).end()}}function Y(F,...ft){if(n.apply(this,arguments)){var H=this.__zoom,bt=js(F.changedTouches?F.changedTouches[0]:F,this),Lt=H.invert(bt),Jt=H.k*(F.shiftKey?.5:2),ee=e(Xt(ie(H,Jt),bt,Lt),t.apply(this,ft),f);yh(F),c>0?Wn(this).transition().duration(c).call(Ct,ee,bt,F):Wn(this).call(Mt.transform,ee,bt,F)}}function rt(F,...ft){if(n.apply(this,arguments)){var H=F.touches,bt=H.length,Lt=fe(this,ft,F.changedTouches.length===bt).event(F),Jt,ee,de,Te;for(Um(F),ee=0;ee<bt;++ee)de=H[ee],Te=js(de,this),Te=[Te,this.__zoom.invert(Te),de.identifier],Lt.touch0?!Lt.touch1&&Lt.touch0[2]!==Te[2]&&(Lt.touch1=Te,Lt.taps=0):(Lt.touch0=Te,Jt=!0,Lt.taps=1+!!m);m&&(m=clearTimeout(m)),Jt&&(Lt.taps<2&&(A=Te[0],m=setTimeout(function(){m=null},C)),c_(this),Lt.start())}}function Bt(F,...ft){if(this.__zooming){var H=fe(this,ft).event(F),bt=F.changedTouches,Lt=bt.length,Jt,ee,de,Te;for(yh(F),Jt=0;Jt<Lt;++Jt)ee=bt[Jt],de=js(ee,this),H.touch0&&H.touch0[2]===ee.identifier?H.touch0[0]=de:H.touch1&&H.touch1[2]===ee.identifier&&(H.touch1[0]=de);if(ee=H.that.__zoom,H.touch1){var ye=H.touch0[0],Ze=H.touch0[1],on=H.touch1[0],An=H.touch1[1],Nn=(Nn=on[0]-ye[0])*Nn+(Nn=on[1]-ye[1])*Nn,ln=(ln=An[0]-Ze[0])*ln+(ln=An[1]-Ze[1])*ln;ee=ie(ee,Math.sqrt(Nn/ln)),de=[(ye[0]+on[0])/2,(ye[1]+on[1])/2],Te=[(Ze[0]+An[0])/2,(Ze[1]+An[1])/2]}else if(H.touch0)de=H.touch0[0],Te=H.touch0[1];else return;H.zoom("touch",e(Xt(ee,de,Te),H.extent,f))}}function Dt(F,...ft){if(this.__zooming){var H=fe(this,ft).event(F),bt=F.changedTouches,Lt=bt.length,Jt,ee;for(Um(F),R&&clearTimeout(R),R=setTimeout(function(){R=null},C),Jt=0;Jt<Lt;++Jt)ee=bt[Jt],H.touch0&&H.touch0[2]===ee.identifier?delete H.touch0:H.touch1&&H.touch1[2]===ee.identifier&&delete H.touch1;if(H.touch1&&!H.touch0&&(H.touch0=H.touch1,delete H.touch1),H.touch0)H.touch0[1]=this.__zoom.invert(H.touch0[0]);else if(H.end(),H.taps===2&&(ee=js(ee,this),Math.hypot(A[0]-ee[0],A[1]-ee[1])<Kt)){var de=Wn(this).on("dblclick.zoom");de&&de.apply(this,arguments)}}}return Mt.wheelDelta=function(F){return arguments.length?(r=typeof F=="function"?F:Jd(+F),Mt):r},Mt.filter=function(F){return arguments.length?(n=typeof F=="function"?F:Jd(!!F),Mt):n},Mt.touchable=function(F){return arguments.length?(a=typeof F=="function"?F:Jd(!!F),Mt):a},Mt.extent=function(F){return arguments.length?(t=typeof F=="function"?F:Jd([[+F[0][0],+F[0][1]],[+F[1][0],+F[1][1]]]),Mt):t},Mt.scaleExtent=function(F){return arguments.length?(o[0]=+F[0],o[1]=+F[1],Mt):[o[0],o[1]]},Mt.translateExtent=function(F){return arguments.length?(f[0][0]=+F[0][0],f[1][0]=+F[1][0],f[0][1]=+F[0][1],f[1][1]=+F[1][1],Mt):[[f[0][0],f[0][1]],[f[1][0],f[1][1]]]},Mt.constrain=function(F){return arguments.length?(e=F,Mt):e},Mt.duration=function(F){return arguments.length?(c=+F,Mt):c},Mt.interpolate=function(F){return arguments.length?(l=F,Mt):l},Mt.on=function(){var F=_.on.apply(_,arguments);return F===_?Mt:F},Mt.clickDistance=function(F){return arguments.length?($t=(F=+F)*F,Mt):Math.sqrt($t)},Mt.tapDistance=function(F){return arguments.length?(Kt=+F,Mt):Kt},Mt}function Sp(n,t){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(t).domain(n);break}return this}function K0(n,t){switch(arguments.length){case 0:break;case 1:{typeof n=="function"?this.interpolator(n):this.range(n);break}default:{this.domain(n),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const Ub=Symbol("implicit");function J0(){var n=new sb,t=[],e=[],r=Ub;function a(o){let f=n.get(o);if(f===void 0){if(r!==Ub)return r;n.set(o,f=t.push(o)-1)}return e[f%e.length]}return a.domain=function(o){if(!arguments.length)return t.slice();t=[],n=new sb;for(const f of o)n.has(f)||n.set(f,t.push(f)-1);return a},a.range=function(o){return arguments.length?(e=Array.from(o),a):e.slice()},a.unknown=function(o){return arguments.length?(r=o,a):r},a.copy=function(){return J0(t,e).unknown(r)},Sp.apply(a,arguments),a}function eE(n){return function(){return n}}function y0(n){return+n}var Gb=[0,1];function Gi(n){return n}function v0(n,t){return(t-=n=+n)?function(e){return(e-n)/t}:eE(isNaN(t)?NaN:.5)}function nE(n,t){var e;return n>t&&(e=n,n=t,t=e),function(r){return Math.max(n,Math.min(t,r))}}function rE(n,t,e){var r=n[0],a=n[1],o=t[0],f=t[1];return a<r?(r=v0(a,r),o=e(f,o)):(r=v0(r,a),o=e(o,f)),function(c){return o(r(c))}}function iE(n,t,e){var r=Math.min(n.length,t.length)-1,a=new Array(r),o=new Array(r),f=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++f<r;)a[f]=v0(n[f],n[f+1]),o[f]=e(t[f],t[f+1]);return function(c){var l=i4(n,c,1,r)-1;return o[l](a[l](c))}}function Q0(n,t){return t.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function tg(){var n=Gb,t=Gb,e=wp,r,a,o,f=Gi,c,l,_;function m(){var R=Math.min(n.length,t.length);return f!==Gi&&(f=nE(n[0],n[R-1])),c=R>2?iE:rE,l=_=null,A}function A(R){return R==null||isNaN(R=+R)?o:(l||(l=c(n.map(r),t,e)))(r(f(R)))}return A.invert=function(R){return f(a((_||(_=c(t,n.map(r),fa)))(R)))},A.domain=function(R){return arguments.length?(n=Array.from(R,y0),m()):n.slice()},A.range=function(R){return arguments.length?(t=Array.from(R),m()):t.slice()},A.rangeRound=function(R){return t=Array.from(R),e=iv,m()},A.clamp=function(R){return arguments.length?(f=R?!0:Gi,m()):f!==Gi},A.interpolate=function(R){return arguments.length?(e=R,m()):e},A.unknown=function(R){return arguments.length?(o=R,A):o},function(R,C){return r=R,a=C,m()}}function aE(){return tg()(Gi,Gi)}function sE(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function D_(n,t){if((e=(n=t?n.toExponential(t-1):n.toExponential()).indexOf("e"))<0)return null;var e,r=n.slice(0,e);return[r.length>1?r[0]+r.slice(2):r,+n.slice(e+1)]}function zc(n){return n=D_(Math.abs(n)),n?n[1]:NaN}function oE(n,t){return function(e,r){for(var a=e.length,o=[],f=0,c=n[0],l=0;a>0&&c>0&&(l+c+1>r&&(c=Math.max(1,r-l)),o.push(e.substring(a-=c,a+c)),!((l+=c+1)>r));)c=n[f=(f+1)%n.length];return o.reverse().join(t)}}function fE(n){return function(t){return t.replace(/[0-9]/g,function(e){return n[+e]})}}var uE=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ph(n){if(!(t=uE.exec(n)))throw new Error("invalid format: "+n);var t;return new eg({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Ph.prototype=eg.prototype;function eg(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}eg.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function cE(n){t:for(var t=n.length,e=1,r=-1,a;e<t;++e)switch(n[e]){case".":r=a=e;break;case"0":r===0&&(r=e),a=e;break;default:if(!+n[e])break t;r>0&&(r=0);break}return r>0?n.slice(0,r)+n.slice(a+1):n}var hv;function lE(n,t){var e=D_(n,t);if(!e)return n+"";var r=e[0],a=e[1],o=a-(hv=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,f=r.length;return o===f?r:o>f?r+new Array(o-f+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+D_(n,Math.max(0,t+o-1))[0]}function $b(n,t){var e=D_(n,t);if(!e)return n+"";var r=e[0],a=e[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}const jb={"%":(n,t)=>(n*100).toFixed(t),b:n=>Math.round(n).toString(2),c:n=>n+"",d:sE,e:(n,t)=>n.toExponential(t),f:(n,t)=>n.toFixed(t),g:(n,t)=>n.toPrecision(t),o:n=>Math.round(n).toString(8),p:(n,t)=>$b(n*100,t),r:$b,s:lE,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function Vb(n){return n}var Wb=Array.prototype.map,Yb=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function hE(n){var t=n.grouping===void 0||n.thousands===void 0?Vb:oE(Wb.call(n.grouping,Number),n.thousands+""),e=n.currency===void 0?"":n.currency[0]+"",r=n.currency===void 0?"":n.currency[1]+"",a=n.decimal===void 0?".":n.decimal+"",o=n.numerals===void 0?Vb:fE(Wb.call(n.numerals,String)),f=n.percent===void 0?"%":n.percent+"",c=n.minus===void 0?"":n.minus+"",l=n.nan===void 0?"NaN":n.nan+"";function _(A){A=Ph(A);var R=A.fill,C=A.align,G=A.sign,$t=A.symbol,Kt=A.zero,Mt=A.width,ie=A.comma,Xt=A.precision,it=A.trim,Ct=A.type;Ct==="n"?(ie=!0,Ct="g"):jb[Ct]||(Xt===void 0&&(Xt=12),it=!0,Ct="g"),(Kt||R==="0"&&C==="=")&&(Kt=!0,R="0",C="=");var fe=$t==="$"?e:$t==="#"&&/[boxX]/.test(Ct)?"0"+Ct.toLowerCase():"",be=$t==="$"?r:/[%p]/.test(Ct)?f:"",sn=jb[Ct],st=/[defgprs%]/.test(Ct);Xt=Xt===void 0?6:/[gprs]/.test(Ct)?Math.max(1,Math.min(21,Xt)):Math.max(0,Math.min(20,Xt));function Y(rt){var Bt=fe,Dt=be,F,ft,H;if(Ct==="c")Dt=sn(rt)+Dt,rt="";else{rt=+rt;var bt=rt<0||1/rt<0;if(rt=isNaN(rt)?l:sn(Math.abs(rt),Xt),it&&(rt=cE(rt)),bt&&+rt==0&&G!=="+"&&(bt=!1),Bt=(bt?G==="("?G:c:G==="-"||G==="("?"":G)+Bt,Dt=(Ct==="s"?Yb[8+hv/3]:"")+Dt+(bt&&G==="("?")":""),st){for(F=-1,ft=rt.length;++F<ft;)if(H=rt.charCodeAt(F),48>H||H>57){Dt=(H===46?a+rt.slice(F+1):rt.slice(F))+Dt,rt=rt.slice(0,F);break}}}ie&&!Kt&&(rt=t(rt,1/0));var Lt=Bt.length+rt.length+Dt.length,Jt=Lt<Mt?new Array(Mt-Lt+1).join(R):"";switch(ie&&Kt&&(rt=t(Jt+rt,Jt.length?Mt-Dt.length:1/0),Jt=""),C){case"<":rt=Bt+rt+Dt+Jt;break;case"=":rt=Bt+Jt+rt+Dt;break;case"^":rt=Jt.slice(0,Lt=Jt.length>>1)+Bt+rt+Dt+Jt.slice(Lt);break;default:rt=Jt+Bt+rt+Dt;break}return o(rt)}return Y.toString=function(){return A+""},Y}function m(A,R){var C=_((A=Ph(A),A.type="f",A)),G=Math.max(-8,Math.min(8,Math.floor(zc(R)/3)))*3,$t=Math.pow(10,-G),Kt=Yb[8+G/3];return function(Mt){return C($t*Mt)+Kt}}return{format:_,formatPrefix:m}}var Qd,ng,dv;dE({thousands:",",grouping:[3],currency:["$",""]});function dE(n){return Qd=hE(n),ng=Qd.format,dv=Qd.formatPrefix,Qd}function _E(n){return Math.max(0,-zc(Math.abs(n)))}function pE(n,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(zc(t)/3)))*3-zc(Math.abs(n)))}function mE(n,t){return n=Math.abs(n),t=Math.abs(t)-n,Math.max(0,zc(t)-zc(n))+1}function gE(n,t,e,r){var a=h4(n,t,e),o;switch(r=Ph(r??",f"),r.type){case"s":{var f=Math.max(Math.abs(n),Math.abs(t));return r.precision==null&&!isNaN(o=pE(a,f))&&(r.precision=o),dv(r,f)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=mE(a,Math.max(Math.abs(n),Math.abs(t))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=_E(a))&&(r.precision=o-(r.type==="%")*2);break}}return ng(r)}function Ap(n){var t=n.domain;return n.ticks=function(e){var r=t();return Jm(r[0],r[r.length-1],e??10)},n.tickFormat=function(e,r){var a=t();return gE(a[0],a[a.length-1],e??10,r)},n.nice=function(e){e==null&&(e=10);var r=t(),a=0,o=r.length-1,f=r[a],c=r[o],l,_,m=10;for(c<f&&(_=f,f=c,c=_,_=a,a=o,o=_);m-- >0;){if(_=Qm(f,c,e),_===l)return r[a]=f,r[o]=c,t(r);if(_>0)f=Math.floor(f/_)*_,c=Math.ceil(c/_)*_;else if(_<0)f=Math.ceil(f*_)/_,c=Math.floor(c*_)/_;else break;l=_}return n},n}function F_(){var n=aE();return n.copy=function(){return Q0(n,F_())},Sp.apply(n,arguments),Ap(n)}function _v(n){var t;function e(r){return r==null||isNaN(r=+r)?t:r}return e.invert=e,e.domain=e.range=function(r){return arguments.length?(n=Array.from(r,y0),e):n.slice()},e.unknown=function(r){return arguments.length?(t=r,e):t},e.copy=function(){return _v(n).unknown(t)},n=arguments.length?Array.from(n,y0):[0,1],Ap(e)}function bE(n,t){n=n.slice();var e=0,r=n.length-1,a=n[e],o=n[r],f;return o<a&&(f=e,e=r,r=f,f=a,a=o,o=f),n[e]=t.floor(a),n[r]=t.ceil(o),n}function Hb(n){return Math.log(n)}function Xb(n){return Math.exp(n)}function yE(n){return-Math.log(-n)}function vE(n){return-Math.exp(-n)}function wE(n){return isFinite(n)?+("1e"+n):n<0?0:n}function xE(n){return n===10?wE:n===Math.E?Math.exp:t=>Math.pow(n,t)}function SE(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),t=>Math.log(t)/n)}function qb(n){return(t,e)=>-n(-t,e)}function pv(n){const t=n(Hb,Xb),e=t.domain;let r=10,a,o;function f(){return a=SE(r),o=xE(r),e()[0]<0?(a=qb(a),o=qb(o),n(yE,vE)):n(Hb,Xb),t}return t.base=function(c){return arguments.length?(r=+c,f()):r},t.domain=function(c){return arguments.length?(e(c),f()):e()},t.ticks=c=>{const l=e();let _=l[0],m=l[l.length-1];const A=m<_;A&&([_,m]=[m,_]);let R=a(_),C=a(m),G,$t;const Kt=c==null?10:+c;let Mt=[];if(!(r%1)&&C-R<Kt){if(R=Math.floor(R),C=Math.ceil(C),_>0){for(;R<=C;++R)for(G=1;G<r;++G)if($t=R<0?G/o(-R):G*o(R),!($t<_)){if($t>m)break;Mt.push($t)}}else for(;R<=C;++R)for(G=r-1;G>=1;--G)if($t=R>0?G/o(-R):G*o(R),!($t<_)){if($t>m)break;Mt.push($t)}Mt.length*2<Kt&&(Mt=Jm(_,m,Kt))}else Mt=Jm(R,C,Math.min(C-R,Kt)).map(o);return A?Mt.reverse():Mt},t.tickFormat=(c,l)=>{if(c==null&&(c=10),l==null&&(l=r===10?"s":","),typeof l!="function"&&(!(r%1)&&(l=Ph(l)).precision==null&&(l.trim=!0),l=ng(l)),c===1/0)return l;const _=Math.max(1,r*c/t.ticks().length);return m=>{let A=m/o(Math.round(a(m)));return A*r<r-.5&&(A*=r),A<=_?l(m):""}},t.nice=()=>e(bE(e(),{floor:c=>o(Math.floor(a(c))),ceil:c=>o(Math.ceil(a(c)))})),t}function mv(){const n=pv(tg()).domain([1,10]);return n.copy=()=>Q0(n,mv()).base(n.base()),Sp.apply(n,arguments),n}function Zb(n){return function(t){return t<0?-Math.pow(-t,n):Math.pow(t,n)}}function AE(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function EE(n){return n<0?-n*n:n*n}function gv(n){var t=n(Gi,Gi),e=1;function r(){return e===1?n(Gi,Gi):e===.5?n(AE,EE):n(Zb(e),Zb(1/e))}return t.exponent=function(a){return arguments.length?(e=+a,r()):e},Ap(t)}function bv(){var n=gv(tg());return n.copy=function(){return Q0(n,bv()).exponent(n.exponent())},Sp.apply(n,arguments),n}function TE(){return bv.apply(null,arguments).exponent(.5)}function rg(){var n=0,t=1,e,r,a,o,f=Gi,c=!1,l;function _(A){return A==null||isNaN(A=+A)?l:f(a===0?.5:(A=(o(A)-e)*a,c?Math.max(0,Math.min(1,A)):A))}_.domain=function(A){return arguments.length?([n,t]=A,e=o(n=+n),r=o(t=+t),a=e===r?0:1/(r-e),_):[n,t]},_.clamp=function(A){return arguments.length?(c=!!A,_):c},_.interpolator=function(A){return arguments.length?(f=A,_):f};function m(A){return function(R){var C,G;return arguments.length?([C,G]=R,f=A(C,G),_):[f(0),f(1)]}}return _.range=m(wp),_.rangeRound=m(iv),_.unknown=function(A){return arguments.length?(l=A,_):l},function(A){return o=A,e=A(n),r=A(t),a=e===r?0:1/(r-e),_}}function ig(n,t){return t.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function yv(){var n=Ap(rg()(Gi));return n.copy=function(){return ig(n,yv())},K0.apply(n,arguments)}function vv(){var n=pv(rg()).domain([1,10]);return n.copy=function(){return ig(n,vv()).base(n.base())},K0.apply(n,arguments)}function wv(){var n=gv(rg());return n.copy=function(){return ig(n,wv()).exponent(n.exponent())},K0.apply(n,arguments)}class IE{constructor(t,e,r){this.prefs=e,this.svg_element_selection=Wn(t),this.width=+this.svg_element_selection.attr("width"),this.height=+this.svg_element_selection.attr("height"),this.renderers=new Map,this.scatterplot=r,this.renderers=new Map}attach_tiles(t){return this.tileSet=t,this.tileSet._zoom=this,this}attach_renderer(t,e){return this.renderers.set(t,e),e.bind_zoom(this),e.zoom.initialize_zoom(),this}zoom_to(t,e=null,r=null,a=4e3){const o=this.scales(),{svg_element_selection:f,zoomer:c,width:l,height:_}=this,m=Rh.translate(l/2,_/2).scale(t).translate(-o.x(e),-o.y(r));f.transition().duration(a).call(c.transform,m)}html_annotation(t){const e=this.svg_element_selection.node().parentNode.parentNode;let r=.75;this.scatterplot.prefs.tooltip_opacity!==void 0&&(r=this.scatterplot.prefs.tooltip_opacity),Wn(e).selectAll("div.tooltip").data(t).join(o=>o.append("div").attr("class","tooltip").style("top",0).style("left",0).style("position","absolute").style("z-index",100).style("border-radius","8px").style("padding","10px").style("background","ivory").style("opacity",r),o=>o.html(f=>this.scatterplot.tooltip_html(f.data)),o=>o.call(f=>f.remove())).html(o=>this.scatterplot.tooltip_html(o.data)).style("transform",o=>`translate(${+o.x+o.dx}px, ${+o.y+o.dy}px)`)}zoom_to_bbox(t,e=4e3,r=1.111){const a=this.scales();let[o,f]=t.x.map(a.x),[c,l]=t.y.map(a.y);if(console.log(this.scatterplot.prefs.zoom_align,"AAH"),this.scatterplot.prefs.zoom_align==="right"){const G=this.width/this.height,$t=(f-o)/(l-c);if($t<G){const Kt=$t/G;console.log(Kt,{x0:o}),o=o-(f-o)*Kt}}const{svg_element_selection:_,zoomer:m,width:A,height:R}=this,C=Rh.translate(A/2,R/2).scale(1/r/Math.max((f-o)/A,(l-c)/R)).translate(-(o+f)/2,-(c+l)/2);_.transition().duration(e).call(m.transform,C)}initialize_zoom(){const{width:t,height:e,svg_element_selection:r}=this;this.transform=Rh;const a=tE().scaleExtent([1/3,1e5]).extent([[0,0],[t,e]]).on("zoom",o=>{var f,c,l;try{document.getElementById("tooltipcircle").remove()}catch{}this.transform=o.transform,this.restart_timer(10*1e3),(c=(f=this.scatterplot).on_zoom)==null||c.call(f,o.transform),(l=o==null?void 0:o.sourceEvent)==null||l.stopPropagation()});r.call(a),this.add_mouseover(),this.zoomer=a}set_highlit_points(t){const{x_:e,y_:r}=this.scales(),a=this.scatterplot.dim("x"),o=this.scatterplot.dim("y"),f=t.map(l=>({x:e(a.apply(l)),y:r(o.apply(l)),data:l,dx:0,dy:30}));this.html_annotation(f),this.svg_element_selection.select("#mousepoints").selectAll("circle.label").data(t,l=>l.ix).join(l=>l.append("circle").attr("id","tooltipcircle").attr("class","label").attr("stroke","#110022").attr("r",12).attr("fill",_=>this.scatterplot.dim("color").apply(_)).attr("cx",_=>e(a.apply(_))).attr("cy",_=>r(o.apply(_))),l=>l.attr("fill",_=>this.scatterplot.dim("color").apply(_)),l=>l.call(_=>{_.remove(),this.prefs.exit_function&&this.prefs.exit_function()})).on("click",(l,_)=>{this.scatterplot.click_function(_)})}set_highlit_point(t){this.set_highlit_points([t])}add_mouseover(){let t=0;const e=this.renderers.get("regl");this.svg_element_selection.on("mousemove",r=>{if(Date.now()-t<75)return;t=Date.now();const a=e.color_pick(r.offsetX,r.offsetY);a===null?this.set_highlit_points([]):this.set_highlit_points([a])})}current_corners(){const{width:t,height:e}=this,r=this.scales();if(r===void 0)return;const{x_:a,y_:o}=r;return{x:[a.invert(0),a.invert(t)],y:[o.invert(0),o.invert(e)]}}current_center(){const{x:t,y:e}=this.current_corners();return[(t[0]+t[1])/2,(e[0]+e[1])/2]}restart_timer(t=1e4){let e=Date.now()+t;this._timer&&(this._timer.stop_at>e&&(e=this._timer.stop_at),this._timer.stop());const r=Wh(this.tick.bind(this));return this._timer=r,this._timer.stop_at=e,this._timer}data(t){return t===void 0?this.tileSet:(this.tileSet=t,this)}scales(t=!0){if(this._scales)return this._scales.x_=this.transform.rescaleX(this._scales.x),this._scales.y_=this.transform.rescaleY(this._scales.y),this._scales;const{width:e,height:r}=this;if(this.tileSet===void 0)throw new Error("Error--scales created before tileSet present.");const{extent:a}=this.tileSet,o={};if(a===void 0)throw new Error("Error--scales created before extent present.");const f={};for(const[R,C]of[["x",e],["y",r]]){const G=a[R],$t=G[1]-G[0];f[R]={limits:G,size_range:$t,pixels_per_unit:C/$t}}const c=f.x.pixels_per_unit/f.y.pixels_per_unit;let l=0,_=0,m=e,A=r;return c>1?(m=e/c,l=(e-m)/2):(A=r*c,_=(r-A)/2),o.x=F_().domain(f.x.limits).range([l,e-l]),o.y=F_().domain(f.y.limits).range([_,r-_]),o.x_=this.transform.rescaleX(o.x),o.y_=this.transform.rescaleY(o.y),this._scales=o,o}webgl_scale(t=!0){const{x:e,y:r}=this.scales();return OE(e,r).flat()}tick(t=!1){this._start=this._start||Date.now(),t!==!0&&this._timer&&this._timer.stop_at<=Date.now()&&this._timer.stop()}}function OE(n,t){function e(l){return l[1]-l[0]}const r=Wd(n.domain()),a=Wd(t.domain()),o=e(n.range())/e(n.domain()),f=e(t.range())/e(t.domain());return[[o,0,-o*r+Wd(n.range())],[0,f,-f*a+Wd(t.range())],[0,0,1]]}var w0={},BE={get exports(){return w0},set exports(n){w0=n}};(function(n,t){(function(e,r){n.exports=r()})(ca,function(){var e=function(d){return d instanceof Uint8Array||d instanceof Uint16Array||d instanceof Uint32Array||d instanceof Int8Array||d instanceof Int16Array||d instanceof Int32Array||d instanceof Float32Array||d instanceof Float64Array||d instanceof Uint8ClampedArray},r=function(d,y){for(var B=Object.keys(y),Q=0;Q<B.length;++Q)d[B[Q]]=y[B[Q]];return d},a=`
`;function o(d){return typeof atob<"u"?atob(d):"base64:"+d}function f(d){var y=new Error("(regl) "+d);throw console.error(y),y}function c(d,y){d||f(y)}function l(d){return d?": "+d:""}function _(d,y,B){d in y||f("unknown parameter ("+d+")"+l(B)+". possible values: "+Object.keys(y).join())}function m(d,y){e(d)||f("invalid parameter type"+l(y)+". must be a typed array")}function A(d,y){switch(y){case"number":return typeof d=="number";case"object":return typeof d=="object";case"string":return typeof d=="string";case"boolean":return typeof d=="boolean";case"function":return typeof d=="function";case"undefined":return typeof d>"u";case"symbol":return typeof d=="symbol"}}function R(d,y,B){A(d,y)||f("invalid parameter type"+l(B)+". expected "+y+", got "+typeof d)}function C(d,y){d>=0&&(d|0)===d||f("invalid parameter type, ("+d+")"+l(y)+". must be a nonnegative integer")}function G(d,y,B){y.indexOf(d)<0&&f("invalid value"+l(B)+". must be one of: "+y)}var $t=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Kt(d){Object.keys(d).forEach(function(y){$t.indexOf(y)<0&&f('invalid regl constructor argument "'+y+'". must be one of '+$t)})}function Mt(d,y){for(d=d+"";d.length<y;)d=" "+d;return d}function ie(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Xt(d,y){this.number=d,this.line=y,this.errors=[]}function it(d,y,B){this.file=d,this.line=y,this.message=B}function Ct(){var d=new Error,y=(d.stack||d).toString(),B=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(y);if(B)return B[1];var Q=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(y);return Q?Q[1]:"unknown"}function fe(){var d=new Error,y=(d.stack||d).toString(),B=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(y);if(B)return B[1];var Q=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(y);return Q?Q[1]:"unknown"}function be(d,y){var B=d.split(`
`),Q=1,lt=0,K={unknown:new ie,0:new ie};K.unknown.name=K[0].name=y||Ct(),K.unknown.lines.push(new Xt(0,""));for(var tt=0;tt<B.length;++tt){var vt=B[tt],yt=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(vt);if(yt)switch(yt[1]){case"line":var It=/(\d+)(\s+\d+)?/.exec(yt[2]);It&&(Q=It[1]|0,It[2]&&(lt=It[2]|0,lt in K||(K[lt]=new ie)));break;case"define":var Rt=/SHADER_NAME(_B64)?\s+(.*)$/.exec(yt[2]);Rt&&(K[lt].name=Rt[1]?o(Rt[2]):Rt[2]);break}K[lt].lines.push(new Xt(Q++,vt))}return Object.keys(K).forEach(function(Ot){var kt=K[Ot];kt.lines.forEach(function(wt){kt.index[wt.number]=wt})}),K}function sn(d){var y=[];return d.split(`
`).forEach(function(B){if(!(B.length<5)){var Q=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(B);Q?y.push(new it(Q[1]|0,Q[2]|0,Q[3].trim())):B.length>0&&y.push(new it("unknown",0,B))}}),y}function st(d,y){y.forEach(function(B){var Q=d[B.file];if(Q){var lt=Q.index[B.line];if(lt){lt.errors.push(B),Q.hasErrors=!0;return}}d.unknown.hasErrors=!0,d.unknown.lines[0].errors.push(B)})}function Y(d,y,B,Q,lt){if(!d.getShaderParameter(y,d.COMPILE_STATUS)){var K=d.getShaderInfoLog(y),tt=Q===d.FRAGMENT_SHADER?"fragment":"vertex";bt(B,"string",tt+" shader source must be a string",lt);var vt=be(B,lt),yt=sn(K);st(vt,yt),Object.keys(vt).forEach(function(It){var Rt=vt[It];if(!Rt.hasErrors)return;var Ot=[""],kt=[""];function wt(Et,z){Ot.push(Et),kt.push(z||"")}wt("file number "+It+": "+Rt.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Rt.lines.forEach(function(Et){if(Et.errors.length>0){wt(Mt(Et.number,4)+"|  ","background-color:yellow; font-weight:bold"),wt(Et.line+a,"color:red; background-color:yellow; font-weight:bold");var z=0;Et.errors.forEach(function(J){var xt=J.message,Yt=/^\s*'(.*)'\s*:\s*(.*)$/.exec(xt);if(Yt){var pt=Yt[1];switch(xt=Yt[2],pt){case"assign":pt="=";break}z=Math.max(Et.line.indexOf(pt,z),0)}else z=0;wt(Mt("| ",6)),wt(Mt("^^^",z+3)+a,"font-weight:bold"),wt(Mt("| ",6)),wt(xt+a,"font-weight:bold")}),wt(Mt("| ",6)+a)}else wt(Mt(Et.number,4)+"|  "),wt(Et.line+a,"color:red")}),typeof document<"u"&&!window.chrome?(kt[0]=Ot.join("%c"),console.log.apply(console,kt)):console.log(Ot.join(""))}),c.raise("Error compiling "+tt+" shader, "+vt[0].name)}}function rt(d,y,B,Q,lt){if(!d.getProgramParameter(y,d.LINK_STATUS)){var K=d.getProgramInfoLog(y),tt=be(B,lt),vt=be(Q,lt),yt='Error linking program with vertex shader, "'+vt[0].name+'", and fragment shader "'+tt[0].name+'"';typeof document<"u"?console.log("%c"+yt+a+"%c"+K,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(yt+a+K),c.raise(yt)}}function Bt(d){d._commandRef=Ct()}function Dt(d,y,B,Q){Bt(d);function lt(yt){return yt?Q.id(yt):0}d._fragId=lt(d.static.frag),d._vertId=lt(d.static.vert);function K(yt,It){Object.keys(It).forEach(function(Rt){yt[Q.id(Rt)]=!0})}var tt=d._uniformSet={};K(tt,y.static),K(tt,y.dynamic);var vt=d._attributeSet={};K(vt,B.static),K(vt,B.dynamic),d._hasCount="count"in d.static||"count"in d.dynamic||"elements"in d.static||"elements"in d.dynamic}function F(d,y){var B=fe();f(d+" in command "+(y||Ct())+(B==="unknown"?"":" called from "+B))}function ft(d,y,B){d||F(y,B||Ct())}function H(d,y,B,Q){d in y||F("unknown parameter ("+d+")"+l(B)+". possible values: "+Object.keys(y).join(),Q||Ct())}function bt(d,y,B,Q){A(d,y)||F("invalid parameter type"+l(B)+". expected "+y+", got "+typeof d,Q||Ct())}function Lt(d){d()}function Jt(d,y,B){d.texture?G(d.texture._texture.internalformat,y,"unsupported texture format for attachment"):G(d.renderbuffer._renderbuffer.format,B,"unsupported renderbuffer format for attachment")}var ee=33071,de=9728,Te=9984,ye=9985,Ze=9986,on=9987,An=5120,Nn=5121,ln=5122,Dn=5123,ir=5124,Kn=5125,Yr=5126,Qo=32819,Mr=32820,ba=33635,hu=34042,si=36193,br={};br[An]=br[Nn]=1,br[ln]=br[Dn]=br[si]=br[ba]=br[Qo]=br[Mr]=2,br[ir]=br[Kn]=br[Yr]=br[hu]=4;function du(d,y){return d===Mr||d===Qo||d===ba?2:d===hu?4:br[d]*y}function Cr(d){return!(d&d-1)&&!!d}function Ir(d,y,B){var Q,lt=y.width,K=y.height,tt=y.channels;c(lt>0&&lt<=B.maxTextureSize&&K>0&&K<=B.maxTextureSize,"invalid texture shape"),(d.wrapS!==ee||d.wrapT!==ee)&&c(Cr(lt)&&Cr(K),"incompatible wrap mode for texture, both width and height must be power of 2"),y.mipmask===1?lt!==1&&K!==1&&c(d.minFilter!==Te&&d.minFilter!==Ze&&d.minFilter!==ye&&d.minFilter!==on,"min filter requires mipmap"):(c(Cr(lt)&&Cr(K),"texture must be a square power of 2 to support mipmapping"),c(y.mipmask===(lt<<1)-1,"missing or incomplete mipmap data")),y.type===Yr&&(B.extensions.indexOf("oes_texture_float_linear")<0&&c(d.minFilter===de&&d.magFilter===de,"filter not supported, must enable oes_texture_float_linear"),c(!d.genMipmaps,"mipmap generation not supported with float textures"));var vt=y.images;for(Q=0;Q<16;++Q)if(vt[Q]){var yt=lt>>Q,It=K>>Q;c(y.mipmask&1<<Q,"missing mipmap data");var Rt=vt[Q];if(c(Rt.width===yt&&Rt.height===It,"invalid shape for mip images"),c(Rt.format===y.format&&Rt.internalformat===y.internalformat&&Rt.type===y.type,"incompatible type for mip image"),!Rt.compressed)if(Rt.data){var Ot=Math.ceil(du(Rt.type,tt)*yt/Rt.unpackAlignment)*Rt.unpackAlignment;c(Rt.data.byteLength===Ot*It,"invalid data for image, buffer size is inconsistent with image format")}else Rt.element||Rt.copy}else d.genMipmaps||c((y.mipmask&1<<Q)===0,"extra mipmap data");y.compressed&&c(!d.genMipmaps,"mipmap generation for compressed images not supported")}function Ai(d,y,B,Q){var lt=d.width,K=d.height,tt=d.channels;c(lt>0&&lt<=Q.maxTextureSize&&K>0&&K<=Q.maxTextureSize,"invalid texture shape"),c(lt===K,"cube map must be square"),c(y.wrapS===ee&&y.wrapT===ee,"wrap mode not supported by cube map");for(var vt=0;vt<B.length;++vt){var yt=B[vt];c(yt.width===lt&&yt.height===K,"inconsistent cube map face shape"),y.genMipmaps&&(c(!yt.compressed,"can not generate mipmap for compressed textures"),c(yt.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var It=yt.images,Rt=0;Rt<16;++Rt){var Ot=It[Rt];if(Ot){var kt=lt>>Rt,wt=K>>Rt;c(yt.mipmask&1<<Rt,"missing mipmap data"),c(Ot.width===kt&&Ot.height===wt,"invalid shape for mip images"),c(Ot.format===d.format&&Ot.internalformat===d.internalformat&&Ot.type===d.type,"incompatible type for mip image"),Ot.compressed||(Ot.data?c(Ot.data.byteLength===kt*wt*Math.max(du(Ot.type,tt),Ot.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ot.element||Ot.copy)}}}}var v=r(c,{optional:Lt,raise:f,commandRaise:F,command:ft,parameter:_,commandParameter:H,constructor:Kt,type:R,commandType:bt,isTypedArray:m,nni:C,oneOf:G,shaderError:Y,linkError:rt,callSite:fe,saveCommandRef:Bt,saveDrawInfo:Dt,framebufferFormat:Jt,guessCommand:Ct,texture2D:Ir,textureCube:Ai}),_u=0,ya=0,Qc=5,rs=6;function lr(d,y){this.id=_u++,this.type=d,this.data=y}function is(d){return d.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Ei(d){if(d.length===0)return[];var y=d.charAt(0),B=d.charAt(d.length-1);if(d.length>1&&y===B&&(y==='"'||y==="'"))return['"'+is(d.substr(1,d.length-2))+'"'];var Q=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(d);if(Q)return Ei(d.substr(0,Q.index)).concat(Ei(Q[1])).concat(Ei(d.substr(Q.index+Q[0].length)));var lt=d.split(".");if(lt.length===1)return['"'+is(d)+'"'];for(var K=[],tt=0;tt<lt.length;++tt)K=K.concat(Ei(lt[tt]));return K}function as(d){return"["+Ei(d).join("][")+"]"}function ao(d,y){return new lr(d,as(y+""))}function so(d){return typeof d=="function"&&!d._reglType||d instanceof lr}function oo(d,y){if(typeof d=="function")return new lr(ya,d);if(typeof d=="number"||typeof d=="boolean")return new lr(Qc,d);if(Array.isArray(d))return new lr(rs,d.map(function(B,Q){return oo(B,y+"["+Q+"]")}));if(d instanceof lr)return d;v(!1,"invalid option type in uniform "+y)}var hr={DynamicVariable:lr,define:ao,isDynamic:so,unbox:oo,accessor:as},kr={next:typeof requestAnimationFrame=="function"?function(d){return requestAnimationFrame(d)}:function(d){return setTimeout(d,16)},cancel:typeof cancelAnimationFrame=="function"?function(d){return cancelAnimationFrame(d)}:clearTimeout},ji=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function tl(){var d={"":0},y=[""];return{id:function(B){var Q=d[B];return Q||(Q=d[B]=y.length,y.push(B),Q)},str:function(B){return y[B]}}}function pu(d,y,B){var Q=document.createElement("canvas");r(Q.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),d.appendChild(Q),d===document.body&&(Q.style.position="absolute",r(d.style,{margin:0,padding:0}));function lt(){var vt=window.innerWidth,yt=window.innerHeight;if(d!==document.body){var It=Q.getBoundingClientRect();vt=It.right-It.left,yt=It.bottom-It.top}Q.width=B*vt,Q.height=B*yt}var K;d!==document.body&&typeof ResizeObserver=="function"?(K=new ResizeObserver(function(){setTimeout(lt)}),K.observe(d)):window.addEventListener("resize",lt,!1);function tt(){K?K.disconnect():window.removeEventListener("resize",lt),d.removeChild(Q)}return lt(),{canvas:Q,onDestroy:tt}}function el(d,y){function B(Q){try{return d.getContext(Q,y)}catch{return null}}return B("webgl")||B("experimental-webgl")||B("webgl-experimental")}function tf(d){return typeof d.nodeName=="string"&&typeof d.appendChild=="function"&&typeof d.getBoundingClientRect=="function"}function va(d){return typeof d.drawArrays=="function"||typeof d.drawElements=="function"}function mu(d){return typeof d=="string"?d.split():(v(Array.isArray(d),"invalid extension array"),d)}function Ti(d){return typeof d=="string"?(v(typeof document<"u","not supported outside of DOM"),document.querySelector(d)):d}function nl(d){var y=d||{},B,Q,lt,K,tt={},vt=[],yt=[],It=typeof window>"u"?1:window.devicePixelRatio,Rt=!1,Ot=function(Et){Et&&v.raise(Et)},kt=function(){};if(typeof y=="string"?(v(typeof document<"u","selector queries only supported in DOM enviroments"),B=document.querySelector(y),v(B,"invalid query string for element")):typeof y=="object"?tf(y)?B=y:va(y)?(K=y,lt=K.canvas):(v.constructor(y),"gl"in y?K=y.gl:"canvas"in y?lt=Ti(y.canvas):"container"in y&&(Q=Ti(y.container)),"attributes"in y&&(tt=y.attributes,v.type(tt,"object","invalid context attributes")),"extensions"in y&&(vt=mu(y.extensions)),"optionalExtensions"in y&&(yt=mu(y.optionalExtensions)),"onDone"in y&&(v.type(y.onDone,"function","invalid or missing onDone callback"),Ot=y.onDone),"profile"in y&&(Rt=!!y.profile),"pixelRatio"in y&&(It=+y.pixelRatio,v(It>0,"invalid pixel ratio"))):v.raise("invalid arguments to regl"),B&&(B.nodeName.toLowerCase()==="canvas"?lt=B:Q=B),!K){if(!lt){v(typeof document<"u","must manually specify webgl context outside of DOM environments");var wt=pu(Q||document.body,Ot,It);if(!wt)return null;lt=wt.canvas,kt=wt.onDestroy}tt.premultipliedAlpha===void 0&&(tt.premultipliedAlpha=!0),K=el(lt,tt)}return K?{gl:K,canvas:lt,container:Q,extensions:vt,optionalExtensions:yt,pixelRatio:It,profile:Rt,onDone:Ot,onDestroy:kt}:(kt(),Ot("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function rl(d,y){var B={};function Q(tt){v.type(tt,"string","extension name must be string");var vt=tt.toLowerCase(),yt;try{yt=B[vt]=d.getExtension(vt)}catch{}return!!yt}for(var lt=0;lt<y.extensions.length;++lt){var K=y.extensions[lt];if(!Q(K))return y.onDestroy(),y.onDone('"'+K+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return y.optionalExtensions.forEach(Q),{extensions:B,restore:function(){Object.keys(B).forEach(function(tt){if(B[tt]&&!Q(tt))throw new Error("(regl): error restoring extension "+tt)})}}}function yr(d,y){for(var B=Array(d),Q=0;Q<d;++Q)B[Q]=y(Q);return B}var il=5120,al=5121,oi=5122,ef=5123,sl=5124,nf=5125,ol=5126;function fl(d){for(var y=16;y<=1<<28;y*=16)if(d<=y)return y;return 0}function Vi(d){var y,B;return y=(d>65535)<<4,d>>>=y,B=(d>255)<<3,d>>>=B,y|=B,B=(d>15)<<2,d>>>=B,y|=B,B=(d>3)<<1,d>>>=B,y|=B,y|d>>1}function gu(){var d=yr(8,function(){return[]});function y(K){var tt=fl(K),vt=d[Vi(tt)>>2];return vt.length>0?vt.pop():new ArrayBuffer(tt)}function B(K){d[Vi(K.byteLength)>>2].push(K)}function Q(K,tt){var vt=null;switch(K){case il:vt=new Int8Array(y(tt),0,tt);break;case al:vt=new Uint8Array(y(tt),0,tt);break;case oi:vt=new Int16Array(y(2*tt),0,tt);break;case ef:vt=new Uint16Array(y(2*tt),0,tt);break;case sl:vt=new Int32Array(y(4*tt),0,tt);break;case nf:vt=new Uint32Array(y(4*tt),0,tt);break;case ol:vt=new Float32Array(y(4*tt),0,tt);break;default:return null}return vt.length!==tt?vt.subarray(0,tt):vt}function lt(K){B(K.buffer)}return{alloc:y,free:B,allocType:Q,freeType:lt}}var Fn=gu();Fn.zero=gu();var ul=3408,cl=3410,ll=3411,Wi=3412,hl=3413,dl=3414,_l=3415,pl=33901,ml=33902,gl=3379,wa=3386,bl=34921,Yi=36347,rf=36348,yl=35661,fo=35660,af=34930,bu=36349,yu=34076,vl=34024,vu=7936,wl=7937,xl=7938,wu=35724,xu=34047,Su=36063,sf=34852,uo=3553,of=34067,co=34069,Au=33984,Ii=6408,xa=5126,ff=5121,ss=36160,Eu=36053,Tu=36064,uf=16384,cf=function(d,y){var B=1;y.ext_texture_filter_anisotropic&&(B=d.getParameter(xu));var Q=1,lt=1;y.webgl_draw_buffers&&(Q=d.getParameter(sf),lt=d.getParameter(Su));var K=!!y.oes_texture_float;if(K){var tt=d.createTexture();d.bindTexture(uo,tt),d.texImage2D(uo,0,Ii,1,1,0,Ii,xa,null);var vt=d.createFramebuffer();if(d.bindFramebuffer(ss,vt),d.framebufferTexture2D(ss,Tu,uo,tt,0),d.bindTexture(uo,null),d.checkFramebufferStatus(ss)!==Eu)K=!1;else{d.viewport(0,0,1,1),d.clearColor(1,0,0,1),d.clear(uf);var yt=Fn.allocType(xa,4);d.readPixels(0,0,1,1,Ii,xa,yt),d.getError()?K=!1:(d.deleteFramebuffer(vt),d.deleteTexture(tt),K=yt[0]===1),Fn.freeType(yt)}}var It=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Rt=!0;if(!It){var Ot=d.createTexture(),kt=Fn.allocType(ff,36);d.activeTexture(Au),d.bindTexture(of,Ot),d.texImage2D(co,0,Ii,3,3,0,Ii,ff,kt),Fn.freeType(kt),d.bindTexture(of,null),d.deleteTexture(Ot),Rt=!d.getError()}return{colorBits:[d.getParameter(cl),d.getParameter(ll),d.getParameter(Wi),d.getParameter(hl)],depthBits:d.getParameter(dl),stencilBits:d.getParameter(_l),subpixelBits:d.getParameter(ul),extensions:Object.keys(y).filter(function(wt){return!!y[wt]}),maxAnisotropic:B,maxDrawbuffers:Q,maxColorAttachments:lt,pointSizeDims:d.getParameter(pl),lineWidthDims:d.getParameter(ml),maxViewportDims:d.getParameter(wa),maxCombinedTextureUnits:d.getParameter(yl),maxCubeMapSize:d.getParameter(yu),maxRenderbufferSize:d.getParameter(vl),maxTextureUnits:d.getParameter(af),maxTextureSize:d.getParameter(gl),maxAttributes:d.getParameter(bl),maxVertexUniforms:d.getParameter(Yi),maxVertexTextureUnits:d.getParameter(fo),maxVaryingVectors:d.getParameter(rf),maxFragmentUniforms:d.getParameter(bu),glsl:d.getParameter(wu),renderer:d.getParameter(wl),vendor:d.getParameter(vu),version:d.getParameter(xl),readFloat:K,npotTextureCube:Rt}};function Jn(d){return!!d&&typeof d=="object"&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&typeof d.offset=="number"&&d.shape.length===d.stride.length&&(Array.isArray(d.data)||e(d.data))}var vr=function(d){return Object.keys(d).map(function(y){return d[y]})},os={shape:ho,flatten:Iu};function Sl(d,y,B){for(var Q=0;Q<y;++Q)B[Q]=d[Q]}function lo(d,y,B,Q){for(var lt=0,K=0;K<y;++K)for(var tt=d[K],vt=0;vt<B;++vt)Q[lt++]=tt[vt]}function lf(d,y,B,Q,lt,K){for(var tt=K,vt=0;vt<y;++vt)for(var yt=d[vt],It=0;It<B;++It)for(var Rt=yt[It],Ot=0;Ot<Q;++Ot)lt[tt++]=Rt[Ot]}function hf(d,y,B,Q,lt){for(var K=1,tt=B+1;tt<y.length;++tt)K*=y[tt];var vt=y[B];if(y.length-B===4){var yt=y[B+1],It=y[B+2],Rt=y[B+3];for(tt=0;tt<vt;++tt)lf(d[tt],yt,It,Rt,Q,lt),lt+=K}else for(tt=0;tt<vt;++tt)hf(d[tt],y,B+1,Q,lt),lt+=K}function Iu(d,y,B,Q){var lt=1;if(y.length)for(var K=0;K<y.length;++K)lt*=y[K];else lt=0;var tt=Q||Fn.allocType(B,lt);switch(y.length){case 0:break;case 1:Sl(d,y[0],tt);break;case 2:lo(d,y[0],y[1],tt);break;case 3:lf(d,y[0],y[1],y[2],tt,0);break;default:hf(d,y,0,tt,0)}return tt}function ho(d){for(var y=[],B=d;B.length;B=B[0])y.push(B.length);return y}var fs={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},df=5120,_o=5122,Al=5124,Ou=5121,_f=5123,Bu=5125,fi=5126,us=5126,Hi={int8:df,int16:_o,int32:Al,uint8:Ou,uint16:_f,uint32:Bu,float:fi,float32:us},Ru=35048,El=35040,cs={dynamic:Ru,stream:El,static:35044},gn=os.flatten,bn=os.shape,pf=35044,Tl=35040,O=5121,$=5126,at=[];at[5120]=1,at[5122]=2,at[5124]=4,at[5121]=1,at[5123]=2,at[5125]=4,at[5126]=4;function ae(d){return fs[Object.prototype.toString.call(d)]|0}function Ke(d,y){for(var B=0;B<y.length;++B)d[B]=y[B]}function _n(d,y,B,Q,lt,K,tt){for(var vt=0,yt=0;yt<B;++yt)for(var It=0;It<Q;++It)d[vt++]=y[lt*yt+K*It+tt]}function Le(d,y,B,Q){var lt=0,K={};function tt(z){this.id=lt++,this.buffer=d.createBuffer(),this.type=z,this.usage=pf,this.byteLength=0,this.dimension=1,this.dtype=O,this.persistentData=null,B.profile&&(this.stats={size:0})}tt.prototype.bind=function(){d.bindBuffer(this.type,this.buffer)},tt.prototype.destroy=function(){kt(this)};var vt=[];function yt(z,J){var xt=vt.pop();return xt||(xt=new tt(z)),xt.bind(),Ot(xt,J,Tl,0,1,!1),xt}function It(z){vt.push(z)}function Rt(z,J,xt){z.byteLength=J.byteLength,d.bufferData(z.type,J,xt)}function Ot(z,J,xt,Yt,pt,Vt){var jt;if(z.usage=xt,Array.isArray(J)){if(z.dtype=Yt||$,J.length>0){var re;if(Array.isArray(J[0])){jt=bn(J);for(var dt=1,ht=1;ht<jt.length;++ht)dt*=jt[ht];z.dimension=dt,re=gn(J,jt,z.dtype),Rt(z,re,xt),Vt?z.persistentData=re:Fn.freeType(re)}else if(typeof J[0]=="number"){z.dimension=pt;var Zt=Fn.allocType(z.dtype,J.length);Ke(Zt,J),Rt(z,Zt,xt),Vt?z.persistentData=Zt:Fn.freeType(Zt)}else e(J[0])?(z.dimension=J[0].length,z.dtype=Yt||ae(J[0])||$,re=gn(J,[J.length,J[0].length],z.dtype),Rt(z,re,xt),Vt?z.persistentData=re:Fn.freeType(re)):v.raise("invalid buffer data")}}else if(e(J))z.dtype=Yt||ae(J),z.dimension=pt,Rt(z,J,xt),Vt&&(z.persistentData=new Uint8Array(new Uint8Array(J.buffer)));else if(Jn(J)){jt=J.shape;var Pt=J.stride,St=J.offset,zt=0,Ut=0,ge=0,_e=0;jt.length===1?(zt=jt[0],Ut=1,ge=Pt[0],_e=0):jt.length===2?(zt=jt[0],Ut=jt[1],ge=Pt[0],_e=Pt[1]):v.raise("invalid shape"),z.dtype=Yt||ae(J.data)||$,z.dimension=Ut;var Gt=Fn.allocType(z.dtype,zt*Ut);_n(Gt,J.data,zt,Ut,ge,_e,St),Rt(z,Gt,xt),Vt?z.persistentData=Gt:Fn.freeType(Gt)}else J instanceof ArrayBuffer?(z.dtype=O,z.dimension=pt,Rt(z,J,xt),Vt&&(z.persistentData=new Uint8Array(new Uint8Array(J)))):v.raise("invalid buffer data")}function kt(z){y.bufferCount--,Q(z);var J=z.buffer;v(J,"buffer must not be deleted already"),d.deleteBuffer(J),z.buffer=null,delete K[z.id]}function wt(z,J,xt,Yt){y.bufferCount++;var pt=new tt(J);K[pt.id]=pt;function Vt(dt){var ht=pf,Zt=null,Pt=0,St=0,zt=1;return Array.isArray(dt)||e(dt)||Jn(dt)||dt instanceof ArrayBuffer?Zt=dt:typeof dt=="number"?Pt=dt|0:dt&&(v.type(dt,"object","buffer arguments must be an object, a number or an array"),"data"in dt&&(v(Zt===null||Array.isArray(Zt)||e(Zt)||Jn(Zt),"invalid data for buffer"),Zt=dt.data),"usage"in dt&&(v.parameter(dt.usage,cs,"invalid buffer usage"),ht=cs[dt.usage]),"type"in dt&&(v.parameter(dt.type,Hi,"invalid buffer type"),St=Hi[dt.type]),"dimension"in dt&&(v.type(dt.dimension,"number","invalid dimension"),zt=dt.dimension|0),"length"in dt&&(v.nni(Pt,"buffer length must be a nonnegative integer"),Pt=dt.length|0)),pt.bind(),Zt?Ot(pt,Zt,ht,St,zt,Yt):(Pt&&d.bufferData(pt.type,Pt,ht),pt.dtype=St||O,pt.usage=ht,pt.dimension=zt,pt.byteLength=Pt),B.profile&&(pt.stats.size=pt.byteLength*at[pt.dtype]),Vt}function jt(dt,ht){v(ht+dt.byteLength<=pt.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+dt.byteLength+" starting from offset "+ht+" to a buffer of size "+pt.byteLength),d.bufferSubData(pt.type,ht,dt)}function re(dt,ht){var Zt=(ht||0)|0,Pt;if(pt.bind(),e(dt)||dt instanceof ArrayBuffer)jt(dt,Zt);else if(Array.isArray(dt)){if(dt.length>0)if(typeof dt[0]=="number"){var St=Fn.allocType(pt.dtype,dt.length);Ke(St,dt),jt(St,Zt),Fn.freeType(St)}else if(Array.isArray(dt[0])||e(dt[0])){Pt=bn(dt);var zt=gn(dt,Pt,pt.dtype);jt(zt,Zt),Fn.freeType(zt)}else v.raise("invalid buffer data")}else if(Jn(dt)){Pt=dt.shape;var Ut=dt.stride,ge=0,_e=0,Gt=0,Wt=0;Pt.length===1?(ge=Pt[0],_e=1,Gt=Ut[0],Wt=0):Pt.length===2?(ge=Pt[0],_e=Pt[1],Gt=Ut[0],Wt=Ut[1]):v.raise("invalid shape");var ue=Array.isArray(dt.data)?pt.dtype:ae(dt.data),me=Fn.allocType(ue,ge*_e);_n(me,dt.data,ge,_e,Gt,Wt,dt.offset),jt(me,Zt),Fn.freeType(me)}else v.raise("invalid data for buffer subdata");return Vt}return xt||Vt(z),Vt._reglType="buffer",Vt._buffer=pt,Vt.subdata=re,B.profile&&(Vt.stats=pt.stats),Vt.destroy=function(){kt(pt)},Vt}function Et(){vr(K).forEach(function(z){z.buffer=d.createBuffer(),d.bindBuffer(z.type,z.buffer),d.bufferData(z.type,z.persistentData||z.byteLength,z.usage)})}return B.profile&&(y.getTotalBufferSize=function(){var z=0;return Object.keys(K).forEach(function(J){z+=K[J].stats.size}),z}),{create:wt,createStream:yt,destroyStream:It,clear:function(){vr(K).forEach(kt),vt.forEach(kt)},getBuffer:function(z){return z&&z._buffer instanceof tt?z._buffer:null},restore:Et,_initBuffer:Ot}}var We=0,hn=0,Or=1,dr=1,ar=4,po=4,Pr={points:We,point:hn,lines:Or,line:dr,triangles:ar,triangle:po,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},mf=0,Zh=1,mo=4,Kh=5120,sr=5121,Jh=5122,_r=5123,Qh=5124,Sa=5125,Oi=34963,Mu=35040,Il=35044;function Cn(d,y,B,Q){var lt={},K=0,tt={uint8:sr,uint16:_r};y.oes_element_index_uint&&(tt.uint32=Sa);function vt(Et){this.id=K++,lt[this.id]=this,this.buffer=Et,this.primType=mo,this.vertCount=0,this.type=0}vt.prototype.bind=function(){this.buffer.bind()};var yt=[];function It(Et){var z=yt.pop();return z||(z=new vt(B.create(null,Oi,!0,!1)._buffer)),Ot(z,Et,Mu,-1,-1,0,0),z}function Rt(Et){yt.push(Et)}function Ot(Et,z,J,xt,Yt,pt,Vt){Et.buffer.bind();var jt;if(z){var re=Vt;!Vt&&(!e(z)||Jn(z)&&!e(z.data))&&(re=y.oes_element_index_uint?Sa:_r),B._initBuffer(Et.buffer,z,J,re,3)}else d.bufferData(Oi,pt,J),Et.buffer.dtype=jt||sr,Et.buffer.usage=J,Et.buffer.dimension=3,Et.buffer.byteLength=pt;if(jt=Vt,!Vt){switch(Et.buffer.dtype){case sr:case Kh:jt=sr;break;case _r:case Jh:jt=_r;break;case Sa:case Qh:jt=Sa;break;default:v.raise("unsupported type for element array")}Et.buffer.dtype=jt}Et.type=jt,v(jt!==Sa||!!y.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var dt=Yt;dt<0&&(dt=Et.buffer.byteLength,jt===_r?dt>>=1:jt===Sa&&(dt>>=2)),Et.vertCount=dt;var ht=xt;if(xt<0){ht=mo;var Zt=Et.buffer.dimension;Zt===1&&(ht=mf),Zt===2&&(ht=Zh),Zt===3&&(ht=mo)}Et.primType=ht}function kt(Et){Q.elementsCount--,v(Et.buffer!==null,"must not double destroy elements"),delete lt[Et.id],Et.buffer.destroy(),Et.buffer=null}function wt(Et,z){var J=B.create(null,Oi,!0),xt=new vt(J._buffer);Q.elementsCount++;function Yt(pt){if(!pt)J(),xt.primType=mo,xt.vertCount=0,xt.type=sr;else if(typeof pt=="number")J(pt),xt.primType=mo,xt.vertCount=pt|0,xt.type=sr;else{var Vt=null,jt=Il,re=-1,dt=-1,ht=0,Zt=0;Array.isArray(pt)||e(pt)||Jn(pt)?Vt=pt:(v.type(pt,"object","invalid arguments for elements"),"data"in pt&&(Vt=pt.data,v(Array.isArray(Vt)||e(Vt)||Jn(Vt),"invalid data for element buffer")),"usage"in pt&&(v.parameter(pt.usage,cs,"invalid element buffer usage"),jt=cs[pt.usage]),"primitive"in pt&&(v.parameter(pt.primitive,Pr,"invalid element buffer primitive"),re=Pr[pt.primitive]),"count"in pt&&(v(typeof pt.count=="number"&&pt.count>=0,"invalid vertex count for elements"),dt=pt.count|0),"type"in pt&&(v.parameter(pt.type,tt,"invalid buffer type"),Zt=tt[pt.type]),"length"in pt?ht=pt.length|0:(ht=dt,Zt===_r||Zt===Jh?ht*=2:(Zt===Sa||Zt===Qh)&&(ht*=4))),Ot(xt,Vt,jt,re,dt,ht,Zt)}return Yt}return Yt(Et),Yt._reglType="elements",Yt._elements=xt,Yt.subdata=function(pt,Vt){return J.subdata(pt,Vt),Yt},Yt.destroy=function(){kt(xt)},Yt}return{create:wt,createStream:It,destroyStream:Rt,getElements:function(Et){return typeof Et=="function"&&Et._elements instanceof vt?Et._elements:null},clear:function(){vr(lt).forEach(kt)}}}var Xi=new Float32Array(1),Ol=new Uint32Array(Xi.buffer),Mp=5123;function Lu(d){for(var y=Fn.allocType(Mp,d.length),B=0;B<d.length;++B)if(isNaN(d[B]))y[B]=65535;else if(d[B]===1/0)y[B]=31744;else if(d[B]===-1/0)y[B]=64512;else{Xi[0]=d[B];var Q=Ol[0],lt=Q>>>31<<15,K=(Q<<1>>>24)-127,tt=Q>>13&1024-1;if(K<-24)y[B]=lt;else if(K<-14){var vt=-14-K;y[B]=lt+(tt+1024>>vt)}else K>15?y[B]=lt+31744:y[B]=lt+(K+15<<10)+tt}return y}function In(d){return Array.isArray(d)||e(d)}var td=function(d){return!(d&d-1)&&!!d},Lp=34467,ui=3553,go=34067,qi=34069,ls=6408,Nu=6406,gf=6407,hs=6409,bo=6410,Bl=32854,Rl=32855,Du=36194,Ml=32819,Np=32820,ed=33635,zr=34042,bf=6402,Aa=34041,Fu=35904,Cu=35906,yo=36193,Ll=33776,Nl=33777,Dl=33778,Fl=33779,ds=35986,nd=35987,rd=34798,ku=35840,Cl=35841,Zi=35842,yf=35843,id=36196,vo=5121,kl=5123,Ea=5125,Br=5126,ad=10242,Dp=10243,Fp=10497,Pl=33071,Cp=33648,kp=10240,wo=10241,W=9728,gt=9729,ut=9984,se=9985,Ie=9986,fn=9987,Qn=33170,pn=4352,zl=4353,Pp=4354,Hr=34046,Pu=3317,zp=37440,xo=37441,zu=37443,vf=37444,un=33984,Up=[ut,Ie,se,fn],wf=[0,hs,bo,gf,ls],Rr={};Rr[hs]=Rr[Nu]=Rr[bf]=1,Rr[Aa]=Rr[bo]=2,Rr[gf]=Rr[Fu]=3,Rr[ls]=Rr[Cu]=4;function So(d){return"[object "+d+"]"}var sd=So("HTMLCanvasElement"),od=So("OffscreenCanvas"),xf=So("CanvasRenderingContext2D"),Ki=So("ImageBitmap"),Sf=So("HTMLImageElement"),Ul=So("HTMLVideoElement"),Uu=Object.keys(fs).concat([sd,od,xf,Ki,Sf,Ul]),_s=[];_s[vo]=1,_s[Br]=4,_s[yo]=2,_s[kl]=2,_s[Ea]=4;var tr=[];tr[Bl]=2,tr[Rl]=2,tr[Du]=2,tr[Aa]=4,tr[Ll]=.5,tr[Nl]=.5,tr[Dl]=1,tr[Fl]=1,tr[ds]=.5,tr[nd]=1,tr[rd]=1,tr[ku]=.5,tr[Cl]=.25,tr[Zi]=.5,tr[yf]=.25,tr[id]=.5;function Af(d){return Array.isArray(d)&&(d.length===0||typeof d[0]=="number")}function Gl(d){if(!Array.isArray(d))return!1;var y=d.length;return!(y===0||!In(d[0]))}function ci(d){return Object.prototype.toString.call(d)}function Ta(d){return ci(d)===sd}function Ef(d){return ci(d)===od}function Gp(d){return ci(d)===xf}function $p(d){return ci(d)===Ki}function jp(d){return ci(d)===Sf}function Gu(d){return ci(d)===Ul}function Ao(d){if(!d)return!1;var y=ci(d);return Uu.indexOf(y)>=0?!0:Af(d)||Gl(d)||Jn(d)}function $u(d){return fs[Object.prototype.toString.call(d)]|0}function Vp(d,y){var B=y.length;switch(d.type){case vo:case kl:case Ea:case Br:var Q=Fn.allocType(d.type,B);Q.set(y),d.data=Q;break;case yo:d.data=Lu(y);break;default:v.raise("unsupported texture type, must specify a typed array")}}function $l(d,y){return Fn.allocType(d.type===yo?Br:d.type,y)}function fd(d,y){d.type===yo?(d.data=Lu(y),Fn.freeType(y)):d.data=y}function Wp(d,y,B,Q,lt,K){for(var tt=d.width,vt=d.height,yt=d.channels,It=tt*vt*yt,Rt=$l(d,It),Ot=0,kt=0;kt<vt;++kt)for(var wt=0;wt<tt;++wt)for(var Et=0;Et<yt;++Et)Rt[Ot++]=y[B*wt+Q*kt+lt*Et+K];fd(d,Rt)}function $n(d,y,B,Q,lt,K){var tt;if(typeof tr[d]<"u"?tt=tr[d]:tt=Rr[d]*_s[y],K&&(tt*=6),lt){for(var vt=0,yt=B;yt>=1;)vt+=tt*yt*yt,yt/=2;return vt}else return tt*B*Q}function wr(d,y,B,Q,lt,K,tt){var vt={"don't care":pn,"dont care":pn,nice:Pp,fast:zl},yt={repeat:Fp,clamp:Pl,mirror:Cp},It={nearest:W,linear:gt},Rt=r({mipmap:fn,"nearest mipmap nearest":ut,"linear mipmap nearest":se,"nearest mipmap linear":Ie,"linear mipmap linear":fn},It),Ot={none:0,browser:vf},kt={uint8:vo,rgba4:Ml,rgb565:ed,"rgb5 a1":Np},wt={alpha:Nu,luminance:hs,"luminance alpha":bo,rgb:gf,rgba:ls,rgba4:Bl,"rgb5 a1":Rl,rgb565:Du},Et={};y.ext_srgb&&(wt.srgb=Fu,wt.srgba=Cu),y.oes_texture_float&&(kt.float32=kt.float=Br),y.oes_texture_half_float&&(kt.float16=kt["half float"]=yo),y.webgl_depth_texture&&(r(wt,{depth:bf,"depth stencil":Aa}),r(kt,{uint16:kl,uint32:Ea,"depth stencil":zr})),y.webgl_compressed_texture_s3tc&&r(Et,{"rgb s3tc dxt1":Ll,"rgba s3tc dxt1":Nl,"rgba s3tc dxt3":Dl,"rgba s3tc dxt5":Fl}),y.webgl_compressed_texture_atc&&r(Et,{"rgb atc":ds,"rgba atc explicit alpha":nd,"rgba atc interpolated alpha":rd}),y.webgl_compressed_texture_pvrtc&&r(Et,{"rgb pvrtc 4bppv1":ku,"rgb pvrtc 2bppv1":Cl,"rgba pvrtc 4bppv1":Zi,"rgba pvrtc 2bppv1":yf}),y.webgl_compressed_texture_etc1&&(Et["rgb etc1"]=id);var z=Array.prototype.slice.call(d.getParameter(Lp));Object.keys(Et).forEach(function(T){var nt=Et[T];z.indexOf(nt)>=0&&(wt[T]=nt)});var J=Object.keys(wt);B.textureFormats=J;var xt=[];Object.keys(wt).forEach(function(T){var nt=wt[T];xt[nt]=T});var Yt=[];Object.keys(kt).forEach(function(T){var nt=kt[T];Yt[nt]=T});var pt=[];Object.keys(It).forEach(function(T){var nt=It[T];pt[nt]=T});var Vt=[];Object.keys(Rt).forEach(function(T){var nt=Rt[T];Vt[nt]=T});var jt=[];Object.keys(yt).forEach(function(T){var nt=yt[T];jt[nt]=T});var re=J.reduce(function(T,nt){var q=wt[nt];return q===hs||q===Nu||q===hs||q===bo||q===bf||q===Aa||y.ext_srgb&&(q===Fu||q===Cu)?T[q]=q:q===Rl||nt.indexOf("rgba")>=0?T[q]=ls:T[q]=gf,T},{});function dt(){this.internalformat=ls,this.format=ls,this.type=vo,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=vf,this.width=0,this.height=0,this.channels=0}function ht(T,nt){T.internalformat=nt.internalformat,T.format=nt.format,T.type=nt.type,T.compressed=nt.compressed,T.premultiplyAlpha=nt.premultiplyAlpha,T.flipY=nt.flipY,T.unpackAlignment=nt.unpackAlignment,T.colorSpace=nt.colorSpace,T.width=nt.width,T.height=nt.height,T.channels=nt.channels}function Zt(T,nt){if(!(typeof nt!="object"||!nt)){if("premultiplyAlpha"in nt&&(v.type(nt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),T.premultiplyAlpha=nt.premultiplyAlpha),"flipY"in nt&&(v.type(nt.flipY,"boolean","invalid texture flip"),T.flipY=nt.flipY),"alignment"in nt&&(v.oneOf(nt.alignment,[1,2,4,8],"invalid texture unpack alignment"),T.unpackAlignment=nt.alignment),"colorSpace"in nt&&(v.parameter(nt.colorSpace,Ot,"invalid colorSpace"),T.colorSpace=Ot[nt.colorSpace]),"type"in nt){var q=nt.type;v(y.oes_texture_float||!(q==="float"||q==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),v(y.oes_texture_half_float||!(q==="half float"||q==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),v(y.webgl_depth_texture||!(q==="uint16"||q==="uint32"||q==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),v.parameter(q,kt,"invalid texture type"),T.type=kt[q]}var qt=T.width,Ae=T.height,x=T.channels,g=!1;"shape"in nt?(v(Array.isArray(nt.shape)&&nt.shape.length>=2,"shape must be an array"),qt=nt.shape[0],Ae=nt.shape[1],nt.shape.length===3&&(x=nt.shape[2],v(x>0&&x<=4,"invalid number of channels"),g=!0),v(qt>=0&&qt<=B.maxTextureSize,"invalid width"),v(Ae>=0&&Ae<=B.maxTextureSize,"invalid height")):("radius"in nt&&(qt=Ae=nt.radius,v(qt>=0&&qt<=B.maxTextureSize,"invalid radius")),"width"in nt&&(qt=nt.width,v(qt>=0&&qt<=B.maxTextureSize,"invalid width")),"height"in nt&&(Ae=nt.height,v(Ae>=0&&Ae<=B.maxTextureSize,"invalid height")),"channels"in nt&&(x=nt.channels,v(x>0&&x<=4,"invalid number of channels"),g=!0)),T.width=qt|0,T.height=Ae|0,T.channels=x|0;var L=!1;if("format"in nt){var U=nt.format;v(y.webgl_depth_texture||!(U==="depth"||U==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),v.parameter(U,wt,"invalid texture format");var j=T.internalformat=wt[U];T.format=re[j],U in kt&&("type"in nt||(T.type=kt[U])),U in Et&&(T.compressed=!0),L=!0}!g&&L?T.channels=Rr[T.format]:g&&!L?T.channels!==wf[T.format]&&(T.format=T.internalformat=wf[T.channels]):L&&g&&v(T.channels===Rr[T.format],"number of channels inconsistent with specified format")}}function Pt(T){d.pixelStorei(zp,T.flipY),d.pixelStorei(xo,T.premultiplyAlpha),d.pixelStorei(zu,T.colorSpace),d.pixelStorei(Pu,T.unpackAlignment)}function St(){dt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function zt(T,nt){var q=null;if(Ao(nt)?q=nt:nt&&(v.type(nt,"object","invalid pixel data type"),Zt(T,nt),"x"in nt&&(T.xOffset=nt.x|0),"y"in nt&&(T.yOffset=nt.y|0),Ao(nt.data)&&(q=nt.data)),v(!T.compressed||q instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),nt.copy){v(!q,"can not specify copy and data field for the same texture");var qt=lt.viewportWidth,Ae=lt.viewportHeight;T.width=T.width||qt-T.xOffset,T.height=T.height||Ae-T.yOffset,T.needsCopy=!0,v(T.xOffset>=0&&T.xOffset<qt&&T.yOffset>=0&&T.yOffset<Ae&&T.width>0&&T.width<=qt&&T.height>0&&T.height<=Ae,"copy texture read out of bounds")}else if(!q)T.width=T.width||1,T.height=T.height||1,T.channels=T.channels||4;else if(e(q))T.channels=T.channels||4,T.data=q,!("type"in nt)&&T.type===vo&&(T.type=$u(q));else if(Af(q))T.channels=T.channels||4,Vp(T,q),T.alignment=1,T.needsFree=!0;else if(Jn(q)){var x=q.data;!Array.isArray(x)&&T.type===vo&&(T.type=$u(x));var g=q.shape,L=q.stride,U,j,D,M,P,S;g.length===3?(D=g[2],S=L[2]):(v(g.length===2,"invalid ndarray pixel data, must be 2 or 3D"),D=1,S=1),U=g[0],j=g[1],M=L[0],P=L[1],T.alignment=1,T.width=U,T.height=j,T.channels=D,T.format=T.internalformat=wf[D],T.needsFree=!0,Wp(T,x,M,P,S,q.offset)}else if(Ta(q)||Ef(q)||Gp(q))Ta(q)||Ef(q)?T.element=q:T.element=q.canvas,T.width=T.element.width,T.height=T.element.height,T.channels=4;else if($p(q))T.element=q,T.width=q.width,T.height=q.height,T.channels=4;else if(jp(q))T.element=q,T.width=q.naturalWidth,T.height=q.naturalHeight,T.channels=4;else if(Gu(q))T.element=q,T.width=q.videoWidth,T.height=q.videoHeight,T.channels=4;else if(Gl(q)){var I=T.width||q[0].length,E=T.height||q.length,X=T.channels;In(q[0][0])?X=X||q[0][0].length:X=X||1;for(var V=os.shape(q),ct=1,_t=0;_t<V.length;++_t)ct*=V[_t];var Nt=$l(T,ct);os.flatten(q,V,"",Nt),fd(T,Nt),T.alignment=1,T.width=I,T.height=E,T.channels=X,T.format=T.internalformat=wf[X],T.needsFree=!0}T.type===Br?v(B.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):T.type===yo&&v(B.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Ut(T,nt,q){var qt=T.element,Ae=T.data,x=T.internalformat,g=T.format,L=T.type,U=T.width,j=T.height;Pt(T),qt?d.texImage2D(nt,q,g,g,L,qt):T.compressed?d.compressedTexImage2D(nt,q,x,U,j,0,Ae):T.needsCopy?(Q(),d.copyTexImage2D(nt,q,g,T.xOffset,T.yOffset,U,j,0)):d.texImage2D(nt,q,g,U,j,0,g,L,Ae||null)}function ge(T,nt,q,qt,Ae){var x=T.element,g=T.data,L=T.internalformat,U=T.format,j=T.type,D=T.width,M=T.height;Pt(T),x?d.texSubImage2D(nt,Ae,q,qt,U,j,x):T.compressed?d.compressedTexSubImage2D(nt,Ae,q,qt,L,D,M,g):T.needsCopy?(Q(),d.copyTexSubImage2D(nt,Ae,q,qt,T.xOffset,T.yOffset,D,M)):d.texSubImage2D(nt,Ae,q,qt,D,M,U,j,g)}var _e=[];function Gt(){return _e.pop()||new St}function Wt(T){T.needsFree&&Fn.freeType(T.data),St.call(T),_e.push(T)}function ue(){dt.call(this),this.genMipmaps=!1,this.mipmapHint=pn,this.mipmask=0,this.images=Array(16)}function me(T,nt,q){var qt=T.images[0]=Gt();T.mipmask=1,qt.width=T.width=nt,qt.height=T.height=q,qt.channels=T.channels=4}function Ee(T,nt){var q=null;if(Ao(nt))q=T.images[0]=Gt(),ht(q,T),zt(q,nt),T.mipmask=1;else if(Zt(T,nt),Array.isArray(nt.mipmap))for(var qt=nt.mipmap,Ae=0;Ae<qt.length;++Ae)q=T.images[Ae]=Gt(),ht(q,T),q.width>>=Ae,q.height>>=Ae,zt(q,qt[Ae]),T.mipmask|=1<<Ae;else q=T.images[0]=Gt(),ht(q,T),zt(q,nt),T.mipmask=1;ht(T,T.images[0]),T.compressed&&(T.internalformat===Ll||T.internalformat===Nl||T.internalformat===Dl||T.internalformat===Fl)&&v(T.width%4===0&&T.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function En(T,nt){for(var q=T.images,qt=0;qt<q.length;++qt){if(!q[qt])return;Ut(q[qt],nt,qt)}}var vn=[];function Oe(){var T=vn.pop()||new ue;dt.call(T),T.mipmask=0;for(var nt=0;nt<16;++nt)T.images[nt]=null;return T}function mn(T){for(var nt=T.images,q=0;q<nt.length;++q)nt[q]&&Wt(nt[q]),nt[q]=null;vn.push(T)}function an(){this.minFilter=W,this.magFilter=W,this.wrapS=Pl,this.wrapT=Pl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=pn}function jn(T,nt){if("min"in nt){var q=nt.min;v.parameter(q,Rt),T.minFilter=Rt[q],Up.indexOf(T.minFilter)>=0&&!("faces"in nt)&&(T.genMipmaps=!0)}if("mag"in nt){var qt=nt.mag;v.parameter(qt,It),T.magFilter=It[qt]}var Ae=T.wrapS,x=T.wrapT;if("wrap"in nt){var g=nt.wrap;typeof g=="string"?(v.parameter(g,yt),Ae=x=yt[g]):Array.isArray(g)&&(v.parameter(g[0],yt),v.parameter(g[1],yt),Ae=yt[g[0]],x=yt[g[1]])}else{if("wrapS"in nt){var L=nt.wrapS;v.parameter(L,yt),Ae=yt[L]}if("wrapT"in nt){var U=nt.wrapT;v.parameter(U,yt),x=yt[U]}}if(T.wrapS=Ae,T.wrapT=x,"anisotropic"in nt){var j=nt.anisotropic;v(typeof j=="number"&&j>=1&&j<=B.maxAnisotropic,"aniso samples must be between 1 and "),T.anisotropic=nt.anisotropic}if("mipmap"in nt){var D=!1;switch(typeof nt.mipmap){case"string":v.parameter(nt.mipmap,vt,"invalid mipmap hint"),T.mipmapHint=vt[nt.mipmap],T.genMipmaps=!0,D=!0;break;case"boolean":D=T.genMipmaps=nt.mipmap;break;case"object":v(Array.isArray(nt.mipmap),"invalid mipmap type"),T.genMipmaps=!1,D=!0;break;default:v.raise("invalid mipmap type")}D&&!("min"in nt)&&(T.minFilter=ut)}}function Vn(T,nt){d.texParameteri(nt,wo,T.minFilter),d.texParameteri(nt,kp,T.magFilter),d.texParameteri(nt,ad,T.wrapS),d.texParameteri(nt,Dp,T.wrapT),y.ext_texture_filter_anisotropic&&d.texParameteri(nt,Hr,T.anisotropic),T.genMipmaps&&(d.hint(Qn,T.mipmapHint),d.generateMipmap(nt))}var Yn=0,er={},fr=B.maxTextureUnits,zn=Array(fr).map(function(){return null});function we(T){dt.call(this),this.mipmask=0,this.internalformat=ls,this.id=Yn++,this.refCount=1,this.target=T,this.texture=d.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new an,tt.profile&&(this.stats={size:0})}function ur(T){d.activeTexture(un),d.bindTexture(T.target,T.texture)}function en(){var T=zn[0];T?d.bindTexture(T.target,T.texture):d.bindTexture(ui,null)}function ce(T){var nt=T.texture;v(nt,"must not double destroy texture");var q=T.unit,qt=T.target;q>=0&&(d.activeTexture(un+q),d.bindTexture(qt,null),zn[q]=null),d.deleteTexture(nt),T.texture=null,T.params=null,T.pixels=null,T.refCount=0,delete er[T.id],K.textureCount--}r(we.prototype,{bind:function(){var T=this;T.bindCount+=1;var nt=T.unit;if(nt<0){for(var q=0;q<fr;++q){var qt=zn[q];if(qt){if(qt.bindCount>0)continue;qt.unit=-1}zn[q]=T,nt=q;break}nt>=fr&&v.raise("insufficient number of texture units"),tt.profile&&K.maxTextureUnits<nt+1&&(K.maxTextureUnits=nt+1),T.unit=nt,d.activeTexture(un+nt),d.bindTexture(T.target,T.texture)}return nt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ce(this)}});function Be(T,nt){var q=new we(ui);er[q.id]=q,K.textureCount++;function qt(g,L){var U=q.texInfo;an.call(U);var j=Oe();return typeof g=="number"?typeof L=="number"?me(j,g|0,L|0):me(j,g|0,g|0):g?(v.type(g,"object","invalid arguments to regl.texture"),jn(U,g),Ee(j,g)):me(j,1,1),U.genMipmaps&&(j.mipmask=(j.width<<1)-1),q.mipmask=j.mipmask,ht(q,j),v.texture2D(U,j,B),q.internalformat=j.internalformat,qt.width=j.width,qt.height=j.height,ur(q),En(j,ui),Vn(U,ui),en(),mn(j),tt.profile&&(q.stats.size=$n(q.internalformat,q.type,j.width,j.height,U.genMipmaps,!1)),qt.format=xt[q.internalformat],qt.type=Yt[q.type],qt.mag=pt[U.magFilter],qt.min=Vt[U.minFilter],qt.wrapS=jt[U.wrapS],qt.wrapT=jt[U.wrapT],qt}function Ae(g,L,U,j){v(!!g,"must specify image data");var D=L|0,M=U|0,P=j|0,S=Gt();return ht(S,q),S.width=0,S.height=0,zt(S,g),S.width=S.width||(q.width>>P)-D,S.height=S.height||(q.height>>P)-M,v(q.type===S.type&&q.format===S.format&&q.internalformat===S.internalformat,"incompatible format for texture.subimage"),v(D>=0&&M>=0&&D+S.width<=q.width&&M+S.height<=q.height,"texture.subimage write out of bounds"),v(q.mipmask&1<<P,"missing mipmap data"),v(S.data||S.element||S.needsCopy,"missing image data"),ur(q),ge(S,ui,D,M,P),en(),Wt(S),qt}function x(g,L){var U=g|0,j=L|0||U;if(U===q.width&&j===q.height)return qt;qt.width=q.width=U,qt.height=q.height=j,ur(q);for(var D=0;q.mipmask>>D;++D){var M=U>>D,P=j>>D;if(!M||!P)break;d.texImage2D(ui,D,q.format,M,P,0,q.format,q.type,null)}return en(),tt.profile&&(q.stats.size=$n(q.internalformat,q.type,U,j,!1,!1)),qt}return qt(T,nt),qt.subimage=Ae,qt.resize=x,qt._reglType="texture2d",qt._texture=q,tt.profile&&(qt.stats=q.stats),qt.destroy=function(){q.decRef()},qt}function je(T,nt,q,qt,Ae,x){var g=new we(go);er[g.id]=g,K.cubeCount++;var L=new Array(6);function U(M,P,S,I,E,X){var V,ct=g.texInfo;for(an.call(ct),V=0;V<6;++V)L[V]=Oe();if(typeof M=="number"||!M){var _t=M|0||1;for(V=0;V<6;++V)me(L[V],_t,_t)}else if(typeof M=="object")if(P)Ee(L[0],M),Ee(L[1],P),Ee(L[2],S),Ee(L[3],I),Ee(L[4],E),Ee(L[5],X);else if(jn(ct,M),Zt(g,M),"faces"in M){var Nt=M.faces;for(v(Array.isArray(Nt)&&Nt.length===6,"cube faces must be a length 6 array"),V=0;V<6;++V)v(typeof Nt[V]=="object"&&!!Nt[V],"invalid input for cube map face"),ht(L[V],g),Ee(L[V],Nt[V])}else for(V=0;V<6;++V)Ee(L[V],M);else v.raise("invalid arguments to cube map");for(ht(g,L[0]),v.optional(function(){B.npotTextureCube||v(td(g.width)&&td(g.height),"your browser does not support non power or two texture dimensions")}),ct.genMipmaps?g.mipmask=(L[0].width<<1)-1:g.mipmask=L[0].mipmask,v.textureCube(g,ct,L,B),g.internalformat=L[0].internalformat,U.width=L[0].width,U.height=L[0].height,ur(g),V=0;V<6;++V)En(L[V],qi+V);for(Vn(ct,go),en(),tt.profile&&(g.stats.size=$n(g.internalformat,g.type,U.width,U.height,ct.genMipmaps,!0)),U.format=xt[g.internalformat],U.type=Yt[g.type],U.mag=pt[ct.magFilter],U.min=Vt[ct.minFilter],U.wrapS=jt[ct.wrapS],U.wrapT=jt[ct.wrapT],V=0;V<6;++V)mn(L[V]);return U}function j(M,P,S,I,E){v(!!P,"must specify image data"),v(typeof M=="number"&&M===(M|0)&&M>=0&&M<6,"invalid face");var X=S|0,V=I|0,ct=E|0,_t=Gt();return ht(_t,g),_t.width=0,_t.height=0,zt(_t,P),_t.width=_t.width||(g.width>>ct)-X,_t.height=_t.height||(g.height>>ct)-V,v(g.type===_t.type&&g.format===_t.format&&g.internalformat===_t.internalformat,"incompatible format for texture.subimage"),v(X>=0&&V>=0&&X+_t.width<=g.width&&V+_t.height<=g.height,"texture.subimage write out of bounds"),v(g.mipmask&1<<ct,"missing mipmap data"),v(_t.data||_t.element||_t.needsCopy,"missing image data"),ur(g),ge(_t,qi+M,X,V,ct),en(),Wt(_t),U}function D(M){var P=M|0;if(P!==g.width){U.width=g.width=P,U.height=g.height=P,ur(g);for(var S=0;S<6;++S)for(var I=0;g.mipmask>>I;++I)d.texImage2D(qi+S,I,g.format,P>>I,P>>I,0,g.format,g.type,null);return en(),tt.profile&&(g.stats.size=$n(g.internalformat,g.type,U.width,U.height,!1,!0)),U}}return U(T,nt,q,qt,Ae,x),U.subimage=j,U.resize=D,U._reglType="textureCube",U._texture=g,tt.profile&&(U.stats=g.stats),U.destroy=function(){g.decRef()},U}function Un(){for(var T=0;T<fr;++T)d.activeTexture(un+T),d.bindTexture(ui,null),zn[T]=null;vr(er).forEach(ce),K.cubeCount=0,K.textureCount=0}tt.profile&&(K.getTotalTextureSize=function(){var T=0;return Object.keys(er).forEach(function(nt){T+=er[nt].stats.size}),T});function mi(){for(var T=0;T<fr;++T){var nt=zn[T];nt&&(nt.bindCount=0,nt.unit=-1,zn[T]=null)}vr(er).forEach(function(q){q.texture=d.createTexture(),d.bindTexture(q.target,q.texture);for(var qt=0;qt<32;++qt)if(q.mipmask&1<<qt)if(q.target===ui)d.texImage2D(ui,qt,q.internalformat,q.width>>qt,q.height>>qt,0,q.internalformat,q.type,null);else for(var Ae=0;Ae<6;++Ae)d.texImage2D(qi+Ae,qt,q.internalformat,q.width>>qt,q.height>>qt,0,q.internalformat,q.type,null);Vn(q.texInfo,q.target)})}function ka(){for(var T=0;T<fr;++T){var nt=zn[T];nt&&(nt.bindCount=0,nt.unit=-1,zn[T]=null),d.activeTexture(un+T),d.bindTexture(ui,null),d.bindTexture(go,null)}}return{create2D:Be,createCube:je,clear:Un,getTexture:function(T){return null},restore:mi,refresh:ka}}var Ia=36161,ju=32854,jl=32855,ud=36194,Vu=33189,Eo=36168,Wu=34041,ps=35907,To=34836,Io=34842,Tf=34843,xr=[];xr[ju]=2,xr[jl]=2,xr[ud]=2,xr[Vu]=2,xr[Eo]=1,xr[Wu]=4,xr[ps]=4,xr[To]=16,xr[Io]=8,xr[Tf]=6;function cd(d,y,B){return xr[d]*y*B}var Yp=function(d,y,B,Q,lt){var K={rgba4:ju,rgb565:ud,"rgb5 a1":jl,depth:Vu,stencil:Eo,"depth stencil":Wu};y.ext_srgb&&(K.srgba=ps),y.ext_color_buffer_half_float&&(K.rgba16f=Io,K.rgb16f=Tf),y.webgl_color_buffer_float&&(K.rgba32f=To);var tt=[];Object.keys(K).forEach(function(wt){var Et=K[wt];tt[Et]=wt});var vt=0,yt={};function It(wt){this.id=vt++,this.refCount=1,this.renderbuffer=wt,this.format=ju,this.width=0,this.height=0,lt.profile&&(this.stats={size:0})}It.prototype.decRef=function(){--this.refCount<=0&&Rt(this)};function Rt(wt){var Et=wt.renderbuffer;v(Et,"must not double destroy renderbuffer"),d.bindRenderbuffer(Ia,null),d.deleteRenderbuffer(Et),wt.renderbuffer=null,wt.refCount=0,delete yt[wt.id],Q.renderbufferCount--}function Ot(wt,Et){var z=new It(d.createRenderbuffer());yt[z.id]=z,Q.renderbufferCount++;function J(Yt,pt){var Vt=0,jt=0,re=ju;if(typeof Yt=="object"&&Yt){var dt=Yt;if("shape"in dt){var ht=dt.shape;v(Array.isArray(ht)&&ht.length>=2,"invalid renderbuffer shape"),Vt=ht[0]|0,jt=ht[1]|0}else"radius"in dt&&(Vt=jt=dt.radius|0),"width"in dt&&(Vt=dt.width|0),"height"in dt&&(jt=dt.height|0);"format"in dt&&(v.parameter(dt.format,K,"invalid renderbuffer format"),re=K[dt.format])}else typeof Yt=="number"?(Vt=Yt|0,typeof pt=="number"?jt=pt|0:jt=Vt):Yt?v.raise("invalid arguments to renderbuffer constructor"):Vt=jt=1;if(v(Vt>0&&jt>0&&Vt<=B.maxRenderbufferSize&&jt<=B.maxRenderbufferSize,"invalid renderbuffer size"),!(Vt===z.width&&jt===z.height&&re===z.format))return J.width=z.width=Vt,J.height=z.height=jt,z.format=re,d.bindRenderbuffer(Ia,z.renderbuffer),d.renderbufferStorage(Ia,re,Vt,jt),v(d.getError()===0,"invalid render buffer format"),lt.profile&&(z.stats.size=cd(z.format,z.width,z.height)),J.format=tt[z.format],J}function xt(Yt,pt){var Vt=Yt|0,jt=pt|0||Vt;return Vt===z.width&&jt===z.height||(v(Vt>0&&jt>0&&Vt<=B.maxRenderbufferSize&&jt<=B.maxRenderbufferSize,"invalid renderbuffer size"),J.width=z.width=Vt,J.height=z.height=jt,d.bindRenderbuffer(Ia,z.renderbuffer),d.renderbufferStorage(Ia,z.format,Vt,jt),v(d.getError()===0,"invalid render buffer format"),lt.profile&&(z.stats.size=cd(z.format,z.width,z.height))),J}return J(wt,Et),J.resize=xt,J._reglType="renderbuffer",J._renderbuffer=z,lt.profile&&(J.stats=z.stats),J.destroy=function(){z.decRef()},J}lt.profile&&(Q.getTotalRenderbufferSize=function(){var wt=0;return Object.keys(yt).forEach(function(Et){wt+=yt[Et].stats.size}),wt});function kt(){vr(yt).forEach(function(wt){wt.renderbuffer=d.createRenderbuffer(),d.bindRenderbuffer(Ia,wt.renderbuffer),d.renderbufferStorage(Ia,wt.format,wt.width,wt.height)}),d.bindRenderbuffer(Ia,null)}return{create:Ot,clear:function(){vr(yt).forEach(Rt)},restore:kt}},Ji=36160,Vl=36161,ms=3553,gs=34069,Oo=36064,Wl=36096,b=36128,bs=33306,If=36053,Xr=36054,tn=36055,Hp=36057,Xp=36061,qp=36193,ys=5121,Zp=5126,ld=6407,hd=6408,Kp=6402,Jp=[ld,hd],li=[];li[hd]=4,li[ld]=3;var Yu=[];Yu[ys]=1,Yu[Zp]=4,Yu[qp]=2;var Qp=32854,tm=32855,em=36194,nm=33189,Qi=36168,dd=34041,rm=35907,im=34836,am=34842,sm=34843,vs=[Qp,tm,em,rm,am,sm,im],Bo={};Bo[If]="complete",Bo[Xr]="incomplete attachment",Bo[Hp]="incomplete dimensions",Bo[tn]="incomplete, missing attachment",Bo[Xp]="unsupported";function om(d,y,B,Q,lt,K){var tt={cur:null,next:null,dirty:!1,setFBO:null},vt=["rgba"],yt=["rgba4","rgb565","rgb5 a1"];y.ext_srgb&&yt.push("srgba"),y.ext_color_buffer_half_float&&yt.push("rgba16f","rgb16f"),y.webgl_color_buffer_float&&yt.push("rgba32f");var It=["uint8"];y.oes_texture_half_float&&It.push("half float","float16"),y.oes_texture_float&&It.push("float","float32");function Rt(St,zt,Ut){this.target=St,this.texture=zt,this.renderbuffer=Ut;var ge=0,_e=0;zt?(ge=zt.width,_e=zt.height):Ut&&(ge=Ut.width,_e=Ut.height),this.width=ge,this.height=_e}function Ot(St){St&&(St.texture&&St.texture._texture.decRef(),St.renderbuffer&&St.renderbuffer._renderbuffer.decRef())}function kt(St,zt,Ut){if(St)if(St.texture){var ge=St.texture._texture,_e=Math.max(1,ge.width),Gt=Math.max(1,ge.height);v(_e===zt&&Gt===Ut,"inconsistent width/height for supplied texture"),ge.refCount+=1}else{var Wt=St.renderbuffer._renderbuffer;v(Wt.width===zt&&Wt.height===Ut,"inconsistent width/height for renderbuffer"),Wt.refCount+=1}}function wt(St,zt){zt&&(zt.texture?d.framebufferTexture2D(Ji,St,zt.target,zt.texture._texture.texture,0):d.framebufferRenderbuffer(Ji,St,Vl,zt.renderbuffer._renderbuffer.renderbuffer))}function Et(St){var zt=ms,Ut=null,ge=null,_e=St;typeof St=="object"&&(_e=St.data,"target"in St&&(zt=St.target|0)),v.type(_e,"function","invalid attachment data");var Gt=_e._reglType;return Gt==="texture2d"?(Ut=_e,v(zt===ms)):Gt==="textureCube"?(Ut=_e,v(zt>=gs&&zt<gs+6,"invalid cube map target")):Gt==="renderbuffer"?(ge=_e,zt=Vl):v.raise("invalid regl object for attachment"),new Rt(zt,Ut,ge)}function z(St,zt,Ut,ge,_e){if(Ut){var Gt=Q.create2D({width:St,height:zt,format:ge,type:_e});return Gt._texture.refCount=0,new Rt(ms,Gt,null)}else{var Wt=lt.create({width:St,height:zt,format:ge});return Wt._renderbuffer.refCount=0,new Rt(Vl,null,Wt)}}function J(St){return St&&(St.texture||St.renderbuffer)}function xt(St,zt,Ut){St&&(St.texture?St.texture.resize(zt,Ut):St.renderbuffer&&St.renderbuffer.resize(zt,Ut),St.width=zt,St.height=Ut)}var Yt=0,pt={};function Vt(){this.id=Yt++,pt[this.id]=this,this.framebuffer=d.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function jt(St){St.colorAttachments.forEach(Ot),Ot(St.depthAttachment),Ot(St.stencilAttachment),Ot(St.depthStencilAttachment)}function re(St){var zt=St.framebuffer;v(zt,"must not double destroy framebuffer"),d.deleteFramebuffer(zt),St.framebuffer=null,K.framebufferCount--,delete pt[St.id]}function dt(St){var zt;d.bindFramebuffer(Ji,St.framebuffer);var Ut=St.colorAttachments;for(zt=0;zt<Ut.length;++zt)wt(Oo+zt,Ut[zt]);for(zt=Ut.length;zt<B.maxColorAttachments;++zt)d.framebufferTexture2D(Ji,Oo+zt,ms,null,0);d.framebufferTexture2D(Ji,bs,ms,null,0),d.framebufferTexture2D(Ji,Wl,ms,null,0),d.framebufferTexture2D(Ji,b,ms,null,0),wt(Wl,St.depthAttachment),wt(b,St.stencilAttachment),wt(bs,St.depthStencilAttachment);var ge=d.checkFramebufferStatus(Ji);!d.isContextLost()&&ge!==If&&v.raise("framebuffer configuration not supported, status = "+Bo[ge]),d.bindFramebuffer(Ji,tt.next?tt.next.framebuffer:null),tt.cur=tt.next,d.getError()}function ht(St,zt){var Ut=new Vt;K.framebufferCount++;function ge(Gt,Wt){var ue;v(tt.next!==Ut,"can not update framebuffer which is currently in use");var me=0,Ee=0,En=!0,vn=!0,Oe=null,mn=!0,an="rgba",jn="uint8",Vn=1,Yn=null,er=null,fr=null,zn=!1;if(typeof Gt=="number")me=Gt|0,Ee=Wt|0||me;else if(!Gt)me=Ee=1;else{v.type(Gt,"object","invalid arguments for framebuffer");var we=Gt;if("shape"in we){var ur=we.shape;v(Array.isArray(ur)&&ur.length>=2,"invalid shape for framebuffer"),me=ur[0],Ee=ur[1]}else"radius"in we&&(me=Ee=we.radius),"width"in we&&(me=we.width),"height"in we&&(Ee=we.height);("color"in we||"colors"in we)&&(Oe=we.color||we.colors,Array.isArray(Oe)&&v(Oe.length===1||y.webgl_draw_buffers,"multiple render targets not supported")),Oe||("colorCount"in we&&(Vn=we.colorCount|0,v(Vn>0,"invalid color buffer count")),"colorTexture"in we&&(mn=!!we.colorTexture,an="rgba4"),"colorType"in we&&(jn=we.colorType,mn?(v(y.oes_texture_float||!(jn==="float"||jn==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),v(y.oes_texture_half_float||!(jn==="half float"||jn==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):jn==="half float"||jn==="float16"?(v(y.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),an="rgba16f"):(jn==="float"||jn==="float32")&&(v(y.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),an="rgba32f"),v.oneOf(jn,It,"invalid color type")),"colorFormat"in we&&(an=we.colorFormat,vt.indexOf(an)>=0?mn=!0:yt.indexOf(an)>=0?mn=!1:v.optional(function(){mn?v.oneOf(we.colorFormat,vt,"invalid color format for texture"):v.oneOf(we.colorFormat,yt,"invalid color format for renderbuffer")}))),("depthTexture"in we||"depthStencilTexture"in we)&&(zn=!!(we.depthTexture||we.depthStencilTexture),v(!zn||y.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in we&&(typeof we.depth=="boolean"?En=we.depth:(Yn=we.depth,vn=!1)),"stencil"in we&&(typeof we.stencil=="boolean"?vn=we.stencil:(er=we.stencil,En=!1)),"depthStencil"in we&&(typeof we.depthStencil=="boolean"?En=vn=we.depthStencil:(fr=we.depthStencil,En=!1,vn=!1))}var en=null,ce=null,Be=null,je=null;if(Array.isArray(Oe))en=Oe.map(Et);else if(Oe)en=[Et(Oe)];else for(en=new Array(Vn),ue=0;ue<Vn;++ue)en[ue]=z(me,Ee,mn,an,jn);v(y.webgl_draw_buffers||en.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),v(en.length<=B.maxColorAttachments,"too many color attachments, not supported"),me=me||en[0].width,Ee=Ee||en[0].height,Yn?ce=Et(Yn):En&&!vn&&(ce=z(me,Ee,zn,"depth","uint32")),er?Be=Et(er):vn&&!En&&(Be=z(me,Ee,!1,"stencil","uint8")),fr?je=Et(fr):!Yn&&!er&&vn&&En&&(je=z(me,Ee,zn,"depth stencil","depth stencil")),v(!!Yn+!!er+!!fr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Un=null;for(ue=0;ue<en.length;++ue)if(kt(en[ue],me,Ee),v(!en[ue]||en[ue].texture&&Jp.indexOf(en[ue].texture._texture.format)>=0||en[ue].renderbuffer&&vs.indexOf(en[ue].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ue+" is invalid"),en[ue]&&en[ue].texture){var mi=li[en[ue].texture._texture.format]*Yu[en[ue].texture._texture.type];Un===null?Un=mi:v(Un===mi,"all color attachments much have the same number of bits per pixel.")}return kt(ce,me,Ee),v(!ce||ce.texture&&ce.texture._texture.format===Kp||ce.renderbuffer&&ce.renderbuffer._renderbuffer.format===nm,"invalid depth attachment for framebuffer object"),kt(Be,me,Ee),v(!Be||Be.renderbuffer&&Be.renderbuffer._renderbuffer.format===Qi,"invalid stencil attachment for framebuffer object"),kt(je,me,Ee),v(!je||je.texture&&je.texture._texture.format===dd||je.renderbuffer&&je.renderbuffer._renderbuffer.format===dd,"invalid depth-stencil attachment for framebuffer object"),jt(Ut),Ut.width=me,Ut.height=Ee,Ut.colorAttachments=en,Ut.depthAttachment=ce,Ut.stencilAttachment=Be,Ut.depthStencilAttachment=je,ge.color=en.map(J),ge.depth=J(ce),ge.stencil=J(Be),ge.depthStencil=J(je),ge.width=Ut.width,ge.height=Ut.height,dt(Ut),ge}function _e(Gt,Wt){v(tt.next!==Ut,"can not resize a framebuffer which is currently in use");var ue=Math.max(Gt|0,1),me=Math.max(Wt|0||ue,1);if(ue===Ut.width&&me===Ut.height)return ge;for(var Ee=Ut.colorAttachments,En=0;En<Ee.length;++En)xt(Ee[En],ue,me);return xt(Ut.depthAttachment,ue,me),xt(Ut.stencilAttachment,ue,me),xt(Ut.depthStencilAttachment,ue,me),Ut.width=ge.width=ue,Ut.height=ge.height=me,dt(Ut),ge}return ge(St,zt),r(ge,{resize:_e,_reglType:"framebuffer",_framebuffer:Ut,destroy:function(){re(Ut),jt(Ut)},use:function(Gt){tt.setFBO({framebuffer:ge},Gt)}})}function Zt(St){var zt=Array(6);function Ut(_e){var Gt;v(zt.indexOf(tt.next)<0,"can not update framebuffer which is currently in use");var Wt={color:null},ue=0,me=null,Ee="rgba",En="uint8",vn=1;if(typeof _e=="number")ue=_e|0;else if(!_e)ue=1;else{v.type(_e,"object","invalid arguments for framebuffer");var Oe=_e;if("shape"in Oe){var mn=Oe.shape;v(Array.isArray(mn)&&mn.length>=2,"invalid shape for framebuffer"),v(mn[0]===mn[1],"cube framebuffer must be square"),ue=mn[0]}else"radius"in Oe&&(ue=Oe.radius|0),"width"in Oe?(ue=Oe.width|0,"height"in Oe&&v(Oe.height===ue,"must be square")):"height"in Oe&&(ue=Oe.height|0);("color"in Oe||"colors"in Oe)&&(me=Oe.color||Oe.colors,Array.isArray(me)&&v(me.length===1||y.webgl_draw_buffers,"multiple render targets not supported")),me||("colorCount"in Oe&&(vn=Oe.colorCount|0,v(vn>0,"invalid color buffer count")),"colorType"in Oe&&(v.oneOf(Oe.colorType,It,"invalid color type"),En=Oe.colorType),"colorFormat"in Oe&&(Ee=Oe.colorFormat,v.oneOf(Oe.colorFormat,vt,"invalid color format for texture"))),"depth"in Oe&&(Wt.depth=Oe.depth),"stencil"in Oe&&(Wt.stencil=Oe.stencil),"depthStencil"in Oe&&(Wt.depthStencil=Oe.depthStencil)}var an;if(me)if(Array.isArray(me))for(an=[],Gt=0;Gt<me.length;++Gt)an[Gt]=me[Gt];else an=[me];else{an=Array(vn);var jn={radius:ue,format:Ee,type:En};for(Gt=0;Gt<vn;++Gt)an[Gt]=Q.createCube(jn)}for(Wt.color=Array(an.length),Gt=0;Gt<an.length;++Gt){var Vn=an[Gt];v(typeof Vn=="function"&&Vn._reglType==="textureCube","invalid cube map"),ue=ue||Vn.width,v(Vn.width===ue&&Vn.height===ue,"invalid cube map shape"),Wt.color[Gt]={target:gs,data:an[Gt]}}for(Gt=0;Gt<6;++Gt){for(var Yn=0;Yn<an.length;++Yn)Wt.color[Yn].target=gs+Gt;Gt>0&&(Wt.depth=zt[0].depth,Wt.stencil=zt[0].stencil,Wt.depthStencil=zt[0].depthStencil),zt[Gt]?zt[Gt](Wt):zt[Gt]=ht(Wt)}return r(Ut,{width:ue,height:ue,color:an})}function ge(_e){var Gt,Wt=_e|0;if(v(Wt>0&&Wt<=B.maxCubeMapSize,"invalid radius for cube fbo"),Wt===Ut.width)return Ut;var ue=Ut.color;for(Gt=0;Gt<ue.length;++Gt)ue[Gt].resize(Wt);for(Gt=0;Gt<6;++Gt)zt[Gt].resize(Wt);return Ut.width=Ut.height=Wt,Ut}return Ut(St),r(Ut,{faces:zt,resize:ge,_reglType:"framebufferCube",destroy:function(){zt.forEach(function(_e){_e.destroy()})}})}function Pt(){tt.cur=null,tt.next=null,tt.dirty=!0,vr(pt).forEach(function(St){St.framebuffer=d.createFramebuffer(),dt(St)})}return r(tt,{getFramebuffer:function(St){if(typeof St=="function"&&St._reglType==="framebuffer"){var zt=St._framebuffer;if(zt instanceof Vt)return zt}return null},create:ht,createCube:Zt,clear:function(){vr(pt).forEach(re)},restore:Pt})}var hi=5126,_d=34962,Hu=34963,pd=["attributes","elements","offset","count","primitive","instances"];function Yl(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=hi,this.offset=0,this.stride=0,this.divisor=0}function fm(d,y,B,Q,lt,K,tt){for(var vt=B.maxAttributes,yt=new Array(vt),It=0;It<vt;++It)yt[It]=new Yl;var Rt=0,Ot={},kt={Record:Yl,scope:{},state:yt,currentVAO:null,targetVAO:null,restore:Et()?jt:function(){},createVAO:re,getVAO:J,destroyBuffer:wt,setVAO:Et()?xt:Yt,clear:Et()?pt:function(){}};function wt(dt){for(var ht=0;ht<yt.length;++ht){var Zt=yt[ht];Zt.buffer===dt&&(d.disableVertexAttribArray(ht),Zt.buffer=null)}}function Et(){return y.oes_vertex_array_object}function z(){return y.angle_instanced_arrays}function J(dt){return typeof dt=="function"&&dt._vao?dt._vao:null}function xt(dt){if(dt!==kt.currentVAO){var ht=Et();dt?ht.bindVertexArrayOES(dt.vao):ht.bindVertexArrayOES(null),kt.currentVAO=dt}}function Yt(dt){if(dt!==kt.currentVAO){if(dt)dt.bindAttrs();else{for(var ht=z(),Zt=0;Zt<yt.length;++Zt){var Pt=yt[Zt];Pt.buffer?(d.enableVertexAttribArray(Zt),Pt.buffer.bind(),d.vertexAttribPointer(Zt,Pt.size,Pt.type,Pt.normalized,Pt.stride,Pt.offfset),ht&&Pt.divisor&&ht.vertexAttribDivisorANGLE(Zt,Pt.divisor)):(d.disableVertexAttribArray(Zt),d.vertexAttrib4f(Zt,Pt.x,Pt.y,Pt.z,Pt.w))}tt.elements?d.bindBuffer(Hu,tt.elements.buffer.buffer):d.bindBuffer(Hu,null)}kt.currentVAO=dt}}function pt(){vr(Ot).forEach(function(dt){dt.destroy()})}function Vt(){this.id=++Rt,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var dt=Et();dt?this.vao=dt.createVertexArrayOES():this.vao=null,Ot[this.id]=this,this.buffers=[]}Vt.prototype.bindAttrs=function(){for(var dt=z(),ht=this.attributes,Zt=0;Zt<ht.length;++Zt){var Pt=ht[Zt];Pt.buffer?(d.enableVertexAttribArray(Zt),d.bindBuffer(_d,Pt.buffer.buffer),d.vertexAttribPointer(Zt,Pt.size,Pt.type,Pt.normalized,Pt.stride,Pt.offset),dt&&Pt.divisor&&dt.vertexAttribDivisorANGLE(Zt,Pt.divisor)):(d.disableVertexAttribArray(Zt),d.vertexAttrib4f(Zt,Pt.x,Pt.y,Pt.z,Pt.w))}for(var St=ht.length;St<vt;++St)d.disableVertexAttribArray(St);var zt=K.getElements(this.elements);zt?d.bindBuffer(Hu,zt.buffer.buffer):d.bindBuffer(Hu,null)},Vt.prototype.refresh=function(){var dt=Et();dt&&(dt.bindVertexArrayOES(this.vao),this.bindAttrs(),kt.currentVAO=null,dt.bindVertexArrayOES(null))},Vt.prototype.destroy=function(){if(this.vao){var dt=Et();this===kt.currentVAO&&(kt.currentVAO=null,dt.bindVertexArrayOES(null)),dt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Ot[this.id]&&(delete Ot[this.id],Q.vaoCount-=1)};function jt(){var dt=Et();dt&&vr(Ot).forEach(function(ht){ht.refresh()})}function re(dt){var ht=new Vt;Q.vaoCount+=1;function Zt(Pt){var St;if(Array.isArray(Pt))St=Pt,ht.elements&&ht.ownsElements&&ht.elements.destroy(),ht.elements=null,ht.ownsElements=!1,ht.offset=0,ht.count=0,ht.instances=-1,ht.primitive=4;else{if(v(typeof Pt=="object","invalid arguments for create vao"),v("attributes"in Pt,"must specify attributes for vao"),Pt.elements){var zt=Pt.elements;ht.ownsElements?typeof zt=="function"&&zt._reglType==="elements"?(ht.elements.destroy(),ht.ownsElements=!1):(ht.elements(zt),ht.ownsElements=!1):K.getElements(Pt.elements)?(ht.elements=Pt.elements,ht.ownsElements=!1):(ht.elements=K.create(Pt.elements),ht.ownsElements=!0)}else ht.elements=null,ht.ownsElements=!1;St=Pt.attributes,ht.offset=0,ht.count=-1,ht.instances=-1,ht.primitive=4,ht.elements&&(ht.count=ht.elements._elements.vertCount,ht.primitive=ht.elements._elements.primType),"offset"in Pt&&(ht.offset=Pt.offset|0),"count"in Pt&&(ht.count=Pt.count|0),"instances"in Pt&&(ht.instances=Pt.instances|0),"primitive"in Pt&&(v(Pt.primitive in Pr,"bad primitive type: "+Pt.primitive),ht.primitive=Pr[Pt.primitive]),v.optional(()=>{for(var En=Object.keys(Pt),vn=0;vn<En.length;++vn)v(pd.indexOf(En[vn])>=0,'invalid option for vao: "'+En[vn]+'" valid options are '+pd)}),v(Array.isArray(St),"attributes must be an array")}v(St.length<vt,"too many attributes"),v(St.length>0,"must specify at least one attribute");var Ut={},ge=ht.attributes;ge.length=St.length;for(var _e=0;_e<St.length;++_e){var Gt=St[_e],Wt=ge[_e]=new Yl,ue=Gt.data||Gt;if(Array.isArray(ue)||e(ue)||Jn(ue)){var me;ht.buffers[_e]&&(me=ht.buffers[_e],e(ue)&&me._buffer.byteLength>=ue.byteLength?me.subdata(ue):(me.destroy(),ht.buffers[_e]=null)),ht.buffers[_e]||(me=ht.buffers[_e]=lt.create(Gt,_d,!1,!0)),Wt.buffer=lt.getBuffer(me),Wt.size=Wt.buffer.dimension|0,Wt.normalized=!1,Wt.type=Wt.buffer.dtype,Wt.offset=0,Wt.stride=0,Wt.divisor=0,Wt.state=1,Ut[_e]=1}else lt.getBuffer(Gt)?(Wt.buffer=lt.getBuffer(Gt),Wt.size=Wt.buffer.dimension|0,Wt.normalized=!1,Wt.type=Wt.buffer.dtype,Wt.offset=0,Wt.stride=0,Wt.divisor=0,Wt.state=1):lt.getBuffer(Gt.buffer)?(Wt.buffer=lt.getBuffer(Gt.buffer),Wt.size=(+Gt.size||Wt.buffer.dimension)|0,Wt.normalized=!!Gt.normalized||!1,"type"in Gt?(v.parameter(Gt.type,Hi,"invalid buffer type"),Wt.type=Hi[Gt.type]):Wt.type=Wt.buffer.dtype,Wt.offset=(Gt.offset||0)|0,Wt.stride=(Gt.stride||0)|0,Wt.divisor=(Gt.divisor||0)|0,Wt.state=1,v(Wt.size>=1&&Wt.size<=4,"size must be between 1 and 4"),v(Wt.offset>=0,"invalid offset"),v(Wt.stride>=0&&Wt.stride<=255,"stride must be between 0 and 255"),v(Wt.divisor>=0,"divisor must be positive"),v(!Wt.divisor||!!y.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Gt?(v(_e>0,"first attribute must not be a constant"),Wt.x=+Gt.x||0,Wt.y=+Gt.y||0,Wt.z=+Gt.z||0,Wt.w=+Gt.w||0,Wt.state=2):v(!1,"invalid attribute spec for location "+_e)}for(var Ee=0;Ee<ht.buffers.length;++Ee)!Ut[Ee]&&ht.buffers[Ee]&&(ht.buffers[Ee].destroy(),ht.buffers[Ee]=null);return ht.refresh(),Zt}return Zt.destroy=function(){for(var Pt=0;Pt<ht.buffers.length;++Pt)ht.buffers[Pt]&&ht.buffers[Pt].destroy();ht.buffers.length=0,ht.ownsElements&&(ht.elements.destroy(),ht.elements=null,ht.ownsElements=!1),ht.destroy()},Zt._vao=ht,Zt._reglType="vao",Zt(dt)}return kt}var Hl=35632,md=35633,um=35718,cm=35721;function Xl(d,y,B,Q){var lt={},K={};function tt(z,J,xt,Yt){this.name=z,this.id=J,this.location=xt,this.info=Yt}function vt(z,J){for(var xt=0;xt<z.length;++xt)if(z[xt].id===J.id){z[xt].location=J.location;return}z.push(J)}function yt(z,J,xt){var Yt=z===Hl?lt:K,pt=Yt[J];if(!pt){var Vt=y.str(J);pt=d.createShader(z),d.shaderSource(pt,Vt),d.compileShader(pt),v.shaderError(d,pt,Vt,z,xt),Yt[J]=pt}return pt}var It={},Rt=[],Ot=0;function kt(z,J){this.id=Ot++,this.fragId=z,this.vertId=J,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Q.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function wt(z,J,xt){var Yt,pt,Vt=yt(Hl,z.fragId),jt=yt(md,z.vertId),re=z.program=d.createProgram();if(d.attachShader(re,Vt),d.attachShader(re,jt),xt)for(Yt=0;Yt<xt.length;++Yt){var dt=xt[Yt];d.bindAttribLocation(re,dt[0],dt[1])}d.linkProgram(re),v.linkError(d,re,y.str(z.fragId),y.str(z.vertId),J);var ht=d.getProgramParameter(re,um);Q.profile&&(z.stats.uniformsCount=ht);var Zt=z.uniforms;for(Yt=0;Yt<ht;++Yt)if(pt=d.getActiveUniform(re,Yt),pt){if(pt.size>1)for(var Pt=0;Pt<pt.size;++Pt){var St=pt.name.replace("[0]","["+Pt+"]");vt(Zt,new tt(St,y.id(St),d.getUniformLocation(re,St),pt))}var zt=pt.name;pt.size>1&&(zt=zt.replace("[0]","")),vt(Zt,new tt(zt,y.id(zt),d.getUniformLocation(re,zt),pt))}var Ut=d.getProgramParameter(re,cm);Q.profile&&(z.stats.attributesCount=Ut);var ge=z.attributes;for(Yt=0;Yt<Ut;++Yt)pt=d.getActiveAttrib(re,Yt),pt&&vt(ge,new tt(pt.name,y.id(pt.name),d.getAttribLocation(re,pt.name),pt))}Q.profile&&(B.getMaxUniformsCount=function(){var z=0;return Rt.forEach(function(J){J.stats.uniformsCount>z&&(z=J.stats.uniformsCount)}),z},B.getMaxAttributesCount=function(){var z=0;return Rt.forEach(function(J){J.stats.attributesCount>z&&(z=J.stats.attributesCount)}),z});function Et(){lt={},K={};for(var z=0;z<Rt.length;++z)wt(Rt[z],null,Rt[z].attributes.map(function(J){return[J.location,J.name]}))}return{clear:function(){var z=d.deleteShader.bind(d);vr(lt).forEach(z),lt={},vr(K).forEach(z),K={},Rt.forEach(function(J){d.deleteProgram(J.program)}),Rt.length=0,It={},B.shaderCount=0},program:function(z,J,xt,Yt){v.command(z>=0,"missing vertex shader",xt),v.command(J>=0,"missing fragment shader",xt);var pt=It[J];pt||(pt=It[J]={});var Vt=pt[z];if(Vt&&(Vt.refCount++,!Yt))return Vt;var jt=new kt(J,z);return B.shaderCount++,wt(jt,xt,Yt),Vt||(pt[z]=jt),Rt.push(jt),r(jt,{destroy:function(){if(jt.refCount--,jt.refCount<=0){d.deleteProgram(jt.program);var re=Rt.indexOf(jt);Rt.splice(re,1),B.shaderCount--}pt[jt.vertId].refCount<=0&&(d.deleteShader(K[jt.vertId]),delete K[jt.vertId],delete It[jt.fragId][jt.vertId]),Object.keys(It[jt.fragId]).length||(d.deleteShader(lt[jt.fragId]),delete lt[jt.fragId],delete It[jt.fragId])}})},restore:Et,shader:yt,frag:-1,vert:-1}}var Of=6408,Oa=5121,lm=3333,Bf=5126;function hm(d,y,B,Q,lt,K,tt){function vt(Rt){var Ot;y.next===null?(v(lt.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ot=Oa):(v(y.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ot=y.next.colorAttachments[0].texture._texture.type,v.optional(function(){K.oes_texture_float?(v(Ot===Oa||Ot===Bf,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ot===Bf&&v(tt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):v(Ot===Oa,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var kt=0,wt=0,Et=Q.framebufferWidth,z=Q.framebufferHeight,J=null;e(Rt)?J=Rt:Rt&&(v.type(Rt,"object","invalid arguments to regl.read()"),kt=Rt.x|0,wt=Rt.y|0,v(kt>=0&&kt<Q.framebufferWidth,"invalid x offset for regl.read"),v(wt>=0&&wt<Q.framebufferHeight,"invalid y offset for regl.read"),Et=(Rt.width||Q.framebufferWidth-kt)|0,z=(Rt.height||Q.framebufferHeight-wt)|0,J=Rt.data||null),J&&(Ot===Oa?v(J instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ot===Bf&&v(J instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),v(Et>0&&Et+kt<=Q.framebufferWidth,"invalid width for read pixels"),v(z>0&&z+wt<=Q.framebufferHeight,"invalid height for read pixels"),B();var xt=Et*z*4;return J||(Ot===Oa?J=new Uint8Array(xt):Ot===Bf&&(J=J||new Float32Array(xt))),v.isTypedArray(J,"data buffer for regl.read() must be a typedarray"),v(J.byteLength>=xt,"data buffer for regl.read() too small"),d.pixelStorei(lm,4),d.readPixels(kt,wt,Et,z,Of,Ot,J),J}function yt(Rt){var Ot;return y.setFBO({framebuffer:Rt.framebuffer},function(){Ot=vt(Rt)}),Ot}function It(Rt){return!Rt||!("framebuffer"in Rt)?vt(Rt):yt(Rt)}return It}function Lr(d){return Array.prototype.slice.call(d)}function Ba(d){return Lr(d).join("")}function ws(){var d=0,y=[],B=[];function Q(Ot){for(var kt=0;kt<B.length;++kt)if(B[kt]===Ot)return y[kt];var wt="g"+d++;return y.push(wt),B.push(Ot),wt}function lt(){var Ot=[];function kt(){Ot.push.apply(Ot,Lr(arguments))}var wt=[];function Et(){var z="v"+d++;return wt.push(z),arguments.length>0&&(Ot.push(z,"="),Ot.push.apply(Ot,Lr(arguments)),Ot.push(";")),z}return r(kt,{def:Et,toString:function(){return Ba([wt.length>0?"var "+wt.join(",")+";":"",Ba(Ot)])}})}function K(){var Ot=lt(),kt=lt(),wt=Ot.toString,Et=kt.toString;function z(J,xt){kt(J,xt,"=",Ot.def(J,xt),";")}return r(function(){Ot.apply(Ot,Lr(arguments))},{def:Ot.def,entry:Ot,exit:kt,save:z,set:function(J,xt,Yt){z(J,xt),Ot(J,xt,"=",Yt,";")},toString:function(){return wt()+Et()}})}function tt(){var Ot=Ba(arguments),kt=K(),wt=K(),Et=kt.toString,z=wt.toString;return r(kt,{then:function(){return kt.apply(kt,Lr(arguments)),this},else:function(){return wt.apply(wt,Lr(arguments)),this},toString:function(){var J=z();return J&&(J="else{"+J+"}"),Ba(["if(",Ot,"){",Et(),"}",J])}})}var vt=lt(),yt={};function It(Ot,kt){var wt=[];function Et(){var pt="a"+wt.length;return wt.push(pt),pt}kt=kt||0;for(var z=0;z<kt;++z)Et();var J=K(),xt=J.toString,Yt=yt[Ot]=r(J,{arg:Et,toString:function(){return Ba(["function(",wt.join(),"){",xt(),"}"])}});return Yt}function Rt(){var Ot=['"use strict";',vt,"return {"];Object.keys(yt).forEach(function(Et){Ot.push('"',Et,'":',yt[Et].toString(),",")}),Ot.push("}");var kt=Ba(Ot).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),wt=Function.apply(null,y.concat(kt));return wt.apply(null,B)}return{global:vt,link:Q,block:lt,proc:It,scope:K,cond:tt,compile:Rt}}var pr="xyzw".split(""),gd=5121,xs=1,Xu=2,Ss=0,Bi=1,qu=2,ql=3,As=4,bd=5,Zl=6,or="dither",Zu="blend.enable",Kl="blend.color",qr="blend.equation",Rf="blend.func",Mf="depth.enable",Ra="depth.func",Jl="depth.range",Sr="depth.mask",Lf="colorMask",yd="cull.enable",vd="cull.face",Ql="frontFace",Nf="lineWidth",wd="polygonOffset.enable",Es="polygonOffset.offset",th="sample.alpha",xd="sample.enable",eh="sample.coverage",Ro="stencil.enable",Sd="stencil.mask",nh="stencil.func",Df="stencil.opFront",Mo="stencil.opBack",Ad="scissor.enable",Ku="scissor.box",ta="viewport",Lo="profile",ea="framebuffer",Ff="vert",Ts="frag",Ma="elements",La="primitive",Na="count",Is="offset",Ju="instances",No="vao",Qu="Width",rh="Height",Os=ea+Qu,Do=ea+rh,ih=ta+Qu,Ed=ta+rh,tc="drawingBuffer",Td=tc+Qu,ec=tc+rh,Ye=[Rf,qr,nh,Df,Mo,eh,ta,Ku,Es],Fo=34962,ah=34963,Cf=35632,Id=35633,Od=3553,dm=34067,Zr=2884,_m=3042,nc=3024,sh=2960,Bd=2929,Rd=3089,Ur=32823,Da=32926,oh=32928,rc=5126,Bs=35664,kf=35665,Co=35666,ic=5124,ko=35667,Po=35668,di=35669,fh=35670,_i=35671,Pf=35672,zf=35673,Rs=35674,Uf=35675,Gf=35676,$f=35678,zo=35680,ac=4,jf=1028,Fa=1029,uh=2304,Ar=2305,Ri=32775,pm=32776,mm=519,pi=7680,Ms=0,ch=1,lh=32774,gm=513,hh=36160,Uo=36064,Nr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Md=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ls={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},na={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Vf={frag:Cf,vert:Id},sc={cw:uh,ccw:Ar};function Ns(d){return Array.isArray(d)||e(d)||Jn(d)}function oc(d){return d.sort(function(y,B){return y===ta?-1:B===ta?1:y<B?-1:1})}function kn(d,y,B,Q){this.thisDep=d,this.contextDep=y,this.propDep=B,this.append=Q}function Ca(d){return d&&!(d.thisDep||d.contextDep||d.propDep)}function Pn(d){return new kn(!1,!1,!1,d)}function mr(d,y){var B=d.type;if(B===Ss){var Q=d.data.length;return new kn(!0,Q>=1,Q>=2,y)}else if(B===As){var lt=d.data;return new kn(lt.thisDep,lt.contextDep,lt.propDep,y)}else{if(B===bd)return new kn(!1,!1,!1,y);if(B===Zl){for(var K=!1,tt=!1,vt=!1,yt=0;yt<d.data.length;++yt){var It=d.data[yt];if(It.type===Bi)vt=!0;else if(It.type===qu)tt=!0;else if(It.type===ql)K=!0;else if(It.type===Ss){K=!0;var Rt=It.data;Rt>=1&&(tt=!0),Rt>=2&&(vt=!0)}else It.type===As&&(K=K||It.data.thisDep,tt=tt||It.data.contextDep,vt=vt||It.data.propDep)}return new kn(K,tt,vt,y)}else return new kn(B===ql,B===qu,B===Bi,y)}}var dh=new kn(!1,!1,!1,function(){});function _h(d,y,B,Q,lt,K,tt,vt,yt,It,Rt,Ot,kt,wt,Et){var z=It.Record,J={add:32774,subtract:32778,"reverse subtract":32779};B.ext_blend_minmax&&(J.min=Ri,J.max=pm);var xt=B.angle_instanced_arrays,Yt=B.webgl_draw_buffers,pt=B.oes_vertex_array_object,Vt={dirty:!0,profile:Et.profile},jt={},re=[],dt={},ht={};function Zt(x){return x.replace(".","_")}function Pt(x,g,L){var U=Zt(x);re.push(x),jt[U]=Vt[U]=!!L,dt[U]=g}function St(x,g,L){var U=Zt(x);re.push(x),Array.isArray(L)?(Vt[U]=L.slice(),jt[U]=L.slice()):Vt[U]=jt[U]=L,ht[U]=g}Pt(or,nc),Pt(Zu,_m),St(Kl,"blendColor",[0,0,0,0]),St(qr,"blendEquationSeparate",[lh,lh]),St(Rf,"blendFuncSeparate",[ch,Ms,ch,Ms]),Pt(Mf,Bd,!0),St(Ra,"depthFunc",gm),St(Jl,"depthRange",[0,1]),St(Sr,"depthMask",!0),St(Lf,Lf,[!0,!0,!0,!0]),Pt(yd,Zr),St(vd,"cullFace",Fa),St(Ql,Ql,Ar),St(Nf,Nf,1),Pt(wd,Ur),St(Es,"polygonOffset",[0,0]),Pt(th,Da),Pt(xd,oh),St(eh,"sampleCoverage",[1,!1]),Pt(Ro,sh),St(Sd,"stencilMask",-1),St(nh,"stencilFunc",[mm,0,-1]),St(Df,"stencilOpSeparate",[jf,pi,pi,pi]),St(Mo,"stencilOpSeparate",[Fa,pi,pi,pi]),Pt(Ad,Rd),St(Ku,"scissor",[0,0,d.drawingBufferWidth,d.drawingBufferHeight]),St(ta,ta,[0,0,d.drawingBufferWidth,d.drawingBufferHeight]);var zt={gl:d,context:kt,strings:y,next:jt,current:Vt,draw:Ot,elements:K,buffer:lt,shader:Rt,attributes:It.state,vao:It,uniforms:yt,framebuffer:vt,extensions:B,timer:wt,isBufferArgs:Ns},Ut={primTypes:Pr,compareFuncs:Ls,blendFuncs:Nr,blendEquations:J,stencilOps:na,glTypes:Hi,orientationType:sc};v.optional(function(){zt.isArrayLike=In}),Yt&&(Ut.backBuffer=[Fa],Ut.drawBuffer=yr(Q.maxDrawbuffers,function(x){return x===0?[0]:yr(x,function(g){return Uo+g})}));var ge=0;function _e(){var x=ws(),g=x.link,L=x.global;x.id=ge++,x.batchId="0";var U=g(zt),j=x.shared={props:"a0"};Object.keys(zt).forEach(function(I){j[I]=L.def(U,".",I)}),v.optional(function(){x.CHECK=g(v),x.commandStr=v.guessCommand(),x.command=g(x.commandStr),x.assert=function(I,E,X){I("if(!(",E,"))",this.CHECK,".commandRaise(",g(X),",",this.command,");")},Ut.invalidBlendCombinations=Md});var D=x.next={},M=x.current={};Object.keys(ht).forEach(function(I){Array.isArray(Vt[I])&&(D[I]=L.def(j.next,".",I),M[I]=L.def(j.current,".",I))});var P=x.constants={};Object.keys(Ut).forEach(function(I){P[I]=L.def(JSON.stringify(Ut[I]))}),x.invoke=function(I,E){switch(E.type){case Ss:var X=["this",j.context,j.props,x.batchId];return I.def(g(E.data),".call(",X.slice(0,Math.max(E.data.length+1,4)),")");case Bi:return I.def(j.props,E.data);case qu:return I.def(j.context,E.data);case ql:return I.def("this",E.data);case As:return E.data.append(x,I),E.data.ref;case bd:return E.data.toString();case Zl:return E.data.map(function(V){return x.invoke(I,V)})}},x.attribCache={};var S={};return x.scopeAttrib=function(I){var E=y.id(I);if(E in S)return S[E];var X=It.scope[E];X||(X=It.scope[E]=new z);var V=S[E]=g(X);return V},x}function Gt(x){var g=x.static,L=x.dynamic,U;if(Lo in g){var j=!!g[Lo];U=Pn(function(M,P){return j}),U.enable=j}else if(Lo in L){var D=L[Lo];U=mr(D,function(M,P){return M.invoke(P,D)})}return U}function Wt(x,g){var L=x.static,U=x.dynamic;if(ea in L){var j=L[ea];return j?(j=vt.getFramebuffer(j),v.command(j,"invalid framebuffer object"),Pn(function(M,P){var S=M.link(j),I=M.shared;P.set(I.framebuffer,".next",S);var E=I.context;return P.set(E,"."+Os,S+".width"),P.set(E,"."+Do,S+".height"),S})):Pn(function(M,P){var S=M.shared;P.set(S.framebuffer,".next","null");var I=S.context;return P.set(I,"."+Os,I+"."+Td),P.set(I,"."+Do,I+"."+ec),"null"})}else if(ea in U){var D=U[ea];return mr(D,function(M,P){var S=M.invoke(P,D),I=M.shared,E=I.framebuffer,X=P.def(E,".getFramebuffer(",S,")");v.optional(function(){M.assert(P,"!"+S+"||"+X,"invalid framebuffer object")}),P.set(E,".next",X);var V=I.context;return P.set(V,"."+Os,X+"?"+X+".width:"+V+"."+Td),P.set(V,"."+Do,X+"?"+X+".height:"+V+"."+ec),X})}else return null}function ue(x,g,L){var U=x.static,j=x.dynamic;function D(S){if(S in U){var I=U[S];v.commandType(I,"object","invalid "+S,L.commandStr);var E=!0,X=I.x|0,V=I.y|0,ct,_t;return"width"in I?(ct=I.width|0,v.command(ct>=0,"invalid "+S,L.commandStr)):E=!1,"height"in I?(_t=I.height|0,v.command(_t>=0,"invalid "+S,L.commandStr)):E=!1,new kn(!E&&g&&g.thisDep,!E&&g&&g.contextDep,!E&&g&&g.propDep,function(oe,Ht){var mt=oe.shared.context,ot=ct;"width"in I||(ot=Ht.def(mt,".",Os,"-",X));var te=_t;return"height"in I||(te=Ht.def(mt,".",Do,"-",V)),[X,V,ot,te]})}else if(S in j){var Nt=j[S],he=mr(Nt,function(oe,Ht){var mt=oe.invoke(Ht,Nt);v.optional(function(){oe.assert(Ht,mt+"&&typeof "+mt+'==="object"',"invalid "+S)});var ot=oe.shared.context,te=Ht.def(mt,".x|0"),Qt=Ht.def(mt,".y|0"),le=Ht.def('"width" in ',mt,"?",mt,".width|0:","(",ot,".",Os,"-",te,")"),nn=Ht.def('"height" in ',mt,"?",mt,".height|0:","(",ot,".",Do,"-",Qt,")");return v.optional(function(){oe.assert(Ht,le+">=0&&"+nn+">=0","invalid "+S)}),[te,Qt,le,nn]});return g&&(he.thisDep=he.thisDep||g.thisDep,he.contextDep=he.contextDep||g.contextDep,he.propDep=he.propDep||g.propDep),he}else return g?new kn(g.thisDep,g.contextDep,g.propDep,function(oe,Ht){var mt=oe.shared.context;return[0,0,Ht.def(mt,".",Os),Ht.def(mt,".",Do)]}):null}var M=D(ta);if(M){var P=M;M=new kn(M.thisDep,M.contextDep,M.propDep,function(S,I){var E=P.append(S,I),X=S.shared.context;return I.set(X,"."+ih,E[2]),I.set(X,"."+Ed,E[3]),E})}return{viewport:M,scissor_box:D(Ku)}}function me(x,g){var L=x.static,U=typeof L[Ts]=="string"&&typeof L[Ff]=="string";if(U){if(Object.keys(g.dynamic).length>0)return null;var j=g.static,D=Object.keys(j);if(D.length>0&&typeof j[D[0]]=="number"){for(var M=[],P=0;P<D.length;++P)v(typeof j[D[P]]=="number","must specify all vertex attribute locations when using vaos"),M.push([j[D[P]]|0,D[P]]);return M}}return null}function Ee(x,g,L){var U=x.static,j=x.dynamic;function D(E){if(E in U){var X=y.id(U[E]);v.optional(function(){Rt.shader(Vf[E],X,v.guessCommand())});var V=Pn(function(){return X});return V.id=X,V}else if(E in j){var ct=j[E];return mr(ct,function(_t,Nt){var he=_t.invoke(Nt,ct),oe=Nt.def(_t.shared.strings,".id(",he,")");return v.optional(function(){Nt(_t.shared.shader,".shader(",Vf[E],",",oe,",",_t.command,");")}),oe})}return null}var M=D(Ts),P=D(Ff),S=null,I;return Ca(M)&&Ca(P)?(S=Rt.program(P.id,M.id,null,L),I=Pn(function(E,X){return E.link(S)})):I=new kn(M&&M.thisDep||P&&P.thisDep,M&&M.contextDep||P&&P.contextDep,M&&M.propDep||P&&P.propDep,function(E,X){var V=E.shared.shader,ct;M?ct=M.append(E,X):ct=X.def(V,".",Ts);var _t;P?_t=P.append(E,X):_t=X.def(V,".",Ff);var Nt=V+".program("+_t+","+ct;return v.optional(function(){Nt+=","+E.command}),X.def(Nt+")")}),{frag:M,vert:P,progVar:I,program:S}}function En(x,g){var L=x.static,U=x.dynamic,j={},D=!1;function M(){if(No in L){var Ht=L[No];return Ht!==null&&It.getVAO(Ht)===null&&(Ht=It.createVAO(Ht)),D=!0,j.vao=Ht,Pn(function(ot){var te=It.getVAO(Ht);return te?ot.link(te):"null"})}else if(No in U){D=!0;var mt=U[No];return mr(mt,function(ot,te){var Qt=ot.invoke(te,mt);return te.def(ot.shared.vao+".getVAO("+Qt+")")})}return null}var P=M(),S=!1;function I(){if(Ma in L){var Ht=L[Ma];if(j.elements=Ht,Ns(Ht)){var mt=j.elements=K.create(Ht,!0);Ht=K.getElements(mt),S=!0}else Ht&&(Ht=K.getElements(Ht),S=!0,v.command(Ht,"invalid elements",g.commandStr));var ot=Pn(function(Qt,le){if(Ht){var nn=Qt.link(Ht);return Qt.ELEMENTS=nn,nn}return Qt.ELEMENTS=null,null});return ot.value=Ht,ot}else if(Ma in U){S=!0;var te=U[Ma];return mr(te,function(Qt,le){var nn=Qt.shared,cr=nn.isBufferArgs,Fs=nn.elements,ia=Qt.invoke(le,te),Li=le.def("null"),Pa=le.def(cr,"(",ia,")"),Cs=Qt.cond(Pa).then(Li,"=",Fs,".createStream(",ia,");").else(Li,"=",Fs,".getElements(",ia,");");return v.optional(function(){Qt.assert(Cs.else,"!"+ia+"||"+Li,"invalid elements")}),le.entry(Cs),le.exit(Qt.cond(Pa).then(Fs,".destroyStream(",Li,");")),Qt.ELEMENTS=Li,Li})}else if(D)return new kn(P.thisDep,P.contextDep,P.propDep,function(Qt,le){return le.def(Qt.shared.vao+".currentVAO?"+Qt.shared.elements+".getElements("+Qt.shared.vao+".currentVAO.elements):null")});return null}var E=I();function X(){if(La in L){var Ht=L[La];return j.primitive=Ht,v.commandParameter(Ht,Pr,"invalid primitve",g.commandStr),Pn(function(ot,te){return Pr[Ht]})}else if(La in U){var mt=U[La];return mr(mt,function(ot,te){var Qt=ot.constants.primTypes,le=ot.invoke(te,mt);return v.optional(function(){ot.assert(te,le+" in "+Qt,"invalid primitive, must be one of "+Object.keys(Pr))}),te.def(Qt,"[",le,"]")})}else{if(S)return Ca(E)?E.value?Pn(function(ot,te){return te.def(ot.ELEMENTS,".primType")}):Pn(function(){return ac}):new kn(E.thisDep,E.contextDep,E.propDep,function(ot,te){var Qt=ot.ELEMENTS;return te.def(Qt,"?",Qt,".primType:",ac)});if(D)return new kn(P.thisDep,P.contextDep,P.propDep,function(ot,te){return te.def(ot.shared.vao+".currentVAO?"+ot.shared.vao+".currentVAO.primitive:"+ac)})}return null}function V(Ht,mt){if(Ht in L){var ot=L[Ht]|0;return mt?j.offset=ot:j.instances=ot,v.command(!mt||ot>=0,"invalid "+Ht,g.commandStr),Pn(function(Qt,le){return mt&&(Qt.OFFSET=ot),ot})}else if(Ht in U){var te=U[Ht];return mr(te,function(Qt,le){var nn=Qt.invoke(le,te);return mt&&(Qt.OFFSET=nn,v.optional(function(){Qt.assert(le,nn+">=0","invalid "+Ht)})),nn})}else if(mt){if(S)return Pn(function(Qt,le){return Qt.OFFSET=0,0});if(D)return new kn(P.thisDep,P.contextDep,P.propDep,function(Qt,le){return le.def(Qt.shared.vao+".currentVAO?"+Qt.shared.vao+".currentVAO.offset:0")})}else if(D)return new kn(P.thisDep,P.contextDep,P.propDep,function(Qt,le){return le.def(Qt.shared.vao+".currentVAO?"+Qt.shared.vao+".currentVAO.instances:-1")});return null}var ct=V(Is,!0);function _t(){if(Na in L){var Ht=L[Na]|0;return j.count=Ht,v.command(typeof Ht=="number"&&Ht>=0,"invalid vertex count",g.commandStr),Pn(function(){return Ht})}else if(Na in U){var mt=U[Na];return mr(mt,function(le,nn){var cr=le.invoke(nn,mt);return v.optional(function(){le.assert(nn,"typeof "+cr+'==="number"&&'+cr+">=0&&"+cr+"===("+cr+"|0)","invalid vertex count")}),cr})}else if(S)if(Ca(E)){if(E)return ct?new kn(ct.thisDep,ct.contextDep,ct.propDep,function(le,nn){var cr=nn.def(le.ELEMENTS,".vertCount-",le.OFFSET);return v.optional(function(){le.assert(nn,cr+">=0","invalid vertex offset/element buffer too small")}),cr}):Pn(function(le,nn){return nn.def(le.ELEMENTS,".vertCount")});var ot=Pn(function(){return-1});return v.optional(function(){ot.MISSING=!0}),ot}else{var te=new kn(E.thisDep||ct.thisDep,E.contextDep||ct.contextDep,E.propDep||ct.propDep,function(le,nn){var cr=le.ELEMENTS;return le.OFFSET?nn.def(cr,"?",cr,".vertCount-",le.OFFSET,":-1"):nn.def(cr,"?",cr,".vertCount:-1")});return v.optional(function(){te.DYNAMIC=!0}),te}else if(D){var Qt=new kn(P.thisDep,P.contextDep,P.propDep,function(le,nn){return nn.def(le.shared.vao,".currentVAO?",le.shared.vao,".currentVAO.count:-1")});return Qt}return null}var Nt=X(),he=_t(),oe=V(Ju,!1);return{elements:E,primitive:Nt,count:he,instances:oe,offset:ct,vao:P,vaoActive:D,elementsActive:S,static:j}}function vn(x,g){var L=x.static,U=x.dynamic,j={};return re.forEach(function(D){var M=Zt(D);function P(S,I){if(D in L){var E=S(L[D]);j[M]=Pn(function(){return E})}else if(D in U){var X=U[D];j[M]=mr(X,function(V,ct){return I(V,ct,V.invoke(ct,X))})}}switch(D){case yd:case Zu:case or:case Ro:case Mf:case Ad:case wd:case th:case xd:case Sr:return P(function(S){return v.commandType(S,"boolean",D,g.commandStr),S},function(S,I,E){return v.optional(function(){S.assert(I,"typeof "+E+'==="boolean"',"invalid flag "+D,S.commandStr)}),E});case Ra:return P(function(S){return v.commandParameter(S,Ls,"invalid "+D,g.commandStr),Ls[S]},function(S,I,E){var X=S.constants.compareFuncs;return v.optional(function(){S.assert(I,E+" in "+X,"invalid "+D+", must be one of "+Object.keys(Ls))}),I.def(X,"[",E,"]")});case Jl:return P(function(S){return v.command(In(S)&&S.length===2&&typeof S[0]=="number"&&typeof S[1]=="number"&&S[0]<=S[1],"depth range is 2d array",g.commandStr),S},function(S,I,E){v.optional(function(){S.assert(I,S.shared.isArrayLike+"("+E+")&&"+E+".length===2&&typeof "+E+'[0]==="number"&&typeof '+E+'[1]==="number"&&'+E+"[0]<="+E+"[1]","depth range must be a 2d array")});var X=I.def("+",E,"[0]"),V=I.def("+",E,"[1]");return[X,V]});case Rf:return P(function(S){v.commandType(S,"object","blend.func",g.commandStr);var I="srcRGB"in S?S.srcRGB:S.src,E="srcAlpha"in S?S.srcAlpha:S.src,X="dstRGB"in S?S.dstRGB:S.dst,V="dstAlpha"in S?S.dstAlpha:S.dst;return v.commandParameter(I,Nr,M+".srcRGB",g.commandStr),v.commandParameter(E,Nr,M+".srcAlpha",g.commandStr),v.commandParameter(X,Nr,M+".dstRGB",g.commandStr),v.commandParameter(V,Nr,M+".dstAlpha",g.commandStr),v.command(Md.indexOf(I+", "+X)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+I+", "+X+")",g.commandStr),[Nr[I],Nr[X],Nr[E],Nr[V]]},function(S,I,E){var X=S.constants.blendFuncs;v.optional(function(){S.assert(I,E+"&&typeof "+E+'==="object"',"invalid blend func, must be an object")});function V(mt,ot){var te=I.def('"',mt,ot,'" in ',E,"?",E,".",mt,ot,":",E,".",mt);return v.optional(function(){S.assert(I,te+" in "+X,"invalid "+D+"."+mt+ot+", must be one of "+Object.keys(Nr))}),te}var ct=V("src","RGB"),_t=V("dst","RGB");v.optional(function(){var mt=S.constants.invalidBlendCombinations;S.assert(I,mt+".indexOf("+ct+'+", "+'+_t+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Nt=I.def(X,"[",ct,"]"),he=I.def(X,"[",V("src","Alpha"),"]"),oe=I.def(X,"[",_t,"]"),Ht=I.def(X,"[",V("dst","Alpha"),"]");return[Nt,oe,he,Ht]});case qr:return P(function(S){if(typeof S=="string")return v.commandParameter(S,J,"invalid "+D,g.commandStr),[J[S],J[S]];if(typeof S=="object")return v.commandParameter(S.rgb,J,D+".rgb",g.commandStr),v.commandParameter(S.alpha,J,D+".alpha",g.commandStr),[J[S.rgb],J[S.alpha]];v.commandRaise("invalid blend.equation",g.commandStr)},function(S,I,E){var X=S.constants.blendEquations,V=I.def(),ct=I.def(),_t=S.cond("typeof ",E,'==="string"');return v.optional(function(){function Nt(he,oe,Ht){S.assert(he,Ht+" in "+X,"invalid "+oe+", must be one of "+Object.keys(J))}Nt(_t.then,D,E),S.assert(_t.else,E+"&&typeof "+E+'==="object"',"invalid "+D),Nt(_t.else,D+".rgb",E+".rgb"),Nt(_t.else,D+".alpha",E+".alpha")}),_t.then(V,"=",ct,"=",X,"[",E,"];"),_t.else(V,"=",X,"[",E,".rgb];",ct,"=",X,"[",E,".alpha];"),I(_t),[V,ct]});case Kl:return P(function(S){return v.command(In(S)&&S.length===4,"blend.color must be a 4d array",g.commandStr),yr(4,function(I){return+S[I]})},function(S,I,E){return v.optional(function(){S.assert(I,S.shared.isArrayLike+"("+E+")&&"+E+".length===4","blend.color must be a 4d array")}),yr(4,function(X){return I.def("+",E,"[",X,"]")})});case Sd:return P(function(S){return v.commandType(S,"number",M,g.commandStr),S|0},function(S,I,E){return v.optional(function(){S.assert(I,"typeof "+E+'==="number"',"invalid stencil.mask")}),I.def(E,"|0")});case nh:return P(function(S){v.commandType(S,"object",M,g.commandStr);var I=S.cmp||"keep",E=S.ref||0,X="mask"in S?S.mask:-1;return v.commandParameter(I,Ls,D+".cmp",g.commandStr),v.commandType(E,"number",D+".ref",g.commandStr),v.commandType(X,"number",D+".mask",g.commandStr),[Ls[I],E,X]},function(S,I,E){var X=S.constants.compareFuncs;v.optional(function(){function Nt(){S.assert(I,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Nt(E+"&&typeof ",E,'==="object"'),Nt('!("cmp" in ',E,")||(",E,".cmp in ",X,")")});var V=I.def('"cmp" in ',E,"?",X,"[",E,".cmp]",":",pi),ct=I.def(E,".ref|0"),_t=I.def('"mask" in ',E,"?",E,".mask|0:-1");return[V,ct,_t]});case Df:case Mo:return P(function(S){v.commandType(S,"object",M,g.commandStr);var I=S.fail||"keep",E=S.zfail||"keep",X=S.zpass||"keep";return v.commandParameter(I,na,D+".fail",g.commandStr),v.commandParameter(E,na,D+".zfail",g.commandStr),v.commandParameter(X,na,D+".zpass",g.commandStr),[D===Mo?Fa:jf,na[I],na[E],na[X]]},function(S,I,E){var X=S.constants.stencilOps;v.optional(function(){S.assert(I,E+"&&typeof "+E+'==="object"',"invalid "+D)});function V(ct){return v.optional(function(){S.assert(I,'!("'+ct+'" in '+E+")||("+E+"."+ct+" in "+X+")","invalid "+D+"."+ct+", must be one of "+Object.keys(na))}),I.def('"',ct,'" in ',E,"?",X,"[",E,".",ct,"]:",pi)}return[D===Mo?Fa:jf,V("fail"),V("zfail"),V("zpass")]});case Es:return P(function(S){v.commandType(S,"object",M,g.commandStr);var I=S.factor|0,E=S.units|0;return v.commandType(I,"number",M+".factor",g.commandStr),v.commandType(E,"number",M+".units",g.commandStr),[I,E]},function(S,I,E){v.optional(function(){S.assert(I,E+"&&typeof "+E+'==="object"',"invalid "+D)});var X=I.def(E,".factor|0"),V=I.def(E,".units|0");return[X,V]});case vd:return P(function(S){var I=0;return S==="front"?I=jf:S==="back"&&(I=Fa),v.command(!!I,M,g.commandStr),I},function(S,I,E){return v.optional(function(){S.assert(I,E+'==="front"||'+E+'==="back"',"invalid cull.face")}),I.def(E,'==="front"?',jf,":",Fa)});case Nf:return P(function(S){return v.command(typeof S=="number"&&S>=Q.lineWidthDims[0]&&S<=Q.lineWidthDims[1],"invalid line width, must be a positive number between "+Q.lineWidthDims[0]+" and "+Q.lineWidthDims[1],g.commandStr),S},function(S,I,E){return v.optional(function(){S.assert(I,"typeof "+E+'==="number"&&'+E+">="+Q.lineWidthDims[0]+"&&"+E+"<="+Q.lineWidthDims[1],"invalid line width")}),E});case Ql:return P(function(S){return v.commandParameter(S,sc,M,g.commandStr),sc[S]},function(S,I,E){return v.optional(function(){S.assert(I,E+'==="cw"||'+E+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),I.def(E+'==="cw"?'+uh+":"+Ar)});case Lf:return P(function(S){return v.command(In(S)&&S.length===4,"color.mask must be length 4 array",g.commandStr),S.map(function(I){return!!I})},function(S,I,E){return v.optional(function(){S.assert(I,S.shared.isArrayLike+"("+E+")&&"+E+".length===4","invalid color.mask")}),yr(4,function(X){return"!!"+E+"["+X+"]"})});case eh:return P(function(S){v.command(typeof S=="object"&&S,M,g.commandStr);var I="value"in S?S.value:1,E=!!S.invert;return v.command(typeof I=="number"&&I>=0&&I<=1,"sample.coverage.value must be a number between 0 and 1",g.commandStr),[I,E]},function(S,I,E){v.optional(function(){S.assert(I,E+"&&typeof "+E+'==="object"',"invalid sample.coverage")});var X=I.def('"value" in ',E,"?+",E,".value:1"),V=I.def("!!",E,".invert");return[X,V]})}}),j}function Oe(x,g){var L=x.static,U=x.dynamic,j={};return Object.keys(L).forEach(function(D){var M=L[D],P;if(typeof M=="number"||typeof M=="boolean")P=Pn(function(){return M});else if(typeof M=="function"){var S=M._reglType;S==="texture2d"||S==="textureCube"?P=Pn(function(I){return I.link(M)}):S==="framebuffer"||S==="framebufferCube"?(v.command(M.color.length>0,'missing color attachment for framebuffer sent to uniform "'+D+'"',g.commandStr),P=Pn(function(I){return I.link(M.color[0])})):v.commandRaise('invalid data for uniform "'+D+'"',g.commandStr)}else In(M)?P=Pn(function(I){var E=I.global.def("[",yr(M.length,function(X){return v.command(typeof M[X]=="number"||typeof M[X]=="boolean","invalid uniform "+D,I.commandStr),M[X]}),"]");return E}):v.commandRaise('invalid or missing data for uniform "'+D+'"',g.commandStr);P.value=M,j[D]=P}),Object.keys(U).forEach(function(D){var M=U[D];j[D]=mr(M,function(P,S){return P.invoke(S,M)})}),j}function mn(x,g){var L=x.static,U=x.dynamic,j={};return Object.keys(L).forEach(function(D){var M=L[D],P=y.id(D),S=new z;if(Ns(M))S.state=xs,S.buffer=lt.getBuffer(lt.create(M,Fo,!1,!0)),S.type=0;else{var I=lt.getBuffer(M);if(I)S.state=xs,S.buffer=I,S.type=0;else if(v.command(typeof M=="object"&&M,"invalid data for attribute "+D,g.commandStr),"constant"in M){var E=M.constant;S.buffer="null",S.state=Xu,typeof E=="number"?S.x=E:(v.command(In(E)&&E.length>0&&E.length<=4,"invalid constant for attribute "+D,g.commandStr),pr.forEach(function(oe,Ht){Ht<E.length&&(S[oe]=E[Ht])}))}else{Ns(M.buffer)?I=lt.getBuffer(lt.create(M.buffer,Fo,!1,!0)):I=lt.getBuffer(M.buffer),v.command(!!I,'missing buffer for attribute "'+D+'"',g.commandStr);var X=M.offset|0;v.command(X>=0,'invalid offset for attribute "'+D+'"',g.commandStr);var V=M.stride|0;v.command(V>=0&&V<256,'invalid stride for attribute "'+D+'", must be integer betweeen [0, 255]',g.commandStr);var ct=M.size|0;v.command(!("size"in M)||ct>0&&ct<=4,'invalid size for attribute "'+D+'", must be 1,2,3,4',g.commandStr);var _t=!!M.normalized,Nt=0;"type"in M&&(v.commandParameter(M.type,Hi,"invalid type for attribute "+D,g.commandStr),Nt=Hi[M.type]);var he=M.divisor|0;v.optional(function(){"divisor"in M&&(v.command(he===0||xt,'cannot specify divisor for attribute "'+D+'", instancing not supported',g.commandStr),v.command(he>=0,'invalid divisor for attribute "'+D+'"',g.commandStr));var oe=g.commandStr,Ht=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(M).forEach(function(mt){v.command(Ht.indexOf(mt)>=0,'unknown parameter "'+mt+'" for attribute pointer "'+D+'" (valid parameters are '+Ht+")",oe)})}),S.buffer=I,S.state=xs,S.size=ct,S.normalized=_t,S.type=Nt||I.dtype,S.offset=X,S.stride=V,S.divisor=he}}j[D]=Pn(function(oe,Ht){var mt=oe.attribCache;if(P in mt)return mt[P];var ot={isStream:!1};return Object.keys(S).forEach(function(te){ot[te]=S[te]}),S.buffer&&(ot.buffer=oe.link(S.buffer),ot.type=ot.type||ot.buffer+".dtype"),mt[P]=ot,ot})}),Object.keys(U).forEach(function(D){var M=U[D];function P(S,I){var E=S.invoke(I,M),X=S.shared,V=S.constants,ct=X.isBufferArgs,_t=X.buffer;v.optional(function(){S.assert(I,E+"&&(typeof "+E+'==="object"||typeof '+E+'==="function")&&('+ct+"("+E+")||"+_t+".getBuffer("+E+")||"+_t+".getBuffer("+E+".buffer)||"+ct+"("+E+'.buffer)||("constant" in '+E+"&&(typeof "+E+'.constant==="number"||'+X.isArrayLike+"("+E+".constant))))",'invalid dynamic attribute "'+D+'"')});var Nt={isStream:I.def(!1)},he=new z;he.state=xs,Object.keys(he).forEach(function(ot){Nt[ot]=I.def(""+he[ot])});var oe=Nt.buffer,Ht=Nt.type;I("if(",ct,"(",E,")){",Nt.isStream,"=true;",oe,"=",_t,".createStream(",Fo,",",E,");",Ht,"=",oe,".dtype;","}else{",oe,"=",_t,".getBuffer(",E,");","if(",oe,"){",Ht,"=",oe,".dtype;",'}else if("constant" in ',E,"){",Nt.state,"=",Xu,";","if(typeof "+E+'.constant === "number"){',Nt[pr[0]],"=",E,".constant;",pr.slice(1).map(function(ot){return Nt[ot]}).join("="),"=0;","}else{",pr.map(function(ot,te){return Nt[ot]+"="+E+".constant.length>"+te+"?"+E+".constant["+te+"]:0;"}).join(""),"}}else{","if(",ct,"(",E,".buffer)){",oe,"=",_t,".createStream(",Fo,",",E,".buffer);","}else{",oe,"=",_t,".getBuffer(",E,".buffer);","}",Ht,'="type" in ',E,"?",V.glTypes,"[",E,".type]:",oe,".dtype;",Nt.normalized,"=!!",E,".normalized;");function mt(ot){I(Nt[ot],"=",E,".",ot,"|0;")}return mt("size"),mt("offset"),mt("stride"),mt("divisor"),I("}}"),I.exit("if(",Nt.isStream,"){",_t,".destroyStream(",oe,");","}"),Nt}j[D]=mr(M,P)}),j}function an(x){var g=x.static,L=x.dynamic,U={};return Object.keys(g).forEach(function(j){var D=g[j];U[j]=Pn(function(M,P){return typeof D=="number"||typeof D=="boolean"?""+D:M.link(D)})}),Object.keys(L).forEach(function(j){var D=L[j];U[j]=mr(D,function(M,P){return M.invoke(P,D)})}),U}function jn(x,g,L,U,j){var D=x.static,M=x.dynamic;v.optional(function(){var mt=[ea,Ff,Ts,Ma,La,Is,Na,Ju,Lo,No].concat(re);function ot(te){Object.keys(te).forEach(function(Qt){v.command(mt.indexOf(Qt)>=0,'unknown parameter "'+Qt+'"',j.commandStr)})}ot(D),ot(M)});var P=me(x,g),S=Wt(x),I=ue(x,S,j),E=En(x,j),X=vn(x,j),V=Ee(x,j,P);function ct(mt){var ot=I[mt];ot&&(X[mt]=ot)}ct(ta),ct(Zt(Ku));var _t=Object.keys(X).length>0,Nt={framebuffer:S,draw:E,shader:V,state:X,dirty:_t,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Nt.profile=Gt(x),Nt.uniforms=Oe(L,j),Nt.drawVAO=Nt.scopeVAO=E.vao,!Nt.drawVAO&&V.program&&!P&&B.angle_instanced_arrays&&E.static.elements){var he=!0,oe=V.program.attributes.map(function(mt){var ot=g.static[mt];return he=he&&!!ot,ot});if(he&&oe.length>0){var Ht=It.getVAO(It.createVAO({attributes:oe,elements:E.static.elements}));Nt.drawVAO=new kn(null,null,null,function(mt,ot){return mt.link(Ht)}),Nt.useVAO=!0}}return P?Nt.useVAO=!0:Nt.attributes=mn(g,j),Nt.context=an(U),Nt}function Vn(x,g,L){var U=x.shared,j=U.context,D=x.scope();Object.keys(L).forEach(function(M){g.save(j,"."+M);var P=L[M],S=P.append(x,g);Array.isArray(S)?D(j,".",M,"=[",S.join(),"];"):D(j,".",M,"=",S,";")}),g(D)}function Yn(x,g,L,U){var j=x.shared,D=j.gl,M=j.framebuffer,P;Yt&&(P=g.def(j.extensions,".webgl_draw_buffers"));var S=x.constants,I=S.drawBuffer,E=S.backBuffer,X;L?X=L.append(x,g):X=g.def(M,".next"),U||g("if(",X,"!==",M,".cur){"),g("if(",X,"){",D,".bindFramebuffer(",hh,",",X,".framebuffer);"),Yt&&g(P,".drawBuffersWEBGL(",I,"[",X,".colorAttachments.length]);"),g("}else{",D,".bindFramebuffer(",hh,",null);"),Yt&&g(P,".drawBuffersWEBGL(",E,");"),g("}",M,".cur=",X,";"),U||g("}")}function er(x,g,L){var U=x.shared,j=U.gl,D=x.current,M=x.next,P=U.current,S=U.next,I=x.cond(P,".dirty");re.forEach(function(E){var X=Zt(E);if(!(X in L.state)){var V,ct;if(X in M){V=M[X],ct=D[X];var _t=yr(Vt[X].length,function(he){return I.def(V,"[",he,"]")});I(x.cond(_t.map(function(he,oe){return he+"!=="+ct+"["+oe+"]"}).join("||")).then(j,".",ht[X],"(",_t,");",_t.map(function(he,oe){return ct+"["+oe+"]="+he}).join(";"),";"))}else{V=I.def(S,".",X);var Nt=x.cond(V,"!==",P,".",X);I(Nt),X in dt?Nt(x.cond(V).then(j,".enable(",dt[X],");").else(j,".disable(",dt[X],");"),P,".",X,"=",V,";"):Nt(j,".",ht[X],"(",V,");",P,".",X,"=",V,";")}}}),Object.keys(L.state).length===0&&I(P,".dirty=false;"),g(I)}function fr(x,g,L,U){var j=x.shared,D=x.current,M=j.current,P=j.gl;oc(Object.keys(L)).forEach(function(S){var I=L[S];if(!(U&&!U(I))){var E=I.append(x,g);if(dt[S]){var X=dt[S];Ca(I)?E?g(P,".enable(",X,");"):g(P,".disable(",X,");"):g(x.cond(E).then(P,".enable(",X,");").else(P,".disable(",X,");")),g(M,".",S,"=",E,";")}else if(In(E)){var V=D[S];g(P,".",ht[S],"(",E,");",E.map(function(ct,_t){return V+"["+_t+"]="+ct}).join(";"),";")}else g(P,".",ht[S],"(",E,");",M,".",S,"=",E,";")}})}function zn(x,g){xt&&(x.instancing=g.def(x.shared.extensions,".angle_instanced_arrays"))}function we(x,g,L,U,j){var D=x.shared,M=x.stats,P=D.current,S=D.timer,I=L.profile;function E(){return typeof performance>"u"?"Date.now()":"performance.now()"}var X,V;function ct(mt){X=g.def(),mt(X,"=",E(),";"),typeof j=="string"?mt(M,".count+=",j,";"):mt(M,".count++;"),wt&&(U?(V=g.def(),mt(V,"=",S,".getNumPendingQueries();")):mt(S,".beginQuery(",M,");"))}function _t(mt){mt(M,".cpuTime+=",E(),"-",X,";"),wt&&(U?mt(S,".pushScopeStats(",V,",",S,".getNumPendingQueries(),",M,");"):mt(S,".endQuery();"))}function Nt(mt){var ot=g.def(P,".profile");g(P,".profile=",mt,";"),g.exit(P,".profile=",ot,";")}var he;if(I){if(Ca(I)){I.enable?(ct(g),_t(g.exit),Nt("true")):Nt("false");return}he=I.append(x,g),Nt(he)}else he=g.def(P,".profile");var oe=x.block();ct(oe),g("if(",he,"){",oe,"}");var Ht=x.block();_t(Ht),g.exit("if(",he,"){",Ht,"}")}function ur(x,g,L,U,j){var D=x.shared;function M(S){switch(S){case Bs:case ko:case _i:return 2;case kf:case Po:case Pf:return 3;case Co:case di:case zf:return 4;default:return 1}}function P(S,I,E){var X=D.gl,V=g.def(S,".location"),ct=g.def(D.attributes,"[",V,"]"),_t=E.state,Nt=E.buffer,he=[E.x,E.y,E.z,E.w],oe=["buffer","normalized","offset","stride"];function Ht(){g("if(!",ct,".buffer){",X,".enableVertexAttribArray(",V,");}");var ot=E.type,te;if(E.size?te=g.def(E.size,"||",I):te=I,g("if(",ct,".type!==",ot,"||",ct,".size!==",te,"||",oe.map(function(le){return ct+"."+le+"!=="+E[le]}).join("||"),"){",X,".bindBuffer(",Fo,",",Nt,".buffer);",X,".vertexAttribPointer(",[V,te,ot,E.normalized,E.stride,E.offset],");",ct,".type=",ot,";",ct,".size=",te,";",oe.map(function(le){return ct+"."+le+"="+E[le]+";"}).join(""),"}"),xt){var Qt=E.divisor;g("if(",ct,".divisor!==",Qt,"){",x.instancing,".vertexAttribDivisorANGLE(",[V,Qt],");",ct,".divisor=",Qt,";}")}}function mt(){g("if(",ct,".buffer){",X,".disableVertexAttribArray(",V,");",ct,".buffer=null;","}if(",pr.map(function(ot,te){return ct+"."+ot+"!=="+he[te]}).join("||"),"){",X,".vertexAttrib4f(",V,",",he,");",pr.map(function(ot,te){return ct+"."+ot+"="+he[te]+";"}).join(""),"}")}_t===xs?Ht():_t===Xu?mt():(g("if(",_t,"===",xs,"){"),Ht(),g("}else{"),mt(),g("}"))}U.forEach(function(S){var I=S.name,E=L.attributes[I],X;if(E){if(!j(E))return;X=E.append(x,g)}else{if(!j(dh))return;var V=x.scopeAttrib(I);v.optional(function(){x.assert(g,V+".state","missing attribute "+I)}),X={},Object.keys(new z).forEach(function(ct){X[ct]=g.def(V,".",ct)})}P(x.link(S),M(S.info.type),X)})}function en(x,g,L,U,j,D){for(var M=x.shared,P=M.gl,S={},I,E=0;E<U.length;++E){var X=U[E],V=X.name,ct=X.info.type,_t=X.info.size,Nt=L.uniforms[V];if(_t>1){if(!Nt)continue;var he=V.replace("[0]","");if(S[he])continue;S[he]=1}var oe=x.link(X),Ht=oe+".location",mt;if(Nt){if(!j(Nt))continue;if(Ca(Nt)){var ot=Nt.value;if(v.command(ot!==null&&typeof ot<"u",'missing uniform "'+V+'"',x.commandStr),ct===$f||ct===zo){v.command(typeof ot=="function"&&(ct===$f&&(ot._reglType==="texture2d"||ot._reglType==="framebuffer")||ct===zo&&(ot._reglType==="textureCube"||ot._reglType==="framebufferCube")),"invalid texture for uniform "+V,x.commandStr);var te=x.link(ot._texture||ot.color[0]._texture);g(P,".uniform1i(",Ht,",",te+".bind());"),g.exit(te,".unbind();")}else if(ct===Rs||ct===Uf||ct===Gf){v.optional(function(){v.command(In(ot),"invalid matrix for uniform "+V,x.commandStr),v.command(ct===Rs&&ot.length===4||ct===Uf&&ot.length===9||ct===Gf&&ot.length===16,"invalid length for matrix uniform "+V,x.commandStr)});var Qt=x.global.def("new Float32Array(["+Array.prototype.slice.call(ot)+"])"),le=2;ct===Uf?le=3:ct===Gf&&(le=4),g(P,".uniformMatrix",le,"fv(",Ht,",false,",Qt,");")}else{switch(ct){case rc:_t===1?v.commandType(ot,"number","uniform "+V,x.commandStr):v.command(In(ot)&&ot.length===_t,"uniform "+V,x.commandStr),I="1f";break;case Bs:v.command(In(ot)&&ot.length&&ot.length%2===0&&ot.length<=_t*2,"uniform "+V,x.commandStr),I="2f";break;case kf:v.command(In(ot)&&ot.length&&ot.length%3===0&&ot.length<=_t*3,"uniform "+V,x.commandStr),I="3f";break;case Co:v.command(In(ot)&&ot.length&&ot.length%4===0&&ot.length<=_t*4,"uniform "+V,x.commandStr),I="4f";break;case fh:_t===1?v.commandType(ot,"boolean","uniform "+V,x.commandStr):v.command(In(ot)&&ot.length===_t,"uniform "+V,x.commandStr),I="1i";break;case ic:_t===1?v.commandType(ot,"number","uniform "+V,x.commandStr):v.command(In(ot)&&ot.length===_t,"uniform "+V,x.commandStr),I="1i";break;case _i:v.command(In(ot)&&ot.length&&ot.length%2===0&&ot.length<=_t*2,"uniform "+V,x.commandStr),I="2i";break;case ko:v.command(In(ot)&&ot.length&&ot.length%2===0&&ot.length<=_t*2,"uniform "+V,x.commandStr),I="2i";break;case Pf:v.command(In(ot)&&ot.length&&ot.length%3===0&&ot.length<=_t*3,"uniform "+V,x.commandStr),I="3i";break;case Po:v.command(In(ot)&&ot.length&&ot.length%3===0&&ot.length<=_t*3,"uniform "+V,x.commandStr),I="3i";break;case zf:v.command(In(ot)&&ot.length&&ot.length%4===0&&ot.length<=_t*4,"uniform "+V,x.commandStr),I="4i";break;case di:v.command(In(ot)&&ot.length&&ot.length%4===0&&ot.length<=_t*4,"uniform "+V,x.commandStr),I="4i";break}_t>1?(I+="v",ot=x.global.def("["+Array.prototype.slice.call(ot)+"]")):ot=In(ot)?Array.prototype.slice.call(ot):ot,g(P,".uniform",I,"(",Ht,",",ot,");")}continue}else mt=Nt.append(x,g)}else{if(!j(dh))continue;mt=g.def(M.uniforms,"[",y.id(V),"]")}ct===$f?(v(!Array.isArray(mt),"must specify a scalar prop for textures"),g("if(",mt,"&&",mt,'._reglType==="framebuffer"){',mt,"=",mt,".color[0];","}")):ct===zo&&(v(!Array.isArray(mt),"must specify a scalar prop for cube maps"),g("if(",mt,"&&",mt,'._reglType==="framebufferCube"){',mt,"=",mt,".color[0];","}")),v.optional(function(){function Gr(Er,Wf){x.assert(g,Er,'bad data or missing for uniform "'+V+'".  '+Wf)}function ks(Er,Wf){Wf===1&&v(!Array.isArray(mt),"must not specify an array type for uniform"),Gr("Array.isArray("+mt+") && typeof "+mt+'[0]===" '+Er+'" || typeof '+mt+'==="'+Er+'"',"invalid type, expected "+Er)}function Kr(Er,Wf,lc){Array.isArray(mt)?v(mt.length&&mt.length%Er===0&&mt.length<=Er*lc,"must have length of "+(lc===1?"":"n * ")+Er):Gr(M.isArrayLike+"("+mt+")&&"+mt+".length && "+mt+".length % "+Er+" === 0 && "+mt+".length<="+Er*lc,"invalid vector, should have length of "+(lc===1?"":"n * ")+Er,x.commandStr)}function Cd(Er){v(!Array.isArray(mt),"must not specify a value type"),Gr("typeof "+mt+'==="function"&&'+mt+'._reglType==="texture'+(Er===Od?"2d":"Cube")+'"',"invalid texture type",x.commandStr)}switch(ct){case ic:ks("number",_t);break;case ko:Kr(2,"number",_t);break;case Po:Kr(3,"number",_t);break;case di:Kr(4,"number",_t);break;case rc:ks("number",_t);break;case Bs:Kr(2,"number",_t);break;case kf:Kr(3,"number",_t);break;case Co:Kr(4,"number",_t);break;case fh:ks("boolean",_t);break;case _i:Kr(2,"boolean",_t);break;case Pf:Kr(3,"boolean",_t);break;case zf:Kr(4,"boolean",_t);break;case Rs:Kr(4,"number",_t);break;case Uf:Kr(9,"number",_t);break;case Gf:Kr(16,"number",_t);break;case $f:Cd(Od);break;case zo:Cd(dm);break}});var nn=1;switch(ct){case $f:case zo:var cr=g.def(mt,"._texture");g(P,".uniform1i(",Ht,",",cr,".bind());"),g.exit(cr,".unbind();");continue;case ic:case fh:I="1i";break;case ko:case _i:I="2i",nn=2;break;case Po:case Pf:I="3i",nn=3;break;case di:case zf:I="4i",nn=4;break;case rc:I="1f";break;case Bs:I="2f",nn=2;break;case kf:I="3f",nn=3;break;case Co:I="4f",nn=4;break;case Rs:I="Matrix2fv";break;case Uf:I="Matrix3fv";break;case Gf:I="Matrix4fv";break}if(I.indexOf("Matrix")===-1&&_t>1&&(I+="v",nn=1),I.charAt(0)==="M"){g(P,".uniform",I,"(",Ht,",");var Fs=Math.pow(ct-Rs+2,2),ia=x.global.def("new Float32Array(",Fs,")");Array.isArray(mt)?g("false,(",yr(Fs,function(Gr){return ia+"["+Gr+"]="+mt[Gr]}),",",ia,")"):g("false,(Array.isArray(",mt,")||",mt," instanceof Float32Array)?",mt,":(",yr(Fs,function(Gr){return ia+"["+Gr+"]="+mt+"["+Gr+"]"}),",",ia,")"),g(");")}else if(nn>1){for(var Li=[],Pa=[],Cs=0;Cs<nn;++Cs)Array.isArray(mt)?Pa.push(mt[Cs]):Pa.push(g.def(mt+"["+Cs+"]")),D&&Li.push(g.def());D&&g("if(!",x.batchId,"||",Li.map(function(Gr,ks){return Gr+"!=="+Pa[ks]}).join("||"),"){",Li.map(function(Gr,ks){return Gr+"="+Pa[ks]+";"}).join("")),g(P,".uniform",I,"(",Ht,",",Pa.join(","),");"),D&&g("}")}else{if(v(!Array.isArray(mt),"uniform value must not be an array"),D){var Fd=g.def();g("if(!",x.batchId,"||",Fd,"!==",mt,"){",Fd,"=",mt,";")}g(P,".uniform",I,"(",Ht,",",mt,");"),D&&g("}")}}}function ce(x,g,L,U){var j=x.shared,D=j.gl,M=j.draw,P=U.draw;function S(){var te=P.elements,Qt,le=g;return te?((te.contextDep&&U.contextDynamic||te.propDep)&&(le=L),Qt=te.append(x,le),P.elementsActive&&le("if("+Qt+")"+D+".bindBuffer("+ah+","+Qt+".buffer.buffer);")):(Qt=le.def(),le(Qt,"=",M,".",Ma,";","if(",Qt,"){",D,".bindBuffer(",ah,",",Qt,".buffer.buffer);}","else if(",j.vao,".currentVAO){",Qt,"=",x.shared.elements+".getElements("+j.vao,".currentVAO.elements);",pt?"":"if("+Qt+")"+D+".bindBuffer("+ah+","+Qt+".buffer.buffer);","}")),Qt}function I(){var te=P.count,Qt,le=g;return te?((te.contextDep&&U.contextDynamic||te.propDep)&&(le=L),Qt=te.append(x,le),v.optional(function(){te.MISSING&&x.assert(g,"false","missing vertex count"),te.DYNAMIC&&x.assert(le,Qt+">=0","missing vertex count")})):(Qt=le.def(M,".",Na),v.optional(function(){x.assert(le,Qt+">=0","missing vertex count")})),Qt}var E=S();function X(te){var Qt=P[te];return Qt?Qt.contextDep&&U.contextDynamic||Qt.propDep?Qt.append(x,L):Qt.append(x,g):g.def(M,".",te)}var V=X(La),ct=X(Is),_t=I();if(typeof _t=="number"){if(_t===0)return}else L("if(",_t,"){"),L.exit("}");var Nt,he;xt&&(Nt=X(Ju),he=x.instancing);var oe=E+".type",Ht=P.elements&&Ca(P.elements)&&!P.vaoActive;function mt(){function te(){L(he,".drawElementsInstancedANGLE(",[V,_t,oe,ct+"<<(("+oe+"-"+gd+")>>1)",Nt],");")}function Qt(){L(he,".drawArraysInstancedANGLE(",[V,ct,_t,Nt],");")}E&&E!=="null"?Ht?te():(L("if(",E,"){"),te(),L("}else{"),Qt(),L("}")):Qt()}function ot(){function te(){L(D+".drawElements("+[V,_t,oe,ct+"<<(("+oe+"-"+gd+")>>1)"]+");")}function Qt(){L(D+".drawArrays("+[V,ct,_t]+");")}E&&E!=="null"?Ht?te():(L("if(",E,"){"),te(),L("}else{"),Qt(),L("}")):Qt()}xt&&(typeof Nt!="number"||Nt>=0)?typeof Nt=="string"?(L("if(",Nt,">0){"),mt(),L("}else if(",Nt,"<0){"),ot(),L("}")):mt():ot()}function Be(x,g,L,U,j){var D=_e(),M=D.proc("body",j);return v.optional(function(){D.commandStr=g.commandStr,D.command=D.link(g.commandStr)}),xt&&(D.instancing=M.def(D.shared.extensions,".angle_instanced_arrays")),x(D,M,L,U),D.compile().body}function je(x,g,L,U){zn(x,g),L.useVAO?L.drawVAO?g(x.shared.vao,".setVAO(",L.drawVAO.append(x,g),");"):g(x.shared.vao,".setVAO(",x.shared.vao,".targetVAO);"):(g(x.shared.vao,".setVAO(null);"),ur(x,g,L,U.attributes,function(){return!0})),en(x,g,L,U.uniforms,function(){return!0},!1),ce(x,g,g,L)}function Un(x,g){var L=x.proc("draw",1);zn(x,L),Vn(x,L,g.context),Yn(x,L,g.framebuffer),er(x,L,g),fr(x,L,g.state),we(x,L,g,!1,!0);var U=g.shader.progVar.append(x,L);if(L(x.shared.gl,".useProgram(",U,".program);"),g.shader.program)je(x,L,g,g.shader.program);else{L(x.shared.vao,".setVAO(null);");var j=x.global.def("{}"),D=L.def(U,".id"),M=L.def(j,"[",D,"]");L(x.cond(M).then(M,".call(this,a0);").else(M,"=",j,"[",D,"]=",x.link(function(P){return Be(je,x,g,P,1)}),"(",U,");",M,".call(this,a0);"))}Object.keys(g.state).length>0&&L(x.shared.current,".dirty=true;"),x.shared.vao&&L(x.shared.vao,".setVAO(null);")}function mi(x,g,L,U){x.batchId="a1",zn(x,g);function j(){return!0}ur(x,g,L,U.attributes,j),en(x,g,L,U.uniforms,j,!1),ce(x,g,g,L)}function ka(x,g,L,U){zn(x,g);var j=L.contextDep,D=g.def(),M="a0",P="a1",S=g.def();x.shared.props=S,x.batchId=D;var I=x.scope(),E=x.scope();g(I.entry,"for(",D,"=0;",D,"<",P,";++",D,"){",S,"=",M,"[",D,"];",E,"}",I.exit);function X(oe){return oe.contextDep&&j||oe.propDep}function V(oe){return!X(oe)}if(L.needsContext&&Vn(x,E,L.context),L.needsFramebuffer&&Yn(x,E,L.framebuffer),fr(x,E,L.state,X),L.profile&&X(L.profile)&&we(x,E,L,!1,!0),U)L.useVAO?L.drawVAO?X(L.drawVAO)?E(x.shared.vao,".setVAO(",L.drawVAO.append(x,E),");"):I(x.shared.vao,".setVAO(",L.drawVAO.append(x,I),");"):I(x.shared.vao,".setVAO(",x.shared.vao,".targetVAO);"):(I(x.shared.vao,".setVAO(null);"),ur(x,I,L,U.attributes,V),ur(x,E,L,U.attributes,X)),en(x,I,L,U.uniforms,V,!1),en(x,E,L,U.uniforms,X,!0),ce(x,I,E,L);else{var ct=x.global.def("{}"),_t=L.shader.progVar.append(x,E),Nt=E.def(_t,".id"),he=E.def(ct,"[",Nt,"]");E(x.shared.gl,".useProgram(",_t,".program);","if(!",he,"){",he,"=",ct,"[",Nt,"]=",x.link(function(oe){return Be(mi,x,L,oe,2)}),"(",_t,");}",he,".call(this,a0[",D,"],",D,");")}}function T(x,g){var L=x.proc("batch",2);x.batchId="0",zn(x,L);var U=!1,j=!0;Object.keys(g.context).forEach(function(ct){U=U||g.context[ct].propDep}),U||(Vn(x,L,g.context),j=!1);var D=g.framebuffer,M=!1;D?(D.propDep?U=M=!0:D.contextDep&&U&&(M=!0),M||Yn(x,L,D)):Yn(x,L,null),g.state.viewport&&g.state.viewport.propDep&&(U=!0);function P(ct){return ct.contextDep&&U||ct.propDep}er(x,L,g),fr(x,L,g.state,function(ct){return!P(ct)}),(!g.profile||!P(g.profile))&&we(x,L,g,!1,"a1"),g.contextDep=U,g.needsContext=j,g.needsFramebuffer=M;var S=g.shader.progVar;if(S.contextDep&&U||S.propDep)ka(x,L,g,null);else{var I=S.append(x,L);if(L(x.shared.gl,".useProgram(",I,".program);"),g.shader.program)ka(x,L,g,g.shader.program);else{L(x.shared.vao,".setVAO(null);");var E=x.global.def("{}"),X=L.def(I,".id"),V=L.def(E,"[",X,"]");L(x.cond(V).then(V,".call(this,a0,a1);").else(V,"=",E,"[",X,"]=",x.link(function(ct){return Be(ka,x,g,ct,2)}),"(",I,");",V,".call(this,a0,a1);"))}}Object.keys(g.state).length>0&&L(x.shared.current,".dirty=true;"),x.shared.vao&&L(x.shared.vao,".setVAO(null);")}function nt(x,g){var L=x.proc("scope",3);x.batchId="a2";var U=x.shared,j=U.current;Vn(x,L,g.context),g.framebuffer&&g.framebuffer.append(x,L),oc(Object.keys(g.state)).forEach(function(M){var P=g.state[M],S=P.append(x,L);In(S)?S.forEach(function(I,E){L.set(x.next[M],"["+E+"]",I)}):L.set(U.next,"."+M,S)}),we(x,L,g,!0,!0),[Ma,Is,Na,Ju,La].forEach(function(M){var P=g.draw[M];P&&L.set(U.draw,"."+M,""+P.append(x,L))}),Object.keys(g.uniforms).forEach(function(M){var P=g.uniforms[M].append(x,L);Array.isArray(P)&&(P="["+P.join()+"]"),L.set(U.uniforms,"["+y.id(M)+"]",P)}),Object.keys(g.attributes).forEach(function(M){var P=g.attributes[M].append(x,L),S=x.scopeAttrib(M);Object.keys(new z).forEach(function(I){L.set(S,"."+I,P[I])})}),g.scopeVAO&&L.set(U.vao,".targetVAO",g.scopeVAO.append(x,L));function D(M){var P=g.shader[M];P&&L.set(U.shader,"."+M,P.append(x,L))}D(Ff),D(Ts),Object.keys(g.state).length>0&&(L(j,".dirty=true;"),L.exit(j,".dirty=true;")),L("a1(",x.shared.context,",a0,",x.batchId,");")}function q(x){if(!(typeof x!="object"||In(x))){for(var g=Object.keys(x),L=0;L<g.length;++L)if(hr.isDynamic(x[g[L]]))return!0;return!1}}function qt(x,g,L){var U=g.static[L];if(!U||!q(U))return;var j=x.global,D=Object.keys(U),M=!1,P=!1,S=!1,I=x.global.def("{}");D.forEach(function(X){var V=U[X];if(hr.isDynamic(V)){typeof V=="function"&&(V=U[X]=hr.unbox(V));var ct=mr(V,null);M=M||ct.thisDep,S=S||ct.propDep,P=P||ct.contextDep}else{switch(j(I,".",X,"="),typeof V){case"number":j(V);break;case"string":j('"',V,'"');break;case"object":Array.isArray(V)&&j("[",V.join(),"]");break;default:j(x.link(V));break}j(";")}});function E(X,V){D.forEach(function(ct){var _t=U[ct];if(hr.isDynamic(_t)){var Nt=X.invoke(V,_t);V(I,".",ct,"=",Nt,";")}})}g.dynamic[L]=new hr.DynamicVariable(As,{thisDep:M,contextDep:P,propDep:S,ref:I,append:E}),delete g.static[L]}function Ae(x,g,L,U,j){var D=_e();D.stats=D.link(j),Object.keys(g.static).forEach(function(P){qt(D,g,P)}),Ye.forEach(function(P){qt(D,x,P)});var M=jn(x,g,L,U,D);return Un(D,M),nt(D,M),T(D,M),r(D.compile(),{destroy:function(){M.shader.program.destroy()}})}return{next:jt,current:Vt,procs:function(){var x=_e(),g=x.proc("poll"),L=x.proc("refresh"),U=x.block();g(U),L(U);var j=x.shared,D=j.gl,M=j.next,P=j.current;U(P,".dirty=false;"),Yn(x,g),Yn(x,L,null,!0);var S;xt&&(S=x.link(xt)),B.oes_vertex_array_object&&L(x.link(B.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var I=0;I<Q.maxAttributes;++I){var E=L.def(j.attributes,"[",I,"]"),X=x.cond(E,".buffer");X.then(D,".enableVertexAttribArray(",I,");",D,".bindBuffer(",Fo,",",E,".buffer.buffer);",D,".vertexAttribPointer(",I,",",E,".size,",E,".type,",E,".normalized,",E,".stride,",E,".offset);").else(D,".disableVertexAttribArray(",I,");",D,".vertexAttrib4f(",I,",",E,".x,",E,".y,",E,".z,",E,".w);",E,".buffer=null;"),L(X),xt&&L(S,".vertexAttribDivisorANGLE(",I,",",E,".divisor);")}return L(x.shared.vao,".currentVAO=null;",x.shared.vao,".setVAO(",x.shared.vao,".targetVAO);"),Object.keys(dt).forEach(function(V){var ct=dt[V],_t=U.def(M,".",V),Nt=x.block();Nt("if(",_t,"){",D,".enable(",ct,")}else{",D,".disable(",ct,")}",P,".",V,"=",_t,";"),L(Nt),g("if(",_t,"!==",P,".",V,"){",Nt,"}")}),Object.keys(ht).forEach(function(V){var ct=ht[V],_t=Vt[V],Nt,he,oe=x.block();if(oe(D,".",ct,"("),In(_t)){var Ht=_t.length;Nt=x.global.def(M,".",V),he=x.global.def(P,".",V),oe(yr(Ht,function(mt){return Nt+"["+mt+"]"}),");",yr(Ht,function(mt){return he+"["+mt+"]="+Nt+"["+mt+"];"}).join("")),g("if(",yr(Ht,function(mt){return Nt+"["+mt+"]!=="+he+"["+mt+"]"}).join("||"),"){",oe,"}")}else Nt=U.def(M,".",V),he=U.def(P,".",V),oe(Nt,");",P,".",V,"=",Nt,";"),g("if(",Nt,"!==",he,"){",oe,"}");L(oe)}),x.compile()}(),compile:Ae}}function bm(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Ld=34918,ra=34919,ph=35007,Nd=function(d,y){if(!y.ext_disjoint_timer_query)return null;var B=[];function Q(){return B.pop()||y.ext_disjoint_timer_query.createQueryEXT()}function lt(xt){B.push(xt)}var K=[];function tt(xt){var Yt=Q();y.ext_disjoint_timer_query.beginQueryEXT(ph,Yt),K.push(Yt),wt(K.length-1,K.length,xt)}function vt(){y.ext_disjoint_timer_query.endQueryEXT(ph)}function yt(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var It=[];function Rt(){return It.pop()||new yt}function Ot(xt){It.push(xt)}var kt=[];function wt(xt,Yt,pt){var Vt=Rt();Vt.startQueryIndex=xt,Vt.endQueryIndex=Yt,Vt.sum=0,Vt.stats=pt,kt.push(Vt)}var Et=[],z=[];function J(){var xt,Yt,pt=K.length;if(pt!==0){z.length=Math.max(z.length,pt+1),Et.length=Math.max(Et.length,pt+1),Et[0]=0,z[0]=0;var Vt=0;for(xt=0,Yt=0;Yt<K.length;++Yt){var jt=K[Yt];y.ext_disjoint_timer_query.getQueryObjectEXT(jt,ra)?(Vt+=y.ext_disjoint_timer_query.getQueryObjectEXT(jt,Ld),lt(jt)):K[xt++]=jt,Et[Yt+1]=Vt,z[Yt+1]=xt}for(K.length=xt,xt=0,Yt=0;Yt<kt.length;++Yt){var re=kt[Yt],dt=re.startQueryIndex,ht=re.endQueryIndex;re.sum+=Et[ht]-Et[dt];var Zt=z[dt],Pt=z[ht];Pt===Zt?(re.stats.gpuTime+=re.sum/1e6,Ot(re)):(re.startQueryIndex=Zt,re.endQueryIndex=Pt,kt[xt++]=re)}kt.length=xt}}return{beginQuery:tt,endQuery:vt,pushScopeStats:wt,update:J,getNumPendingQueries:function(){return K.length},clear:function(){B.push.apply(B,K);for(var xt=0;xt<B.length;xt++)y.ext_disjoint_timer_query.deleteQueryEXT(B[xt]);K.length=0,B.length=0},restore:function(){K.length=0,B.length=0}}},ym=16384,Dd=256,vm=1024,wm=34962,Mi="webglcontextlost",fc="webglcontextrestored",uc=1,mh=2,cc=3;function Ds(d,y){for(var B=0;B<d.length;++B)if(d[B]===y)return B;return-1}function ve(d){var y=nl(d);if(!y)return null;var B=y.gl,Q=B.getContextAttributes(),lt=B.isContextLost(),K=rl(B,y);if(!K)return null;var tt=tl(),vt=bm(),yt=K.extensions,It=Nd(B,yt),Rt=ji(),Ot=B.drawingBufferWidth,kt=B.drawingBufferHeight,wt={tick:0,time:0,viewportWidth:Ot,viewportHeight:kt,framebufferWidth:Ot,framebufferHeight:kt,drawingBufferWidth:Ot,drawingBufferHeight:kt,pixelRatio:y.pixelRatio},Et={},z={elements:null,primitive:4,count:-1,offset:0,instances:-1},J=cf(B,yt),xt=Le(B,vt,y,Vt),Yt=Cn(B,yt,xt,vt),pt=fm(B,yt,J,vt,xt,Yt,z);function Vt(ce){return pt.destroyBuffer(ce)}var jt=Xl(B,tt,vt,y),re=wr(B,yt,J,function(){Zt.procs.poll()},wt,vt,y),dt=Yp(B,yt,J,vt,y),ht=om(B,yt,J,re,dt,vt),Zt=_h(B,tt,yt,J,xt,Yt,re,ht,Et,pt,jt,z,wt,It,y),Pt=hm(B,ht,Zt.procs.poll,wt,Q,yt,J),St=Zt.next,zt=B.canvas,Ut=[],ge=[],_e=[],Gt=[y.onDestroy],Wt=null;function ue(){if(Ut.length===0){It&&It.update(),Wt=null;return}Wt=kr.next(ue),fr();for(var ce=Ut.length-1;ce>=0;--ce){var Be=Ut[ce];Be&&Be(wt,null,0)}B.flush(),It&&It.update()}function me(){!Wt&&Ut.length>0&&(Wt=kr.next(ue))}function Ee(){Wt&&(kr.cancel(ue),Wt=null)}function En(ce){ce.preventDefault(),lt=!0,Ee(),ge.forEach(function(Be){Be()})}function vn(ce){B.getError(),lt=!1,K.restore(),jt.restore(),xt.restore(),re.restore(),dt.restore(),ht.restore(),pt.restore(),It&&It.restore(),Zt.procs.refresh(),me(),_e.forEach(function(Be){Be()})}zt&&(zt.addEventListener(Mi,En,!1),zt.addEventListener(fc,vn,!1));function Oe(){Ut.length=0,Ee(),zt&&(zt.removeEventListener(Mi,En),zt.removeEventListener(fc,vn)),jt.clear(),ht.clear(),dt.clear(),pt.clear(),re.clear(),Yt.clear(),xt.clear(),It&&It.clear(),Gt.forEach(function(ce){ce()})}function mn(ce){v(!!ce,"invalid args to regl({...})"),v.type(ce,"object","invalid args to regl({...})");function Be(j){var D=r({},j);delete D.uniforms,delete D.attributes,delete D.context,delete D.vao,"stencil"in D&&D.stencil.op&&(D.stencil.opBack=D.stencil.opFront=D.stencil.op,delete D.stencil.op);function M(P){if(P in D){var S=D[P];delete D[P],Object.keys(S).forEach(function(I){D[P+"."+I]=S[I]})}}return M("blend"),M("depth"),M("cull"),M("stencil"),M("polygonOffset"),M("scissor"),M("sample"),"vao"in j&&(D.vao=j.vao),D}function je(j,D){var M={},P={};return Object.keys(j).forEach(function(S){var I=j[S];if(hr.isDynamic(I)){P[S]=hr.unbox(I,S);return}else if(D&&Array.isArray(I)){for(var E=0;E<I.length;++E)if(hr.isDynamic(I[E])){P[S]=hr.unbox(I,S);return}}M[S]=I}),{dynamic:P,static:M}}var Un=je(ce.context||{},!0),mi=je(ce.uniforms||{},!0),ka=je(ce.attributes||{},!1),T=je(Be(ce),!1),nt={gpuTime:0,cpuTime:0,count:0},q=Zt.compile(T,ka,mi,Un,nt),qt=q.draw,Ae=q.batch,x=q.scope,g=[];function L(j){for(;g.length<j;)g.push(null);return g}function U(j,D){var M;if(lt&&v.raise("context lost"),typeof j=="function")return x.call(this,null,j,0);if(typeof D=="function")if(typeof j=="number")for(M=0;M<j;++M)x.call(this,null,D,M);else if(Array.isArray(j))for(M=0;M<j.length;++M)x.call(this,j[M],D,M);else return x.call(this,j,D,0);else if(typeof j=="number"){if(j>0)return Ae.call(this,L(j|0),j|0)}else if(Array.isArray(j)){if(j.length)return Ae.call(this,j,j.length)}else return qt.call(this,j)}return r(U,{stats:nt,destroy:function(){q.destroy()}})}var an=ht.setFBO=mn({framebuffer:hr.define.call(null,uc,"framebuffer")});function jn(ce,Be){var je=0;Zt.procs.poll();var Un=Be.color;Un&&(B.clearColor(+Un[0]||0,+Un[1]||0,+Un[2]||0,+Un[3]||0),je|=ym),"depth"in Be&&(B.clearDepth(+Be.depth),je|=Dd),"stencil"in Be&&(B.clearStencil(Be.stencil|0),je|=vm),v(!!je,"called regl.clear with no buffer specified"),B.clear(je)}function Vn(ce){if(v(typeof ce=="object"&&ce,"regl.clear() takes an object as input"),"framebuffer"in ce)if(ce.framebuffer&&ce.framebuffer_reglType==="framebufferCube")for(var Be=0;Be<6;++Be)an(r({framebuffer:ce.framebuffer.faces[Be]},ce),jn);else an(ce,jn);else jn(null,ce)}function Yn(ce){v.type(ce,"function","regl.frame() callback must be a function"),Ut.push(ce);function Be(){var je=Ds(Ut,ce);v(je>=0,"cannot cancel a frame twice");function Un(){var mi=Ds(Ut,Un);Ut[mi]=Ut[Ut.length-1],Ut.length-=1,Ut.length<=0&&Ee()}Ut[je]=Un}return me(),{cancel:Be}}function er(){var ce=St.viewport,Be=St.scissor_box;ce[0]=ce[1]=Be[0]=Be[1]=0,wt.viewportWidth=wt.framebufferWidth=wt.drawingBufferWidth=ce[2]=Be[2]=B.drawingBufferWidth,wt.viewportHeight=wt.framebufferHeight=wt.drawingBufferHeight=ce[3]=Be[3]=B.drawingBufferHeight}function fr(){wt.tick+=1,wt.time=we(),er(),Zt.procs.poll()}function zn(){re.refresh(),er(),Zt.procs.refresh(),It&&It.update()}function we(){return(ji()-Rt)/1e3}zn();function ur(ce,Be){v.type(Be,"function","listener callback must be a function");var je;switch(ce){case"frame":return Yn(Be);case"lost":je=ge;break;case"restore":je=_e;break;case"destroy":je=Gt;break;default:v.raise("invalid event, must be one of frame,lost,restore,destroy")}return je.push(Be),{cancel:function(){for(var Un=0;Un<je.length;++Un)if(je[Un]===Be){je[Un]=je[je.length-1],je.pop();return}}}}var en=r(mn,{clear:Vn,prop:hr.define.bind(null,uc),context:hr.define.bind(null,mh),this:hr.define.bind(null,cc),draw:mn({}),buffer:function(ce){return xt.create(ce,wm,!1,!1)},elements:function(ce){return Yt.create(ce,!1)},texture:re.create2D,cube:re.createCube,renderbuffer:dt.create,framebuffer:ht.create,framebufferCube:ht.createCube,vao:pt.createVAO,attributes:Q,frame:Yn,on:ur,limits:J,hasExtension:function(ce){return J.extensions.indexOf(ce.toLowerCase())>=0},read:Pt,destroy:Oe,_gl:B,_refresh:zn,poll:function(){fr(),It&&It.update()},now:we,stats:vt});return y.onDone(null,en),en}return ve})})(BE);var RE=LE,Oh=new Uint8Array(4),ME=new Float32Array(Oh.buffer);function LE(n,t,e,r){return Oh[0]=r,Oh[1]=e,Oh[2]=t,Oh[3]=n,ME[0]}class Hf{constructor(t,e="arithmetic"){this.transform="arithmetic",this.transform=e,this.start=t,this.value=t,this.target=t}update(t,e){if(e===0){this.value=t,this.timer!==void 0&&this.timer.stop();return}this.start=this.value,this.target=t,this.start_timer(e)}start_timer(t){this.timer!==void 0&&this.timer.stop();const e=Wh(r=>{const a=r/t;if(a>=1){this.value=this.target,e.stop();return}const o=1-a,f=a;this.value=this.transform==="geometric"?this.start**o*this.target**f:this.start*o+this.target*f});this.timer=e}}class NE{constructor(){this.maxPoints=new Hf(1e4,"geometric"),this.pointSize=new Hf(1,"geometric"),this.targetOpacity=new Hf(50),this.foregroundOpacity=new Hf(1),this.backgroundOpacity=new Hf(.5),this.foregroundSize=new Hf(1,"geometric"),this.backgroundSize=new Hf(1,"geometric")}apply_prefs(t){const{duration:e}=t;this.maxPoints.update(t.max_points,e),this.targetOpacity.update(t.alpha,e),this.pointSize.update(t.point_size,e),this.foregroundOpacity.update(t.background_options.opacity[1],e),this.backgroundOpacity.update(t.background_options.opacity[0],e),this.foregroundSize.update(t.background_options.size[1],e),this.backgroundSize.update(t.background_options.size[0],e)}get max_points(){return this.maxPoints.value}get alpha(){return this.targetOpacity.value}get point_size(){return this.pointSize.value}get foreground_opacity(){return this.foregroundOpacity.value}get background_opacity(){return this.backgroundOpacity.value}get foreground_size(){return this.foregroundSize.value}get background_size(){return this.backgroundSize.value}}class xv{constructor(t,e,r){this._use_scale_to_download_tiles=!0,this._initializations=[],this.render_props=new NE,this.scatterplot=r,this.holder=Wn(t),this.canvas=Wn(this.holder.node().firstElementChild).node(),this.dataset=e,this.width=+Wn(this.canvas).attr("width"),this.height=+Wn(this.canvas).attr("height"),this.deferred_functions=[],this._use_scale_to_download_tiles=!0}get discard_share(){return 0}get prefs(){const t={...this.scatterplot.prefs};return t.arrow_table=void 0,t.arrow_buffer=void 0,t}get alpha(){return this.render_props.alpha}get optimal_alpha(){var t,e,r,a;const o=(t=this.prefs.zoom_balance)!=null?t:1,{alpha:f,point_size:c,max_ix:l,width:_,discard_share:m,height:A}=this,R=(a=(r=(e=this.zoom)==null?void 0:e.transform)==null?void 0:r.k)!=null?a:1,C=f/100,G=1/R**2,$t=window.devicePixelRatio||1,Kt=_*A/$t,ie=e0([l,this.dataset.highest_known_ix||1e10])*(1-m),Xt=Math.exp(Math.log(R)*o),it=Math.PI*(Xt*c/$t/2)**2,Ct=C*Kt/(ie*G*it);return Ct<1/255?1/255:Ct}get point_size(){return this.render_props.point_size}get max_ix(){const{prefs:t}=this,{max_points:e}=this.render_props;if(!this._use_scale_to_download_tiles)return e;const{k:r}=this.zoom.transform,a=Math.exp(Math.log(r)*t.zoom_balance);return e*r*r/a/a}visible_tiles(){const{max_ix:t}=this,{dataset:e}=this,a=this.aes.dim("x").current.field=="x"&&this.aes.dim("y").current.field=="y"&&this.aes.dim("x").last.field=="x"&&this.aes.dim("y").last.field=="y"?e.map(o=>o).filter(o=>o.is_visible(t,this.zoom.current_corners())):e.map(o=>o).filter(o=>o.min_ix<this.max_ix);return a.sort((o,f)=>o.min_ix-f.min_ix),a}bind_zoom(t){return this.zoom=t,this}async initialize(){}}const DE=`precision mediump float;
#define GLSLIFY 1

vec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.411764705882353) * direction;
  vec2 off2 = vec2(3.2941176470588234) * direction;
  vec2 off3 = vec2(5.176470588235294) * direction;
  color += texture2D(image, uv) * 0.1964825501511404;
  color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;
  color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;
  color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;
  color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;
  color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;
  color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;
  return color;
}

uniform vec2 iResolution;
uniform sampler2D iChannel0;
uniform vec2 direction;

void main() {
  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);
  gl_FragColor = blur13(iChannel0, uv, iResolution.xy, direction);
}
`,FE=`precision mediump float;
#define GLSLIFY 1

uniform float u_zoom_balance;
uniform float u_tile_id;
uniform float u_update_time;
uniform float u_transition_duration;

// Type of jitter.
uniform float u_jitter;
uniform float u_last_jitter;

// Whether to plot only a single category.
uniform float u_only_color;
uniform float u_grid_mode;

uniform vec3 u_filter_numeric; // An override for simple numeric operations.
uniform vec3 u_last_filter_numeric; // An override for simple numeric operations.

uniform vec3 u_filter2_numeric; // An override for simple numeric operations.
uniform vec3 u_last_filter2_numeric; // An override for simple numeric operations.

uniform vec3 u_foreground_numeric; // An override for simple numeric operations.
uniform vec3 u_last_foreground_numeric; // An override for simple numeric operations.

// Transform from data space to the open window.
uniform mat3 u_window_scale;
uniform mat3 u_last_window_scale;
// Transform from the open window to the d3-zoom.
uniform mat3 u_zoom;

uniform float u_width;
uniform float u_height;
uniform float u_use_glyphset;
varying vec2 letter_pos; // store which letter to use.

uniform float u_maxix;           // The maximum index to plot.
uniform float u_time;            // The current time.
uniform float u_k;               // The d3-scale factor.
uniform float u_color_picker_mode;
uniform float u_base_size;
uniform float u_alpha;
uniform float u_foreground_number; // -1 -- everything is foreground; 0 -- background; 1 -- foreground.
uniform vec4 u_background_rgba;
uniform float u_foreground_alpha;
uniform float u_background_mouseover;
uniform float u_foreground_size;
uniform float u_background_size;

uniform sampler2D u_one_d_aesthetic_map;
uniform sampler2D u_color_aesthetic_map;

// The same set of items for a variety of aesthetics.

// whether to continuously interpolate between
// x0 and x, y0 and y.
uniform float u_position_interpolation_mode;

float a_color;
float a_last_color;

uniform float u_color_buffer_num;
uniform float u_last_color_buffer_num;

uniform vec3 u_color_constant;
uniform vec3 u_last_color_constant;

uniform float u_color_transform;
uniform float u_last_color_transform;
uniform vec2 u_color_domain;
uniform vec2 u_last_color_domain;
uniform float u_last_color_map_position;
uniform float u_color_map_position;

bool a_color_is_constant;
bool a_last_color_is_constant;

/*
python code to generate what follows.
def autogenerate_code():
  ks = ["x", "y", "jitter_radius", "jitter_speed", "size", "filter", "filter2", "x0", "y0", "foreground"]
  times = ["", "last_"]
  print("""
  //  BEGIN AUTOGENERATED. DO NOT EDIT. 
  // ------------------------------------------------    
  """)
  for k in ks:
    for time in times:
      timek = time + k
      print(f"""
  uniform float u_{timek}_buffer_num;
  uniform float u_{timek}_constant;
  uniform float u_{timek}_transform;
  uniform vec2 u_{timek}_domain;
  uniform vec2 u_{timek}_range;
  uniform float u_{timek}_map_position;
  float a_{timek};
  bool a_{timek}_is_constant;
      """)
  for i in range(0, 16):
    print(f"attribute float buffer_{i};")
  for k in ks:
    for time in times:
      timek = time + k
      print(f"""
    if (u_{timek}_buffer_num > -0.5) {{
      a_{timek} = get_buffer(u_{timek}_buffer_num);
      a_{timek}_is_constant = false;
    }} else {{
      a_{timek} = u_{timek}_constant;
      a_{timek}_is_constant = true;
    }}""")
  print("""
//  END AUTOGENERATED. DO NOT EDIT ABOVE. 
// ------------------------------------------------    
  """)

autogenerate_code()
*/

  //  BEGIN AUTOGENERATED. DO NOT EDIT. 
  // ------------------------------------------------    
  

  uniform float u_x_buffer_num;
  uniform float u_x_constant;
  uniform float u_x_transform;
  uniform vec2 u_x_domain;
  uniform vec2 u_x_range;
  uniform float u_x_map_position;
  float a_x;
  bool a_x_is_constant;
      

  uniform float u_last_x_buffer_num;
  uniform float u_last_x_constant;
  uniform float u_last_x_transform;
  uniform vec2 u_last_x_domain;
  uniform vec2 u_last_x_range;
  uniform float u_last_x_map_position;
  float a_last_x;
  bool a_last_x_is_constant;
      

  uniform float u_y_buffer_num;
  uniform float u_y_constant;
  uniform float u_y_transform;
  uniform vec2 u_y_domain;
  uniform vec2 u_y_range;
  uniform float u_y_map_position;
  float a_y;
  bool a_y_is_constant;
      

  uniform float u_last_y_buffer_num;
  uniform float u_last_y_constant;
  uniform float u_last_y_transform;
  uniform vec2 u_last_y_domain;
  uniform vec2 u_last_y_range;
  uniform float u_last_y_map_position;
  float a_last_y;
  bool a_last_y_is_constant;
      

  uniform float u_jitter_radius_buffer_num;
  uniform float u_jitter_radius_constant;
  uniform float u_jitter_radius_transform;
  uniform vec2 u_jitter_radius_domain;
  uniform vec2 u_jitter_radius_range;
  uniform float u_jitter_radius_map_position;
  float a_jitter_radius;
  bool a_jitter_radius_is_constant;
      

  uniform float u_last_jitter_radius_buffer_num;
  uniform float u_last_jitter_radius_constant;
  uniform float u_last_jitter_radius_transform;
  uniform vec2 u_last_jitter_radius_domain;
  uniform vec2 u_last_jitter_radius_range;
  uniform float u_last_jitter_radius_map_position;
  float a_last_jitter_radius;
  bool a_last_jitter_radius_is_constant;
      

  uniform float u_jitter_speed_buffer_num;
  uniform float u_jitter_speed_constant;
  uniform float u_jitter_speed_transform;
  uniform vec2 u_jitter_speed_domain;
  uniform vec2 u_jitter_speed_range;
  uniform float u_jitter_speed_map_position;
  float a_jitter_speed;
  bool a_jitter_speed_is_constant;
      

  uniform float u_last_jitter_speed_buffer_num;
  uniform float u_last_jitter_speed_constant;
  uniform float u_last_jitter_speed_transform;
  uniform vec2 u_last_jitter_speed_domain;
  uniform vec2 u_last_jitter_speed_range;
  uniform float u_last_jitter_speed_map_position;
  float a_last_jitter_speed;
  bool a_last_jitter_speed_is_constant;
      

  uniform float u_size_buffer_num;
  uniform float u_size_constant;
  uniform float u_size_transform;
  uniform vec2 u_size_domain;
  uniform vec2 u_size_range;
  uniform float u_size_map_position;
  float a_size;
  bool a_size_is_constant;
      

  uniform float u_last_size_buffer_num;
  uniform float u_last_size_constant;
  uniform float u_last_size_transform;
  uniform vec2 u_last_size_domain;
  uniform vec2 u_last_size_range;
  uniform float u_last_size_map_position;
  float a_last_size;
  bool a_last_size_is_constant;
      

  uniform float u_filter_buffer_num;
  uniform float u_filter_constant;
  uniform float u_filter_transform;
  uniform vec2 u_filter_domain;
  uniform vec2 u_filter_range;
  uniform float u_filter_map_position;
  float a_filter;
  bool a_filter_is_constant;
      

  uniform float u_last_filter_buffer_num;
  uniform float u_last_filter_constant;
  uniform float u_last_filter_transform;
  uniform vec2 u_last_filter_domain;
  uniform vec2 u_last_filter_range;
  uniform float u_last_filter_map_position;
  float a_last_filter;
  bool a_last_filter_is_constant;
      

  uniform float u_filter2_buffer_num;
  uniform float u_filter2_constant;
  uniform float u_filter2_transform;
  uniform vec2 u_filter2_domain;
  uniform vec2 u_filter2_range;
  uniform float u_filter2_map_position;
  float a_filter2;
  bool a_filter2_is_constant;
      

  uniform float u_last_filter2_buffer_num;
  uniform float u_last_filter2_constant;
  uniform float u_last_filter2_transform;
  uniform vec2 u_last_filter2_domain;
  uniform vec2 u_last_filter2_range;
  uniform float u_last_filter2_map_position;
  float a_last_filter2;
  bool a_last_filter2_is_constant;
      

  uniform float u_x0_buffer_num;
  uniform float u_x0_constant;
  uniform float u_x0_transform;
  uniform vec2 u_x0_domain;
  uniform vec2 u_x0_range;
  uniform float u_x0_map_position;
  float a_x0;
  bool a_x0_is_constant;
      

  uniform float u_last_x0_buffer_num;
  uniform float u_last_x0_constant;
  uniform float u_last_x0_transform;
  uniform vec2 u_last_x0_domain;
  uniform vec2 u_last_x0_range;
  uniform float u_last_x0_map_position;
  float a_last_x0;
  bool a_last_x0_is_constant;
      

  uniform float u_y0_buffer_num;
  uniform float u_y0_constant;
  uniform float u_y0_transform;
  uniform vec2 u_y0_domain;
  uniform vec2 u_y0_range;
  uniform float u_y0_map_position;
  float a_y0;
  bool a_y0_is_constant;
      

  uniform float u_last_y0_buffer_num;
  uniform float u_last_y0_constant;
  uniform float u_last_y0_transform;
  uniform vec2 u_last_y0_domain;
  uniform vec2 u_last_y0_range;
  uniform float u_last_y0_map_position;
  float a_last_y0;
  bool a_last_y0_is_constant;
      

  uniform float u_foreground_buffer_num;
  uniform float u_foreground_constant;
  uniform float u_foreground_transform;
  uniform vec2 u_foreground_domain;
  uniform vec2 u_foreground_range;
  uniform float u_foreground_map_position;
  float a_foreground;
  bool a_foreground_is_constant;
      

  uniform float u_last_foreground_buffer_num;
  uniform float u_last_foreground_constant;
  uniform float u_last_foreground_transform;
  uniform vec2 u_last_foreground_domain;
  uniform vec2 u_last_foreground_range;
  uniform float u_last_foreground_map_position;
  float a_last_foreground;
  bool a_last_foreground_is_constant;
      
attribute float buffer_0;
attribute float buffer_1;
attribute float buffer_2;
attribute float buffer_3;
attribute float buffer_4;
attribute float buffer_5;
attribute float buffer_6;
attribute float buffer_7;
attribute float buffer_8;
attribute float buffer_9;
attribute float buffer_10;
attribute float buffer_11;
attribute float buffer_12;
attribute float buffer_13;
attribute float buffer_14;
attribute float buffer_15;

//  END AUTOGENERATED. DO NOT EDIT ABOVE. 
// ------------------------------------------------    

highp float ix_to_random(in float ix, in float seed) {
  // For high numbers, taking the log avoids coincidence.
  highp float seed2 = log(ix + 2.) + 1.;
  vec2 co = vec2(seed2, seed);
  highp float a = 12.9898;
  highp float b = 78.233;
  highp float c = 43758.5453;
  highp float dt = dot(co.xy, vec2(a, b));
  highp float sn = mod(dt, 3.14);
  return fract(sin(sn) * c);
}

// The fill color.
varying vec4 fill;
varying float point_size;

uniform float u_jitter_radius_lookup;
uniform float u_jitter_radius_lookup_y_constant;
uniform vec2 u_jitter_radius_lookup_x_domain;
uniform vec2 u_jitter_radius_lookup_y_domain;

float point_size_adjust;

// A coordinate to throw away a vertex point.
vec4 discard_me = vec4(100.0, 100.0, 1.0, 1.0);

// Initialized in the main loop
// mat3 from_coord_to_gl;

const float e = 1.618282;
// I've been convinced.
const float tau = 2. * 3.14159265359;

float interpolate_raw(in float x, in float min, in float max) {
  if (x < min) {return 0.;}
  if (x > max) {return 1.;}
  return (x - min)/(max - min);
}

float interpolate(in float x, in float min, in float max) {
  if (max < min) {
    return 1. - interpolate_raw(x, max, min);
  } else {
    return interpolate_raw(x, min, max);
  }
}

/*

The following glsl code was written in python.

buffers = [*range(16)]

def write_buffs(buffs):
    if len(buffs) == 1:
        return[f"return buffer_{buffs[0]}"]
    condition_1 = ["  " + line for line in write_buffs(buffs[:len(buffs)//2])]
    condition_2 = ["" + line for line in write_buffs(buffs[len(buffs)//2:])]

    args = [
        f"if (i < {buffs[len(buffs) // 2 - 1]}.5) {{",
        *condition_1,
        "}",
        *condition_2
    ]
    return args

print("\\n".join(write_buffs(buffers)))
*/

float get_buffer(in float i) {
  //given an index, returns the appropriate buffer.
  if (i < 7.5) {
    if (i < 3.5) {
      if (i < 1.5) {
        if (i < 0.5) {
          return buffer_0;
        }
        return buffer_1;
      }
      if (i < 2.5) {
        return buffer_2;
      }
      return buffer_3;
    }
    if (i < 5.5) {
      if (i < 4.5) {
        return buffer_4;
      }
      return buffer_5;
    }
    if (i < 6.5) {
      return buffer_6;
    }
    return buffer_7;
  }
  if (i < 11.5) {
    if (i < 9.5) {
      if (i < 8.5) {
        return buffer_8;
      }
      return buffer_9;
    }
    if (i < 10.5) {
      return buffer_10;
    }
    return buffer_11;
  }
  if (i < 13.5) {
    if (i < 12.5) {
      return buffer_12;
    }
    return buffer_13;
  }
  if (i < 14.5) {
    return buffer_14;
  }
  return buffer_15;
}

float linstep(in vec2 range, in float x) {
  return interpolate(x, range.x, range.y);
  float scale_size = range.y - range.x;
  float from_left = x - range.x;
  return clamp(from_left / scale_size, 0.0, 1.0);
}

float linscale(in vec2 range, in float x) {
  float scale_size = range.y - range.x;
  float from_left = x - range.x;
  return from_left / scale_size;
}

vec2 box_muller(in float ix, in float seed) {
  // Box-Muller transform gives you two gaussian randoms for two uniforms.
  highp float U = ix_to_random(ix, seed);
  highp float V = ix_to_random(ix, seed + 17.123123);
  return vec2(sqrt(-2. * log(U)) * cos(tau * V),
              sqrt(-2. * log(U)) * sin(tau * V));
}

/*************** END COLOR SCALES *******************************/

float domainify(in vec2 domain, in float transform, in float attr, in bool clamped) {

  // Clamp an attribute into a domain, with an optional log or sqrt transform.
  if (transform == 2.) {
    domain = sqrt(domain);
    attr = sqrt(attr);
  }
  if (transform == 3.) {
    domain = log(domain);
    attr = log(attr);
  }
  if (clamped) {
    return linstep(domain, attr);
  } else {
    return linscale(domain, attr);
  }
}

mat3 pixelspace_to_glspace;

float run_numeric_filter (in float a_filter,
  in float u_filter_op, in float u_filter_param_1,
  in float u_filter_param_2) {
  bool truthy;
  if (u_filter_op < 1.5) {
    truthy = a_filter < u_filter_param_1;
  } else if (u_filter_op < 2.5) {
    truthy = a_filter > u_filter_param_1;
  } else if (u_filter_op < 3.5) {
    truthy = a_filter == u_filter_param_1;
  } else if (u_filter_op < 4.5) {
    truthy = abs(a_filter - u_filter_param_2) < u_filter_param_1;
  }
  if (truthy) {return 1.;} else {return 0.;}
}

float choose_and_run_filter(
  in vec3 u_filter_numeric,
  in float a_filter,
  in float map_location,
  in bool filter_is_constant
  ) {
    if (filter_is_constant) {
      return 1.;
    }
    if (u_filter_numeric.r < 0.5) {
      // Must be on a dictionary. Unreasonable assumption, maybe?
      float frac_filter = linstep(vec2(-2047., 2047), a_filter);
      float map_coords = (map_location + .5) / 32.;
      return texture2D(u_one_d_aesthetic_map, vec2(map_coords, frac_filter)).a;
    } else {
      return run_numeric_filter(a_filter,
        u_filter_numeric.r, u_filter_numeric.g, u_filter_numeric.b);
    }
}

const float tau_0 = 2. * 3.14159265359;

highp float ix_to_random_1540259130(in float ix, in float seed) {
  // For high numbers, taking the log avoids coincidence.
  highp float seed2 = log(ix) + 1.;
  vec2 co = vec2(seed2, seed);
  highp float a = 12.9898;
  highp float b = 78.233;
  highp float c = 43758.5453;
  highp float dt= dot(co.xy ,vec2(a,b));
  highp float sn= mod(dt,3.14);
  return fract(sin(sn) * c);
}

highp vec2 box_muller_1540259130(in float ix, in float seed) {
  // Box-Muller transform gives you two gaussian randoms for two uniforms.
  highp float U = ix_to_random_1540259130(ix, seed);
  highp float V = ix_to_random_1540259130(ix, seed + 17.123123);
  return vec2(
    sqrt(-2.*log(U))*cos(tau_0*V),
    sqrt(-2.*log(U))*sin(tau_0*V)
  );
}

vec2 logarithmic_spiral_jitter_1540259130(
  in float ix, // a random seed.
  in float a, // offset
  in float angle_parameter_1540259130, // angle parameter
  in float randomize_angle_1540259130, // sd radians
  in float max_r_1540259130, // Maximum radius of spiral.
  in float randomize_rotation_max_radians_1540259130, // in standard deviations to the log-multiplier.
  in float randomize_radius_1540259130, // in standard deviation percentage points.
  in float hole, // donut hole size.
  in float speed_0, // webgl units per second.
  in float time_0,// The time, in seconds, to plot at. Generally passed as a uniform or something.
  in float acceleration,
  in float n_spirals_1540259130,
  in float shear,
  in float aspect_ratio_1540259130
  ) {
  // Each point starts at a different place on the spiral.
  vec2 two_gaussians_1540259130 = box_muller_1540259130(ix, 55.1);

  highp float calculated_angle = angle_parameter_1540259130 + two_gaussians_1540259130.x * randomize_angle_1540259130;
  float k = 1. / tan(calculated_angle);
  if (k > 100000.) {
    k = 0.;
  }

  // The length of the segment to be traversed.
  float arc_length =  sqrt((1. + k*k)/k) * (max_r_1540259130 - a);
  float period = arc_length / speed_0;

  // Every point needs to start at a different place along the curve.
  float stagger_time = ix_to_random_1540259130(ix, 3.);

  // How long does a circuit take? Add some random noise.
  float time_period = period * exp(box_muller_1540259130(ix, 0.031).x / 6.);

  // Adjust u_time from the clock to our current spot.
  float varying_time = time_0 + stagger_time * time_period;

  // Adjust that time by raising to a power to set the speed along the curve.
  // Not sure if this is the soundest way to parametrize.
  float relative_time = pow(1. - mod(varying_time, time_period)/time_period, acceleration);

  // Calculate the radius at this time point.
  float radius = max_r_1540259130 * relative_time + a;

  // The angle implied by that radius.
  float theta  = 1./k * log(radius / a);

  /* A different way to calculate radius from the theta. Not used
  float max_theta = 1. / k * log(max_r / a);
  float theta2 = max_theta * relative_time;
  vec2 pos_theta_style = vec2(a * exp(k * theta2), theta2);
  radius = pos_theta_style.x;
  theta = pos_theta_style.y;
  */

  // If multiple spirals, the theta needs to be rotated for which spiral we're in.
  // Choose it based on a new random seed.
  float which_spiral = floor(ix_to_random_1540259130(ix, 13.13) * n_spirals_1540259130);
  float which_spiral_adjust = which_spiral / n_spirals_1540259130 * tau_0;
  theta = theta + which_spiral_adjust;

  // Add some gaussian jitter to the polar coordinates.
  vec2 polar_jitter = box_muller_1540259130(ix, 24.);

  highp float radius_adjust = 1. + polar_jitter.x * randomize_radius_1540259130;
  highp float theta_adjust = polar_jitter.y * randomize_rotation_max_radians_1540259130;

  vec2 shear_adjust = box_muller_1540259130(ix, 59.1) * shear;

  mat3 shear_mat = mat3(
    1., shear_adjust.x, 0.,
    shear_adjust.y, 1., 0.,
    0., 0., 1.);
  // into euclidean space.
  vec3 pos_spiral = vec3(
   cos(theta + theta_adjust)*(radius * radius_adjust + hole),
   sin(theta + theta_adjust)*(radius * radius_adjust + hole),
   0.
  );
  mat3 adjust_to_viewport =
         mat3(
            1./aspect_ratio_1540259130, 0., 0.,
            0., 1., 0.,
            0., 0., 1.);

  pos_spiral = pos_spiral * shear_mat * 
               adjust_to_viewport;
  return pos_spiral.xy;
}

#define FLOAT_MAX  1.70141184e38
#define FLOAT_MIN  1.17549435e-38

lowp vec4 encode_float_1604150559(highp float v) {
  highp float av = abs(v);

  //Handle special cases
  if(av < FLOAT_MIN) {
    return vec4(0.0, 0.0, 0.0, 0.0);
  } else if(v > FLOAT_MAX) {
    return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;
  } else if(v < -FLOAT_MAX) {
    return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;
  }

  highp vec4 c = vec4(0,0,0,0);

  //Compute exponent and mantissa
  highp float e = floor(log2(av));
  highp float m = av * pow(2.0, -e) - 1.0;
  
  //Unpack mantissa
  c[1] = floor(128.0 * m);
  m -= c[1] / 128.0;
  c[2] = floor(32768.0 * m);
  m -= c[2] / 32768.0;
  c[3] = floor(8388608.0 * m);
  
  //Unpack exponent
  highp float ebias = e + 127.0;
  c[0] = floor(ebias / 2.0);
  ebias -= c[0] * 2.0;
  c[1] += floor(ebias) * 128.0; 

  //Unpack sign bit
  c[0] += 128.0 * step(0.0, -v);

  //Scale back to range
  return c / 255.0;
}

#ifndef PI
#define PI 3.141592653589793
#endif

float sineInOut_0(float t) {
  return -0.5 * (cos(PI * t) - 1.0);
}

#ifndef PI
#define PI 3.141592653589793
#endif

vec2 bezier_interpolate(vec2 p1, vec2 p2, float frac, float ix) {
  // Interpolates between two points on a Bezier curve around a jittered middle.
  // Makes animations look cooler.
    vec2 midpoint = box_muller(ix, 3.) * .05 *
         dot(p2 - p1, p2 - p1)
         + p2 / 2. + p1 / 2.;

      return mix(
        mix(p2, midpoint, frac),
        mix(midpoint, p1, frac),
      frac);
}

float sineInOut(float t) {
  return -0.5 * (cos(PI * t) - 1.0);
}

const vec4 decoder = vec4(1./256./256./256., 1. / 256. / 256., 1. / 256., 1.);

float RGBAtoFloat(in vec4 floater) {
  // Scale values up by 256.
  return dot(floater, decoder);
}

float texture_float_lookup(in vec2 domain,
                           in vec2 range,
                           in float transform,
                           in float attr,
                           in float texture_position) {
  if (transform == 4.0) {
    // Literal transforms aren't looked up, just returned as is.
    return attr;
  }
  float inrange = domainify(domain, transform, attr, true);
  if (texture_position > 0.5) {
    float y_pos = texture_position / 32. - 0.5 / 32.;
    vec4 encoded = texture2D(u_one_d_aesthetic_map, vec2(y_pos, inrange));
    return encoded.a;
    return RGBAtoFloat(encoded); // unreachable.
  } else {
    return mix(range.x, range.y, inrange);
  }
}

vec2 calculate_position(in vec2 position, in float x_scale_type,
                        in vec2 x_domain, in vec2 x_range, in float y_scale_type,
                        in vec2 y_domain, in vec2 y_range, in mat3 window_scale,
                        in mat3 zoom, in float x_map_position,
                        in float y_map_position
                        ) {
    float x;
    float y;

    if (x_scale_type < 4.0) {
      float x_ = linscale(u_color_domain, a_color);
      x = texture_float_lookup(x_domain, x_range,
        x_scale_type,
        position.x, 0. // ymap position 0 means never use a texture lookup.
        );
    } else {
      x = position.x;
    }

    if (y_scale_type < 4.0) {
      y = texture_float_lookup(y_domain, y_range, y_scale_type,
        position.y, 0. // ymap position 0 means never use a texture lookup.
        );
    } else {
      y = position.y;
    }
    vec3 pos2d = vec3(x, y, 1.0) * window_scale * zoom * pixelspace_to_glspace;
    return pos2d.xy;
}

float cubicInOut(float t) {
  return t < 0.5
    ? 4.0 * t * t * t
    : 1. - 4.0 * pow(1. - t, 3.0);
}

vec4 ixToRGBA(in float ix)  {
  float min = fract(ix / 256.);
  float mid = fract((ix - min) / 256.);
  float high = fract((ix - min - mid * 256.) / (256.) / 256.);
  return vec4(min, mid, high, 1.);
}

vec2 circle_jitter(in float ix, in float aspect_ratio, in float time,
                   in float radius, in float speed) {
  vec2 two_gaussians = box_muller(ix, 12.);

  float stagger_time = two_gaussians.y * tau;

  // How long does a circuit take?

  float units_per_period = radius * tau;
  float units_per_second = speed;
  float seconds_per_period = units_per_period / units_per_second;
  float time_period = seconds_per_period;
  if (time_period > 1e4) {
    return vec2(0., 0.);
  }

  // Adjust time from the clock to our current spot.
  float varying_time = time + stagger_time * time_period;
  // Where are we from 0 to 1 relative to the time period

  float relative_time = 1. - mod(varying_time, time_period) / time_period;

  float theta = relative_time * tau;
  // Problem--should it lie on a disk, or on a circle?
  float r_mult = 1.;//(sqrt(ix_to_random(ix, 7.)));

  return vec2(cos(theta) * r_mult, aspect_ratio * sin(theta) * r_mult) *
         radius;
}

vec2 calculate_jitter(
  in float jitter_type,
  in float ix, // distinguishing index
  in vec2 jitter_radius_domain,
  in vec2 jitter_radius_range,
  in float jitter_radius_transform,
  in float jitter_radius,
  in float jitter_radius_map_position,
  in bool jitter_radius_is_constant,
  in vec2 jitter_speed_domain,
  in vec2 jitter_speed_range,
  in float jitter_speed_transform,
  in float jitter_speed,
  in float jitter_speed_map_position,
  in bool jitter_speed_is_constant
) {

  // Jitter is calculated based on speed, so requires two full maps in.
  if (jitter_type == 0.) {
    // No jitter
    return vec2(0., 0.);
  }

  if (jitter_type == 5.) {
    // Temporal jitter--should be broken out into a separate channel/channels.
    float time_period = 60.;
    float share = 1./4.;
    float offset = ix_to_random(ix, 12.);
    float fractional = fract((offset * time_period + u_time)/time_period);
    if (fractional > share) {
      return vec2(0., 0.);
    }
    float size = 0.5 * (1. - cos(2. * 3.1415926 * min(fractional/share, 1. - fractional/share)));
    size = clamp(size, 0., 1.);
    return vec2(size, 0.);
  }
  float jitter_r;  
  if (jitter_radius_is_constant) {
    jitter_r = jitter_radius;
  } else {
    jitter_r = texture_float_lookup(
    jitter_radius_domain,
    jitter_radius_range,
    jitter_radius_transform,
    jitter_radius,
    0.);
  }
  if (jitter_type == 3.) {
    float r = box_muller(ix, 1.).r * jitter_r;
    r = r * point_size_adjust;
    float theta = ix_to_random(ix, 15.) * tau;
    return vec2(cos(theta) * r, sin(theta) * r * u_width / u_height);
  }

  if (jitter_type == 2.) {
    // uniform in the circle.
    float theta = ix_to_random(ix, 15.) * tau;
    float r = jitter_r * sqrt(ix_to_random(ix, 115.));
    r = r * point_size_adjust;
    return vec2(cos(theta) * r, sin(theta) * r * u_width / u_height);
  }

  /* Jittering that includes motion) */

  float p_jitter_speed =
      texture_float_lookup(jitter_speed_domain,
                          jitter_speed_range,
                          jitter_speed_transform, jitter_speed,
                          jitter_speed_map_position);

  if (jitter_type == 1.) {
    return logarithmic_spiral_jitter_1540259130(
                ix,
                0.005 * jitter_r,                     // a
                1.3302036,                       // angle parameter
                0.005,                                 // angle random
                jitter_r,                             // max radius
                0.03,                                 // random_rotation
                0.06,                                 // random radius
                0.003 * point_size_adjust * jitter_r, // donut.
                .5 * p_jitter_speed * jitter_r / point_size_adjust, // speed
                u_time,                                           // time
                0.8,                                              // acceleration
                2.0,                                              // n_spirals
                .09, //shear
                u_width/u_height         // shear
            );
  }

  if (jitter_type == 4.) {
    // circle
    return circle_jitter(ix, u_width/u_height, u_time, jitter_r, p_jitter_speed);
  }
}

void run_color_fill(in float ease) {
  float alpha = min(u_alpha, 1.0);
  if (u_only_color >= -1.5) {
    if (u_only_color > -.5 && a_color != u_only_color) {
      gl_Position = discard_me;
      return;
    } else {
      // -1 is a special value meaning 'plot everything'.
      fill = vec4(0., 0., 0., 1. / 255.);
      gl_PointSize = 1.;
    }
  } else {
    if (a_color_is_constant) {
      fill = vec4(u_color_constant.rgb, alpha);
    } else {
      float fractional_color = linstep(u_color_domain, a_color);
      float color_pos = (u_color_map_position * -1. - 1.) / 32. + 0.5 / 32.;
      fractional_color = domainify(u_color_domain, u_color_transform, a_color, true);
      fill = texture2D(u_color_aesthetic_map , vec2(color_pos, fractional_color));
      fill = vec4(fill.rgb, alpha);
    }
    if (ease < 1.) {
      vec4 last_fill;
      if (a_last_color_is_constant) {
        last_fill = vec4(u_last_color_constant.rgb, alpha);
      } else {
        float last_fractional = linstep(u_last_color_domain, a_last_color);
        float color_pos = (u_last_color_map_position * -1. - 1.) / 32. + 0.5 / 32.;
        last_fractional = domainify(u_last_color_domain, u_last_color_transform, a_last_color, true);
        last_fill = texture2D(u_color_aesthetic_map, vec2(color_pos, last_fractional));
        // Alpha channel interpolation already happened.
        last_fill = vec4(last_fill.rgb, alpha);
      }
      // RGB blending is bad--maybe use https://www.shadertoy.com/view/lsdGzN
      // instead?
      fill = mix(last_fill, fill, ease);
    }
  }
}

vec2 calc_and_interpolate_positions(
  inout vec2 old_position,
  in float u_last_x_transform,
  in vec2 u_last_x_domain,
  in vec2 u_last_x_range,
  in float u_last_y_transform,
  in vec2 u_last_y_domain,
  in vec2 u_last_y_range,
  in mat3 u_last_window_scale,
  in mat3 u_zoom,
  in float u_last_x_map_position,
  in float u_last_y_map_position,
  inout vec2 position,
  in float u_x_transform,
  in vec2 u_x_domain,
  in vec2 u_x_range,
  in float u_y_transform,
  in vec2 u_y_domain,
  in vec2 u_y_range,
  in mat3 u_window_scale,
  in float u_x_map_position,
  in float u_y_map_position,
  in float interpolation,
  in float u_grid_mode, 
  in float ix) {

  old_position = calculate_position(old_position, u_last_x_transform,
    u_last_x_domain, u_last_x_range,
    u_last_y_transform, u_last_y_domain, u_last_y_range,
    u_last_window_scale,
    u_zoom, u_last_x_map_position,      
    u_last_y_map_position);
    
  bool plot_actual_position = u_grid_mode < .5;

  if (plot_actual_position) {
    position = calculate_position(position, 
      u_x_transform,
      u_x_domain, u_x_range,
      u_y_transform, u_y_domain, 
      u_y_range, u_window_scale, u_zoom, 
      u_x_map_position, u_y_map_position);
    float xpos = clamp((1. + position.x) / 2., 0., 1.);
    float randy = ix_to_random(ix, 13.76);
    float delay = xpos + randy * .1;
    delay = delay * 3.;

    float frac = interpolate(
      u_update_time,
      delay,
      u_transition_duration + delay
    );

    frac = sineInOut_0(frac);

    if (frac <= 0.) {
      position = old_position;
    } else if (frac < 1.) {
      frac = fract(frac);
      position = bezier_interpolate(position, old_position, frac, ix);
    }
  } else {
    position.x = -1. + 2. * linscale(u_x_domain, position.x);
    //position.y = -1.0;
    vec2 jitterspec = vec2(
      (ix_to_random(ix, 3.) * a_jitter_radius ) * 2.,
      (ix_to_random(ix, 1.5) * a_jitter_speed ) * 2.
    );
    position = position + jitterspec;
  }
  return position;
}

void main() {
  float debug_mode = 0.;
  float ix = buffer_0;
  float ix_in_tile = buffer_1;
  if (ix > u_maxix) {
    // throw away points that are too low.
    gl_Position = discard_me;
    return;
  }

  if (debug_mode > 1.5) {
    // Debug mode.
    gl_PointSize = 2.;
    gl_Position = vec4(box_muller(ix, 2.).xy * .33, 0., 1.);
    return;
  }

 // Autogenerated below this point

    if (u_x_buffer_num > -0.5) {
      a_x = get_buffer(u_x_buffer_num);
      a_x_is_constant = false;
    } else {
      a_x = u_x_constant;
      a_x_is_constant = true;
    }

    if (u_last_x_buffer_num > -0.5) {
      a_last_x = get_buffer(u_last_x_buffer_num);
      a_last_x_is_constant = false;
    } else {
      a_last_x = u_last_x_constant;
      a_last_x_is_constant = true;
    }

    if (u_y_buffer_num > -0.5) {
      a_y = get_buffer(u_y_buffer_num);
      a_y_is_constant = false;
    } else {
      a_y = u_y_constant;
      a_y_is_constant = true;
    }

    if (u_last_y_buffer_num > -0.5) {
      a_last_y = get_buffer(u_last_y_buffer_num);
      a_last_y_is_constant = false;
    } else {
      a_last_y = u_last_y_constant;
      a_last_y_is_constant = true;
    }

    if (u_jitter_radius_buffer_num > -0.5) {
      a_jitter_radius = get_buffer(u_jitter_radius_buffer_num);
      a_jitter_radius_is_constant = false;
    } else {
      a_jitter_radius = u_jitter_radius_constant;
      a_jitter_radius_is_constant = true;
    }

    if (u_last_jitter_radius_buffer_num > -0.5) {
      a_last_jitter_radius = get_buffer(u_last_jitter_radius_buffer_num);
      a_last_jitter_radius_is_constant = false;
    } else {
      a_last_jitter_radius = u_last_jitter_radius_constant;
      a_last_jitter_radius_is_constant = true;
    }

    if (u_jitter_speed_buffer_num > -0.5) {
      a_jitter_speed = get_buffer(u_jitter_speed_buffer_num);
      a_jitter_speed_is_constant = false;
    } else {
      a_jitter_speed = u_jitter_speed_constant;
      a_jitter_speed_is_constant = true;
    }

    if (u_last_jitter_speed_buffer_num > -0.5) {
      a_last_jitter_speed = get_buffer(u_last_jitter_speed_buffer_num);
      a_last_jitter_speed_is_constant = false;
    } else {
      a_last_jitter_speed = u_last_jitter_speed_constant;
      a_last_jitter_speed_is_constant = true;
    }

    if (u_size_buffer_num > -0.5) {
      a_size = get_buffer(u_size_buffer_num);
      a_size_is_constant = false;
    } else {
      a_size = u_size_constant;
      a_size_is_constant = true;
    }

    if (u_last_size_buffer_num > -0.5) {
      a_last_size = get_buffer(u_last_size_buffer_num);
      a_last_size_is_constant = false;
    } else {
      a_last_size = u_last_size_constant;
      a_last_size_is_constant = true;
    }

    if (u_filter_buffer_num > -0.5) {
      a_filter = get_buffer(u_filter_buffer_num);
      a_filter_is_constant = false;
    } else {
      a_filter = u_filter_constant;
      a_filter_is_constant = true;
    }

    if (u_last_filter_buffer_num > -0.5) {
      a_last_filter = get_buffer(u_last_filter_buffer_num);
      a_last_filter_is_constant = false;
    } else {
      a_last_filter = u_last_filter_constant;
      a_last_filter_is_constant = true;
    }

    if (u_filter2_buffer_num > -0.5) {
      a_filter2 = get_buffer(u_filter2_buffer_num);
      a_filter2_is_constant = false;
    } else {
      a_filter2 = u_filter2_constant;
      a_filter2_is_constant = true;
    }

    if (u_last_filter2_buffer_num > -0.5) {
      a_last_filter2 = get_buffer(u_last_filter2_buffer_num);
      a_last_filter2_is_constant = false;
    } else {
      a_last_filter2 = u_last_filter2_constant;
      a_last_filter2_is_constant = true;
    }

    if (u_x0_buffer_num > -0.5) {
      a_x0 = get_buffer(u_x0_buffer_num);
      a_x0_is_constant = false;
    } else {
      a_x0 = u_x0_constant;
      a_x0_is_constant = true;
    }

    if (u_last_x0_buffer_num > -0.5) {
      a_last_x0 = get_buffer(u_last_x0_buffer_num);
      a_last_x0_is_constant = false;
    } else {
      a_last_x0 = u_last_x0_constant;
      a_last_x0_is_constant = true;
    }

    if (u_y0_buffer_num > -0.5) {
      a_y0 = get_buffer(u_y0_buffer_num);
      a_y0_is_constant = false;
    } else {
      a_y0 = u_y0_constant;
      a_y0_is_constant = true;
    }

    if (u_last_y0_buffer_num > -0.5) {
      a_last_y0 = get_buffer(u_last_y0_buffer_num);
      a_last_y0_is_constant = false;
    } else {
      a_last_y0 = u_last_y0_constant;
      a_last_y0_is_constant = true;
    }

    if (u_foreground_buffer_num > -0.5) {
      a_foreground = get_buffer(u_foreground_buffer_num);
      a_foreground_is_constant = false;
    } else {
      a_foreground = u_foreground_constant;
      a_foreground_is_constant = true;
    }

    if (u_last_foreground_buffer_num > -0.5) {
      a_last_foreground = get_buffer(u_last_foreground_buffer_num);
      a_last_foreground_is_constant = false;
    } else {
      a_last_foreground = u_last_foreground_constant;
      a_last_foreground_is_constant = true;
    }

//  END AUTOGENERATED. DO NOT EDIT ABOVE. 
// ------------------------------------------------    
  gl_PointSize = 1.;

  if (u_color_buffer_num > -0.5) {
    a_color = get_buffer(u_color_buffer_num);
    a_color_is_constant = false;
  } else {
    a_color = ix;
    a_color_is_constant = true;
  }

  if (u_last_color_buffer_num > -0.5) {
    a_last_color = get_buffer(u_last_color_buffer_num);
    a_last_color_is_constant = false;
  } else {
    a_last_color = ix;
    a_last_color_is_constant = true;
  }

  pixelspace_to_glspace = mat3(
      2. / u_width, 0., -1.,
      0., - 2. / u_height, 1.,
      0., 0., 1.
  );

  float interpolation =
    interpolate(u_update_time, 0., u_transition_duration);
    
  float ease = interpolation;

  // I set this sometimes.

  vec2 position = vec2(a_x, a_y);
  vec2 old_position = vec2(a_last_x, a_last_y);

  position = calc_and_interpolate_positions(
    old_position,
    u_last_x_transform,
    u_last_x_domain, u_last_x_range,
    u_last_y_transform,
    u_last_y_domain, u_last_y_range,
    u_last_window_scale,
    u_zoom,
    u_last_x_map_position,
    u_last_y_map_position,
    position,
    u_x_transform,
    u_x_domain, u_x_range,
    u_y_transform,
    u_y_domain, u_y_range,
    u_window_scale,
    u_x_map_position,
    u_y_map_position,
    interpolation,
    u_grid_mode,
    ix
  );

  if (u_x0_buffer_num > 0.) {
    vec2 position0 = vec2(a_x0, a_y0);
    vec2 old_position0 = vec2(a_last_x0, a_last_y0);

    position0 = calc_and_interpolate_positions(
      old_position0,
      u_last_x0_transform,
      u_last_x0_domain, u_last_x0_range,
      u_last_y0_transform,
      u_last_y0_domain, u_last_y0_range,
      u_last_window_scale,
      u_zoom,
      u_last_x0_map_position,
      u_last_y0_map_position,
      position0,
      u_x0_transform,
      u_x0_domain, u_x0_range,
      u_y0_transform,
      u_y0_domain, u_y0_range,
      u_window_scale,
      u_x0_map_position,
      u_y0_map_position,
      interpolation,
      u_grid_mode,
      ix
    );

    if (u_position_interpolation_mode > 0.) {
      float rand2 = ix_to_random(ix, 11.76);

      // If it's a continuous loop, just choose a random point along that loop.
      float rand_offset = fract(u_update_time/u_transition_duration / 10. + rand2);
      position = mix(position0, position, rand_offset);
    }
  }

  bool plot_actual_position = u_grid_mode < .5;

  if (u_position_interpolation_mode > 0.) {
    float rand2 = ix_to_random(ix, 11.76);

    // If it's a continuous loop, just choose a random point along that loop.
    float rand_offset = fract(u_update_time/u_transition_duration + rand2);
    
  }

/*  position = vec2(
    ix_to_random(ix, .1),
    ix_to_random(ix, .2)
  );*/
  /* FILTERING */

  float filter_status = choose_and_run_filter(
    u_filter_numeric,
    a_filter,
    u_filter_map_position,
    a_filter_is_constant
  );

  float last_filter_status = choose_and_run_filter(
    u_last_filter_numeric,
    a_last_filter,
    u_last_filter_map_position,
    a_last_filter_is_constant
  );

  float filter2_status = choose_and_run_filter(
    u_filter2_numeric,
    a_filter2,
    u_filter2_map_position,
    a_filter2_is_constant
  );

  float last_filter2_status = choose_and_run_filter(
    u_last_filter2_numeric,
    a_last_filter2,
    u_last_filter2_map_position,
    a_last_filter2_is_constant
  );

  float foreground_status = choose_and_run_filter(
    u_foreground_numeric,
    a_foreground,
    u_foreground_map_position,
    a_foreground_is_constant
  );

  float last_foreground_status = choose_and_run_filter(
    u_last_foreground_numeric,
    a_last_foreground,
    u_last_foreground_map_position,
    a_last_foreground_is_constant
  );
  float fg_ease = mix(last_foreground_status, foreground_status, ease);
  if (ease < ix_to_random(ix, 1.)) {
    foreground_status = last_foreground_status;
  }

  /*if (a_foreground_is_constant) {
    foreground_status = 1.;
  }*/

  bool was_filtered = last_filter2_status < .5 || last_filter_status < .5;
  bool will_be_filtered = filter2_status < .5 || filter_status < .5;

  bool overall_filter_status = will_be_filtered;

  if (ease < ix_to_random(ix, 1.)) {
    overall_filter_status = was_filtered;
  }

  if (overall_filter_status == true) {
    gl_Position = discard_me;
    return;
  }

  float size_multiplier = texture_float_lookup(
    u_size_domain,
    u_size_range,
    u_size_transform, a_size,
    u_size_map_position);

  float last_size_multiplier = texture_float_lookup(
    u_last_size_domain, u_last_size_range, u_last_size_transform, a_last_size,
    u_last_size_map_position);

  size_multiplier = u_base_size * 
     mix(last_size_multiplier, size_multiplier, ease);
  
  float depth_size_adjust = (1.0 - ix / (u_maxix));

  // It's ugly on new macs when it jumps straight from one to two for a bunch of points at once.
  float size_fuzz = exp(ix_to_random(ix, 3.1) * .5 - .25);

  point_size_adjust = exp(log(u_k) * u_zoom_balance) * size_fuzz;// * depth_size_adjust;
//  point_size_adjust = exp(log(u_k) * u_zoom_balance);
  gl_PointSize = point_size_adjust * size_multiplier;
  if (gl_PointSize <= 0.01) {
    gl_Position = discard_me;
    return;
  }
  vec2 jitter = vec2(0., 0.);
//  

  if (plot_actual_position && (u_jitter > 0. || u_last_jitter > 0.)) {
    /* JITTER */
    jitter = vec2(ix_to_random(ix, 2. + u_time), ix_to_random(ix, 3. + u_time)) * .01;
    float jitter_radius_fraction;
      jitter = calculate_jitter(
        u_jitter, ix,
        u_jitter_radius_domain,        u_jitter_radius_range,
        u_jitter_radius_transform,        a_jitter_radius,
        u_jitter_radius_map_position,        a_jitter_radius_is_constant,
        u_jitter_speed_domain,
        u_jitter_speed_range,
        u_jitter_speed_transform, a_jitter_speed,
        u_jitter_speed_map_position, a_jitter_speed_is_constant
      );
    vec2 last_jitter;
    if (ease < 1.) {
      last_jitter = calculate_jitter(
        u_last_jitter, ix,
        u_last_jitter_radius_domain,       
        u_last_jitter_radius_range,
        u_last_jitter_radius_transform,        
        a_last_jitter_radius,
        u_last_jitter_radius_map_position,
        a_last_jitter_radius_is_constant,
        u_last_jitter_speed_domain,
        u_last_jitter_speed_range,
        u_last_jitter_speed_transform,
        a_last_jitter_speed,
        u_last_jitter_speed_map_position,
        a_last_jitter_speed_is_constant
      );
      jitter = mix(last_jitter, jitter, ease);
    }
    if (u_jitter == 5.) {
      // temporal jitter: rescale the point from the first dimension
      gl_PointSize *= jitter.x;
      jitter = vec2(0., 0.);
      if (gl_PointSize < 0.05) {
        gl_Position = discard_me;
        return;
      }
    }
    gl_Position = vec4(position + jitter, 0., 1.);
  } else {
    gl_Position = vec4(position + jitter, 0., 1.);
  }  
  if (u_color_picker_mode == 1.) {
    // Add one so the first element is distinguishable.
    fill = encode_float_1604150559(ix + 1.);
  } else if (u_color_picker_mode == 2.) {
    fill = encode_float_1604150559(u_tile_id + 1.);
  } else if (u_color_picker_mode == 3.) {
    fill = encode_float_1604150559(ix_in_tile + 1.);
  } else {
    run_color_fill(ease);
  }

  // Are we in a mode where we need to plot foreground and background?
  if (u_foreground_number > -1.) {
    // In that case, throw away points from the other half of the set.
    if (u_foreground_number != foreground_status) {
      gl_Position = discard_me;
      return;
    }
    if (u_foreground_number == 1.) {
      gl_PointSize *= u_foreground_size;
      fill = vec4(fill.rgb, min(1., fill.a * u_foreground_alpha));
    }
    // If we're in background mode, got to change the points a bit.
    if (u_foreground_number == 0.) { 
      gl_PointSize *= u_background_size;
      // Should the color piker run?
      if (u_color_picker_mode >= 1.) {
        if (u_background_mouseover == 1.) {
          // pass--keep the colors as are.
        } else {
          gl_Position = discard_me;
          return;
        }
      } else {
       float alpha = min(u_alpha * u_background_rgba.a, 1.);
        if (alpha < 1./255.) {
          // Very light alphas must be quantized. Only show an appropriate sample.
          float seed = ix_to_random(ix, 38.6);
          if (alpha * 255. < seed) {
            gl_Position = discard_me;
            return;
          } else {
            alpha = 1. / 255.;
          }
        }
        fill = vec4(u_background_rgba.rgb, alpha);
      }
    }
  }
    
  point_size = gl_PointSize;

/*  if (u_use_glyphset > 0. && point_size > 5.0) {
    float random_letter = floor(64. * ix_to_random(ix, 1.3));
    letter_pos = vec2(
      // start at a number between 0 and 7.
      mod(random_letter, 8.) / 8.,
      floor(random_letter / 8.) / 8.
    );
    gl_PointSize *= 3.0;
  }*/
}
`,CE=`#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
#endif

precision mediump float;
#define GLSLIFY 1

varying vec4 fill;
varying vec2 letter_pos;
varying float point_size;

uniform float u_only_color;
uniform float u_color_picker_mode;
//uniform float u_use_glyphset;
//uniform sampler2D u_glyphset;

float delta = 0.0, alpha = 1.0;

bool out_of_circle(in vec2 coord) {
  vec2 cxy = 2.0 * coord - 1.0;
  float r_sq = dot(cxy, cxy);
  if (r_sq > 1.03) {return true;}
  return false;
}

bool out_of_hollow_circle(in vec2 coord) {
  vec2 cxy = 2.0 * coord - 1.0;
  float r_sq = dot(cxy, cxy);
  if (r_sq > 1.01) {return true;}
  float distance_from_edge = (1.0 - r_sq) * point_size;
  if (distance_from_edge > 4.0) {return true;}
  return false;
}

bool out_of_triangle(in vec2 coord) {
  if (coord.y > (2. * abs(coord.x - .5))) {
    return false;
  }
  return true;
}

void main() {
  if (u_only_color >= -1.5) {
    gl_FragColor = vec4(0., 0., 0., 1./255.);
    return;
  }

  float alpha = fill.a;
//  if (u_use_glyphset == 0. || point_size < 5.0) {
    if (out_of_circle(gl_PointCoord)) {
      discard;
      return;
    }
    vec2 cxy = 2.0 * gl_PointCoord - 1.0;
    float r = dot(cxy, cxy);
    #ifdef GL_OES_standard_derivatives
      delta = fwidth(r);
      alpha *= (1.0 - smoothstep(1.0 - delta, 1.0 + delta, r));
    #endif
/*  } else {
    vec2 coords = letter_pos + gl_PointCoord/8.;
//    vec2 coords = vec2(.2, .2);
    vec4 sprite = texture2D(u_glyphset, coords);
    alpha *= (sprite.a);  
//    fill = vec4(1.0, 1.0, 1.0, alpha);  
    if (alpha <= 0.03) discard;
  }*/
  // Pre-blend the alpha channel.
  if (u_color_picker_mode >= 1.) {
    // no alpha when color picking; we use all four channels for that.
    gl_FragColor = fill;
  } else {
    gl_FragColor = vec4(fill.rgb * alpha, alpha);
  }

}
`;function x0(n){return n.op!==void 0}function Sv(n){return n.lambda!==void 0}function zh(n){return n.constant!==void 0}function kE(n){return n!==null&&n.url!==void 0}function PE(n){return n!==null&&n.labels!==void 0}var C_={},zE={get exports(){return C_},set exports(n){C_=n}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(n,t){(function(){var e,r="4.17.21",a=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",c="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",_=500,m="__lodash_placeholder__",A=1,R=2,C=4,G=1,$t=2,Kt=1,Mt=2,ie=4,Xt=8,it=16,Ct=32,fe=64,be=128,sn=256,st=512,Y=30,rt="...",Bt=800,Dt=16,F=1,ft=2,H=3,bt=1/0,Lt=9007199254740991,Jt=17976931348623157e292,ee=0/0,de=4294967295,Te=de-1,ye=de>>>1,Ze=[["ary",be],["bind",Kt],["bindKey",Mt],["curry",Xt],["curryRight",it],["flip",st],["partial",Ct],["partialRight",fe],["rearg",sn]],on="[object Arguments]",An="[object Array]",Nn="[object AsyncFunction]",ln="[object Boolean]",Dn="[object Date]",ir="[object DOMException]",Kn="[object Error]",Yr="[object Function]",Qo="[object GeneratorFunction]",Mr="[object Map]",ba="[object Number]",hu="[object Null]",si="[object Object]",br="[object Promise]",du="[object Proxy]",Cr="[object RegExp]",Ir="[object Set]",Ai="[object String]",v="[object Symbol]",_u="[object Undefined]",ya="[object WeakMap]",Qc="[object WeakSet]",rs="[object ArrayBuffer]",lr="[object DataView]",is="[object Float32Array]",Ei="[object Float64Array]",as="[object Int8Array]",ao="[object Int16Array]",so="[object Int32Array]",oo="[object Uint8Array]",hr="[object Uint8ClampedArray]",kr="[object Uint16Array]",ji="[object Uint32Array]",tl=/\b__p \+= '';/g,pu=/\b(__p \+=) '' \+/g,el=/(__e\(.*?\)|\b__t\)) \+\n'';/g,tf=/&(?:amp|lt|gt|quot|#39);/g,va=/[&<>"']/g,mu=RegExp(tf.source),Ti=RegExp(va.source),nl=/<%-([\s\S]+?)%>/g,rl=/<%([\s\S]+?)%>/g,yr=/<%=([\s\S]+?)%>/g,il=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,al=/^\w*$/,oi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ef=/[\\^$.*+?()[\]{}|]/g,sl=RegExp(ef.source),nf=/^\s+/,ol=/\s/,fl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Vi=/\{\n\/\* \[wrapped with (.+)\] \*/,gu=/,? & /,Fn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ul=/[()=,{}\[\]\/\s]/,cl=/\\(\\)?/g,ll=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Wi=/\w*$/,hl=/^[-+]0x[0-9a-f]+$/i,dl=/^0b[01]+$/i,_l=/^\[object .+?Constructor\]$/,pl=/^0o[0-7]+$/i,ml=/^(?:0|[1-9]\d*)$/,gl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,wa=/($^)/,bl=/['\n\r\u2028\u2029\\]/g,Yi="\\ud800-\\udfff",rf="\\u0300-\\u036f",yl="\\ufe20-\\ufe2f",fo="\\u20d0-\\u20ff",af=rf+yl+fo,bu="\\u2700-\\u27bf",yu="a-z\\xdf-\\xf6\\xf8-\\xff",vl="\\xac\\xb1\\xd7\\xf7",vu="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",wl="\\u2000-\\u206f",xl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",wu="A-Z\\xc0-\\xd6\\xd8-\\xde",xu="\\ufe0e\\ufe0f",Su=vl+vu+wl+xl,sf="[']",uo="["+Yi+"]",of="["+Su+"]",co="["+af+"]",Au="\\d+",Ii="["+bu+"]",xa="["+yu+"]",ff="[^"+Yi+Su+Au+bu+yu+wu+"]",ss="\\ud83c[\\udffb-\\udfff]",Eu="(?:"+co+"|"+ss+")",Tu="[^"+Yi+"]",uf="(?:\\ud83c[\\udde6-\\uddff]){2}",cf="[\\ud800-\\udbff][\\udc00-\\udfff]",Jn="["+wu+"]",vr="\\u200d",os="(?:"+xa+"|"+ff+")",Sl="(?:"+Jn+"|"+ff+")",lo="(?:"+sf+"(?:d|ll|m|re|s|t|ve))?",lf="(?:"+sf+"(?:D|LL|M|RE|S|T|VE))?",hf=Eu+"?",Iu="["+xu+"]?",ho="(?:"+vr+"(?:"+[Tu,uf,cf].join("|")+")"+Iu+hf+")*",fs="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",df="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",_o=Iu+hf+ho,Al="(?:"+[Ii,uf,cf].join("|")+")"+_o,Ou="(?:"+[Tu+co+"?",co,uf,cf,uo].join("|")+")",_f=RegExp(sf,"g"),Bu=RegExp(co,"g"),fi=RegExp(ss+"(?="+ss+")|"+Ou+_o,"g"),us=RegExp([Jn+"?"+xa+"+"+lo+"(?="+[of,Jn,"$"].join("|")+")",Sl+"+"+lf+"(?="+[of,Jn+os,"$"].join("|")+")",Jn+"?"+os+"+"+lo,Jn+"+"+lf,df,fs,Au,Al].join("|"),"g"),Hi=RegExp("["+vr+Yi+af+xu+"]"),Ru=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,El=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],cs=-1,gn={};gn[is]=gn[Ei]=gn[as]=gn[ao]=gn[so]=gn[oo]=gn[hr]=gn[kr]=gn[ji]=!0,gn[on]=gn[An]=gn[rs]=gn[ln]=gn[lr]=gn[Dn]=gn[Kn]=gn[Yr]=gn[Mr]=gn[ba]=gn[si]=gn[Cr]=gn[Ir]=gn[Ai]=gn[ya]=!1;var bn={};bn[on]=bn[An]=bn[rs]=bn[lr]=bn[ln]=bn[Dn]=bn[is]=bn[Ei]=bn[as]=bn[ao]=bn[so]=bn[Mr]=bn[ba]=bn[si]=bn[Cr]=bn[Ir]=bn[Ai]=bn[v]=bn[oo]=bn[hr]=bn[kr]=bn[ji]=!0,bn[Kn]=bn[Yr]=bn[ya]=!1;var pf={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},Tl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},O={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},$={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},at=parseFloat,ae=parseInt,Ke=typeof ca=="object"&&ca&&ca.Object===Object&&ca,_n=typeof self=="object"&&self&&self.Object===Object&&self,Le=Ke||_n||Function("return this")(),We=t&&!t.nodeType&&t,hn=We&&!0&&n&&!n.nodeType&&n,Or=hn&&hn.exports===We,dr=Or&&Ke.process,ar=function(){try{var W=hn&&hn.require&&hn.require("util").types;return W||dr&&dr.binding&&dr.binding("util")}catch{}}(),po=ar&&ar.isArrayBuffer,Pr=ar&&ar.isDate,mf=ar&&ar.isMap,Zh=ar&&ar.isRegExp,mo=ar&&ar.isSet,Kh=ar&&ar.isTypedArray;function sr(W,gt,ut){switch(ut.length){case 0:return W.call(gt);case 1:return W.call(gt,ut[0]);case 2:return W.call(gt,ut[0],ut[1]);case 3:return W.call(gt,ut[0],ut[1],ut[2])}return W.apply(gt,ut)}function Jh(W,gt,ut,se){for(var Ie=-1,fn=W==null?0:W.length;++Ie<fn;){var Qn=W[Ie];gt(se,Qn,ut(Qn),W)}return se}function _r(W,gt){for(var ut=-1,se=W==null?0:W.length;++ut<se&&gt(W[ut],ut,W)!==!1;);return W}function Qh(W,gt){for(var ut=W==null?0:W.length;ut--&&gt(W[ut],ut,W)!==!1;);return W}function Sa(W,gt){for(var ut=-1,se=W==null?0:W.length;++ut<se;)if(!gt(W[ut],ut,W))return!1;return!0}function Oi(W,gt){for(var ut=-1,se=W==null?0:W.length,Ie=0,fn=[];++ut<se;){var Qn=W[ut];gt(Qn,ut,W)&&(fn[Ie++]=Qn)}return fn}function Mu(W,gt){var ut=W==null?0:W.length;return!!ut&&qi(W,gt,0)>-1}function Il(W,gt,ut){for(var se=-1,Ie=W==null?0:W.length;++se<Ie;)if(ut(gt,W[se]))return!0;return!1}function Cn(W,gt){for(var ut=-1,se=W==null?0:W.length,Ie=Array(se);++ut<se;)Ie[ut]=gt(W[ut],ut,W);return Ie}function Xi(W,gt){for(var ut=-1,se=gt.length,Ie=W.length;++ut<se;)W[Ie+ut]=gt[ut];return W}function Ol(W,gt,ut,se){var Ie=-1,fn=W==null?0:W.length;for(se&&fn&&(ut=W[++Ie]);++Ie<fn;)ut=gt(ut,W[Ie],Ie,W);return ut}function Mp(W,gt,ut,se){var Ie=W==null?0:W.length;for(se&&Ie&&(ut=W[--Ie]);Ie--;)ut=gt(ut,W[Ie],Ie,W);return ut}function Lu(W,gt){for(var ut=-1,se=W==null?0:W.length;++ut<se;)if(gt(W[ut],ut,W))return!0;return!1}var In=hs("length");function td(W){return W.split("")}function Lp(W){return W.match(Fn)||[]}function ui(W,gt,ut){var se;return ut(W,function(Ie,fn,Qn){if(gt(Ie,fn,Qn))return se=fn,!1}),se}function go(W,gt,ut,se){for(var Ie=W.length,fn=ut+(se?1:-1);se?fn--:++fn<Ie;)if(gt(W[fn],fn,W))return fn;return-1}function qi(W,gt,ut){return gt===gt?vo(W,gt,ut):go(W,Nu,ut)}function ls(W,gt,ut,se){for(var Ie=ut-1,fn=W.length;++Ie<fn;)if(se(W[Ie],gt))return Ie;return-1}function Nu(W){return W!==W}function gf(W,gt){var ut=W==null?0:W.length;return ut?Du(W,gt)/ut:ee}function hs(W){return function(gt){return gt==null?e:gt[W]}}function bo(W){return function(gt){return W==null?e:W[gt]}}function Bl(W,gt,ut,se,Ie){return Ie(W,function(fn,Qn,pn){ut=se?(se=!1,fn):gt(ut,fn,Qn,pn)}),ut}function Rl(W,gt){var ut=W.length;for(W.sort(gt);ut--;)W[ut]=W[ut].value;return W}function Du(W,gt){for(var ut,se=-1,Ie=W.length;++se<Ie;){var fn=gt(W[se]);fn!==e&&(ut=ut===e?fn:ut+fn)}return ut}function Ml(W,gt){for(var ut=-1,se=Array(W);++ut<W;)se[ut]=gt(ut);return se}function Np(W,gt){return Cn(gt,function(ut){return[ut,W[ut]]})}function ed(W){return W&&W.slice(0,ad(W)+1).replace(nf,"")}function zr(W){return function(gt){return W(gt)}}function bf(W,gt){return Cn(gt,function(ut){return W[ut]})}function Aa(W,gt){return W.has(gt)}function Fu(W,gt){for(var ut=-1,se=W.length;++ut<se&&qi(gt,W[ut],0)>-1;);return ut}function Cu(W,gt){for(var ut=W.length;ut--&&qi(gt,W[ut],0)>-1;);return ut}function yo(W,gt){for(var ut=W.length,se=0;ut--;)W[ut]===gt&&++se;return se}var Ll=bo(pf),Nl=bo(Tl);function Dl(W){return"\\"+$[W]}function Fl(W,gt){return W==null?e:W[gt]}function ds(W){return Hi.test(W)}function nd(W){return Ru.test(W)}function rd(W){for(var gt,ut=[];!(gt=W.next()).done;)ut.push(gt.value);return ut}function ku(W){var gt=-1,ut=Array(W.size);return W.forEach(function(se,Ie){ut[++gt]=[Ie,se]}),ut}function Cl(W,gt){return function(ut){return W(gt(ut))}}function Zi(W,gt){for(var ut=-1,se=W.length,Ie=0,fn=[];++ut<se;){var Qn=W[ut];(Qn===gt||Qn===m)&&(W[ut]=m,fn[Ie++]=ut)}return fn}function yf(W){var gt=-1,ut=Array(W.size);return W.forEach(function(se){ut[++gt]=se}),ut}function id(W){var gt=-1,ut=Array(W.size);return W.forEach(function(se){ut[++gt]=[se,se]}),ut}function vo(W,gt,ut){for(var se=ut-1,Ie=W.length;++se<Ie;)if(W[se]===gt)return se;return-1}function kl(W,gt,ut){for(var se=ut+1;se--;)if(W[se]===gt)return se;return se}function Ea(W){return ds(W)?Fp(W):In(W)}function Br(W){return ds(W)?Pl(W):td(W)}function ad(W){for(var gt=W.length;gt--&&ol.test(W.charAt(gt)););return gt}var Dp=bo(O);function Fp(W){for(var gt=fi.lastIndex=0;fi.test(W);)++gt;return gt}function Pl(W){return W.match(fi)||[]}function Cp(W){return W.match(us)||[]}var kp=function W(gt){gt=gt==null?Le:wo.defaults(Le.Object(),gt,wo.pick(Le,El));var ut=gt.Array,se=gt.Date,Ie=gt.Error,fn=gt.Function,Qn=gt.Math,pn=gt.Object,zl=gt.RegExp,Pp=gt.String,Hr=gt.TypeError,Pu=ut.prototype,zp=fn.prototype,xo=pn.prototype,zu=gt["__core-js_shared__"],vf=zp.toString,un=xo.hasOwnProperty,Up=0,wf=function(){var i=/[^.]+$/.exec(zu&&zu.keys&&zu.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Rr=xo.toString,So=vf.call(pn),sd=Le._,od=zl("^"+vf.call(un).replace(ef,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xf=Or?gt.Buffer:e,Ki=gt.Symbol,Sf=gt.Uint8Array,Ul=xf?xf.allocUnsafe:e,Uu=Cl(pn.getPrototypeOf,pn),_s=pn.create,tr=xo.propertyIsEnumerable,Af=Pu.splice,Gl=Ki?Ki.isConcatSpreadable:e,ci=Ki?Ki.iterator:e,Ta=Ki?Ki.toStringTag:e,Ef=function(){try{var i=B(pn,"defineProperty");return i({},"",{}),i}catch{}}(),Gp=gt.clearTimeout!==Le.clearTimeout&&gt.clearTimeout,$p=se&&se.now!==Le.Date.now&&se.now,jp=gt.setTimeout!==Le.setTimeout&&gt.setTimeout,Gu=Qn.ceil,Ao=Qn.floor,$u=pn.getOwnPropertySymbols,Vp=xf?xf.isBuffer:e,$l=gt.isFinite,fd=Pu.join,Wp=Cl(pn.keys,pn),$n=Qn.max,wr=Qn.min,Ia=se.now,ju=gt.parseInt,jl=Qn.random,ud=Pu.reverse,Vu=B(gt,"DataView"),Eo=B(gt,"Map"),Wu=B(gt,"Promise"),ps=B(gt,"Set"),To=B(gt,"WeakMap"),Io=B(pn,"create"),Tf=To&&new To,xr={},cd=an(Vu),Yp=an(Eo),Ji=an(Wu),Vl=an(ps),ms=an(To),gs=Ki?Ki.prototype:e,Oo=gs?gs.valueOf:e,Wl=gs?gs.toString:e;function b(i){if(Zn(i)&&!Pe(i)&&!(i instanceof tn)){if(i instanceof Xr)return i;if(un.call(i,"__wrapped__"))return Vn(i)}return new Xr(i)}var bs=function(){function i(){}return function(s){if(!Hn(s))return{};if(_s)return _s(s);i.prototype=s;var u=new i;return i.prototype=e,u}}();function If(){}function Xr(i,s){this.__wrapped__=i,this.__actions__=[],this.__chain__=!!s,this.__index__=0,this.__values__=e}b.templateSettings={escape:nl,evaluate:rl,interpolate:yr,variable:"",imports:{_:b}},b.prototype=If.prototype,b.prototype.constructor=b,Xr.prototype=bs(If.prototype),Xr.prototype.constructor=Xr;function tn(i){this.__wrapped__=i,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=de,this.__views__=[]}function Hp(){var i=new tn(this.__wrapped__);return i.__actions__=Ar(this.__actions__),i.__dir__=this.__dir__,i.__filtered__=this.__filtered__,i.__iteratees__=Ar(this.__iteratees__),i.__takeCount__=this.__takeCount__,i.__views__=Ar(this.__views__),i}function Xp(){if(this.__filtered__){var i=new tn(this);i.__dir__=-1,i.__filtered__=!0}else i=this.clone(),i.__dir__*=-1;return i}function qp(){var i=this.__wrapped__.value(),s=this.__dir__,u=Pe(i),h=s<0,p=u?i.length:0,w=vt(0,p,this.__views__),N=w.start,k=w.end,Z=k-N,At=h?k:N-1,Tt=this.__iteratees__,Ft=Tt.length,ne=0,pe=wr(Z,this.__takeCount__);if(!u||!h&&p==Z&&pe==Z)return kf(i,this.__actions__);var xe=[];t:for(;Z--&&ne<pe;){At+=s;for(var Je=-1,Se=i[At];++Je<Ft;){var rn=Tt[Je],cn=rn.iteratee,bi=rn.type,$r=cn(Se);if(bi==ft)Se=$r;else if(!$r){if(bi==F)continue t;break t}}xe[ne++]=Se}return xe}tn.prototype=bs(If.prototype),tn.prototype.constructor=tn;function ys(i){var s=-1,u=i==null?0:i.length;for(this.clear();++s<u;){var h=i[s];this.set(h[0],h[1])}}function Zp(){this.__data__=Io?Io(null):{},this.size=0}function ld(i){var s=this.has(i)&&delete this.__data__[i];return this.size-=s?1:0,s}function hd(i){var s=this.__data__;if(Io){var u=s[i];return u===l?e:u}return un.call(s,i)?s[i]:e}function Kp(i){var s=this.__data__;return Io?s[i]!==e:un.call(s,i)}function Jp(i,s){var u=this.__data__;return this.size+=this.has(i)?0:1,u[i]=Io&&s===e?l:s,this}ys.prototype.clear=Zp,ys.prototype.delete=ld,ys.prototype.get=hd,ys.prototype.has=Kp,ys.prototype.set=Jp;function li(i){var s=-1,u=i==null?0:i.length;for(this.clear();++s<u;){var h=i[s];this.set(h[0],h[1])}}function Yu(){this.__data__=[],this.size=0}function Qp(i){var s=this.__data__,u=Oa(s,i);if(u<0)return!1;var h=s.length-1;return u==h?s.pop():Af.call(s,u,1),--this.size,!0}function tm(i){var s=this.__data__,u=Oa(s,i);return u<0?e:s[u][1]}function em(i){return Oa(this.__data__,i)>-1}function nm(i,s){var u=this.__data__,h=Oa(u,i);return h<0?(++this.size,u.push([i,s])):u[h][1]=s,this}li.prototype.clear=Yu,li.prototype.delete=Qp,li.prototype.get=tm,li.prototype.has=em,li.prototype.set=nm;function Qi(i){var s=-1,u=i==null?0:i.length;for(this.clear();++s<u;){var h=i[s];this.set(h[0],h[1])}}function dd(){this.size=0,this.__data__={hash:new ys,map:new(Eo||li),string:new ys}}function rm(i){var s=d(this,i).delete(i);return this.size-=s?1:0,s}function im(i){return d(this,i).get(i)}function am(i){return d(this,i).has(i)}function sm(i,s){var u=d(this,i),h=u.size;return u.set(i,s),this.size+=u.size==h?0:1,this}Qi.prototype.clear=dd,Qi.prototype.delete=rm,Qi.prototype.get=im,Qi.prototype.has=am,Qi.prototype.set=sm;function vs(i){var s=-1,u=i==null?0:i.length;for(this.__data__=new Qi;++s<u;)this.add(i[s])}function Bo(i){return this.__data__.set(i,l),this}function om(i){return this.__data__.has(i)}vs.prototype.add=vs.prototype.push=Bo,vs.prototype.has=om;function hi(i){var s=this.__data__=new li(i);this.size=s.size}function _d(){this.__data__=new li,this.size=0}function Hu(i){var s=this.__data__,u=s.delete(i);return this.size=s.size,u}function pd(i){return this.__data__.get(i)}function Yl(i){return this.__data__.has(i)}function fm(i,s){var u=this.__data__;if(u instanceof li){var h=u.__data__;if(!Eo||h.length<a-1)return h.push([i,s]),this.size=++u.size,this;u=this.__data__=new Qi(h)}return u.set(i,s),this.size=u.size,this}hi.prototype.clear=_d,hi.prototype.delete=Hu,hi.prototype.get=pd,hi.prototype.has=Yl,hi.prototype.set=fm;function Hl(i,s){var u=Pe(i),h=!u&&Yf(i),p=!u&&!h&&Go(i),w=!u&&!h&&!p&&hc(i),N=u||h||p||w,k=N?Ml(i.length,Pp):[],Z=k.length;for(var At in i)(s||un.call(i,At))&&!(N&&(At=="length"||p&&(At=="offset"||At=="parent")||w&&(At=="buffer"||At=="byteLength"||At=="byteOffset")||z(At,Z)))&&k.push(At);return k}function md(i){var s=i.length;return s?i[tc(0,s-1)]:e}function um(i,s){return vn(Ar(i),ws(s,0,i.length))}function cm(i){return vn(Ar(i))}function Xl(i,s,u){(u!==e&&!aa(i[s],u)||u===e&&!(s in i))&&Lr(i,s,u)}function Of(i,s,u){var h=i[s];(!(un.call(i,s)&&aa(h,u))||u===e&&!(s in i))&&Lr(i,s,u)}function Oa(i,s){for(var u=i.length;u--;)if(aa(i[u][0],s))return u;return-1}function lm(i,s,u,h){return Bi(i,function(p,w,N){s(h,p,u(p),N)}),h}function Bf(i,s){return i&&Ri(s,Tr(s),i)}function hm(i,s){return i&&Ri(s,Qr(s),i)}function Lr(i,s,u){s=="__proto__"&&Ef?Ef(i,s,{configurable:!0,enumerable:!0,value:u,writable:!0}):i[s]=u}function Ba(i,s){for(var u=-1,h=s.length,p=ut(h),w=i==null;++u<h;)p[u]=w?e:Tm(i,s[u]);return p}function ws(i,s,u){return i===i&&(u!==e&&(i=i<=u?i:u),s!==e&&(i=i>=s?i:s)),i}function pr(i,s,u,h,p,w){var N,k=s&A,Z=s&R,At=s&C;if(u&&(N=p?u(i,h,p,w):u(i)),N!==e)return N;if(!Hn(i))return i;var Tt=Pe(i);if(Tt){if(N=Rt(i),!k)return Ar(i,N)}else{var Ft=tt(i),ne=Ft==Yr||Ft==Qo;if(Go(i))return zf(i,k);if(Ft==si||Ft==on||ne&&!p){if(N=Z||ne?{}:Ot(i),!k)return Z?mm(i,hm(N,i)):pm(i,Bf(N,i))}else{if(!bn[Ft])return p?i:{};N=kt(i,Ft,k)}}w||(w=new hi);var pe=w.get(i);if(pe)return pe;w.set(i,N),Vg(i)?i.forEach(function(Se){N.add(pr(Se,s,u,Se,i,w))}):$g(i)&&i.forEach(function(Se,rn){N.set(rn,pr(Se,s,u,rn,i,w))});var xe=At?Z?uc:fc:Z?Qr:Tr,Je=Tt?e:xe(i);return _r(Je||i,function(Se,rn){Je&&(rn=Se,Se=i[rn]),Of(N,rn,pr(Se,s,u,rn,i,w))}),N}function gd(i){var s=Tr(i);return function(u){return xs(u,i,s)}}function xs(i,s,u){var h=u.length;if(i==null)return!h;for(i=pn(i);h--;){var p=u[h],w=s[p],N=i[p];if(N===e&&!(p in i)||!w(N))return!1}return!0}function Xu(i,s,u){if(typeof i!="function")throw new Hr(f);return ue(function(){i.apply(e,u)},s)}function Ss(i,s,u,h){var p=-1,w=Mu,N=!0,k=i.length,Z=[],At=s.length;if(!k)return Z;u&&(s=Cn(s,zr(u))),h?(w=Il,N=!1):s.length>=a&&(w=Aa,N=!1,s=new vs(s));t:for(;++p<k;){var Tt=i[p],Ft=u==null?Tt:u(Tt);if(Tt=h||Tt!==0?Tt:0,N&&Ft===Ft){for(var ne=At;ne--;)if(s[ne]===Ft)continue t;Z.push(Tt)}else w(s,Ft,h)||Z.push(Tt)}return Z}var Bi=ch(qr),qu=ch(Rf,!0);function ql(i,s){var u=!0;return Bi(i,function(h,p,w){return u=!!s(h,p,w),u}),u}function As(i,s,u){for(var h=-1,p=i.length;++h<p;){var w=i[h],N=s(w);if(N!=null&&(k===e?N===N&&!gi(N):u(N,k)))var k=N,Z=w}return Z}function bd(i,s,u,h){var p=i.length;for(u=He(u),u<0&&(u=-u>p?0:p+u),h=h===e||h>p?p:He(h),h<0&&(h+=p),h=u>h?0:Yg(h);u<h;)i[u++]=s;return i}function Zl(i,s){var u=[];return Bi(i,function(h,p,w){s(h,p,w)&&u.push(h)}),u}function or(i,s,u,h,p){var w=-1,N=i.length;for(u||(u=Et),p||(p=[]);++w<N;){var k=i[w];s>0&&u(k)?s>1?or(k,s-1,u,h,p):Xi(p,k):h||(p[p.length]=k)}return p}var Zu=lh(),Kl=lh(!0);function qr(i,s){return i&&Zu(i,s,Tr)}function Rf(i,s){return i&&Kl(i,s,Tr)}function Mf(i,s){return Oi(s,function(u){return Ps(i[u])})}function Ra(i,s){s=di(s,i);for(var u=0,h=s.length;i!=null&&u<h;)i=i[mn(s[u++])];return u&&u==h?i:e}function Jl(i,s,u){var h=s(i);return Pe(i)?h:Xi(h,u(i))}function Sr(i){return i==null?i===e?_u:hu:Ta&&Ta in pn(i)?Q(i):zt(i)}function Lf(i,s){return i>s}function yd(i,s){return i!=null&&un.call(i,s)}function vd(i,s){return i!=null&&s in pn(i)}function Ql(i,s,u){return i>=wr(s,u)&&i<$n(s,u)}function Nf(i,s,u){for(var h=u?Il:Mu,p=i[0].length,w=i.length,N=w,k=ut(w),Z=1/0,At=[];N--;){var Tt=i[N];N&&s&&(Tt=Cn(Tt,zr(s))),Z=wr(Tt.length,Z),k[N]=!u&&(s||p>=120&&Tt.length>=120)?new vs(N&&Tt):e}Tt=i[0];var Ft=-1,ne=k[0];t:for(;++Ft<p&&At.length<Z;){var pe=Tt[Ft],xe=s?s(pe):pe;if(pe=u||pe!==0?pe:0,!(ne?Aa(ne,xe):h(At,xe,u))){for(N=w;--N;){var Je=k[N];if(!(Je?Aa(Je,xe):h(i[N],xe,u)))continue t}ne&&ne.push(xe),At.push(pe)}}return At}function wd(i,s,u,h){return qr(i,function(p,w,N){s(h,u(p),w,N)}),h}function Es(i,s,u){s=di(s,i),i=ge(i,s);var h=i==null?i:i[mn(M(s))];return h==null?e:sr(h,i,u)}function th(i){return Zn(i)&&Sr(i)==on}function xd(i){return Zn(i)&&Sr(i)==rs}function eh(i){return Zn(i)&&Sr(i)==Dn}function Ro(i,s,u,h,p){return i===s?!0:i==null||s==null||!Zn(i)&&!Zn(s)?i!==i&&s!==s:Sd(i,s,u,h,Ro,p)}function Sd(i,s,u,h,p,w){var N=Pe(i),k=Pe(s),Z=N?An:tt(i),At=k?An:tt(s);Z=Z==on?si:Z,At=At==on?si:At;var Tt=Z==si,Ft=At==si,ne=Z==At;if(ne&&Go(i)){if(!Go(s))return!1;N=!0,Tt=!1}if(ne&&!Tt)return w||(w=new hi),N||hc(i)?Dd(i,s,u,h,p,w):vm(i,s,Z,u,h,p,w);if(!(u&G)){var pe=Tt&&un.call(i,"__wrapped__"),xe=Ft&&un.call(s,"__wrapped__");if(pe||xe){var Je=pe?i.value():i,Se=xe?s.value():s;return w||(w=new hi),p(Je,Se,u,h,w)}}return ne?(w||(w=new hi),wm(i,s,u,h,p,w)):!1}function nh(i){return Zn(i)&&tt(i)==Mr}function Df(i,s,u,h){var p=u.length,w=p,N=!h;if(i==null)return!w;for(i=pn(i);p--;){var k=u[p];if(N&&k[2]?k[1]!==i[k[0]]:!(k[0]in i))return!1}for(;++p<w;){k=u[p];var Z=k[0],At=i[Z],Tt=k[1];if(N&&k[2]){if(At===e&&!(Z in i))return!1}else{var Ft=new hi;if(h)var ne=h(At,Tt,Z,i,s,Ft);if(!(ne===e?Ro(Tt,At,G|$t,h,Ft):ne))return!1}}return!0}function Mo(i){if(!Hn(i)||Vt(i))return!1;var s=Ps(i)?od:_l;return s.test(an(i))}function Ad(i){return Zn(i)&&Sr(i)==Cr}function Ku(i){return Zn(i)&&tt(i)==Ir}function ta(i){return Zn(i)&&$d(i.length)&&!!gn[Sr(i)]}function Lo(i){return typeof i=="function"?i:i==null?ti:typeof i=="object"?Pe(i)?Na(i[0],i[1]):La(i):rb(i)}function ea(i){if(!re(i))return Wp(i);var s=[];for(var u in pn(i))un.call(i,u)&&u!="constructor"&&s.push(u);return s}function Ff(i){if(!Hn(i))return St(i);var s=re(i),u=[];for(var h in i)h=="constructor"&&(s||!un.call(i,h))||u.push(h);return u}function Ts(i,s){return i<s}function Ma(i,s){var u=-1,h=Jr(i)?ut(i.length):[];return Bi(i,function(p,w,N){h[++u]=s(p,w,N)}),h}function La(i){var s=y(i);return s.length==1&&s[0][2]?ht(s[0][0],s[0][1]):function(u){return u===i||Df(u,i,s)}}function Na(i,s){return xt(i)&&dt(s)?ht(mn(i),s):function(u){var h=Tm(u,i);return h===e&&h===s?Im(u,i):Ro(s,h,G|$t)}}function Is(i,s,u,h,p){i!==s&&Zu(s,function(w,N){if(p||(p=new hi),Hn(w))Ju(i,s,N,u,Is,h,p);else{var k=h?h(Gt(i,N),w,N+"",i,s,p):e;k===e&&(k=w),Xl(i,N,k)}},Qr)}function Ju(i,s,u,h,p,w,N){var k=Gt(i,u),Z=Gt(s,u),At=N.get(Z);if(At){Xl(i,u,At);return}var Tt=w?w(k,Z,u+"",i,s,N):e,Ft=Tt===e;if(Ft){var ne=Pe(Z),pe=!ne&&Go(Z),xe=!ne&&!pe&&hc(Z);Tt=Z,ne||pe||xe?Pe(k)?Tt=k:nr(k)?Tt=Ar(k):pe?(Ft=!1,Tt=zf(Z,!0)):xe?(Ft=!1,Tt=zo(Z,!0)):Tt=[]:gh(Z)||Yf(Z)?(Tt=k,Yf(k)?Tt=Hg(k):(!Hn(k)||Ps(k))&&(Tt=Ot(Z))):Ft=!1}Ft&&(N.set(Z,Tt),p(Tt,Z,h,w,N),N.delete(Z)),Xl(i,u,Tt)}function No(i,s){var u=i.length;if(u)return s+=s<0?u:0,z(s,u)?i[s]:e}function Qu(i,s,u){s.length?s=Cn(s,function(w){return Pe(w)?function(N){return Ra(N,w.length===1?w[0]:w)}:w}):s=[ti];var h=-1;s=Cn(s,zr(ve()));var p=Ma(i,function(w,N,k){var Z=Cn(s,function(At){return At(w)});return{criteria:Z,index:++h,value:w}});return Rl(p,function(w,N){return jf(w,N,u)})}function rh(i,s){return Os(i,s,function(u,h){return Im(i,h)})}function Os(i,s,u){for(var h=-1,p=s.length,w={};++h<p;){var N=s[h],k=Ra(i,N);u(k,N)&&Cf(w,di(N,i),k)}return w}function Do(i){return function(s){return Ra(s,i)}}function ih(i,s,u,h){var p=h?ls:qi,w=-1,N=s.length,k=i;for(i===s&&(s=Ar(s)),u&&(k=Cn(i,zr(u)));++w<N;)for(var Z=0,At=s[w],Tt=u?u(At):At;(Z=p(k,Tt,Z,h))>-1;)k!==i&&Af.call(k,Z,1),Af.call(i,Z,1);return i}function Ed(i,s){for(var u=i?s.length:0,h=u-1;u--;){var p=s[u];if(u==h||p!==w){var w=p;z(p)?Af.call(i,p,1):oh(i,p)}}return i}function tc(i,s){return i+Ao(jl()*(s-i+1))}function Td(i,s,u,h){for(var p=-1,w=$n(Gu((s-i)/(u||1)),0),N=ut(w);w--;)N[h?w:++p]=i,i+=u;return N}function ec(i,s){var u="";if(!i||s<1||s>Lt)return u;do s%2&&(u+=i),s=Ao(s/2),s&&(i+=i);while(s);return u}function Ye(i,s){return me(Ut(i,s,ti),i+"")}function Fo(i){return md(dc(i))}function ah(i,s){var u=dc(i);return vn(u,ws(s,0,u.length))}function Cf(i,s,u,h){if(!Hn(i))return i;s=di(s,i);for(var p=-1,w=s.length,N=w-1,k=i;k!=null&&++p<w;){var Z=mn(s[p]),At=u;if(Z==="__proto__"||Z==="constructor"||Z==="prototype")return i;if(p!=N){var Tt=k[Z];At=h?h(Tt,Z,k):e,At===e&&(At=Hn(Tt)?Tt:z(s[p+1])?[]:{})}Of(k,Z,At),k=k[Z]}return i}var Id=Tf?function(i,s){return Tf.set(i,s),i}:ti,Od=Ef?function(i,s){return Ef(i,"toString",{configurable:!0,enumerable:!1,value:Bm(s),writable:!0})}:ti;function dm(i){return vn(dc(i))}function Zr(i,s,u){var h=-1,p=i.length;s<0&&(s=-s>p?0:p+s),u=u>p?p:u,u<0&&(u+=p),p=s>u?0:u-s>>>0,s>>>=0;for(var w=ut(p);++h<p;)w[h]=i[h+s];return w}function _m(i,s){var u;return Bi(i,function(h,p,w){return u=s(h,p,w),!u}),!!u}function nc(i,s,u){var h=0,p=i==null?h:i.length;if(typeof s=="number"&&s===s&&p<=ye){for(;h<p;){var w=h+p>>>1,N=i[w];N!==null&&!gi(N)&&(u?N<=s:N<s)?h=w+1:p=w}return p}return sh(i,s,ti,u)}function sh(i,s,u,h){var p=0,w=i==null?0:i.length;if(w===0)return 0;s=u(s);for(var N=s!==s,k=s===null,Z=gi(s),At=s===e;p<w;){var Tt=Ao((p+w)/2),Ft=u(i[Tt]),ne=Ft!==e,pe=Ft===null,xe=Ft===Ft,Je=gi(Ft);if(N)var Se=h||xe;else At?Se=xe&&(h||ne):k?Se=xe&&ne&&(h||!pe):Z?Se=xe&&ne&&!pe&&(h||!Je):pe||Je?Se=!1:Se=h?Ft<=s:Ft<s;Se?p=Tt+1:w=Tt}return wr(w,Te)}function Bd(i,s){for(var u=-1,h=i.length,p=0,w=[];++u<h;){var N=i[u],k=s?s(N):N;if(!u||!aa(k,Z)){var Z=k;w[p++]=N===0?0:N}}return w}function Rd(i){return typeof i=="number"?i:gi(i)?ee:+i}function Ur(i){if(typeof i=="string")return i;if(Pe(i))return Cn(i,Ur)+"";if(gi(i))return Wl?Wl.call(i):"";var s=i+"";return s=="0"&&1/i==-bt?"-0":s}function Da(i,s,u){var h=-1,p=Mu,w=i.length,N=!0,k=[],Z=k;if(u)N=!1,p=Il;else if(w>=a){var At=s?null:bm(i);if(At)return yf(At);N=!1,p=Aa,Z=new vs}else Z=s?[]:k;t:for(;++h<w;){var Tt=i[h],Ft=s?s(Tt):Tt;if(Tt=u||Tt!==0?Tt:0,N&&Ft===Ft){for(var ne=Z.length;ne--;)if(Z[ne]===Ft)continue t;s&&Z.push(Ft),k.push(Tt)}else p(Z,Ft,u)||(Z!==k&&Z.push(Ft),k.push(Tt))}return k}function oh(i,s){return s=di(s,i),i=ge(i,s),i==null||delete i[mn(M(s))]}function rc(i,s,u,h){return Cf(i,s,u(Ra(i,s)),h)}function Bs(i,s,u,h){for(var p=i.length,w=h?p:-1;(h?w--:++w<p)&&s(i[w],w,i););return u?Zr(i,h?0:w,h?w+1:p):Zr(i,h?w+1:0,h?p:w)}function kf(i,s){var u=i;return u instanceof tn&&(u=u.value()),Ol(s,function(h,p){return p.func.apply(p.thisArg,Xi([h],p.args))},u)}function Co(i,s,u){var h=i.length;if(h<2)return h?Da(i[0]):[];for(var p=-1,w=ut(h);++p<h;)for(var N=i[p],k=-1;++k<h;)k!=p&&(w[p]=Ss(w[p]||N,i[k],s,u));return Da(or(w,1),s,u)}function ic(i,s,u){for(var h=-1,p=i.length,w=s.length,N={};++h<p;){var k=h<w?s[h]:e;u(N,i[h],k)}return N}function ko(i){return nr(i)?i:[]}function Po(i){return typeof i=="function"?i:ti}function di(i,s){return Pe(i)?i:xt(i,s)?[i]:Oe(wn(i))}var fh=Ye;function _i(i,s,u){var h=i.length;return u=u===e?h:u,!s&&u>=h?i:Zr(i,s,u)}var Pf=Gp||function(i){return Le.clearTimeout(i)};function zf(i,s){if(s)return i.slice();var u=i.length,h=Ul?Ul(u):new i.constructor(u);return i.copy(h),h}function Rs(i){var s=new i.constructor(i.byteLength);return new Sf(s).set(new Sf(i)),s}function Uf(i,s){var u=s?Rs(i.buffer):i.buffer;return new i.constructor(u,i.byteOffset,i.byteLength)}function Gf(i){var s=new i.constructor(i.source,Wi.exec(i));return s.lastIndex=i.lastIndex,s}function $f(i){return Oo?pn(Oo.call(i)):{}}function zo(i,s){var u=s?Rs(i.buffer):i.buffer;return new i.constructor(u,i.byteOffset,i.length)}function ac(i,s){if(i!==s){var u=i!==e,h=i===null,p=i===i,w=gi(i),N=s!==e,k=s===null,Z=s===s,At=gi(s);if(!k&&!At&&!w&&i>s||w&&N&&Z&&!k&&!At||h&&N&&Z||!u&&Z||!p)return 1;if(!h&&!w&&!At&&i<s||At&&u&&p&&!h&&!w||k&&u&&p||!N&&p||!Z)return-1}return 0}function jf(i,s,u){for(var h=-1,p=i.criteria,w=s.criteria,N=p.length,k=u.length;++h<N;){var Z=ac(p[h],w[h]);if(Z){if(h>=k)return Z;var At=u[h];return Z*(At=="desc"?-1:1)}}return i.index-s.index}function Fa(i,s,u,h){for(var p=-1,w=i.length,N=u.length,k=-1,Z=s.length,At=$n(w-N,0),Tt=ut(Z+At),Ft=!h;++k<Z;)Tt[k]=s[k];for(;++p<N;)(Ft||p<w)&&(Tt[u[p]]=i[p]);for(;At--;)Tt[k++]=i[p++];return Tt}function uh(i,s,u,h){for(var p=-1,w=i.length,N=-1,k=u.length,Z=-1,At=s.length,Tt=$n(w-k,0),Ft=ut(Tt+At),ne=!h;++p<Tt;)Ft[p]=i[p];for(var pe=p;++Z<At;)Ft[pe+Z]=s[Z];for(;++N<k;)(ne||p<w)&&(Ft[pe+u[N]]=i[p++]);return Ft}function Ar(i,s){var u=-1,h=i.length;for(s||(s=ut(h));++u<h;)s[u]=i[u];return s}function Ri(i,s,u,h){var p=!u;u||(u={});for(var w=-1,N=s.length;++w<N;){var k=s[w],Z=h?h(u[k],i[k],k,u,i):e;Z===e&&(Z=i[k]),p?Lr(u,k,Z):Of(u,k,Z)}return u}function pm(i,s){return Ri(i,lt(i),s)}function mm(i,s){return Ri(i,K(i),s)}function pi(i,s){return function(u,h){var p=Pe(u)?Jh:lm,w=s?s():{};return p(u,i,ve(h,2),w)}}function Ms(i){return Ye(function(s,u){var h=-1,p=u.length,w=p>1?u[p-1]:e,N=p>2?u[2]:e;for(w=i.length>3&&typeof w=="function"?(p--,w):e,N&&J(u[0],u[1],N)&&(w=p<3?e:w,p=1),s=pn(s);++h<p;){var k=u[h];k&&i(s,k,h,w)}return s})}function ch(i,s){return function(u,h){if(u==null)return u;if(!Jr(u))return i(u,h);for(var p=u.length,w=s?p:-1,N=pn(u);(s?w--:++w<p)&&h(N[w],w,N)!==!1;);return u}}function lh(i){return function(s,u,h){for(var p=-1,w=pn(s),N=h(s),k=N.length;k--;){var Z=N[i?k:++p];if(u(w[Z],Z,w)===!1)break}return s}}function gm(i,s,u){var h=s&Kt,p=Nr(i);function w(){var N=this&&this!==Le&&this instanceof w?p:i;return N.apply(h?u:this,arguments)}return w}function hh(i){return function(s){s=wn(s);var u=ds(s)?Br(s):e,h=u?u[0]:s.charAt(0),p=u?_i(u,1).join(""):s.slice(1);return h[i]()+p}}function Uo(i){return function(s){return Ol(eb(tb(s).replace(_f,"")),i,"")}}function Nr(i){return function(){var s=arguments;switch(s.length){case 0:return new i;case 1:return new i(s[0]);case 2:return new i(s[0],s[1]);case 3:return new i(s[0],s[1],s[2]);case 4:return new i(s[0],s[1],s[2],s[3]);case 5:return new i(s[0],s[1],s[2],s[3],s[4]);case 6:return new i(s[0],s[1],s[2],s[3],s[4],s[5]);case 7:return new i(s[0],s[1],s[2],s[3],s[4],s[5],s[6])}var u=bs(i.prototype),h=i.apply(u,s);return Hn(h)?h:u}}function Md(i,s,u){var h=Nr(i);function p(){for(var w=arguments.length,N=ut(w),k=w,Z=Ds(p);k--;)N[k]=arguments[k];var At=w<3&&N[0]!==Z&&N[w-1]!==Z?[]:Zi(N,Z);if(w-=At.length,w<u)return dh(i,s,Vf,p.placeholder,e,N,At,e,e,u-w);var Tt=this&&this!==Le&&this instanceof p?h:i;return sr(Tt,this,N)}return p}function Ls(i){return function(s,u,h){var p=pn(s);if(!Jr(s)){var w=ve(u,3);s=Tr(s),u=function(k){return w(p[k],k,p)}}var N=i(s,u,h);return N>-1?p[w?s[N]:N]:e}}function na(i){return Mi(function(s){var u=s.length,h=u,p=Xr.prototype.thru;for(i&&s.reverse();h--;){var w=s[h];if(typeof w!="function")throw new Hr(f);if(p&&!N&&cc(w)=="wrapper")var N=new Xr([],!0)}for(h=N?h:u;++h<u;){w=s[h];var k=cc(w),Z=k=="wrapper"?mh(w):e;Z&&pt(Z[0])&&Z[1]==(be|Xt|Ct|sn)&&!Z[4].length&&Z[9]==1?N=N[cc(Z[0])].apply(N,Z[3]):N=w.length==1&&pt(w)?N[k]():N.thru(w)}return function(){var At=arguments,Tt=At[0];if(N&&At.length==1&&Pe(Tt))return N.plant(Tt).value();for(var Ft=0,ne=u?s[Ft].apply(this,At):Tt;++Ft<u;)ne=s[Ft].call(this,ne);return ne}})}function Vf(i,s,u,h,p,w,N,k,Z,At){var Tt=s&be,Ft=s&Kt,ne=s&Mt,pe=s&(Xt|it),xe=s&st,Je=ne?e:Nr(i);function Se(){for(var rn=arguments.length,cn=ut(rn),bi=rn;bi--;)cn[bi]=arguments[bi];if(pe)var $r=Ds(Se),yi=yo(cn,$r);if(h&&(cn=Fa(cn,h,p,pe)),w&&(cn=uh(cn,w,N,pe)),rn-=yi,pe&&rn<At){var rr=Zi(cn,$r);return dh(i,s,Vf,Se.placeholder,u,cn,rr,k,Z,At-rn)}var sa=Ft?u:this,Us=ne?sa[i]:i;return rn=cn.length,k?cn=_e(cn,k):xe&&rn>1&&cn.reverse(),Tt&&Z<rn&&(cn.length=Z),this&&this!==Le&&this instanceof Se&&(Us=Je||Nr(Us)),Us.apply(sa,cn)}return Se}function sc(i,s){return function(u,h){return wd(u,i,s(h),{})}}function Ns(i,s){return function(u,h){var p;if(u===e&&h===e)return s;if(u!==e&&(p=u),h!==e){if(p===e)return h;typeof u=="string"||typeof h=="string"?(u=Ur(u),h=Ur(h)):(u=Rd(u),h=Rd(h)),p=i(u,h)}return p}}function oc(i){return Mi(function(s){return s=Cn(s,zr(ve())),Ye(function(u){var h=this;return i(s,function(p){return sr(p,h,u)})})})}function kn(i,s){s=s===e?" ":Ur(s);var u=s.length;if(u<2)return u?ec(s,i):s;var h=ec(s,Gu(i/Ea(s)));return ds(s)?_i(Br(h),0,i).join(""):h.slice(0,i)}function Ca(i,s,u,h){var p=s&Kt,w=Nr(i);function N(){for(var k=-1,Z=arguments.length,At=-1,Tt=h.length,Ft=ut(Tt+Z),ne=this&&this!==Le&&this instanceof N?w:i;++At<Tt;)Ft[At]=h[At];for(;Z--;)Ft[At++]=arguments[++k];return sr(ne,p?u:this,Ft)}return N}function Pn(i){return function(s,u,h){return h&&typeof h!="number"&&J(s,u,h)&&(u=h=e),s=zs(s),u===e?(u=s,s=0):u=zs(u),h=h===e?s<u?1:-1:zs(h),Td(s,u,h,i)}}function mr(i){return function(s,u){return typeof s=="string"&&typeof u=="string"||(s=Ni(s),u=Ni(u)),i(s,u)}}function dh(i,s,u,h,p,w,N,k,Z,At){var Tt=s&Xt,Ft=Tt?N:e,ne=Tt?e:N,pe=Tt?w:e,xe=Tt?e:w;s|=Tt?Ct:fe,s&=~(Tt?fe:Ct),s&ie||(s&=~(Kt|Mt));var Je=[i,s,p,pe,Ft,xe,ne,k,Z,At],Se=u.apply(e,Je);return pt(i)&&Wt(Se,Je),Se.placeholder=h,Ee(Se,i,s)}function _h(i){var s=Qn[i];return function(u,h){if(u=Ni(u),h=h==null?0:wr(He(h),292),h&&$l(u)){var p=(wn(u)+"e").split("e"),w=s(p[0]+"e"+(+p[1]+h));return p=(wn(w)+"e").split("e"),+(p[0]+"e"+(+p[1]-h))}return s(u)}}var bm=ps&&1/yf(new ps([,-0]))[1]==bt?function(i){return new ps(i)}:Lm;function Ld(i){return function(s){var u=tt(s);return u==Mr?ku(s):u==Ir?id(s):Np(s,i(s))}}function ra(i,s,u,h,p,w,N,k){var Z=s&Mt;if(!Z&&typeof i!="function")throw new Hr(f);var At=h?h.length:0;if(At||(s&=~(Ct|fe),h=p=e),N=N===e?N:$n(He(N),0),k=k===e?k:He(k),At-=p?p.length:0,s&fe){var Tt=h,Ft=p;h=p=e}var ne=Z?e:mh(i),pe=[i,s,u,h,p,Tt,Ft,w,N,k];if(ne&&Pt(pe,ne),i=pe[0],s=pe[1],u=pe[2],h=pe[3],p=pe[4],k=pe[9]=pe[9]===e?Z?0:i.length:$n(pe[9]-At,0),!k&&s&(Xt|it)&&(s&=~(Xt|it)),!s||s==Kt)var xe=gm(i,s,u);else s==Xt||s==it?xe=Md(i,s,k):(s==Ct||s==(Kt|Ct))&&!p.length?xe=Ca(i,s,u,h):xe=Vf.apply(e,pe);var Je=ne?Id:Wt;return Ee(Je(xe,pe),i,s)}function ph(i,s,u,h){return i===e||aa(i,xo[u])&&!un.call(h,u)?s:i}function Nd(i,s,u,h,p,w){return Hn(i)&&Hn(s)&&(w.set(s,i),Is(i,s,e,Nd,w),w.delete(s)),i}function ym(i){return gh(i)?e:i}function Dd(i,s,u,h,p,w){var N=u&G,k=i.length,Z=s.length;if(k!=Z&&!(N&&Z>k))return!1;var At=w.get(i),Tt=w.get(s);if(At&&Tt)return At==s&&Tt==i;var Ft=-1,ne=!0,pe=u&$t?new vs:e;for(w.set(i,s),w.set(s,i);++Ft<k;){var xe=i[Ft],Je=s[Ft];if(h)var Se=N?h(Je,xe,Ft,s,i,w):h(xe,Je,Ft,i,s,w);if(Se!==e){if(Se)continue;ne=!1;break}if(pe){if(!Lu(s,function(rn,cn){if(!Aa(pe,cn)&&(xe===rn||p(xe,rn,u,h,w)))return pe.push(cn)})){ne=!1;break}}else if(!(xe===Je||p(xe,Je,u,h,w))){ne=!1;break}}return w.delete(i),w.delete(s),ne}function vm(i,s,u,h,p,w,N){switch(u){case lr:if(i.byteLength!=s.byteLength||i.byteOffset!=s.byteOffset)return!1;i=i.buffer,s=s.buffer;case rs:return!(i.byteLength!=s.byteLength||!w(new Sf(i),new Sf(s)));case ln:case Dn:case ba:return aa(+i,+s);case Kn:return i.name==s.name&&i.message==s.message;case Cr:case Ai:return i==s+"";case Mr:var k=ku;case Ir:var Z=h&G;if(k||(k=yf),i.size!=s.size&&!Z)return!1;var At=N.get(i);if(At)return At==s;h|=$t,N.set(i,s);var Tt=Dd(k(i),k(s),h,p,w,N);return N.delete(i),Tt;case v:if(Oo)return Oo.call(i)==Oo.call(s)}return!1}function wm(i,s,u,h,p,w){var N=u&G,k=fc(i),Z=k.length,At=fc(s),Tt=At.length;if(Z!=Tt&&!N)return!1;for(var Ft=Z;Ft--;){var ne=k[Ft];if(!(N?ne in s:un.call(s,ne)))return!1}var pe=w.get(i),xe=w.get(s);if(pe&&xe)return pe==s&&xe==i;var Je=!0;w.set(i,s),w.set(s,i);for(var Se=N;++Ft<Z;){ne=k[Ft];var rn=i[ne],cn=s[ne];if(h)var bi=N?h(cn,rn,ne,s,i,w):h(rn,cn,ne,i,s,w);if(!(bi===e?rn===cn||p(rn,cn,u,h,w):bi)){Je=!1;break}Se||(Se=ne=="constructor")}if(Je&&!Se){var $r=i.constructor,yi=s.constructor;$r!=yi&&"constructor"in i&&"constructor"in s&&!(typeof $r=="function"&&$r instanceof $r&&typeof yi=="function"&&yi instanceof yi)&&(Je=!1)}return w.delete(i),w.delete(s),Je}function Mi(i){return me(Ut(i,e,T),i+"")}function fc(i){return Jl(i,Tr,lt)}function uc(i){return Jl(i,Qr,K)}var mh=Tf?function(i){return Tf.get(i)}:Lm;function cc(i){for(var s=i.name+"",u=xr[s],h=un.call(xr,s)?u.length:0;h--;){var p=u[h],w=p.func;if(w==null||w==i)return p.name}return s}function Ds(i){var s=un.call(b,"placeholder")?b:i;return s.placeholder}function ve(){var i=b.iteratee||Rm;return i=i===Rm?Lo:i,arguments.length?i(arguments[0],arguments[1]):i}function d(i,s){var u=i.__data__;return Yt(s)?u[typeof s=="string"?"string":"hash"]:u.map}function y(i){for(var s=Tr(i),u=s.length;u--;){var h=s[u],p=i[h];s[u]=[h,p,dt(p)]}return s}function B(i,s){var u=Fl(i,s);return Mo(u)?u:e}function Q(i){var s=un.call(i,Ta),u=i[Ta];try{i[Ta]=e;var h=!0}catch{}var p=Rr.call(i);return h&&(s?i[Ta]=u:delete i[Ta]),p}var lt=$u?function(i){return i==null?[]:(i=pn(i),Oi($u(i),function(s){return tr.call(i,s)}))}:Nm,K=$u?function(i){for(var s=[];i;)Xi(s,lt(i)),i=Uu(i);return s}:Nm,tt=Sr;(Vu&&tt(new Vu(new ArrayBuffer(1)))!=lr||Eo&&tt(new Eo)!=Mr||Wu&&tt(Wu.resolve())!=br||ps&&tt(new ps)!=Ir||To&&tt(new To)!=ya)&&(tt=function(i){var s=Sr(i),u=s==si?i.constructor:e,h=u?an(u):"";if(h)switch(h){case cd:return lr;case Yp:return Mr;case Ji:return br;case Vl:return Ir;case ms:return ya}return s});function vt(i,s,u){for(var h=-1,p=u.length;++h<p;){var w=u[h],N=w.size;switch(w.type){case"drop":i+=N;break;case"dropRight":s-=N;break;case"take":s=wr(s,i+N);break;case"takeRight":i=$n(i,s-N);break}}return{start:i,end:s}}function yt(i){var s=i.match(Vi);return s?s[1].split(gu):[]}function It(i,s,u){s=di(s,i);for(var h=-1,p=s.length,w=!1;++h<p;){var N=mn(s[h]);if(!(w=i!=null&&u(i,N)))break;i=i[N]}return w||++h!=p?w:(p=i==null?0:i.length,!!p&&$d(p)&&z(N,p)&&(Pe(i)||Yf(i)))}function Rt(i){var s=i.length,u=new i.constructor(s);return s&&typeof i[0]=="string"&&un.call(i,"index")&&(u.index=i.index,u.input=i.input),u}function Ot(i){return typeof i.constructor=="function"&&!re(i)?bs(Uu(i)):{}}function kt(i,s,u){var h=i.constructor;switch(s){case rs:return Rs(i);case ln:case Dn:return new h(+i);case lr:return Uf(i,u);case is:case Ei:case as:case ao:case so:case oo:case hr:case kr:case ji:return zo(i,u);case Mr:return new h;case ba:case Ai:return new h(i);case Cr:return Gf(i);case Ir:return new h;case v:return $f(i)}}function wt(i,s){var u=s.length;if(!u)return i;var h=u-1;return s[h]=(u>1?"& ":"")+s[h],s=s.join(u>2?", ":" "),i.replace(fl,`{
/* [wrapped with `+s+`] */
`)}function Et(i){return Pe(i)||Yf(i)||!!(Gl&&i&&i[Gl])}function z(i,s){var u=typeof i;return s=s??Lt,!!s&&(u=="number"||u!="symbol"&&ml.test(i))&&i>-1&&i%1==0&&i<s}function J(i,s,u){if(!Hn(u))return!1;var h=typeof s;return(h=="number"?Jr(u)&&z(s,u.length):h=="string"&&s in u)?aa(u[s],i):!1}function xt(i,s){if(Pe(i))return!1;var u=typeof i;return u=="number"||u=="symbol"||u=="boolean"||i==null||gi(i)?!0:al.test(i)||!il.test(i)||s!=null&&i in pn(s)}function Yt(i){var s=typeof i;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?i!=="__proto__":i===null}function pt(i){var s=cc(i),u=b[s];if(typeof u!="function"||!(s in tn.prototype))return!1;if(i===u)return!0;var h=mh(u);return!!h&&i===h[0]}function Vt(i){return!!wf&&wf in i}var jt=zu?Ps:Dm;function re(i){var s=i&&i.constructor,u=typeof s=="function"&&s.prototype||xo;return i===u}function dt(i){return i===i&&!Hn(i)}function ht(i,s){return function(u){return u==null?!1:u[i]===s&&(s!==e||i in pn(u))}}function Zt(i){var s=Ud(i,function(h){return u.size===_&&u.clear(),h}),u=s.cache;return s}function Pt(i,s){var u=i[1],h=s[1],p=u|h,w=p<(Kt|Mt|be),N=h==be&&u==Xt||h==be&&u==sn&&i[7].length<=s[8]||h==(be|sn)&&s[7].length<=s[8]&&u==Xt;if(!(w||N))return i;h&Kt&&(i[2]=s[2],p|=u&Kt?0:ie);var k=s[3];if(k){var Z=i[3];i[3]=Z?Fa(Z,k,s[4]):k,i[4]=Z?Zi(i[3],m):s[4]}return k=s[5],k&&(Z=i[5],i[5]=Z?uh(Z,k,s[6]):k,i[6]=Z?Zi(i[5],m):s[6]),k=s[7],k&&(i[7]=k),h&be&&(i[8]=i[8]==null?s[8]:wr(i[8],s[8])),i[9]==null&&(i[9]=s[9]),i[0]=s[0],i[1]=p,i}function St(i){var s=[];if(i!=null)for(var u in pn(i))s.push(u);return s}function zt(i){return Rr.call(i)}function Ut(i,s,u){return s=$n(s===e?i.length-1:s,0),function(){for(var h=arguments,p=-1,w=$n(h.length-s,0),N=ut(w);++p<w;)N[p]=h[s+p];p=-1;for(var k=ut(s+1);++p<s;)k[p]=h[p];return k[s]=u(N),sr(i,this,k)}}function ge(i,s){return s.length<2?i:Ra(i,Zr(s,0,-1))}function _e(i,s){for(var u=i.length,h=wr(s.length,u),p=Ar(i);h--;){var w=s[h];i[h]=z(w,u)?p[w]:e}return i}function Gt(i,s){if(!(s==="constructor"&&typeof i[s]=="function")&&s!="__proto__")return i[s]}var Wt=En(Id),ue=jp||function(i,s){return Le.setTimeout(i,s)},me=En(Od);function Ee(i,s,u){var h=s+"";return me(i,wt(h,jn(yt(h),u)))}function En(i){var s=0,u=0;return function(){var h=Ia(),p=Dt-(h-u);if(u=h,p>0){if(++s>=Bt)return arguments[0]}else s=0;return i.apply(e,arguments)}}function vn(i,s){var u=-1,h=i.length,p=h-1;for(s=s===e?h:s;++u<s;){var w=tc(u,p),N=i[w];i[w]=i[u],i[u]=N}return i.length=s,i}var Oe=Zt(function(i){var s=[];return i.charCodeAt(0)===46&&s.push(""),i.replace(oi,function(u,h,p,w){s.push(p?w.replace(cl,"$1"):h||u)}),s});function mn(i){if(typeof i=="string"||gi(i))return i;var s=i+"";return s=="0"&&1/i==-bt?"-0":s}function an(i){if(i!=null){try{return vf.call(i)}catch{}try{return i+""}catch{}}return""}function jn(i,s){return _r(Ze,function(u){var h="_."+u[0];s&u[1]&&!Mu(i,h)&&i.push(h)}),i.sort()}function Vn(i){if(i instanceof tn)return i.clone();var s=new Xr(i.__wrapped__,i.__chain__);return s.__actions__=Ar(i.__actions__),s.__index__=i.__index__,s.__values__=i.__values__,s}function Yn(i,s,u){(u?J(i,s,u):s===e)?s=1:s=$n(He(s),0);var h=i==null?0:i.length;if(!h||s<1)return[];for(var p=0,w=0,N=ut(Gu(h/s));p<h;)N[w++]=Zr(i,p,p+=s);return N}function er(i){for(var s=-1,u=i==null?0:i.length,h=0,p=[];++s<u;){var w=i[s];w&&(p[h++]=w)}return p}function fr(){var i=arguments.length;if(!i)return[];for(var s=ut(i-1),u=arguments[0],h=i;h--;)s[h-1]=arguments[h];return Xi(Pe(u)?Ar(u):[u],or(s,1))}var zn=Ye(function(i,s){return nr(i)?Ss(i,or(s,1,nr,!0)):[]}),we=Ye(function(i,s){var u=M(s);return nr(u)&&(u=e),nr(i)?Ss(i,or(s,1,nr,!0),ve(u,2)):[]}),ur=Ye(function(i,s){var u=M(s);return nr(u)&&(u=e),nr(i)?Ss(i,or(s,1,nr,!0),e,u):[]});function en(i,s,u){var h=i==null?0:i.length;return h?(s=u||s===e?1:He(s),Zr(i,s<0?0:s,h)):[]}function ce(i,s,u){var h=i==null?0:i.length;return h?(s=u||s===e?1:He(s),s=h-s,Zr(i,0,s<0?0:s)):[]}function Be(i,s){return i&&i.length?Bs(i,ve(s,3),!0,!0):[]}function je(i,s){return i&&i.length?Bs(i,ve(s,3),!0):[]}function Un(i,s,u,h){var p=i==null?0:i.length;return p?(u&&typeof u!="number"&&J(i,s,u)&&(u=0,h=p),bd(i,s,u,h)):[]}function mi(i,s,u){var h=i==null?0:i.length;if(!h)return-1;var p=u==null?0:He(u);return p<0&&(p=$n(h+p,0)),go(i,ve(s,3),p)}function ka(i,s,u){var h=i==null?0:i.length;if(!h)return-1;var p=h-1;return u!==e&&(p=He(u),p=u<0?$n(h+p,0):wr(p,h-1)),go(i,ve(s,3),p,!0)}function T(i){var s=i==null?0:i.length;return s?or(i,1):[]}function nt(i){var s=i==null?0:i.length;return s?or(i,bt):[]}function q(i,s){var u=i==null?0:i.length;return u?(s=s===e?1:He(s),or(i,s)):[]}function qt(i){for(var s=-1,u=i==null?0:i.length,h={};++s<u;){var p=i[s];h[p[0]]=p[1]}return h}function Ae(i){return i&&i.length?i[0]:e}function x(i,s,u){var h=i==null?0:i.length;if(!h)return-1;var p=u==null?0:He(u);return p<0&&(p=$n(h+p,0)),qi(i,s,p)}function g(i){var s=i==null?0:i.length;return s?Zr(i,0,-1):[]}var L=Ye(function(i){var s=Cn(i,ko);return s.length&&s[0]===i[0]?Nf(s):[]}),U=Ye(function(i){var s=M(i),u=Cn(i,ko);return s===M(u)?s=e:u.pop(),u.length&&u[0]===i[0]?Nf(u,ve(s,2)):[]}),j=Ye(function(i){var s=M(i),u=Cn(i,ko);return s=typeof s=="function"?s:e,s&&u.pop(),u.length&&u[0]===i[0]?Nf(u,e,s):[]});function D(i,s){return i==null?"":fd.call(i,s)}function M(i){var s=i==null?0:i.length;return s?i[s-1]:e}function P(i,s,u){var h=i==null?0:i.length;if(!h)return-1;var p=h;return u!==e&&(p=He(u),p=p<0?$n(h+p,0):wr(p,h-1)),s===s?kl(i,s,p):go(i,Nu,p,!0)}function S(i,s){return i&&i.length?No(i,He(s)):e}var I=Ye(E);function E(i,s){return i&&i.length&&s&&s.length?ih(i,s):i}function X(i,s,u){return i&&i.length&&s&&s.length?ih(i,s,ve(u,2)):i}function V(i,s,u){return i&&i.length&&s&&s.length?ih(i,s,e,u):i}var ct=Mi(function(i,s){var u=i==null?0:i.length,h=Ba(i,s);return Ed(i,Cn(s,function(p){return z(p,u)?+p:p}).sort(ac)),h});function _t(i,s){var u=[];if(!(i&&i.length))return u;var h=-1,p=[],w=i.length;for(s=ve(s,3);++h<w;){var N=i[h];s(N,h,i)&&(u.push(N),p.push(h))}return Ed(i,p),u}function Nt(i){return i==null?i:ud.call(i)}function he(i,s,u){var h=i==null?0:i.length;return h?(u&&typeof u!="number"&&J(i,s,u)?(s=0,u=h):(s=s==null?0:He(s),u=u===e?h:He(u)),Zr(i,s,u)):[]}function oe(i,s){return nc(i,s)}function Ht(i,s,u){return sh(i,s,ve(u,2))}function mt(i,s){var u=i==null?0:i.length;if(u){var h=nc(i,s);if(h<u&&aa(i[h],s))return h}return-1}function ot(i,s){return nc(i,s,!0)}function te(i,s,u){return sh(i,s,ve(u,2),!0)}function Qt(i,s){var u=i==null?0:i.length;if(u){var h=nc(i,s,!0)-1;if(aa(i[h],s))return h}return-1}function le(i){return i&&i.length?Bd(i):[]}function nn(i,s){return i&&i.length?Bd(i,ve(s,2)):[]}function cr(i){var s=i==null?0:i.length;return s?Zr(i,1,s):[]}function Fs(i,s,u){return i&&i.length?(s=u||s===e?1:He(s),Zr(i,0,s<0?0:s)):[]}function ia(i,s,u){var h=i==null?0:i.length;return h?(s=u||s===e?1:He(s),s=h-s,Zr(i,s<0?0:s,h)):[]}function Li(i,s){return i&&i.length?Bs(i,ve(s,3),!1,!0):[]}function Pa(i,s){return i&&i.length?Bs(i,ve(s,3)):[]}var Cs=Ye(function(i){return Da(or(i,1,nr,!0))}),Fd=Ye(function(i){var s=M(i);return nr(s)&&(s=e),Da(or(i,1,nr,!0),ve(s,2))}),Gr=Ye(function(i){var s=M(i);return s=typeof s=="function"?s:e,Da(or(i,1,nr,!0),e,s)});function ks(i){return i&&i.length?Da(i):[]}function Kr(i,s){return i&&i.length?Da(i,ve(s,2)):[]}function Cd(i,s){return s=typeof s=="function"?s:e,i&&i.length?Da(i,e,s):[]}function Er(i){if(!(i&&i.length))return[];var s=0;return i=Oi(i,function(u){if(nr(u))return s=$n(u.length,s),!0}),Ml(s,function(u){return Cn(i,hs(u))})}function Wf(i,s){if(!(i&&i.length))return[];var u=Er(i);return s==null?u:Cn(u,function(h){return sr(s,e,h)})}var lc=Ye(function(i,s){return nr(i)?Ss(i,s):[]}),ix=Ye(function(i){return Co(Oi(i,nr))}),ax=Ye(function(i){var s=M(i);return nr(s)&&(s=e),Co(Oi(i,nr),ve(s,2))}),sx=Ye(function(i){var s=M(i);return s=typeof s=="function"?s:e,Co(Oi(i,nr),e,s)}),ox=Ye(Er);function fx(i,s){return ic(i||[],s||[],Of)}function ux(i,s){return ic(i||[],s||[],Cf)}var cx=Ye(function(i){var s=i.length,u=s>1?i[s-1]:e;return u=typeof u=="function"?(i.pop(),u):e,Wf(i,u)});function Mg(i){var s=b(i);return s.__chain__=!0,s}function lx(i,s){return s(i),i}function kd(i,s){return s(i)}var hx=Mi(function(i){var s=i.length,u=s?i[0]:0,h=this.__wrapped__,p=function(w){return Ba(w,i)};return s>1||this.__actions__.length||!(h instanceof tn)||!z(u)?this.thru(p):(h=h.slice(u,+u+(s?1:0)),h.__actions__.push({func:kd,args:[p],thisArg:e}),new Xr(h,this.__chain__).thru(function(w){return s&&!w.length&&w.push(e),w}))});function dx(){return Mg(this)}function _x(){return new Xr(this.value(),this.__chain__)}function px(){this.__values__===e&&(this.__values__=Wg(this.value()));var i=this.__index__>=this.__values__.length,s=i?e:this.__values__[this.__index__++];return{done:i,value:s}}function mx(){return this}function gx(i){for(var s,u=this;u instanceof If;){var h=Vn(u);h.__index__=0,h.__values__=e,s?p.__wrapped__=h:s=h;var p=h;u=u.__wrapped__}return p.__wrapped__=i,s}function bx(){var i=this.__wrapped__;if(i instanceof tn){var s=i;return this.__actions__.length&&(s=new tn(this)),s=s.reverse(),s.__actions__.push({func:kd,args:[Nt],thisArg:e}),new Xr(s,this.__chain__)}return this.thru(Nt)}function yx(){return kf(this.__wrapped__,this.__actions__)}var vx=pi(function(i,s,u){un.call(i,u)?++i[u]:Lr(i,u,1)});function wx(i,s,u){var h=Pe(i)?Sa:ql;return u&&J(i,s,u)&&(s=e),h(i,ve(s,3))}function xx(i,s){var u=Pe(i)?Oi:Zl;return u(i,ve(s,3))}var Sx=Ls(mi),Ax=Ls(ka);function Ex(i,s){return or(Pd(i,s),1)}function Tx(i,s){return or(Pd(i,s),bt)}function Ix(i,s,u){return u=u===e?1:He(u),or(Pd(i,s),u)}function Lg(i,s){var u=Pe(i)?_r:Bi;return u(i,ve(s,3))}function Ng(i,s){var u=Pe(i)?Qh:qu;return u(i,ve(s,3))}var Ox=pi(function(i,s,u){un.call(i,u)?i[u].push(s):Lr(i,u,[s])});function Bx(i,s,u,h){i=Jr(i)?i:dc(i),u=u&&!h?He(u):0;var p=i.length;return u<0&&(u=$n(p+u,0)),jd(i)?u<=p&&i.indexOf(s,u)>-1:!!p&&qi(i,s,u)>-1}var Rx=Ye(function(i,s,u){var h=-1,p=typeof s=="function",w=Jr(i)?ut(i.length):[];return Bi(i,function(N){w[++h]=p?sr(s,N,u):Es(N,s,u)}),w}),Mx=pi(function(i,s,u){Lr(i,u,s)});function Pd(i,s){var u=Pe(i)?Cn:Ma;return u(i,ve(s,3))}function Lx(i,s,u,h){return i==null?[]:(Pe(s)||(s=s==null?[]:[s]),u=h?e:u,Pe(u)||(u=u==null?[]:[u]),Qu(i,s,u))}var Nx=pi(function(i,s,u){i[u?0:1].push(s)},function(){return[[],[]]});function Dx(i,s,u){var h=Pe(i)?Ol:Bl,p=arguments.length<3;return h(i,ve(s,4),u,p,Bi)}function Fx(i,s,u){var h=Pe(i)?Mp:Bl,p=arguments.length<3;return h(i,ve(s,4),u,p,qu)}function Cx(i,s){var u=Pe(i)?Oi:Zl;return u(i,Gd(ve(s,3)))}function kx(i){var s=Pe(i)?md:Fo;return s(i)}function Px(i,s,u){(u?J(i,s,u):s===e)?s=1:s=He(s);var h=Pe(i)?um:ah;return h(i,s)}function zx(i){var s=Pe(i)?cm:dm;return s(i)}function Ux(i){if(i==null)return 0;if(Jr(i))return jd(i)?Ea(i):i.length;var s=tt(i);return s==Mr||s==Ir?i.size:ea(i).length}function Gx(i,s,u){var h=Pe(i)?Lu:_m;return u&&J(i,s,u)&&(s=e),h(i,ve(s,3))}var $x=Ye(function(i,s){if(i==null)return[];var u=s.length;return u>1&&J(i,s[0],s[1])?s=[]:u>2&&J(s[0],s[1],s[2])&&(s=[s[0]]),Qu(i,or(s,1),[])}),zd=$p||function(){return Le.Date.now()};function jx(i,s){if(typeof s!="function")throw new Hr(f);return i=He(i),function(){if(--i<1)return s.apply(this,arguments)}}function Dg(i,s,u){return s=u?e:s,s=i&&s==null?i.length:s,ra(i,be,e,e,e,e,s)}function Fg(i,s){var u;if(typeof s!="function")throw new Hr(f);return i=He(i),function(){return--i>0&&(u=s.apply(this,arguments)),i<=1&&(s=e),u}}var xm=Ye(function(i,s,u){var h=Kt;if(u.length){var p=Zi(u,Ds(xm));h|=Ct}return ra(i,h,s,u,p)}),Cg=Ye(function(i,s,u){var h=Kt|Mt;if(u.length){var p=Zi(u,Ds(Cg));h|=Ct}return ra(s,h,i,u,p)});function kg(i,s,u){s=u?e:s;var h=ra(i,Xt,e,e,e,e,e,s);return h.placeholder=kg.placeholder,h}function Pg(i,s,u){s=u?e:s;var h=ra(i,it,e,e,e,e,e,s);return h.placeholder=Pg.placeholder,h}function zg(i,s,u){var h,p,w,N,k,Z,At=0,Tt=!1,Ft=!1,ne=!0;if(typeof i!="function")throw new Hr(f);s=Ni(s)||0,Hn(u)&&(Tt=!!u.leading,Ft="maxWait"in u,w=Ft?$n(Ni(u.maxWait)||0,s):w,ne="trailing"in u?!!u.trailing:ne);function pe(rr){var sa=h,Us=p;return h=p=e,At=rr,N=i.apply(Us,sa),N}function xe(rr){return At=rr,k=ue(rn,s),Tt?pe(rr):N}function Je(rr){var sa=rr-Z,Us=rr-At,ib=s-sa;return Ft?wr(ib,w-Us):ib}function Se(rr){var sa=rr-Z,Us=rr-At;return Z===e||sa>=s||sa<0||Ft&&Us>=w}function rn(){var rr=zd();if(Se(rr))return cn(rr);k=ue(rn,Je(rr))}function cn(rr){return k=e,ne&&h?pe(rr):(h=p=e,N)}function bi(){k!==e&&Pf(k),At=0,h=Z=p=k=e}function $r(){return k===e?N:cn(zd())}function yi(){var rr=zd(),sa=Se(rr);if(h=arguments,p=this,Z=rr,sa){if(k===e)return xe(Z);if(Ft)return Pf(k),k=ue(rn,s),pe(Z)}return k===e&&(k=ue(rn,s)),N}return yi.cancel=bi,yi.flush=$r,yi}var Vx=Ye(function(i,s){return Xu(i,1,s)}),Wx=Ye(function(i,s,u){return Xu(i,Ni(s)||0,u)});function Yx(i){return ra(i,st)}function Ud(i,s){if(typeof i!="function"||s!=null&&typeof s!="function")throw new Hr(f);var u=function(){var h=arguments,p=s?s.apply(this,h):h[0],w=u.cache;if(w.has(p))return w.get(p);var N=i.apply(this,h);return u.cache=w.set(p,N)||w,N};return u.cache=new(Ud.Cache||Qi),u}Ud.Cache=Qi;function Gd(i){if(typeof i!="function")throw new Hr(f);return function(){var s=arguments;switch(s.length){case 0:return!i.call(this);case 1:return!i.call(this,s[0]);case 2:return!i.call(this,s[0],s[1]);case 3:return!i.call(this,s[0],s[1],s[2])}return!i.apply(this,s)}}function Hx(i){return Fg(2,i)}var Xx=fh(function(i,s){s=s.length==1&&Pe(s[0])?Cn(s[0],zr(ve())):Cn(or(s,1),zr(ve()));var u=s.length;return Ye(function(h){for(var p=-1,w=wr(h.length,u);++p<w;)h[p]=s[p].call(this,h[p]);return sr(i,this,h)})}),Sm=Ye(function(i,s){var u=Zi(s,Ds(Sm));return ra(i,Ct,e,s,u)}),Ug=Ye(function(i,s){var u=Zi(s,Ds(Ug));return ra(i,fe,e,s,u)}),qx=Mi(function(i,s){return ra(i,sn,e,e,e,s)});function Zx(i,s){if(typeof i!="function")throw new Hr(f);return s=s===e?s:He(s),Ye(i,s)}function Kx(i,s){if(typeof i!="function")throw new Hr(f);return s=s==null?0:$n(He(s),0),Ye(function(u){var h=u[s],p=_i(u,0,s);return h&&Xi(p,h),sr(i,this,p)})}function Jx(i,s,u){var h=!0,p=!0;if(typeof i!="function")throw new Hr(f);return Hn(u)&&(h="leading"in u?!!u.leading:h,p="trailing"in u?!!u.trailing:p),zg(i,s,{leading:h,maxWait:s,trailing:p})}function Qx(i){return Dg(i,1)}function t3(i,s){return Sm(Po(s),i)}function e3(){if(!arguments.length)return[];var i=arguments[0];return Pe(i)?i:[i]}function n3(i){return pr(i,C)}function r3(i,s){return s=typeof s=="function"?s:e,pr(i,C,s)}function i3(i){return pr(i,A|C)}function a3(i,s){return s=typeof s=="function"?s:e,pr(i,A|C,s)}function s3(i,s){return s==null||xs(i,s,Tr(s))}function aa(i,s){return i===s||i!==i&&s!==s}var o3=mr(Lf),f3=mr(function(i,s){return i>=s}),Yf=th(function(){return arguments}())?th:function(i){return Zn(i)&&un.call(i,"callee")&&!tr.call(i,"callee")},Pe=ut.isArray,u3=po?zr(po):xd;function Jr(i){return i!=null&&$d(i.length)&&!Ps(i)}function nr(i){return Zn(i)&&Jr(i)}function c3(i){return i===!0||i===!1||Zn(i)&&Sr(i)==ln}var Go=Vp||Dm,l3=Pr?zr(Pr):eh;function h3(i){return Zn(i)&&i.nodeType===1&&!gh(i)}function d3(i){if(i==null)return!0;if(Jr(i)&&(Pe(i)||typeof i=="string"||typeof i.splice=="function"||Go(i)||hc(i)||Yf(i)))return!i.length;var s=tt(i);if(s==Mr||s==Ir)return!i.size;if(re(i))return!ea(i).length;for(var u in i)if(un.call(i,u))return!1;return!0}function _3(i,s){return Ro(i,s)}function p3(i,s,u){u=typeof u=="function"?u:e;var h=u?u(i,s):e;return h===e?Ro(i,s,e,u):!!h}function Am(i){if(!Zn(i))return!1;var s=Sr(i);return s==Kn||s==ir||typeof i.message=="string"&&typeof i.name=="string"&&!gh(i)}function m3(i){return typeof i=="number"&&$l(i)}function Ps(i){if(!Hn(i))return!1;var s=Sr(i);return s==Yr||s==Qo||s==Nn||s==du}function Gg(i){return typeof i=="number"&&i==He(i)}function $d(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=Lt}function Hn(i){var s=typeof i;return i!=null&&(s=="object"||s=="function")}function Zn(i){return i!=null&&typeof i=="object"}var $g=mf?zr(mf):nh;function g3(i,s){return i===s||Df(i,s,y(s))}function b3(i,s,u){return u=typeof u=="function"?u:e,Df(i,s,y(s),u)}function y3(i){return jg(i)&&i!=+i}function v3(i){if(jt(i))throw new Ie(o);return Mo(i)}function w3(i){return i===null}function x3(i){return i==null}function jg(i){return typeof i=="number"||Zn(i)&&Sr(i)==ba}function gh(i){if(!Zn(i)||Sr(i)!=si)return!1;var s=Uu(i);if(s===null)return!0;var u=un.call(s,"constructor")&&s.constructor;return typeof u=="function"&&u instanceof u&&vf.call(u)==So}var Em=Zh?zr(Zh):Ad;function S3(i){return Gg(i)&&i>=-Lt&&i<=Lt}var Vg=mo?zr(mo):Ku;function jd(i){return typeof i=="string"||!Pe(i)&&Zn(i)&&Sr(i)==Ai}function gi(i){return typeof i=="symbol"||Zn(i)&&Sr(i)==v}var hc=Kh?zr(Kh):ta;function A3(i){return i===e}function E3(i){return Zn(i)&&tt(i)==ya}function T3(i){return Zn(i)&&Sr(i)==Qc}var I3=mr(Ts),O3=mr(function(i,s){return i<=s});function Wg(i){if(!i)return[];if(Jr(i))return jd(i)?Br(i):Ar(i);if(ci&&i[ci])return rd(i[ci]());var s=tt(i),u=s==Mr?ku:s==Ir?yf:dc;return u(i)}function zs(i){if(!i)return i===0?i:0;if(i=Ni(i),i===bt||i===-bt){var s=i<0?-1:1;return s*Jt}return i===i?i:0}function He(i){var s=zs(i),u=s%1;return s===s?u?s-u:s:0}function Yg(i){return i?ws(He(i),0,de):0}function Ni(i){if(typeof i=="number")return i;if(gi(i))return ee;if(Hn(i)){var s=typeof i.valueOf=="function"?i.valueOf():i;i=Hn(s)?s+"":s}if(typeof i!="string")return i===0?i:+i;i=ed(i);var u=dl.test(i);return u||pl.test(i)?ae(i.slice(2),u?2:8):hl.test(i)?ee:+i}function Hg(i){return Ri(i,Qr(i))}function B3(i){return i?ws(He(i),-Lt,Lt):i===0?i:0}function wn(i){return i==null?"":Ur(i)}var R3=Ms(function(i,s){if(re(s)||Jr(s)){Ri(s,Tr(s),i);return}for(var u in s)un.call(s,u)&&Of(i,u,s[u])}),Xg=Ms(function(i,s){Ri(s,Qr(s),i)}),Vd=Ms(function(i,s,u,h){Ri(s,Qr(s),i,h)}),M3=Ms(function(i,s,u,h){Ri(s,Tr(s),i,h)}),L3=Mi(Ba);function N3(i,s){var u=bs(i);return s==null?u:Bf(u,s)}var D3=Ye(function(i,s){i=pn(i);var u=-1,h=s.length,p=h>2?s[2]:e;for(p&&J(s[0],s[1],p)&&(h=1);++u<h;)for(var w=s[u],N=Qr(w),k=-1,Z=N.length;++k<Z;){var At=N[k],Tt=i[At];(Tt===e||aa(Tt,xo[At])&&!un.call(i,At))&&(i[At]=w[At])}return i}),F3=Ye(function(i){return i.push(e,Nd),sr(qg,e,i)});function C3(i,s){return ui(i,ve(s,3),qr)}function k3(i,s){return ui(i,ve(s,3),Rf)}function P3(i,s){return i==null?i:Zu(i,ve(s,3),Qr)}function z3(i,s){return i==null?i:Kl(i,ve(s,3),Qr)}function U3(i,s){return i&&qr(i,ve(s,3))}function G3(i,s){return i&&Rf(i,ve(s,3))}function $3(i){return i==null?[]:Mf(i,Tr(i))}function j3(i){return i==null?[]:Mf(i,Qr(i))}function Tm(i,s,u){var h=i==null?e:Ra(i,s);return h===e?u:h}function V3(i,s){return i!=null&&It(i,s,yd)}function Im(i,s){return i!=null&&It(i,s,vd)}var W3=sc(function(i,s,u){s!=null&&typeof s.toString!="function"&&(s=Rr.call(s)),i[s]=u},Bm(ti)),Y3=sc(function(i,s,u){s!=null&&typeof s.toString!="function"&&(s=Rr.call(s)),un.call(i,s)?i[s].push(u):i[s]=[u]},ve),H3=Ye(Es);function Tr(i){return Jr(i)?Hl(i):ea(i)}function Qr(i){return Jr(i)?Hl(i,!0):Ff(i)}function X3(i,s){var u={};return s=ve(s,3),qr(i,function(h,p,w){Lr(u,s(h,p,w),h)}),u}function q3(i,s){var u={};return s=ve(s,3),qr(i,function(h,p,w){Lr(u,p,s(h,p,w))}),u}var Z3=Ms(function(i,s,u){Is(i,s,u)}),qg=Ms(function(i,s,u,h){Is(i,s,u,h)}),K3=Mi(function(i,s){var u={};if(i==null)return u;var h=!1;s=Cn(s,function(w){return w=di(w,i),h||(h=w.length>1),w}),Ri(i,uc(i),u),h&&(u=pr(u,A|R|C,ym));for(var p=s.length;p--;)oh(u,s[p]);return u});function J3(i,s){return Zg(i,Gd(ve(s)))}var Q3=Mi(function(i,s){return i==null?{}:rh(i,s)});function Zg(i,s){if(i==null)return{};var u=Cn(uc(i),function(h){return[h]});return s=ve(s),Os(i,u,function(h,p){return s(h,p[0])})}function tS(i,s,u){s=di(s,i);var h=-1,p=s.length;for(p||(p=1,i=e);++h<p;){var w=i==null?e:i[mn(s[h])];w===e&&(h=p,w=u),i=Ps(w)?w.call(i):w}return i}function eS(i,s,u){return i==null?i:Cf(i,s,u)}function nS(i,s,u,h){return h=typeof h=="function"?h:e,i==null?i:Cf(i,s,u,h)}var Kg=Ld(Tr),Jg=Ld(Qr);function rS(i,s,u){var h=Pe(i),p=h||Go(i)||hc(i);if(s=ve(s,4),u==null){var w=i&&i.constructor;p?u=h?new w:[]:Hn(i)?u=Ps(w)?bs(Uu(i)):{}:u={}}return(p?_r:qr)(i,function(N,k,Z){return s(u,N,k,Z)}),u}function iS(i,s){return i==null?!0:oh(i,s)}function aS(i,s,u){return i==null?i:rc(i,s,Po(u))}function sS(i,s,u,h){return h=typeof h=="function"?h:e,i==null?i:rc(i,s,Po(u),h)}function dc(i){return i==null?[]:bf(i,Tr(i))}function oS(i){return i==null?[]:bf(i,Qr(i))}function fS(i,s,u){return u===e&&(u=s,s=e),u!==e&&(u=Ni(u),u=u===u?u:0),s!==e&&(s=Ni(s),s=s===s?s:0),ws(Ni(i),s,u)}function uS(i,s,u){return s=zs(s),u===e?(u=s,s=0):u=zs(u),i=Ni(i),Ql(i,s,u)}function cS(i,s,u){if(u&&typeof u!="boolean"&&J(i,s,u)&&(s=u=e),u===e&&(typeof s=="boolean"?(u=s,s=e):typeof i=="boolean"&&(u=i,i=e)),i===e&&s===e?(i=0,s=1):(i=zs(i),s===e?(s=i,i=0):s=zs(s)),i>s){var h=i;i=s,s=h}if(u||i%1||s%1){var p=jl();return wr(i+p*(s-i+at("1e-"+((p+"").length-1))),s)}return tc(i,s)}var lS=Uo(function(i,s,u){return s=s.toLowerCase(),i+(u?Qg(s):s)});function Qg(i){return Om(wn(i).toLowerCase())}function tb(i){return i=wn(i),i&&i.replace(gl,Ll).replace(Bu,"")}function hS(i,s,u){i=wn(i),s=Ur(s);var h=i.length;u=u===e?h:ws(He(u),0,h);var p=u;return u-=s.length,u>=0&&i.slice(u,p)==s}function dS(i){return i=wn(i),i&&Ti.test(i)?i.replace(va,Nl):i}function _S(i){return i=wn(i),i&&sl.test(i)?i.replace(ef,"\\$&"):i}var pS=Uo(function(i,s,u){return i+(u?"-":"")+s.toLowerCase()}),mS=Uo(function(i,s,u){return i+(u?" ":"")+s.toLowerCase()}),gS=hh("toLowerCase");function bS(i,s,u){i=wn(i),s=He(s);var h=s?Ea(i):0;if(!s||h>=s)return i;var p=(s-h)/2;return kn(Ao(p),u)+i+kn(Gu(p),u)}function yS(i,s,u){i=wn(i),s=He(s);var h=s?Ea(i):0;return s&&h<s?i+kn(s-h,u):i}function vS(i,s,u){i=wn(i),s=He(s);var h=s?Ea(i):0;return s&&h<s?kn(s-h,u)+i:i}function wS(i,s,u){return u||s==null?s=0:s&&(s=+s),ju(wn(i).replace(nf,""),s||0)}function xS(i,s,u){return(u?J(i,s,u):s===e)?s=1:s=He(s),ec(wn(i),s)}function SS(){var i=arguments,s=wn(i[0]);return i.length<3?s:s.replace(i[1],i[2])}var AS=Uo(function(i,s,u){return i+(u?"_":"")+s.toLowerCase()});function ES(i,s,u){return u&&typeof u!="number"&&J(i,s,u)&&(s=u=e),u=u===e?de:u>>>0,u?(i=wn(i),i&&(typeof s=="string"||s!=null&&!Em(s))&&(s=Ur(s),!s&&ds(i))?_i(Br(i),0,u):i.split(s,u)):[]}var TS=Uo(function(i,s,u){return i+(u?" ":"")+Om(s)});function IS(i,s,u){return i=wn(i),u=u==null?0:ws(He(u),0,i.length),s=Ur(s),i.slice(u,u+s.length)==s}function OS(i,s,u){var h=b.templateSettings;u&&J(i,s,u)&&(s=e),i=wn(i),s=Vd({},s,h,ph);var p=Vd({},s.imports,h.imports,ph),w=Tr(p),N=bf(p,w),k,Z,At=0,Tt=s.interpolate||wa,Ft="__p += '",ne=zl((s.escape||wa).source+"|"+Tt.source+"|"+(Tt===yr?ll:wa).source+"|"+(s.evaluate||wa).source+"|$","g"),pe="//# sourceURL="+(un.call(s,"sourceURL")?(s.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++cs+"]")+`
`;i.replace(ne,function(Se,rn,cn,bi,$r,yi){return cn||(cn=bi),Ft+=i.slice(At,yi).replace(bl,Dl),rn&&(k=!0,Ft+=`' +
__e(`+rn+`) +
'`),$r&&(Z=!0,Ft+=`';
`+$r+`;
__p += '`),cn&&(Ft+=`' +
((__t = (`+cn+`)) == null ? '' : __t) +
'`),At=yi+Se.length,Se}),Ft+=`';
`;var xe=un.call(s,"variable")&&s.variable;if(!xe)Ft=`with (obj) {
`+Ft+`
}
`;else if(ul.test(xe))throw new Ie(c);Ft=(Z?Ft.replace(tl,""):Ft).replace(pu,"$1").replace(el,"$1;"),Ft="function("+(xe||"obj")+`) {
`+(xe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(k?", __e = _.escape":"")+(Z?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Ft+`return __p
}`;var Je=nb(function(){return fn(w,pe+"return "+Ft).apply(e,N)});if(Je.source=Ft,Am(Je))throw Je;return Je}function BS(i){return wn(i).toLowerCase()}function RS(i){return wn(i).toUpperCase()}function MS(i,s,u){if(i=wn(i),i&&(u||s===e))return ed(i);if(!i||!(s=Ur(s)))return i;var h=Br(i),p=Br(s),w=Fu(h,p),N=Cu(h,p)+1;return _i(h,w,N).join("")}function LS(i,s,u){if(i=wn(i),i&&(u||s===e))return i.slice(0,ad(i)+1);if(!i||!(s=Ur(s)))return i;var h=Br(i),p=Cu(h,Br(s))+1;return _i(h,0,p).join("")}function NS(i,s,u){if(i=wn(i),i&&(u||s===e))return i.replace(nf,"");if(!i||!(s=Ur(s)))return i;var h=Br(i),p=Fu(h,Br(s));return _i(h,p).join("")}function DS(i,s){var u=Y,h=rt;if(Hn(s)){var p="separator"in s?s.separator:p;u="length"in s?He(s.length):u,h="omission"in s?Ur(s.omission):h}i=wn(i);var w=i.length;if(ds(i)){var N=Br(i);w=N.length}if(u>=w)return i;var k=u-Ea(h);if(k<1)return h;var Z=N?_i(N,0,k).join(""):i.slice(0,k);if(p===e)return Z+h;if(N&&(k+=Z.length-k),Em(p)){if(i.slice(k).search(p)){var At,Tt=Z;for(p.global||(p=zl(p.source,wn(Wi.exec(p))+"g")),p.lastIndex=0;At=p.exec(Tt);)var Ft=At.index;Z=Z.slice(0,Ft===e?k:Ft)}}else if(i.indexOf(Ur(p),k)!=k){var ne=Z.lastIndexOf(p);ne>-1&&(Z=Z.slice(0,ne))}return Z+h}function FS(i){return i=wn(i),i&&mu.test(i)?i.replace(tf,Dp):i}var CS=Uo(function(i,s,u){return i+(u?" ":"")+s.toUpperCase()}),Om=hh("toUpperCase");function eb(i,s,u){return i=wn(i),s=u?e:s,s===e?nd(i)?Cp(i):Lp(i):i.match(s)||[]}var nb=Ye(function(i,s){try{return sr(i,e,s)}catch(u){return Am(u)?u:new Ie(u)}}),kS=Mi(function(i,s){return _r(s,function(u){u=mn(u),Lr(i,u,xm(i[u],i))}),i});function PS(i){var s=i==null?0:i.length,u=ve();return i=s?Cn(i,function(h){if(typeof h[1]!="function")throw new Hr(f);return[u(h[0]),h[1]]}):[],Ye(function(h){for(var p=-1;++p<s;){var w=i[p];if(sr(w[0],this,h))return sr(w[1],this,h)}})}function zS(i){return gd(pr(i,A))}function Bm(i){return function(){return i}}function US(i,s){return i==null||i!==i?s:i}var GS=na(),$S=na(!0);function ti(i){return i}function Rm(i){return Lo(typeof i=="function"?i:pr(i,A))}function jS(i){return La(pr(i,A))}function VS(i,s){return Na(i,pr(s,A))}var WS=Ye(function(i,s){return function(u){return Es(u,i,s)}}),YS=Ye(function(i,s){return function(u){return Es(i,u,s)}});function Mm(i,s,u){var h=Tr(s),p=Mf(s,h);u==null&&!(Hn(s)&&(p.length||!h.length))&&(u=s,s=i,i=this,p=Mf(s,Tr(s)));var w=!(Hn(u)&&"chain"in u)||!!u.chain,N=Ps(i);return _r(p,function(k){var Z=s[k];i[k]=Z,N&&(i.prototype[k]=function(){var At=this.__chain__;if(w||At){var Tt=i(this.__wrapped__),Ft=Tt.__actions__=Ar(this.__actions__);return Ft.push({func:Z,args:arguments,thisArg:i}),Tt.__chain__=At,Tt}return Z.apply(i,Xi([this.value()],arguments))})}),i}function HS(){return Le._===this&&(Le._=sd),this}function Lm(){}function XS(i){return i=He(i),Ye(function(s){return No(s,i)})}var qS=oc(Cn),ZS=oc(Sa),KS=oc(Lu);function rb(i){return xt(i)?hs(mn(i)):Do(i)}function JS(i){return function(s){return i==null?e:Ra(i,s)}}var QS=Pn(),t6=Pn(!0);function Nm(){return[]}function Dm(){return!1}function e6(){return{}}function n6(){return""}function r6(){return!0}function i6(i,s){if(i=He(i),i<1||i>Lt)return[];var u=de,h=wr(i,de);s=ve(s),i-=de;for(var p=Ml(h,s);++u<i;)s(u);return p}function a6(i){return Pe(i)?Cn(i,mn):gi(i)?[i]:Ar(Oe(wn(i)))}function s6(i){var s=++Up;return wn(i)+s}var o6=Ns(function(i,s){return i+s},0),f6=_h("ceil"),u6=Ns(function(i,s){return i/s},1),c6=_h("floor");function l6(i){return i&&i.length?As(i,ti,Lf):e}function h6(i,s){return i&&i.length?As(i,ve(s,2),Lf):e}function d6(i){return gf(i,ti)}function _6(i,s){return gf(i,ve(s,2))}function p6(i){return i&&i.length?As(i,ti,Ts):e}function m6(i,s){return i&&i.length?As(i,ve(s,2),Ts):e}var g6=Ns(function(i,s){return i*s},1),b6=_h("round"),y6=Ns(function(i,s){return i-s},0);function v6(i){return i&&i.length?Du(i,ti):0}function w6(i,s){return i&&i.length?Du(i,ve(s,2)):0}return b.after=jx,b.ary=Dg,b.assign=R3,b.assignIn=Xg,b.assignInWith=Vd,b.assignWith=M3,b.at=L3,b.before=Fg,b.bind=xm,b.bindAll=kS,b.bindKey=Cg,b.castArray=e3,b.chain=Mg,b.chunk=Yn,b.compact=er,b.concat=fr,b.cond=PS,b.conforms=zS,b.constant=Bm,b.countBy=vx,b.create=N3,b.curry=kg,b.curryRight=Pg,b.debounce=zg,b.defaults=D3,b.defaultsDeep=F3,b.defer=Vx,b.delay=Wx,b.difference=zn,b.differenceBy=we,b.differenceWith=ur,b.drop=en,b.dropRight=ce,b.dropRightWhile=Be,b.dropWhile=je,b.fill=Un,b.filter=xx,b.flatMap=Ex,b.flatMapDeep=Tx,b.flatMapDepth=Ix,b.flatten=T,b.flattenDeep=nt,b.flattenDepth=q,b.flip=Yx,b.flow=GS,b.flowRight=$S,b.fromPairs=qt,b.functions=$3,b.functionsIn=j3,b.groupBy=Ox,b.initial=g,b.intersection=L,b.intersectionBy=U,b.intersectionWith=j,b.invert=W3,b.invertBy=Y3,b.invokeMap=Rx,b.iteratee=Rm,b.keyBy=Mx,b.keys=Tr,b.keysIn=Qr,b.map=Pd,b.mapKeys=X3,b.mapValues=q3,b.matches=jS,b.matchesProperty=VS,b.memoize=Ud,b.merge=Z3,b.mergeWith=qg,b.method=WS,b.methodOf=YS,b.mixin=Mm,b.negate=Gd,b.nthArg=XS,b.omit=K3,b.omitBy=J3,b.once=Hx,b.orderBy=Lx,b.over=qS,b.overArgs=Xx,b.overEvery=ZS,b.overSome=KS,b.partial=Sm,b.partialRight=Ug,b.partition=Nx,b.pick=Q3,b.pickBy=Zg,b.property=rb,b.propertyOf=JS,b.pull=I,b.pullAll=E,b.pullAllBy=X,b.pullAllWith=V,b.pullAt=ct,b.range=QS,b.rangeRight=t6,b.rearg=qx,b.reject=Cx,b.remove=_t,b.rest=Zx,b.reverse=Nt,b.sampleSize=Px,b.set=eS,b.setWith=nS,b.shuffle=zx,b.slice=he,b.sortBy=$x,b.sortedUniq=le,b.sortedUniqBy=nn,b.split=ES,b.spread=Kx,b.tail=cr,b.take=Fs,b.takeRight=ia,b.takeRightWhile=Li,b.takeWhile=Pa,b.tap=lx,b.throttle=Jx,b.thru=kd,b.toArray=Wg,b.toPairs=Kg,b.toPairsIn=Jg,b.toPath=a6,b.toPlainObject=Hg,b.transform=rS,b.unary=Qx,b.union=Cs,b.unionBy=Fd,b.unionWith=Gr,b.uniq=ks,b.uniqBy=Kr,b.uniqWith=Cd,b.unset=iS,b.unzip=Er,b.unzipWith=Wf,b.update=aS,b.updateWith=sS,b.values=dc,b.valuesIn=oS,b.without=lc,b.words=eb,b.wrap=t3,b.xor=ix,b.xorBy=ax,b.xorWith=sx,b.zip=ox,b.zipObject=fx,b.zipObjectDeep=ux,b.zipWith=cx,b.entries=Kg,b.entriesIn=Jg,b.extend=Xg,b.extendWith=Vd,Mm(b,b),b.add=o6,b.attempt=nb,b.camelCase=lS,b.capitalize=Qg,b.ceil=f6,b.clamp=fS,b.clone=n3,b.cloneDeep=i3,b.cloneDeepWith=a3,b.cloneWith=r3,b.conformsTo=s3,b.deburr=tb,b.defaultTo=US,b.divide=u6,b.endsWith=hS,b.eq=aa,b.escape=dS,b.escapeRegExp=_S,b.every=wx,b.find=Sx,b.findIndex=mi,b.findKey=C3,b.findLast=Ax,b.findLastIndex=ka,b.findLastKey=k3,b.floor=c6,b.forEach=Lg,b.forEachRight=Ng,b.forIn=P3,b.forInRight=z3,b.forOwn=U3,b.forOwnRight=G3,b.get=Tm,b.gt=o3,b.gte=f3,b.has=V3,b.hasIn=Im,b.head=Ae,b.identity=ti,b.includes=Bx,b.indexOf=x,b.inRange=uS,b.invoke=H3,b.isArguments=Yf,b.isArray=Pe,b.isArrayBuffer=u3,b.isArrayLike=Jr,b.isArrayLikeObject=nr,b.isBoolean=c3,b.isBuffer=Go,b.isDate=l3,b.isElement=h3,b.isEmpty=d3,b.isEqual=_3,b.isEqualWith=p3,b.isError=Am,b.isFinite=m3,b.isFunction=Ps,b.isInteger=Gg,b.isLength=$d,b.isMap=$g,b.isMatch=g3,b.isMatchWith=b3,b.isNaN=y3,b.isNative=v3,b.isNil=x3,b.isNull=w3,b.isNumber=jg,b.isObject=Hn,b.isObjectLike=Zn,b.isPlainObject=gh,b.isRegExp=Em,b.isSafeInteger=S3,b.isSet=Vg,b.isString=jd,b.isSymbol=gi,b.isTypedArray=hc,b.isUndefined=A3,b.isWeakMap=E3,b.isWeakSet=T3,b.join=D,b.kebabCase=pS,b.last=M,b.lastIndexOf=P,b.lowerCase=mS,b.lowerFirst=gS,b.lt=I3,b.lte=O3,b.max=l6,b.maxBy=h6,b.mean=d6,b.meanBy=_6,b.min=p6,b.minBy=m6,b.stubArray=Nm,b.stubFalse=Dm,b.stubObject=e6,b.stubString=n6,b.stubTrue=r6,b.multiply=g6,b.nth=S,b.noConflict=HS,b.noop=Lm,b.now=zd,b.pad=bS,b.padEnd=yS,b.padStart=vS,b.parseInt=wS,b.random=cS,b.reduce=Dx,b.reduceRight=Fx,b.repeat=xS,b.replace=SS,b.result=tS,b.round=b6,b.runInContext=W,b.sample=kx,b.size=Ux,b.snakeCase=AS,b.some=Gx,b.sortedIndex=oe,b.sortedIndexBy=Ht,b.sortedIndexOf=mt,b.sortedLastIndex=ot,b.sortedLastIndexBy=te,b.sortedLastIndexOf=Qt,b.startCase=TS,b.startsWith=IS,b.subtract=y6,b.sum=v6,b.sumBy=w6,b.template=OS,b.times=i6,b.toFinite=zs,b.toInteger=He,b.toLength=Yg,b.toLower=BS,b.toNumber=Ni,b.toSafeInteger=B3,b.toString=wn,b.toUpper=RS,b.trim=MS,b.trimEnd=LS,b.trimStart=NS,b.truncate=DS,b.unescape=FS,b.uniqueId=s6,b.upperCase=CS,b.upperFirst=Om,b.each=Lg,b.eachRight=Ng,b.first=Ae,Mm(b,function(){var i={};return qr(b,function(s,u){un.call(b.prototype,u)||(i[u]=s)}),i}(),{chain:!1}),b.VERSION=r,_r(["bind","bindKey","curry","curryRight","partial","partialRight"],function(i){b[i].placeholder=b}),_r(["drop","take"],function(i,s){tn.prototype[i]=function(u){u=u===e?1:$n(He(u),0);var h=this.__filtered__&&!s?new tn(this):this.clone();return h.__filtered__?h.__takeCount__=wr(u,h.__takeCount__):h.__views__.push({size:wr(u,de),type:i+(h.__dir__<0?"Right":"")}),h},tn.prototype[i+"Right"]=function(u){return this.reverse()[i](u).reverse()}}),_r(["filter","map","takeWhile"],function(i,s){var u=s+1,h=u==F||u==H;tn.prototype[i]=function(p){var w=this.clone();return w.__iteratees__.push({iteratee:ve(p,3),type:u}),w.__filtered__=w.__filtered__||h,w}}),_r(["head","last"],function(i,s){var u="take"+(s?"Right":"");tn.prototype[i]=function(){return this[u](1).value()[0]}}),_r(["initial","tail"],function(i,s){var u="drop"+(s?"":"Right");tn.prototype[i]=function(){return this.__filtered__?new tn(this):this[u](1)}}),tn.prototype.compact=function(){return this.filter(ti)},tn.prototype.find=function(i){return this.filter(i).head()},tn.prototype.findLast=function(i){return this.reverse().find(i)},tn.prototype.invokeMap=Ye(function(i,s){return typeof i=="function"?new tn(this):this.map(function(u){return Es(u,i,s)})}),tn.prototype.reject=function(i){return this.filter(Gd(ve(i)))},tn.prototype.slice=function(i,s){i=He(i);var u=this;return u.__filtered__&&(i>0||s<0)?new tn(u):(i<0?u=u.takeRight(-i):i&&(u=u.drop(i)),s!==e&&(s=He(s),u=s<0?u.dropRight(-s):u.take(s-i)),u)},tn.prototype.takeRightWhile=function(i){return this.reverse().takeWhile(i).reverse()},tn.prototype.toArray=function(){return this.take(de)},qr(tn.prototype,function(i,s){var u=/^(?:filter|find|map|reject)|While$/.test(s),h=/^(?:head|last)$/.test(s),p=b[h?"take"+(s=="last"?"Right":""):s],w=h||/^find/.test(s);p&&(b.prototype[s]=function(){var N=this.__wrapped__,k=h?[1]:arguments,Z=N instanceof tn,At=k[0],Tt=Z||Pe(N),Ft=function(rn){var cn=p.apply(b,Xi([rn],k));return h&&ne?cn[0]:cn};Tt&&u&&typeof At=="function"&&At.length!=1&&(Z=Tt=!1);var ne=this.__chain__,pe=!!this.__actions__.length,xe=w&&!ne,Je=Z&&!pe;if(!w&&Tt){N=Je?N:new tn(this);var Se=i.apply(N,k);return Se.__actions__.push({func:kd,args:[Ft],thisArg:e}),new Xr(Se,ne)}return xe&&Je?i.apply(this,k):(Se=this.thru(Ft),xe?h?Se.value()[0]:Se.value():Se)})}),_r(["pop","push","shift","sort","splice","unshift"],function(i){var s=Pu[i],u=/^(?:push|sort|unshift)$/.test(i)?"tap":"thru",h=/^(?:pop|shift)$/.test(i);b.prototype[i]=function(){var p=arguments;if(h&&!this.__chain__){var w=this.value();return s.apply(Pe(w)?w:[],p)}return this[u](function(N){return s.apply(Pe(N)?N:[],p)})}}),qr(tn.prototype,function(i,s){var u=b[s];if(u){var h=u.name+"";un.call(xr,h)||(xr[h]=[]),xr[h].push({name:s,func:u})}}),xr[Vf(e,Mt).name]=[{name:"wrapper",func:e}],tn.prototype.clone=Hp,tn.prototype.reverse=Xp,tn.prototype.value=qp,b.prototype.at=hx,b.prototype.chain=dx,b.prototype.commit=_x,b.prototype.next=px,b.prototype.plant=gx,b.prototype.reverse=bx,b.prototype.toJSON=b.prototype.valueOf=b.prototype.value=yx,b.prototype.first=b.prototype.head,ci&&(b.prototype[ci]=mx),b},wo=kp();hn?((hn.exports=wo)._=wo,We._=wo):Le._=wo}).call(ca)})(zE,C_);const S0={sqrt:TE,log:mv,linear:F_,literal:_v};class Ep{constructor(t,e,r,a){if(this.field=null,this._texture_buffer=null,this.partner=null,this._textures={},this.current_encoding=null,this.aesthetic_map=a,this.aesthetic_map===void 0)throw new Error("Aesthetic map is undefined");this.scatterplot=t,this.regl=e,this._range=[0,1],this.dataset=r,this.id=Math.random().toString()}apply(t){return this.scale===void 0?this.default_constant:this.scale(this.value_for(t))}get transform(){return this._transform?this._transform:this.default_transform}set transform(t){this._transform=t}get scale(){if(this._scale)return this._scale;if(this.is_dictionary()){console.warn("Dictionary scales only supported for colors");const e=J0().domain(this.domain);return this._scale=e.range(this.range)}const t=S0[this.transform]();return t.domain(this.domain).range(this.range),this._scale=t}get column(){if(this.field===null)throw new Error("Can't retrieve column for aesthetic without a field");if(this.dataset.root_tile.record_batch){const t=this.dataset.root_tile.record_batch.getChild(this.field);if(t==null)throw new Error("Can't find column "+this.field);return t}throw new Error("Table is null")}get default_domain(){var t;if(this.field==null)return[1,1];if(!this.scatterplot._root._schema)return[1,1];const{column:e}=this;return e?((t=e.type)==null?void 0:t.dictionary)!==void 0?[-2047,Math.floor(this.aesthetic_map.texture_size/2)-1]:(this.dataset.domain(this.field),this.dataset.domain(this.field)):[1,1]}default_data(){const t=this.toGLType(this.default_constant);return Array(this.aesthetic_map.texture_size).fill(t)}get webGLDomain(){return this.is_dictionary()?[-2047,2047]:this.domain}get domain(){return this._domain===void 0&&(this._domain=this.default_domain),this._domain||this.default_domain}get range(){return this._range||this.default_range}value_for(t){return this.field&&t[this.field]?t[this.field]:null}get map_position(){return this.use_map_on_regl===0?0:this.aesthetic_map.get_position(this.id)}get texture_buffer(){return this._texture_buffer?this._texture_buffer:(this._texture_buffer=new Float32Array(this.aesthetic_map.texture_size),this._texture_buffer.set(this.default_data()),this._texture_buffer)}post_to_regl_buffer(){this.aesthetic_map.set_one_d(this.id,this.texture_buffer)}convert_string_encoding(t){return{field:t,domain:this.default_domain,range:this.default_range}}complete_domain(t){return t.domain=t.domain||this.default_domain,t}reset_to_defaults(){this._domain=this.default_domain,this._range=[0,1],this._transform=void 0,this._constant=this.default_constant,this.field=null,this.current_encoding=null,this._scale=void 0}update(t){if(t===void 0){console.warn("Should never be calling update with undefined.");return}if(t===null||t==="null"){this.current_encoding=null,this.reset_to_defaults();return}if(this._scale=void 0,typeof t=="string"&&(t=this.convert_string_encoding(t)),C_.isNumber(t)){const e={constant:t};this.current_encoding=e;return}if(Object.keys(t).length===0){console.warn("Resetting parameters with an empty object is deprecated: use 'null'"),this.reset_to_defaults();return}if(this.current_encoding=t,!zh(t)&&(this.field=t.field,!x0(t))){if(Sv(t)){const{lambda:e,field:r}=t;e&&(this.apply_function_for_textures(r,this.domain,e),this.post_to_regl_buffer());return}t.domain===void 0&&(t.domain=this.default_domain),t.range&&(this._domain=t.domain,this._range=t.range),this._transform=t.transform||void 0}}encode_for_textures(t){const{texture_size:e}=this.aesthetic_map,r=Array(e),a=S0[this.transform]().range(t).domain([0,e-1]);for(let o=0;o<e;o+=1)r[o]=a(o)}arrow_column(){if(this.field===null)throw new Error("Can't retrieve column for aesthetic without a field");const t=this.dataset.root_tile.record_batch.getChild(this.field);if(t===null)throw`No column ${this.field} on arrow table for aesthetic`;return t}is_dictionary(){var t,e;return this.field===null||this.field===void 0?!1:((e=(t=this.arrow_column())==null?void 0:t.type)==null?void 0:e.dictionary)!==void 0}get constant(){return this.current_encoding!==null&&zh(this.current_encoding)?this.toGLType(this.current_encoding.constant):this.toGLType(this.default_constant)}get use_map_on_regl(){return this.is_dictionary()?1:0}materialize_function(t){const e=typeof t=="string"?HE(Ov(t)):t;return this._func=e,e}apply_function_for_textures(t,e,r){var a;const{texture_size:o}=this.aesthetic_map,f=this.materialize_function(r);let c=nu(o);if(t===void 0||this.dataset.root_tile.record_batch===void 0){t===void 0&&console.warn("SETTING EMPTY FIELD"),this.dataset.root_tile.record_batch===void 0&&console.warn("SETTING EMPTY TABLE"),this.texture_buffer.set(nu(o).map(m=>1));return}const{column:l}=this;if(!l)throw new Error(`Column ${t} does not exist on table.`);if((a=l==null?void 0:l.type)!=null&&a.dictionary){c.fill("");const m=l.data[0].dictionary.toArray();for(const[A,R]of m.entries())c[A]=R}else c=c.map(m=>this.scale(m));const _=c.map(m=>f(m));this.texture_buffer.set(_)}}class ag extends Ep{constructor(t,e,r,a){super(t,e,r,a),this.current_encoding=null}toGLType(t){return t}static get_default_domain(){return[0,1]}get default_domain(){return[0,1]}}class UE extends ag{constructor(){super(...arguments),this._constant=1,this.default_constant=1,this.default_transform="sqrt"}static get default_constant(){return 1.5}get default_range(){return[0,1]}}class Av extends ag{constructor(t,e,r,a){super(t,e,r,a),this.default_range=[-1,1],this.default_constant=0,this.default_transform="literal",this._constant=0,this._transform="literal"}get range(){return this._range?this._range:this.dataset.extent&&this.field&&this.dataset.extent[this.field]?this.dataset.extent[this.field]:this.default_range}static get default_constant(){return 0}}class Ev extends Av{constructor(){super(...arguments),this.field="x"}}class GE extends Ev{}class Tv extends Av{constructor(){super(...arguments),this.field="y"}}class $E extends Tv{}class Iv extends Ep{constructor(t,e,r,a){super(t,e,r,a)}toGLType(t){return t?1:0}update(t){super.update(t),this.current_encoding!==null&&Object.keys(this.current_encoding).length===0&&(this.current_encoding=null)}ops_to_array(){const t=this.current_encoding;return t===null?[0,0,0]:t===void 0?[0,0,0]:x0(t)?t.op==="within"?[4,t.a,t.b]:t.op==="between"?[4,(t.b-t.a)/2,(t.b+t.a)/2]:[[null,"lt","gt","eq"].indexOf(t.op),t.a,0]:[0,0,0]}apply(t){const e=this.current_encoding;if(e==null)return!0;if(x0(e))return this.apply_op(t,e);if(zh(e))return e.constant!==0;if(Sv(e)){if(this._func===void 0)throw new Error("_func should have been bound"+JSON.stringify(this.current_encoding));const r=this.value_for(t);return r===null?!1:!!this._func(r)}return!0}apply_op(t,e){const{op:r,a}=e,o=this.value_for(t);if(o===null)return!1;if(r==="eq")return o==a;if(r==="gt")return o>a;if(r==="lt")return o<a;if(r==="within")return Math.abs(o-e.b)<a;if(r==="between"){const f=(e.a+e.b)/2,c=Math.abs(e.a-e.b)/2;return Math.abs(o-f)<c}return!1}get default_domain(){return[0,1]}}class jE extends Iv{constructor(){super(...arguments),this.current_encoding=null,this._constant=1,this.default_constant=1,this.default_range=[0,1],this.default_transform="literal"}get active(){return!(this.current_encoding===null||zh(this.current_encoding))}}class Kb extends Iv{constructor(){super(...arguments),this.current_encoding=null,this._constant=1,this.default_constant=1,this.default_transform="literal",this.default_range=[0,1]}}class VE extends ag{constructor(){super(...arguments),this.default_transform="linear",this.default_range=[0,1],this.default_constant=.5,this._constant=0}}function WE(n){return n==="spiral"?1:n==="uniform"?2:n==="normal"?3:n==="circle"?4:n==="time"?5:0}class YE extends Ep{constructor(){super(...arguments),this._constant=0,this.jitter_int_formatted=0,this.default_transform="linear",this._method="None"}toGLType(t){return t}get default_constant(){return 0}get default_range(){return[0,1]}get method(){var t,e;return(e=(t=this.current_encoding)==null?void 0:t.method)!=null?e:"None"}set method(t){this._method=t}get jitter_int_format(){return WE(this.method)}}function Ov(n){let[t,e]=n.split("=>").map(a=>a.trim());if(e===void 0)throw new Error(`Couldn't parse ${n} into a function`);e.slice(0,1)!=="{"&&e.slice(0,6)!=="return"&&(e=`return ${e}`);const r=`${t} => ${e}`;return{field:t,lambda:r}}function HE(n){if(typeof n.lambda=="function")throw"Must pass a string to lambda, not a function.";const{lambda:t,field:e}=n;if(e===void 0)throw"Must pass a field to lambda.";const r=Ov(t).lambda,[a,o]=r.split("=>",2).map(c=>c.trim());return new Function(a,o)}function qe(n){for(var t=n.length/6|0,e=new Array(t),r=0;r<t;)e[r]="#"+n.slice(r*6,++r*6);return e}const XE=qe("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),qE=qe("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),ZE=qe("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),KE=qe("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),JE=qe("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),QE=qe("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),tT=qe("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),eT=qe("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),nT=qe("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),rT=qe("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),Mn=n=>E5(n[n.length-1]);var Bv=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(qe);const iT=Mn(Bv);var Rv=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(qe);const aT=Mn(Rv);var Mv=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(qe);const sT=Mn(Mv);var Lv=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(qe);const oT=Mn(Lv);var Nv=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(qe);const fT=Mn(Nv);var Dv=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(qe);const uT=Mn(Dv);var Fv=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(qe);const cT=Mn(Fv);var Cv=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(qe);const lT=Mn(Cv);var kv=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(qe);const hT=Mn(kv);var Pv=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(qe);const dT=Mn(Pv);var zv=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(qe);const _T=Mn(zv);var Uv=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(qe);const pT=Mn(Uv);var Gv=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(qe);const mT=Mn(Gv);var $v=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(qe);const gT=Mn($v);var jv=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(qe);const bT=Mn(jv);var Vv=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(qe);const yT=Mn(Vv);var Wv=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(qe);const vT=Mn(Wv);var Yv=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(qe);const wT=Mn(Yv);var Hv=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(qe);const xT=Mn(Hv);var Xv=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(qe);const ST=Mn(Xv);var qv=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(qe);const AT=Mn(qv);var Zv=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(qe);const ET=Mn(Zv);var Kv=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(qe);const TT=Mn(Kv);var Jv=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(qe);const IT=Mn(Jv);var Qv=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(qe);const OT=Mn(Qv);var t1=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(qe);const BT=Mn(t1);var e1=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(qe);const RT=Mn(e1);function MT(n){return n=Math.max(0,Math.min(1,n)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-n*(35.34-n*(2381.73-n*(6402.7-n*(7024.72-n*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+n*(170.73+n*(52.82-n*(131.46-n*(176.58-n*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+n*(442.36-n*(2482.43-n*(6167.24-n*(6614.94-n*2475.67)))))))+")"}const LT=X0(Qa(300,.5,0),Qa(-240,.5,1));var NT=X0(Qa(-100,.75,.35),Qa(80,1.5,.8)),DT=X0(Qa(260,.75,.35),Qa(80,1.5,.8)),t_=Qa();function FT(n){(n<0||n>1)&&(n-=Math.floor(n));var t=Math.abs(n-.5);return t_.h=360*n-100,t_.s=1.5-1.5*t,t_.l=.8-.9*t,t_+""}var e_=Qs(),CT=Math.PI/3,kT=Math.PI*2/3;function PT(n){var t;return n=(.5-n)*Math.PI,e_.r=255*(t=Math.sin(n))*t,e_.g=255*(t=Math.sin(n+CT))*t,e_.b=255*(t=Math.sin(n+kT))*t,e_+""}function zT(n){return n=Math.max(0,Math.min(1,n)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+n*(1172.33-n*(10793.56-n*(33300.12-n*(38394.49-n*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+n*(557.33+n*(1225.33-n*(3574.96-n*(1073.77+n*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+n*(3211.1-n*(15327.97-n*(27814-n*(22569.18-n*6838.66)))))))+")"}function Tp(n){var t=n.length;return function(e){return n[Math.max(0,Math.min(t-1,Math.floor(e*t)))]}}const UT=Tp(qe("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var GT=Tp(qe("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),$T=Tp(qe("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),jT=Tp(qe("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));const sg=Object.freeze(Object.defineProperty({__proto__:null,interpolateBlues:ET,interpolateBrBG:iT,interpolateBuGn:dT,interpolateBuPu:_T,interpolateCividis:MT,interpolateCool:DT,interpolateCubehelixDefault:LT,interpolateGnBu:pT,interpolateGreens:TT,interpolateGreys:IT,interpolateInferno:$T,interpolateMagma:GT,interpolateOrRd:mT,interpolateOranges:RT,interpolatePRGn:aT,interpolatePiYG:sT,interpolatePlasma:jT,interpolatePuBu:bT,interpolatePuBuGn:gT,interpolatePuOr:oT,interpolatePuRd:yT,interpolatePurples:OT,interpolateRainbow:FT,interpolateRdBu:fT,interpolateRdGy:uT,interpolateRdPu:vT,interpolateRdYlBu:cT,interpolateRdYlGn:lT,interpolateReds:BT,interpolateSinebow:PT,interpolateSpectral:hT,interpolateTurbo:zT,interpolateViridis:UT,interpolateWarm:NT,interpolateYlGn:xT,interpolateYlGnBu:wT,interpolateYlOrBr:ST,interpolateYlOrRd:AT,schemeAccent:qE,schemeBlues:Zv,schemeBrBG:Bv,schemeBuGn:Pv,schemeBuPu:zv,schemeCategory10:XE,schemeDark2:ZE,schemeGnBu:Uv,schemeGreens:Kv,schemeGreys:Jv,schemeOrRd:Gv,schemeOranges:e1,schemePRGn:Rv,schemePaired:KE,schemePastel1:JE,schemePastel2:QE,schemePiYG:Mv,schemePuBu:jv,schemePuBuGn:$v,schemePuOr:Lv,schemePuRd:Vv,schemePurples:Qv,schemeRdBu:Nv,schemeRdGy:Dv,schemeRdPu:Wv,schemeRdYlBu:Fv,schemeRdYlGn:Cv,schemeReds:t1,schemeSet1:tT,schemeSet2:eT,schemeSet3:nT,schemeSpectral:kv,schemeTableau10:rT,schemeYlGn:Hv,schemeYlGnBu:Yv,schemeYlOrBr:Xv,schemeYlOrRd:qv},Symbol.toStringTag,{value:"Module"})),VT=1664525,WT=1013904223,Jb=1/4294967296;function YT(n=Math.random()){let t=(0<=n&&n<1?n/Jb:Math.abs(n))|0;return()=>(t=VT*t+WT|0,Jb*(t>>>0))}const Ic=4096;function HT(n){const t=new Uint8Array(4*Ic);return nu(Ic).forEach(e=>{const r=Qs(n(e/Ic));t.set([r.r,r.g,r.b,255],e*4)}),t}const Va={white:new Uint8Array(4*Ic).fill(255)},k_={};function P_(n){const t=n.map(r=>{const a=Qs(r);return[a.r,a.g,a.b,255]}),e=new Uint8Array(Ic*4);for(let r=0;r<Ic;r++)e.set(t[r%n.length],r*4);return e}for(const n of["schemeAccent","schemeCategory10","schemeDark2","schemePaired","schemePastel1","schemePastel2","schemeSet1","schemeSet2","schemeSet3","schemeTableau10"]){const t=sg[n],e=n.replace("scheme","").toLowerCase();Va[e]=P_(t),k_[e]=t}for(const n of["interpolateBlues","interpolateBrBG","interpolateBuGn","interpolateBuPu","interpolateCividis","interpolateCool","interpolateCubehelixDefault","interpolateGnBu","interpolateGreens","interpolateGreys","interpolateInferno","interpolateMagma","interpolateOrRd","interpolateOranges","interpolatePRGn","interpolatePiYG","interpolatePlasma","interpolatePuBu","interpolatePuBuGn","interpolatePuOr","interpolatePuRd","interpolatePurples","interpolateRainbow","interpolateRdBu","interpolateRdGy","interpolateRdPu","interpolateRdYlBu","interpolateRdYlGn","interpolateReds","interpolateSinebow","interpolateSpectral","interpolateTurbo","interpolateViridis","interpolateWarm","interpolateYlGn","interpolateYlGnBu","interpolateYlOrBr","interpolateYlOrRd"]){const t=n.replace("interpolate","").toLowerCase(),e=sg[n];if(Va[t]=HT(e),t==="rainbow"){const r=p4(YT(1));Va.shufbow=r(Va[t])}}function XT(){const n=["#E69F00","#CC79A7","#56B4E9","#009E73","#0072B2","#D55E00","#F0E442"];Va.okabe=P_(n),k_.okabe=n}XT();class qT extends Ep{constructor(){super(...arguments),this._constant="#CC5500",this.texture_type="uint8",this.default_constant="#CC5500",this.default_transform="linear",this.current_encoding=null}get default_range(){return[0,1]}default_data(){return Va.viridis}get use_map_on_regl(){return 1}get scale(){if(this._scale)return this._scale;S0[this.transform]().domain(this.domain).range(this.range);const t=this.range;function e(r){return r==="ylorrd"?"YlOrRd":r.charAt(0).toUpperCase()+r.slice(1)}if(this.is_dictionary()){const r=J0().domain(this.domain);if(typeof t=="string"&&k_[t]){if(this.column.data[0].dictionary===null)throw new Error("Dictionary is null");return this._scale=r.range(k_[t]).domain(this.column.data[0].dictionary.toArray())}else return this._scale=r.range(this.range)}if(typeof t=="string"){const r=sg["interpolate"+e(t)];if(r!==void 0)return this.transform==="sqrt"?this._scale=wv(r).exponent(.5).domain(this.domain):this.transform==="log"?this._scale=vv(r).domain(this.domain):this._scale=yv(r).domain(this.domain)}}get texture_buffer(){return this._texture_buffer?this._texture_buffer:(this._texture_buffer=new Uint8Array(this.aesthetic_map.texture_size*4),this._texture_buffer.set(this.default_data()),this._texture_buffer)}post_to_regl_buffer(){this.aesthetic_map.set_color(this.id,this.texture_buffer)}update(t){super.update(t),this.current_encoding=t,t===null&&(t={constant:this.default_constant}),zh(t)||(t.range&&typeof t.range[0]=="string"?(this.encode_for_textures(t.range),this.post_to_regl_buffer()):t.range&&this.post_to_regl_buffer())}toGLType(t){const{r:e,g:r,b:a}=Qs(t);return[e/255,r/255,a/255]}encode_for_textures(t){if(Array.isArray(t)){const e=t.join("/");if(Va[e]){this.texture_buffer.set(Va[e]);return}else{let r;if(!this.is_dictionary())r=P_(t);else{const a=this.column.data[0].dictionary.toArray(),o=Object.fromEntries(a.map((c,l)=>[c,l])),f=[];for(let c=0;c<this.domain.length;c++){const l=this.domain[c],_=t[c];o[l]!==void 0&&(f[o[l]]=_)}for(let c=0;c<a.length;c++)f[c]===void 0&&(f[c]="gray");r=P_(f)}this.texture_buffer.set(r);return}}if(Va[t]){this.texture_buffer.set(Va[t]);return}t.length===this.aesthetic_map.texture_size*4&&(console.warn("SETTING FULL RANGE IS DEPRECATED,"),this.texture_buffer.set(t)),console.error(`request range of ${t} for color ${this.field} unknown`)}}const Gm={size:UE,jitter_speed:VE,jitter_radius:YE,color:qT,filter:Kb,filter2:Kb,x:Ev,y:Tv,x0:GE,y0:$E,foreground:jE};class ZT{constructor(t,e,r,a,o){if(this.needs_transitions=!1,a===void 0)throw new Error("Aesthetic map is undefined.");this.scatterplot=t,this.regl=e,this.dataset=r,this.aesthetic_map=a,this.states=[new o(this.scatterplot,this.regl,this.dataset,this.aesthetic_map),new o(this.scatterplot,this.regl,this.dataset,this.aesthetic_map)]}get current(){return this.states[0]}get last(){return this.states[1]}update(t){JSON.stringify(t)===JSON.stringify(this.states[0].current_encoding)||t===void 0?(this.needs_transitions&&this.states[1].update(this.states[0].current_encoding),this.needs_transitions=!1):(this.states.reverse(),this.states[0].update(t),this.needs_transitions=!0)}}class KT{constructor(t,e,r){return this.encoding={},this.scatterplot=t,this.store={},this.regl=e,this.tileSet=r,this.position_interpolation=!1,this.aesthetic_map=new JT(this.regl),this}dim(t){if(this.store[t])return this.store[t];if(!Gm[t])throw new Error(`Unknown aesthetic ${t}`);const e=Gm[t],r=this.scatterplot,a=this.regl,o=this.aesthetic_map,f=new ZT(r,a,this.tileSet,o,e);return this.store[t]=f,f}*[Symbol.iterator](){for(const[t,e]of Object.entries(this.store))yield[t,e]}interpret_position(t){if(t){t.x0||t.position0?this.position_interpolation=!0:(t.x||t.position)&&(this.position_interpolation=!1);for(const e of["position","position0"]){const r=e.replace("position","");if(t[e]){if(t[e]==="literal")t[`x${r}`]={field:"x",transform:"literal"},t[`y${r}`]={field:"y",transform:"literal"};else{const a=t[e];t[`x${r}`]={field:`${a}.x`,transform:"literal"},t[`y${r}`]={field:`${a}.y`,transform:"literal"}}delete t[e]}}}delete t.position,delete t.position0}apply_encoding(t){if(t===void 0&&(t={}),t.filter1)throw new Error('filter1 is not supported; just say "filter"');this.interpret_position(t);for(const e of Object.keys(Gm))this.dim(e).update(t[e])}}class JT{constructor(t,e=4096){this.id_locs={},this.offsets={},this.texture_size=e,this.texture_widths=32,this.regl=t,this._one_d_position=1,this._color_position=-1}get_position(t){return this.offsets[t]||0}set_one_d(t,e){let r;const{offsets:a}=this;a[t]?r=a[t]:(r=this._one_d_position++,a[t]=r),this.one_d_texture.subimage({data:e,width:1,height:this.texture_size},r,0)}set_color(t,e){let r;const{offsets:a}=this;a[t]?r=a[t]:(r=this._color_position--,a[t]=r),this.color_texture.subimage({data:e,width:1,height:this.texture_size},-r-1,0)}get one_d_texture(){if(this._one_d_texture)return this._one_d_texture;const t=this.regl.hasExtension("OES_texture_float")?"float":this.regl.hasExtension("OES_texture_half_float")?"half float":"uint8",e=t==="uint8"?"rgba":"alpha",r={width:this.texture_widths,height:this.texture_size,type:t,format:e};return this._one_d_texture=this.regl.texture(r),this._one_d_texture}get color_texture(){return this._color_texture?this._color_texture:(this._color_texture=this.regl.texture({width:this.texture_widths,height:this.texture_size,type:"uint8",format:"rgba"}),this._color_texture)}}class QT extends xv{constructor(t,e,r){super(t,e,r),this.buffer_size=1024*1024*64,this._use_scale_to_download_tiles=!0,this.fbos={},this.textures={};const a=this.canvas;if(this.canvas===void 0)throw new Error("No canvas found");this.regl=w0({optionalExtensions:["OES_standard_derivatives","OES_element_index_uint","OES_texture_float","OES_texture_half_float"],canvas:a}),this.tileSet=e,this.aes=new KT(r,this.regl,e),this.initialize_textures(),this._initializations=[this.tileSet.promise.then(()=>{this.remake_renderer(),this._webgl_scale_history=[this.default_webgl_scale,this.default_webgl_scale]})],this.initialize(),this._buffers=new Qb(this.regl,this.buffer_size)}get buffers(){return this._buffers=this._buffers||new Qb(this.regl,this.buffer_size),this._buffers}data(t){return t===void 0?this.tileSet:(this.tileSet=t,this)}get props(){this.allocate_aesthetic_buffers();const{prefs:t,aes_to_buffer_num:e,buffer_num_to_variable:r,variable_to_buffer_num:a}=this,{transform:o}=this.zoom,f={aes:{encoding:this.aes.encoding},colors_as_grid:0,corners:this.zoom.current_corners(),zoom_balance:t.zoom_balance,transform:o,max_ix:this.max_ix,point_size:this.point_size,alpha:this.optimal_alpha,time:Date.now()-this.zoom._start,update_time:Date.now()-this.most_recent_restart,relative_time:(Date.now()-this.most_recent_restart)/t.duration,string_index:0,prefs:JSON.parse(JSON.stringify(t)),color_type:void 0,start_time:this.most_recent_restart,webgl_scale:this._webgl_scale_history[0],last_webgl_scale:this._webgl_scale_history[1],use_scale_for_tiles:this._use_scale_to_download_tiles,grid_mode:0,buffer_num_to_variable:r,aes_to_buffer_num:e,variable_to_buffer_num:a,color_picker_mode:0,zoom_matrix:[[o.k,0,o.x],[0,o.k,o.y],[0,0,1]].flat()};return JSON.parse(JSON.stringify(f))}get default_webgl_scale(){return this._default_webgl_scale?this._default_webgl_scale:(this._default_webgl_scale=this.zoom.webgl_scale(),this._default_webgl_scale)}render_points(t){const e=[];let r=0;const a=this.aes.store.foreground.states[0].active||this.aes.store.foreground.states[1].active;for(const o of this.visible_tiles()){if(o._buffer_manager=o._buffer_manager||new t2(this.regl,o,this),!o._buffer_manager.ready(t.block_for_buffers))continue;const f={manager:o._buffer_manager,number:r++,foreground:a?1:-1,tile_id:o.numeric_id,sprites:this.sprites};if(Object.assign(f,t),e.push(f),a){const c={...f,foreground:0};e.push(c)}}e.sort((o,f)=>(3+o.foreground)*1e3-(3+f.foreground)*1e3+f.number-o.number),this._renderer(e)}tick(){const{prefs:t}=this,{regl:e,tileSet:r}=this,{props:a}=this;this.tick_num=this.tick_num||0,this.tick_num++,this._use_scale_to_download_tiles?r.download_most_needed_tiles(this.zoom.current_corners(),this.props.max_ix,5):r.download_most_needed_tiles(t.max_points,this.max_ix,5),e.clear({color:[.9,.9,.93,0],depth:1});const o=Date.now();async function f(c){for(;Date.now()-o<10&&c.length>0;){const l=c.shift();if(l!==void 0)try{await l()}catch(_){console.warn(_,l)}}}f(this.deferred_functions);try{this.render_all(a)}catch(c){throw console.warn("ERROR NOTED"),this.reglframe.cancel(),c}}single_blur_pass(t,e,r){const{regl:a}=this;e.use(()=>{a.clear({color:[0,0,0,0]}),a({frag:DE,uniforms:{iResolution:({viewportWidth:o,viewportHeight:f})=>[o,f],iChannel0:t,direction:r},vert:`
        precision mediump float;
        attribute vec2 position;
        varying vec2 uv;
        void main() {
          uv = 0.5 * (position + 1.0);
          gl_Position = vec4(position, 0, 1);
        }`,attributes:{position:[-4,-4,4,-4,0,4]},depth:{enable:!1},count:3})()})}blur(t,e,r=3){let a=r-1;for(;a>-1;)this.single_blur_pass(t,e,[2**a,0]),this.single_blur_pass(e,t,[0,2**a]),a-=1}render_all(t){const{regl:e}=this;this.fbos.points.use(()=>{e.clear({color:[0,0,0,0]}),this.render_points(t)}),e.clear({color:[0,0,0,0]}),this.fbos.lines.use(()=>e.clear({color:[0,0,0,0]})),this.scatterplot.trimap&&this.fbos.lines.use(()=>{this.scatterplot.trimap.zoom=this.zoom,this.scatterplot.trimap.tick("polygon")});for(const r of[this.fbos.lines,this.fbos.points])e({profile:!0,blend:{enable:!0,func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},frag:`
        precision mediump float;
        varying vec2 uv;
        uniform sampler2D tex;
        uniform float wRcp, hRcp;
        void main() {
          gl_FragColor = texture2D(tex, uv);
        }
      `,vert:`
        precision mediump float;
        attribute vec2 position;
        varying vec2 uv;
        void main() {
          uv = 0.5 * (position + 1.0);
          gl_Position = vec4(position, 0., 1.);
        }
      `,attributes:{position:this.fill_buffer},depth:{enable:!1},count:3,uniforms:{tex:()=>r,wRcp:({viewportWidth:a})=>1/a,hRcp:({viewportHeight:a})=>1/a}})()}initialize_textures(){const{regl:t}=this;this.fbos=this.fbos||{},this.textures=this.textures||{},this.textures.empty_texture=t.texture(nu(128).map(e=>nu(128).map(r=>[0,0,0]))),this.fbos.minicounter=t.framebuffer({width:512,height:512,depth:!1}),this.fbos.lines=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.points=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.ping=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.pong=t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.contour=this.fbos.contour||t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.colorpicker=this.fbos.colorpicker||t.framebuffer({width:this.width,height:this.height,depth:!1}),this.fbos.dummy=this.fbos.dummy||t.framebuffer({width:1,height:1,depth:!1})}get_image_texture(t){const{regl:e}=this;if(this.textures=this.textures||{},this.textures[t])return this.textures[t];const r=new Image;return r.src=t,r.addEventListener("load",()=>{this.textures[t]=e.texture(r)}),this.textures[t]}n_visible(t=-1){let{width:e,height:r}=this;e=Math.floor(e),r=Math.floor(r),this.contour_vals===void 0&&(this.contour_vals=new Uint8Array(e*r*4));const{props:a}=this;a.only_color=t;let o;return this.fbos.contour.use(()=>{this.regl.clear({color:[0,0,0,0]}),this.render_points(a),this.regl.read(this.contour_vals),o=m4(this.contour_vals)}),o}get integer_buffer(){if(this._integer_buffer===void 0){const t=new Float32Array(65536);for(let e=0;e<2**16;e++)t[e]=e;this._integer_buffer=this.regl.buffer(t)}return this._integer_buffer}color_pick(t,e){if(e===0)return null;const r=this.color_pick_single(t,e,"tile_id");if(r==-1)return null;const a=this.color_pick_single(t,e,"ix_in_tile");if(a===-1)return null;for(const o of this.visible_tiles())if(o.numeric_id===r)return o.record_batch.get(a);return null}color_pick_single(t,e,r="tile_id"){const{props:a,height:o}=this;a.color_picker_mode=["ix","tile_id","ix_in_tile"].indexOf(r)+1;let f=[0,0,0,0];this.fbos.colorpicker.use(()=>{this.regl.clear({color:[0,0,0,0]}),this.render_points(a);try{f=this.regl.read({x:t,y:o-e,width:1,height:1})}catch{console.warn("Read bad data from",{x:t,y:e,height:o,attempted:o-e})}});const c=RE(...f)-1;return Math.round(c)}get fill_buffer(){if(!this._fill_buffer){const{regl:t}=this;this._fill_buffer=t.buffer({data:[-4,-4,4,-4,0,4]})}return this._fill_buffer}draw_contour_buffer(t,e){let{width:r,height:a}=this;r=Math.floor(r),a=Math.floor(a),this.contour_vals=this.contour_vals||new Uint8Array(4*r*a),this.contour_alpha_vals=this.contour_alpha_vals||new Uint16Array(r*a);const{props:o}=this;o.aes.encoding.color={field:t},o.only_color=e,this.fbos.contour.use(()=>{this.regl.clear({color:[0,0,0,0]}),this.render_points(o),this.regl.read(this.contour_vals)}),this.blur(this.fbos.contour,this.fbos.ping,3),this.fbos.contour.use(()=>{this.regl.read(this.contour_vals)});let f=0;for(;f<r*a*4;)this.contour_alpha_vals[f/4]=this.contour_vals[f+3]*255,f+=4;return this.contour_alpha_vals}remake_renderer(){const{regl:t}=this,e={depth:{enable:!1},stencil:{enable:!1},blend:{enable(r,{color_picker_mode:a}){return a<.5},func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},primitive:"points",frag:CE,vert:FE,count(r,a){return a.manager.count},attributes:{},uniforms:{u_update_time:t.prop("update_time"),u_transition_duration(r,a){return a.prefs.duration},u_only_color(r,a){return a.only_color!==void 0?a.only_color:-2},u_use_glyphset:(r,{prefs:a})=>a.glyph_set?1:0,u_glyphset:(r,{prefs:a})=>a.glyph_set?this.get_image_texture(a.glyph_set):this.textures.empty_texture,u_color_picker_mode:t.prop("color_picker_mode"),u_position_interpolation_mode(){return this.aes.position_interpolation?1:0},u_grid_mode:(r,{grid_mode:a})=>a,u_colors_as_grid:t.prop("colors_as_grid"),u_tile_id:(r,a)=>a.tile_id,u_width:({viewportWidth:r})=>r,u_height:({viewportHeight:r})=>r,u_one_d_aesthetic_map:this.aes.aesthetic_map.one_d_texture,u_color_aesthetic_map:this.aes.aesthetic_map.color_texture,u_aspect_ratio:({viewportWidth:r,viewportHeight:a})=>r/a,u_zoom_balance:t.prop("zoom_balance"),u_base_size:(r,{point_size:a})=>a,u_maxix:(r,{max_ix:a})=>a,u_alpha:(r,{alpha:a})=>a,u_foreground_number:(r,{foreground:a})=>a,u_foreground_alpha:()=>this.render_props.foreground_opacity,u_background_rgba:()=>{const r=this.prefs.background_options.color,{r:a,g:o,b:f}=Qs(r);return[a/255,o/255,f/255,this.prefs.background_options.opacity]},u_background_mouseover:()=>this.prefs.background_options.mouseover?1:0,u_background_size:()=>this.render_props.background_size,u_foreground_size:()=>this.render_props.foreground_size,u_k:(r,a)=>a.transform.k,u_window_scale:t.prop("webgl_scale"),u_last_window_scale:t.prop("last_webgl_scale"),u_time:({time:r})=>r,u_filter_numeric(){return this.aes.dim("filter").current.ops_to_array()},u_last_filter_numeric(){return this.aes.dim("filter").last.ops_to_array()},u_filter2_numeric(){return this.aes.dim("filter2").current.ops_to_array()},u_last_filter2_numeric(){return this.aes.dim("filter2").last.ops_to_array()},u_foreground_numeric(){return this.aes.dim("foreground").current.ops_to_array()},u_last_foreground_numeric(){return this.aes.dim("foreground").last.ops_to_array()},u_jitter:()=>this.aes.dim("jitter_radius").current.jitter_int_format,u_last_jitter:()=>this.aes.dim("jitter_radius").last.jitter_int_format,u_zoom(r,a){return a.zoom_matrix}}};for(const r of nu(0,16))e.attributes[`buffer_${r}`]=(a,{manager:o,buffer_num_to_variable:f})=>o.regl_elements.get(f[r])||{constant:0};for(const r of["x","y","color","jitter_radius","x0","y0","jitter_speed","size","filter","filter2","foreground"])for(const a of["current","last"]){const o=a==="current"?"":"last_";e.uniforms[`u_${o}${r}_map_position`]=()=>this.aes.dim(r)[a].map_position,e.uniforms[`u_${o}${r}_buffer_num`]=(f,{aes_to_buffer_num:c})=>{const l=c[`${r}--${a}`];return l===void 0?-1:l},e.uniforms[`u_${o}${r}_domain`]=()=>this.aes.dim(r)[a].webGLDomain,e.uniforms[`u_${o}${r}_range`]=()=>this.aes.dim(r)[a].range,e.uniforms[`u_${o}${r}_transform`]=()=>{const f=this.aes.dim(r)[a].transform;if(f==="linear")return 1;if(f==="sqrt")return 2;if(f==="log")return 3;if(f==="literal")return 4;throw"Invalid transform"},e.uniforms[`u_${o}${r}_constant`]=()=>this.aes.dim(r)[a].constant}return this._renderer=t(e),this._renderer}allocate_aesthetic_buffers(){const t=[],e=["x","y","color","x0","y0","size","jitter_radius","jitter_speed","filter","filter2","foreground"];for(const c of e){const l=["current","last"];for(const _ of l)try{this.aes.dim(c)[_].field&&t.push({aesthetic:c,time:_,field:this.aes.dim(c)[_].field})}catch(m){throw this.reglframe=void 0,m}}t.sort((c,l)=>c.time<l.time?-1:l.time<c.time?1:e.indexOf(c.aesthetic)-e.indexOf(l.aesthetic));const r={},a={ix:0,ix_in_tile:1};let o=1;for(const{aesthetic:c,time:l,field:_}of t){const m=`${c}--${l}`;if(a[_]!==void 0){r[m]=a[_];continue}if(o++<16){r[m]=o,a[_]=o;continue}else r[m]=r[`${c}--current`]}const f=[...Object.keys(a)];this.aes_to_buffer_num=r,this.variable_to_buffer_num=a,this.buffer_num_to_variable=f}get discard_share(){return 0}}class t2{constructor(t,e,r){this.tile=e,this.regl=t,this.renderer=r,this.regl_elements=new Map([["ix_in_tile",{offset:0,stride:4,buffer:r.integer_buffer,byte_size:4*2**16}]])}ready(){const{renderer:t}=this,e=new Set;for(const[r,a]of t.aes)for(const o of a.states)o.field&&e.add(o.field);for(const r of["ix","ix_in_tile",...e])if(!this.ready_or_not_here_it_comes(r).ready)return!1;return!0}ready_or_not_here_it_comes(t){const{renderer:e,regl_elements:r}=this,a=this.regl_elements.get(t);return a===null?{ready:!1,promise:null}:a===void 0?this.tile.ready?(r.set(t,null),{ready:!1,promise:new Promise(f=>{e.deferred_functions.push(async()=>{await this.create_regl_buffer(t),f()})})}):{ready:!1,promise:null}:{ready:!0,promise:Promise.resolve()}}release(t){let e;(e=this.regl_elements.get(t))&&this.renderer.buffers.free_block(e)}get count(){return this.tile.record_batch.numRows}async create_buffer_data(t){var e;const{tile:r}=this;if(!r.ready)throw new Error("Tile table not present.");let a=r.record_batch.getChild(t);if(!a)if(await r.dataset.transformations[t]!==void 0){if(await r.apply_transformation(t),a=r.record_batch.getChild(t),!a)throw new Error(`${t} was not created.`)}else{const f=r.record_batch.schema.fields.map(c=>c.name);throw new Error(`Requested ${t} but table only has columns ["${f.join('", "')}]"`)}if(a.type.typeId!==3){const o=new Float32Array(r.record_batch.numRows),f=a.data[0];if(a.type.dictionary)for(let c=0;c<r.record_batch.numRows;c++)o[c]=f.values[c]-2047;else if(f.stride===2&&a.type.typeId===10){const c=new Int32Array(f.values).buffer,l=new BigInt64Array(c),_=(e=a==null?void 0:a.type)==null?void 0:e.unit,m=_===0?.001:_===1?1:_===2?1e3:_===3?1e6:42;if(m===42)throw new Error(`Unknown time type ${_}`);for(let A=0;A<r.record_batch.numRows;A++)o[A]=Number(l[A])/m}else for(let c=0;c<r.record_batch.numRows;c++)o[c]=Number(f.values[c]);return o}return a.data[0].values.constructor===Float64Array?new Float32Array(a.data[0].values):a.data[0].values}async create_regl_buffer(t){const{regl_elements:e,renderer:r}=this,a=await this.create_buffer_data(t);if(a.constructor!==Float32Array)throw console.warn(typeof a,a),new Error("Buffer data must be a Float32Array");const o=4,f=a.length,c=r.buffers.allocate_block(f,o);e.set(t,c),c.buffer.subdata(a,c.offset)}}class Qb{constructor(t,e){this.freed_buffers=[],this.regl=t,this.buffer_size=e,this.buffers=[],this.pointer=0,this.generate_new_buffer()}generate_new_buffer(){this.buffers.length&&this.buffer_size-this.pointer>128&&this.freed_buffers.push({buffer:this.buffers[0],offset:this.pointer,stride:4,byte_size:this.buffer_size-this.pointer}),this.pointer=0,this.buffers.unshift(this.regl.buffer({type:"float",length:this.buffer_size,usage:"dynamic"}))}free_block(t){this.freed_buffers.push(t)}allocate_block(t,e){const r=t*e;let a=0;for(const f of this.freed_buffers){if(f.byte_size===r)return this.freed_buffers.splice(a,1),{buffer:f.buffer,offset:f.offset,stride:e,byte_size:r};a+=1}this.pointer+t*e>this.buffer_size&&this.generate_new_buffer();const o={buffer:this.buffers[0],offset:this.pointer,stride:e,byte_size:t*e};return this.pointer+=t*e,o}}function Me(n,t,e,r){function a(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function c(m){try{_(r.next(m))}catch(A){f(A)}}function l(m){try{_(r.throw(m))}catch(A){f(A)}}function _(m){m.done?o(m.value):a(m.value).then(c,l)}_((r=r.apply(n,t||[])).next())})}function ty(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xe(n){return this instanceof Xe?(this.v=n,this):new Xe(n)}function Ka(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(n,t||[]),a,o=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(R){r[R]&&(a[R]=function(C){return new Promise(function(G,$t){o.push([R,C,G,$t])>1||c(R,C)})})}function c(R,C){try{l(r[R](C))}catch(G){A(o[0][3],G)}}function l(R){R.value instanceof Xe?Promise.resolve(R.value.v).then(_,m):A(o[0][2],R)}function _(R){c("next",R)}function m(R){c("throw",R)}function A(R,C){R(C),o.shift(),o.length&&c(o[0][0],o[0][1])}}function l_(n){var t,e;return t={},r("next"),r("throw",function(a){throw a}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(a,o){t[a]=n[a]?function(f){return(e=!e)?{value:Xe(n[a](f)),done:a==="return"}:o?o(f):f}:o}}function Oc(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof ty=="function"?ty(n):n[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(o){e[o]=n[o]&&function(f){return new Promise(function(c,l){f=n[o](f),a(c,l,f.done,f.value)})}}function a(o,f,c,l){Promise.resolve(l).then(function(_){o({value:_,done:c})},f)}}const e2=new TextDecoder("utf-8"),A0=n=>e2.decode(n),n2=new TextEncoder,og=n=>n2.encode(n),[oO,r2]=(()=>{const n=()=>{throw new Error("BigInt is not available in this environment")};function t(){throw n()}return t.asIntN=()=>{throw n()},t.asUintN=()=>{throw n()},typeof BigInt<"u"?[BigInt,!0]:[t,!1]})(),[qo,fO]=(()=>{const n=()=>{throw new Error("BigInt64Array is not available in this environment")};class t{static get BYTES_PER_ELEMENT(){return 8}static of(){throw n()}static from(){throw n()}constructor(){throw n()}}return typeof BigInt64Array<"u"?[BigInt64Array,!0]:[t,!1]})(),[Zo,uO]=(()=>{const n=()=>{throw new Error("BigUint64Array is not available in this environment")};class t{static get BYTES_PER_ELEMENT(){return 8}static of(){throw n()}static from(){throw n()}constructor(){throw n()}}return typeof BigUint64Array<"u"?[BigUint64Array,!0]:[t,!1]})(),i2=n=>typeof n=="number",a2=n=>typeof n=="boolean",jr=n=>typeof n=="function",da=n=>n!=null&&Object(n)===n,Uh=n=>da(n)&&jr(n.then),Ip=n=>da(n)&&jr(n[Symbol.iterator]),fg=n=>da(n)&&jr(n[Symbol.asyncIterator]),E0=n=>da(n)&&da(n.schema),n1=n=>da(n)&&"done"in n&&"value"in n,r1=n=>da(n)&&jr(n.stat)&&i2(n.fd),i1=n=>da(n)&&ug(n.body),a1=n=>"_getDOMStream"in n&&"_getNodeStream"in n,ug=n=>da(n)&&jr(n.cancel)&&jr(n.getReader)&&!a1(n),s1=n=>da(n)&&jr(n.read)&&jr(n.pipe)&&a2(n.readable)&&!a1(n),s2=n=>da(n)&&jr(n.clear)&&jr(n.bytes)&&jr(n.position)&&jr(n.setPosition)&&jr(n.capacity)&&jr(n.getBufferIdentifier)&&jr(n.createLong),cg=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function o2(n){const t=n[0]?[n[0]]:[];let e,r,a,o;for(let f,c,l=0,_=0,m=n.length;++l<m;){if(f=t[_],c=n[l],!f||!c||f.buffer!==c.buffer||c.byteOffset<f.byteOffset){c&&(t[++_]=c);continue}if({byteOffset:e,byteLength:a}=f,{byteOffset:r,byteLength:o}=c,e+a<r||r+o<e){c&&(t[++_]=c);continue}t[_]=new Uint8Array(f.buffer,e,r-e+o)}return t}function ey(n,t,e=0,r=t.byteLength){const a=n.byteLength,o=new Uint8Array(n.buffer,n.byteOffset,a),f=new Uint8Array(t.buffer,t.byteOffset,Math.min(r,a));return o.set(f,e),n}function ts(n,t){const e=o2(n),r=e.reduce((m,A)=>m+A.byteLength,0);let a,o,f,c=0,l=-1;const _=Math.min(t||Number.POSITIVE_INFINITY,r);for(const m=e.length;++l<m;){if(a=e[l],o=a.subarray(0,Math.min(a.length,_-c)),_<=c+o.length){o.length<a.length?e[l]=a.subarray(o.length):o.length===a.length&&l++,f?ey(f,o,c):f=o;break}ey(f||(f=new Uint8Array(_)),o,c),c+=o.length}return[f||new Uint8Array(0),e.slice(l),r-(f?f.byteLength:0)]}function Rn(n,t){let e=n1(t)?t.value:t;return e instanceof n?n===Uint8Array?new n(e.buffer,e.byteOffset,e.byteLength):e:e?(typeof e=="string"&&(e=og(e)),e instanceof ArrayBuffer?new n(e):e instanceof cg?new n(e):s2(e)?Rn(n,e.bytes()):ArrayBuffer.isView(e)?e.byteLength<=0?new n(0):new n(e.buffer,e.byteOffset,e.byteLength/n.BYTES_PER_ELEMENT):n.from(e)):new n(0)}const vh=n=>Rn(Int32Array,n),xn=n=>Rn(Uint8Array,n),T0=n=>(n.next(),n);function*f2(n,t){const e=function*(a){yield a},r=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof cg?e(t):Ip(t)?t:e(t);return yield*T0(function*(a){let o=null;do o=a.next(yield Rn(n,o));while(!o.done)}(r[Symbol.iterator]())),new n}const u2=n=>f2(Uint8Array,n);function o1(n,t){return Ka(this,arguments,function*(){if(Uh(t))return yield Xe(yield Xe(yield*l_(Oc(o1(n,yield Xe(t))))));const r=function(f){return Ka(this,arguments,function*(){yield yield Xe(yield Xe(f))})},a=function(f){return Ka(this,arguments,function*(){yield Xe(yield*l_(Oc(T0(function*(c){let l=null;do l=c.next(yield l==null?void 0:l.value);while(!l.done)}(f[Symbol.iterator]())))))})},o=typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof cg?r(t):Ip(t)?a(t):fg(t)?t:r(t);return yield Xe(yield*l_(Oc(T0(function(f){return Ka(this,arguments,function*(){let c=null;do c=yield Xe(f.next(yield yield Xe(Rn(n,c))));while(!c.done)})}(o[Symbol.asyncIterator]()))))),yield Xe(new n)})}const c2=n=>o1(Uint8Array,n);function l2(n,t){let e=0;const r=n.length;if(r!==t.length)return!1;if(r>0)do if(n[e]!==t[e])return!1;while(++e<r);return!0}const Fi={fromIterable(n){return n_(h2(n))},fromAsyncIterable(n){return n_(d2(n))},fromDOMStream(n){return n_(_2(n))},fromNodeStream(n){return n_(m2(n))},toDOMStream(n,t){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(n,t){throw new Error('"toNodeStream" not available in this environment')}},n_=n=>(n.next(),n);function*h2(n){let t,e=!1,r=[],a,o,f,c=0;function l(){return o==="peek"?ts(r,f)[0]:([a,r,c]=ts(r,f),a)}({cmd:o,size:f}=yield null);const _=u2(n)[Symbol.iterator]();try{do if({done:t,value:a}=Number.isNaN(f-c)?_.next():_.next(f-c),!t&&a.byteLength>0&&(r.push(a),c+=a.byteLength),t||f<=c)do({cmd:o,size:f}=yield l());while(f<c);while(!t)}catch(m){(e=!0)&&typeof _.throw=="function"&&_.throw(m)}finally{e===!1&&typeof _.return=="function"&&_.return(null)}return null}function d2(n){return Ka(this,arguments,function*(){let e,r=!1,a=[],o,f,c,l=0;function _(){return f==="peek"?ts(a,c)[0]:([o,a,l]=ts(a,c),o)}({cmd:f,size:c}=yield yield Xe(null));const m=c2(n)[Symbol.asyncIterator]();try{do if({done:e,value:o}=Number.isNaN(c-l)?yield Xe(m.next()):yield Xe(m.next(c-l)),!e&&o.byteLength>0&&(a.push(o),l+=o.byteLength),e||c<=l)do({cmd:f,size:c}=yield yield Xe(_()));while(c<l);while(!e)}catch(A){(r=!0)&&typeof m.throw=="function"&&(yield Xe(m.throw(A)))}finally{r===!1&&typeof m.return=="function"&&(yield Xe(m.return(new Uint8Array(0))))}return yield Xe(null)})}function _2(n){return Ka(this,arguments,function*(){let e=!1,r=!1,a=[],o,f,c,l=0;function _(){return f==="peek"?ts(a,c)[0]:([o,a,l]=ts(a,c),o)}({cmd:f,size:c}=yield yield Xe(null));const m=new p2(n);try{do if({done:e,value:o}=Number.isNaN(c-l)?yield Xe(m.read()):yield Xe(m.read(c-l)),!e&&o.byteLength>0&&(a.push(xn(o)),l+=o.byteLength),e||c<=l)do({cmd:f,size:c}=yield yield Xe(_()));while(c<l);while(!e)}catch(A){(r=!0)&&(yield Xe(m.cancel(A)))}finally{r===!1?yield Xe(m.cancel()):n.locked&&m.releaseLock()}return yield Xe(null)})}class p2{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return Me(this,void 0,void 0,function*(){const{reader:e,source:r}=this;e&&(yield e.cancel(t).catch(()=>{})),r&&r.locked&&this.releaseLock()})}read(t){return Me(this,void 0,void 0,function*(){if(t===0)return{done:this.reader==null,value:new Uint8Array(0)};const e=yield this.reader.read();return!e.done&&(e.value=xn(e)),e})}}const $m=(n,t)=>{const e=a=>r([t,a]);let r;return[t,e,new Promise(a=>(r=a)&&n.once(t,e))]};function m2(n){return Ka(this,arguments,function*(){const e=[];let r="error",a=!1,o=null,f,c,l=0,_=[],m;function A(){return f==="peek"?ts(_,c)[0]:([m,_,l]=ts(_,c),m)}if({cmd:f,size:c}=yield yield Xe(null),n.isTTY)return yield yield Xe(new Uint8Array(0)),yield Xe(null);try{e[0]=$m(n,"end"),e[1]=$m(n,"error");do{if(e[2]=$m(n,"readable"),[r,o]=yield Xe(Promise.race(e.map(C=>C[2]))),r==="error")break;if((a=r==="end")||(Number.isFinite(c-l)?(m=xn(n.read(c-l)),m.byteLength<c-l&&(m=xn(n.read()))):m=xn(n.read()),m.byteLength>0&&(_.push(m),l+=m.byteLength)),a||c<=l)do({cmd:f,size:c}=yield yield Xe(A()));while(c<l)}while(!a)}finally{yield Xe(R(e,r==="error"?o:null))}return yield Xe(null);function R(C,G){return m=_=null,new Promise(($t,Kt)=>{for(const[Mt,ie]of C)n.off(Mt,ie);try{const Mt=n.destroy;Mt&&Mt.call(n,G),G=void 0}catch(Mt){G=Mt||G}finally{G!=null?Kt(G):$t()}})}})}var zi;(function(n){n[n.V1=0]="V1",n[n.V2=1]="V2",n[n.V3=2]="V3",n[n.V4=3]="V4",n[n.V5=4]="V5"})(zi||(zi={}));var _a;(function(n){n[n.Sparse=0]="Sparse",n[n.Dense=1]="Dense"})(_a||(_a={}));var Fr;(function(n){n[n.HALF=0]="HALF",n[n.SINGLE=1]="SINGLE",n[n.DOUBLE=2]="DOUBLE"})(Fr||(Fr={}));var eo;(function(n){n[n.DAY=0]="DAY",n[n.MILLISECOND=1]="MILLISECOND"})(eo||(eo={}));var yn;(function(n){n[n.SECOND=0]="SECOND",n[n.MILLISECOND=1]="MILLISECOND",n[n.MICROSECOND=2]="MICROSECOND",n[n.NANOSECOND=3]="NANOSECOND"})(yn||(yn={}));var Yo;(function(n){n[n.YEAR_MONTH=0]="YEAR_MONTH",n[n.DAY_TIME=1]="DAY_TIME",n[n.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(Yo||(Yo={}));var Bn;(function(n){n[n.NONE=0]="NONE",n[n.Schema=1]="Schema",n[n.DictionaryBatch=2]="DictionaryBatch",n[n.RecordBatch=3]="RecordBatch",n[n.Tensor=4]="Tensor",n[n.SparseTensor=5]="SparseTensor"})(Bn||(Bn={}));var et;(function(n){n[n.NONE=0]="NONE",n[n.Null=1]="Null",n[n.Int=2]="Int",n[n.Float=3]="Float",n[n.Binary=4]="Binary",n[n.Utf8=5]="Utf8",n[n.Bool=6]="Bool",n[n.Decimal=7]="Decimal",n[n.Date=8]="Date",n[n.Time=9]="Time",n[n.Timestamp=10]="Timestamp",n[n.Interval=11]="Interval",n[n.List=12]="List",n[n.Struct=13]="Struct",n[n.Union=14]="Union",n[n.FixedSizeBinary=15]="FixedSizeBinary",n[n.FixedSizeList=16]="FixedSizeList",n[n.Map=17]="Map",n[n.Dictionary=-1]="Dictionary",n[n.Int8=-2]="Int8",n[n.Int16=-3]="Int16",n[n.Int32=-4]="Int32",n[n.Int64=-5]="Int64",n[n.Uint8=-6]="Uint8",n[n.Uint16=-7]="Uint16",n[n.Uint32=-8]="Uint32",n[n.Uint64=-9]="Uint64",n[n.Float16=-10]="Float16",n[n.Float32=-11]="Float32",n[n.Float64=-12]="Float64",n[n.DateDay=-13]="DateDay",n[n.DateMillisecond=-14]="DateMillisecond",n[n.TimestampSecond=-15]="TimestampSecond",n[n.TimestampMillisecond=-16]="TimestampMillisecond",n[n.TimestampMicrosecond=-17]="TimestampMicrosecond",n[n.TimestampNanosecond=-18]="TimestampNanosecond",n[n.TimeSecond=-19]="TimeSecond",n[n.TimeMillisecond=-20]="TimeMillisecond",n[n.TimeMicrosecond=-21]="TimeMicrosecond",n[n.TimeNanosecond=-22]="TimeNanosecond",n[n.DenseUnion=-23]="DenseUnion",n[n.SparseUnion=-24]="SparseUnion",n[n.IntervalDayTime=-25]="IntervalDayTime",n[n.IntervalYearMonth=-26]="IntervalYearMonth"})(et||(et={}));var Vs;(function(n){n[n.OFFSET=0]="OFFSET",n[n.DATA=1]="DATA",n[n.VALIDITY=2]="VALIDITY",n[n.TYPE=3]="TYPE"})(Vs||(Vs={}));const g2=void 0;function Gh(n){if(n===null)return"null";if(n===g2)return"undefined";switch(typeof n){case"number":return`${n}`;case"bigint":return`${n}`;case"string":return`"${n}"`}return typeof n[Symbol.toPrimitive]=="function"?n[Symbol.toPrimitive]("string"):ArrayBuffer.isView(n)?n instanceof qo||n instanceof Zo?`[${[...n].map(t=>Gh(t))}]`:`[${n}]`:ArrayBuffer.isView(n)?`[${n}]`:JSON.stringify(n,(t,e)=>typeof e=="bigint"?`${e}`:e)}const b2=Symbol.for("isArrowBigNum");function ga(n,...t){return t.length===0?Object.setPrototypeOf(Rn(this.TypedArray,n),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(n,...t),this.constructor.prototype)}ga.prototype[b2]=!0;ga.prototype.toJSON=function(){return`"${au(this)}"`};ga.prototype.valueOf=function(){return f1(this)};ga.prototype.toString=function(){return au(this)};ga.prototype[Symbol.toPrimitive]=function(n="default"){switch(n){case"number":return f1(this);case"string":return au(this);case"default":return I0(this)}return au(this)};function Bc(...n){return ga.apply(this,n)}function Rc(...n){return ga.apply(this,n)}function $h(...n){return ga.apply(this,n)}Object.setPrototypeOf(Bc.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(Rc.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf($h.prototype,Object.create(Uint32Array.prototype));Object.assign(Bc.prototype,ga.prototype,{constructor:Bc,signed:!0,TypedArray:Int32Array,BigIntArray:qo});Object.assign(Rc.prototype,ga.prototype,{constructor:Rc,signed:!1,TypedArray:Uint32Array,BigIntArray:Zo});Object.assign($h.prototype,ga.prototype,{constructor:$h,signed:!0,TypedArray:Uint32Array,BigIntArray:Zo});function f1(n){const{buffer:t,byteOffset:e,length:r,signed:a}=n,o=new Zo(t,e,r),f=a&&o[o.length-1]&BigInt(1)<<BigInt(63);let c=BigInt(f?1:0),l=BigInt(0);if(f){for(const _ of o)c+=~_*(BigInt(1)<<BigInt(32)*l++);c*=BigInt(-1)}else for(const _ of o)c+=_*(BigInt(1)<<BigInt(32)*l++);return c}let au,I0;r2?(I0=n=>n.byteLength===8?new n.BigIntArray(n.buffer,n.byteOffset,1)[0]:jm(n),au=n=>n.byteLength===8?`${new n.BigIntArray(n.buffer,n.byteOffset,1)[0]}`:jm(n)):(au=jm,I0=au);function jm(n){let t="";const e=new Uint32Array(2);let r=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2);const a=new Uint32Array((r=new Uint16Array(r).reverse()).buffer);let o=-1;const f=r.length-1;do{for(e[0]=r[o=0];o<f;)r[o++]=e[1]=e[0]/10,e[0]=(e[0]-e[1]*10<<16)+r[o];r[o]=e[1]=e[0]/10,e[0]=e[0]-e[1]*10,t=`${e[0]}${t}`}while(a[0]||a[1]||a[2]||a[3]);return t??"0"}class lg{static new(t,e){switch(e){case!0:return new Bc(t);case!1:return new Rc(t)}switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:case qo:return new Bc(t)}return t.byteLength===16?new $h(t):new Rc(t)}static signed(t){return new Bc(t)}static unsigned(t){return new Rc(t)}static decimal(t){return new $h(t)}constructor(t,e){return lg.new(t,e)}}var u1,c1,l1,h1,d1,_1,p1,m1,g1,b1,y1,v1,w1,x1,S1,A1,E1,T1,I1;class ze{static isNull(t){return(t==null?void 0:t.typeId)===et.Null}static isInt(t){return(t==null?void 0:t.typeId)===et.Int}static isFloat(t){return(t==null?void 0:t.typeId)===et.Float}static isBinary(t){return(t==null?void 0:t.typeId)===et.Binary}static isUtf8(t){return(t==null?void 0:t.typeId)===et.Utf8}static isBool(t){return(t==null?void 0:t.typeId)===et.Bool}static isDecimal(t){return(t==null?void 0:t.typeId)===et.Decimal}static isDate(t){return(t==null?void 0:t.typeId)===et.Date}static isTime(t){return(t==null?void 0:t.typeId)===et.Time}static isTimestamp(t){return(t==null?void 0:t.typeId)===et.Timestamp}static isInterval(t){return(t==null?void 0:t.typeId)===et.Interval}static isList(t){return(t==null?void 0:t.typeId)===et.List}static isStruct(t){return(t==null?void 0:t.typeId)===et.Struct}static isUnion(t){return(t==null?void 0:t.typeId)===et.Union}static isFixedSizeBinary(t){return(t==null?void 0:t.typeId)===et.FixedSizeBinary}static isFixedSizeList(t){return(t==null?void 0:t.typeId)===et.FixedSizeList}static isMap(t){return(t==null?void 0:t.typeId)===et.Map}static isDictionary(t){return(t==null?void 0:t.typeId)===et.Dictionary}static isDenseUnion(t){return ze.isUnion(t)&&t.mode===_a.Dense}static isSparseUnion(t){return ze.isUnion(t)&&t.mode===_a.Sparse}get typeId(){return et.NONE}}u1=Symbol.toStringTag;ze[u1]=(n=>(n.children=null,n.ArrayType=Array,n[Symbol.toStringTag]="DataType"))(ze.prototype);let Ho=class extends ze{toString(){return"Null"}get typeId(){return et.Null}};c1=Symbol.toStringTag;Ho[c1]=(n=>n[Symbol.toStringTag]="Null")(Ho.prototype);class Wr extends ze{constructor(t,e){super(),this.isSigned=t,this.bitWidth=e}get typeId(){return et.Int}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?qo:Zo}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}l1=Symbol.toStringTag;Wr[l1]=(n=>(n.isSigned=null,n.bitWidth=null,n[Symbol.toStringTag]="Int"))(Wr.prototype);class O1 extends Wr{constructor(){super(!0,8)}get ArrayType(){return Int8Array}}class B1 extends Wr{constructor(){super(!0,16)}get ArrayType(){return Int16Array}}class Uc extends Wr{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}let R1=class extends Wr{constructor(){super(!0,64)}get ArrayType(){return qo}};class M1 extends Wr{constructor(){super(!1,8)}get ArrayType(){return Uint8Array}}class L1 extends Wr{constructor(){super(!1,16)}get ArrayType(){return Uint16Array}}class N1 extends Wr{constructor(){super(!1,32)}get ArrayType(){return Uint32Array}}let D1=class extends Wr{constructor(){super(!1,64)}get ArrayType(){return Zo}};Object.defineProperty(O1.prototype,"ArrayType",{value:Int8Array});Object.defineProperty(B1.prototype,"ArrayType",{value:Int16Array});Object.defineProperty(Uc.prototype,"ArrayType",{value:Int32Array});Object.defineProperty(R1.prototype,"ArrayType",{value:qo});Object.defineProperty(M1.prototype,"ArrayType",{value:Uint8Array});Object.defineProperty(L1.prototype,"ArrayType",{value:Uint16Array});Object.defineProperty(N1.prototype,"ArrayType",{value:Uint32Array});Object.defineProperty(D1.prototype,"ArrayType",{value:Zo});class cu extends ze{constructor(t){super(),this.precision=t}get typeId(){return et.Float}get ArrayType(){switch(this.precision){case Fr.HALF:return Uint16Array;case Fr.SINGLE:return Float32Array;case Fr.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}h1=Symbol.toStringTag;cu[h1]=(n=>(n.precision=null,n[Symbol.toStringTag]="Float"))(cu.prototype);class F1 extends cu{constructor(){super(Fr.SINGLE)}}class C1 extends cu{constructor(){super(Fr.DOUBLE)}}Object.defineProperty(F1.prototype,"ArrayType",{value:Float32Array});Object.defineProperty(C1.prototype,"ArrayType",{value:Float64Array});let z_=class extends ze{constructor(){super()}get typeId(){return et.Binary}toString(){return"Binary"}};d1=Symbol.toStringTag;z_[d1]=(n=>(n.ArrayType=Uint8Array,n[Symbol.toStringTag]="Binary"))(z_.prototype);let U_=class extends ze{constructor(){super()}get typeId(){return et.Utf8}toString(){return"Utf8"}};_1=Symbol.toStringTag;U_[_1]=(n=>(n.ArrayType=Uint8Array,n[Symbol.toStringTag]="Utf8"))(U_.prototype);let G_=class extends ze{constructor(){super()}get typeId(){return et.Bool}toString(){return"Bool"}};p1=Symbol.toStringTag;G_[p1]=(n=>(n.ArrayType=Uint8Array,n[Symbol.toStringTag]="Bool"))(G_.prototype);let $_=class extends ze{constructor(t,e,r=128){super(),this.scale=t,this.precision=e,this.bitWidth=r}get typeId(){return et.Decimal}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}};m1=Symbol.toStringTag;$_[m1]=(n=>(n.scale=null,n.precision=null,n.ArrayType=Uint32Array,n[Symbol.toStringTag]="Decimal"))($_.prototype);class j_ extends ze{constructor(t){super(),this.unit=t}get typeId(){return et.Date}toString(){return`Date${(this.unit+1)*32}<${eo[this.unit]}>`}}g1=Symbol.toStringTag;j_[g1]=(n=>(n.unit=null,n.ArrayType=Int32Array,n[Symbol.toStringTag]="Date"))(j_.prototype);class jh extends ze{constructor(t,e){super(),this.unit=t,this.bitWidth=e}get typeId(){return et.Time}toString(){return`Time${this.bitWidth}<${yn[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return qo}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}b1=Symbol.toStringTag;jh[b1]=(n=>(n.unit=null,n.bitWidth=null,n[Symbol.toStringTag]="Time"))(jh.prototype);class V_ extends ze{constructor(t,e){super(),this.unit=t,this.timezone=e}get typeId(){return et.Timestamp}toString(){return`Timestamp<${yn[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}y1=Symbol.toStringTag;V_[y1]=(n=>(n.unit=null,n.timezone=null,n.ArrayType=Int32Array,n[Symbol.toStringTag]="Timestamp"))(V_.prototype);class W_ extends ze{constructor(t){super(),this.unit=t}get typeId(){return et.Interval}toString(){return`Interval<${Yo[this.unit]}>`}}v1=Symbol.toStringTag;W_[v1]=(n=>(n.unit=null,n.ArrayType=Int32Array,n[Symbol.toStringTag]="Interval"))(W_.prototype);let Y_=class extends ze{constructor(t){super(),this.children=[t]}get typeId(){return et.List}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}};w1=Symbol.toStringTag;Y_[w1]=(n=>(n.children=null,n[Symbol.toStringTag]="List"))(Y_.prototype);class Vr extends ze{constructor(t){super(),this.children=t}get typeId(){return et.Struct}toString(){return`Struct<{${this.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}}x1=Symbol.toStringTag;Vr[x1]=(n=>(n.children=null,n[Symbol.toStringTag]="Struct"))(Vr.prototype);class H_ extends ze{constructor(t,e,r){super(),this.mode=t,this.children=r,this.typeIds=e=Int32Array.from(e),this.typeIdToChildIndex=e.reduce((a,o,f)=>(a[o]=f)&&a||a,Object.create(null))}get typeId(){return et.Union}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(t=>`${t.type}`).join(" | ")}>`}}S1=Symbol.toStringTag;H_[S1]=(n=>(n.mode=null,n.typeIds=null,n.children=null,n.typeIdToChildIndex=null,n.ArrayType=Int8Array,n[Symbol.toStringTag]="Union"))(H_.prototype);let X_=class extends ze{constructor(t){super(),this.byteWidth=t}get typeId(){return et.FixedSizeBinary}toString(){return`FixedSizeBinary[${this.byteWidth}]`}};A1=Symbol.toStringTag;X_[A1]=(n=>(n.byteWidth=null,n.ArrayType=Uint8Array,n[Symbol.toStringTag]="FixedSizeBinary"))(X_.prototype);let q_=class extends ze{constructor(t,e){super(),this.listSize=t,this.children=[e]}get typeId(){return et.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}};E1=Symbol.toStringTag;q_[E1]=(n=>(n.children=null,n.listSize=null,n[Symbol.toStringTag]="FixedSizeList"))(q_.prototype);class Z_ extends ze{constructor(t,e=!1){super(),this.children=[t],this.keysSorted=e}get typeId(){return et.Map}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}}T1=Symbol.toStringTag;Z_[T1]=(n=>(n.children=null,n.keysSorted=null,n[Symbol.toStringTag]="Map_"))(Z_.prototype);const y2=(n=>()=>++n)(-1);class Gc extends ze{constructor(t,e,r,a){super(),this.indices=e,this.dictionary=t,this.isOrdered=a||!1,this.id=r==null?y2():typeof r=="number"?r:r.low}get typeId(){return et.Dictionary}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}I1=Symbol.toStringTag;Gc[I1]=(n=>(n.id=null,n.indices=null,n.isOrdered=null,n.dictionary=null,n[Symbol.toStringTag]="Dictionary"))(Gc.prototype);function Ws(n){const t=n;switch(n.typeId){case et.Decimal:return n.bitWidth/32;case et.Timestamp:return 2;case et.Date:return 1+t.unit;case et.Interval:return 1+t.unit;case et.FixedSizeList:return t.listSize;case et.FixedSizeBinary:return t.byteWidth;default:return 1}}class dn{visitMany(t,...e){return t.map((r,a)=>this.visit(r,...e.map(o=>o[a])))}visit(...t){return this.getVisitFn(t[0],!1).apply(this,t)}getVisitFn(t,e=!0){return v2(this,t,e)}getVisitFnByTypeId(t,e=!0){return mc(this,t,e)}visitNull(t,...e){return null}visitBool(t,...e){return null}visitInt(t,...e){return null}visitFloat(t,...e){return null}visitUtf8(t,...e){return null}visitBinary(t,...e){return null}visitFixedSizeBinary(t,...e){return null}visitDate(t,...e){return null}visitTimestamp(t,...e){return null}visitTime(t,...e){return null}visitDecimal(t,...e){return null}visitList(t,...e){return null}visitStruct(t,...e){return null}visitUnion(t,...e){return null}visitDictionary(t,...e){return null}visitInterval(t,...e){return null}visitFixedSizeList(t,...e){return null}visitMap(t,...e){return null}}function v2(n,t,e=!0){return typeof t=="number"?mc(n,t,e):typeof t=="string"&&t in et?mc(n,et[t],e):t&&t instanceof ze?mc(n,ny(t),e):t!=null&&t.type&&t.type instanceof ze?mc(n,ny(t.type),e):mc(n,et.NONE,e)}function mc(n,t,e=!0){let r=null;switch(t){case et.Null:r=n.visitNull;break;case et.Bool:r=n.visitBool;break;case et.Int:r=n.visitInt;break;case et.Int8:r=n.visitInt8||n.visitInt;break;case et.Int16:r=n.visitInt16||n.visitInt;break;case et.Int32:r=n.visitInt32||n.visitInt;break;case et.Int64:r=n.visitInt64||n.visitInt;break;case et.Uint8:r=n.visitUint8||n.visitInt;break;case et.Uint16:r=n.visitUint16||n.visitInt;break;case et.Uint32:r=n.visitUint32||n.visitInt;break;case et.Uint64:r=n.visitUint64||n.visitInt;break;case et.Float:r=n.visitFloat;break;case et.Float16:r=n.visitFloat16||n.visitFloat;break;case et.Float32:r=n.visitFloat32||n.visitFloat;break;case et.Float64:r=n.visitFloat64||n.visitFloat;break;case et.Utf8:r=n.visitUtf8;break;case et.Binary:r=n.visitBinary;break;case et.FixedSizeBinary:r=n.visitFixedSizeBinary;break;case et.Date:r=n.visitDate;break;case et.DateDay:r=n.visitDateDay||n.visitDate;break;case et.DateMillisecond:r=n.visitDateMillisecond||n.visitDate;break;case et.Timestamp:r=n.visitTimestamp;break;case et.TimestampSecond:r=n.visitTimestampSecond||n.visitTimestamp;break;case et.TimestampMillisecond:r=n.visitTimestampMillisecond||n.visitTimestamp;break;case et.TimestampMicrosecond:r=n.visitTimestampMicrosecond||n.visitTimestamp;break;case et.TimestampNanosecond:r=n.visitTimestampNanosecond||n.visitTimestamp;break;case et.Time:r=n.visitTime;break;case et.TimeSecond:r=n.visitTimeSecond||n.visitTime;break;case et.TimeMillisecond:r=n.visitTimeMillisecond||n.visitTime;break;case et.TimeMicrosecond:r=n.visitTimeMicrosecond||n.visitTime;break;case et.TimeNanosecond:r=n.visitTimeNanosecond||n.visitTime;break;case et.Decimal:r=n.visitDecimal;break;case et.List:r=n.visitList;break;case et.Struct:r=n.visitStruct;break;case et.Union:r=n.visitUnion;break;case et.DenseUnion:r=n.visitDenseUnion||n.visitUnion;break;case et.SparseUnion:r=n.visitSparseUnion||n.visitUnion;break;case et.Dictionary:r=n.visitDictionary;break;case et.Interval:r=n.visitInterval;break;case et.IntervalDayTime:r=n.visitIntervalDayTime||n.visitInterval;break;case et.IntervalYearMonth:r=n.visitIntervalYearMonth||n.visitInterval;break;case et.FixedSizeList:r=n.visitFixedSizeList;break;case et.Map:r=n.visitMap;break}if(typeof r=="function")return r;if(!e)return()=>null;throw new Error(`Unrecognized type '${et[t]}'`)}function ny(n){switch(n.typeId){case et.Null:return et.Null;case et.Int:{const{bitWidth:t,isSigned:e}=n;switch(t){case 8:return e?et.Int8:et.Uint8;case 16:return e?et.Int16:et.Uint16;case 32:return e?et.Int32:et.Uint32;case 64:return e?et.Int64:et.Uint64}return et.Int}case et.Float:switch(n.precision){case Fr.HALF:return et.Float16;case Fr.SINGLE:return et.Float32;case Fr.DOUBLE:return et.Float64}return et.Float;case et.Binary:return et.Binary;case et.Utf8:return et.Utf8;case et.Bool:return et.Bool;case et.Decimal:return et.Decimal;case et.Time:switch(n.unit){case yn.SECOND:return et.TimeSecond;case yn.MILLISECOND:return et.TimeMillisecond;case yn.MICROSECOND:return et.TimeMicrosecond;case yn.NANOSECOND:return et.TimeNanosecond}return et.Time;case et.Timestamp:switch(n.unit){case yn.SECOND:return et.TimestampSecond;case yn.MILLISECOND:return et.TimestampMillisecond;case yn.MICROSECOND:return et.TimestampMicrosecond;case yn.NANOSECOND:return et.TimestampNanosecond}return et.Timestamp;case et.Date:switch(n.unit){case eo.DAY:return et.DateDay;case eo.MILLISECOND:return et.DateMillisecond}return et.Date;case et.Interval:switch(n.unit){case Yo.DAY_TIME:return et.IntervalDayTime;case Yo.YEAR_MONTH:return et.IntervalYearMonth}return et.Interval;case et.Map:return et.Map;case et.List:return et.List;case et.Struct:return et.Struct;case et.Union:switch(n.mode){case _a.Dense:return et.DenseUnion;case _a.Sparse:return et.SparseUnion}return et.Union;case et.FixedSizeBinary:return et.FixedSizeBinary;case et.FixedSizeList:return et.FixedSizeList;case et.Dictionary:return et.Dictionary}throw new Error(`Unrecognized type '${et[n.typeId]}'`)}dn.prototype.visitInt8=null;dn.prototype.visitInt16=null;dn.prototype.visitInt32=null;dn.prototype.visitInt64=null;dn.prototype.visitUint8=null;dn.prototype.visitUint16=null;dn.prototype.visitUint32=null;dn.prototype.visitUint64=null;dn.prototype.visitFloat16=null;dn.prototype.visitFloat32=null;dn.prototype.visitFloat64=null;dn.prototype.visitDateDay=null;dn.prototype.visitDateMillisecond=null;dn.prototype.visitTimestampSecond=null;dn.prototype.visitTimestampMillisecond=null;dn.prototype.visitTimestampMicrosecond=null;dn.prototype.visitTimestampNanosecond=null;dn.prototype.visitTimeSecond=null;dn.prototype.visitTimeMillisecond=null;dn.prototype.visitTimeMicrosecond=null;dn.prototype.visitTimeNanosecond=null;dn.prototype.visitDenseUnion=null;dn.prototype.visitSparseUnion=null;dn.prototype.visitIntervalDayTime=null;dn.prototype.visitIntervalYearMonth=null;const k1=new Float64Array(1),_c=new Uint32Array(k1.buffer);function P1(n){const t=(n&31744)>>10,e=(n&1023)/1024,r=Math.pow(-1,(n&32768)>>15);switch(t){case 31:return r*(e?Number.NaN:1/0);case 0:return r*(e?6103515625e-14*e:0)}return r*Math.pow(2,t-15)*(1+e)}function w2(n){if(n!==n)return 32256;k1[0]=n;const t=(_c[1]&2147483648)>>16&65535;let e=_c[1]&2146435072,r=0;return e>=1089470464?_c[0]>0?e=31744:(e=(e&2080374784)>>16,r=(_c[1]&1048575)>>10):e<=1056964608?(r=1048576+(_c[1]&1048575),r=1048576+(r<<(e>>20)-998)>>21,e=0):(e=e-1056964608>>10,r=(_c[1]&1048575)+512>>10),t|e|r&65535}class Ue extends dn{}function Ve(n){return(t,e,r)=>{if(t.setValid(e,r!=null))return n(t,e,r)}}const x2=(n,t,e)=>{n[t]=Math.trunc(e/864e5)},hg=(n,t,e)=>{n[t]=Math.trunc(e%4294967296),n[t+1]=Math.trunc(e/4294967296)},S2=(n,t,e)=>{n[t]=Math.trunc(e*1e3%4294967296),n[t+1]=Math.trunc(e*1e3/4294967296)},A2=(n,t,e)=>{n[t]=Math.trunc(e*1e6%4294967296),n[t+1]=Math.trunc(e*1e6/4294967296)},z1=(n,t,e,r)=>{if(e+1<t.length){const{[e]:a,[e+1]:o}=t;n.set(r.subarray(0,o-a),a)}},E2=({offset:n,values:t},e,r)=>{const a=n+e;r?t[a>>3]|=1<<a%8:t[a>>3]&=~(1<<a%8)},ro=({values:n},t,e)=>{n[t]=e},dg=({values:n},t,e)=>{n[t]=e},U1=({values:n},t,e)=>{n[t]=w2(e)},T2=(n,t,e)=>{switch(n.type.precision){case Fr.HALF:return U1(n,t,e);case Fr.SINGLE:case Fr.DOUBLE:return dg(n,t,e)}},G1=({values:n},t,e)=>{x2(n,t,e.valueOf())},$1=({values:n},t,e)=>{hg(n,t*2,e.valueOf())},I2=({stride:n,values:t},e,r)=>{t.set(r.subarray(0,n),n*e)},O2=({values:n,valueOffsets:t},e,r)=>z1(n,t,e,r),B2=({values:n,valueOffsets:t},e,r)=>{z1(n,t,e,og(r))},R2=(n,t,e)=>{n.type.unit===eo.DAY?G1(n,t,e):$1(n,t,e)},j1=({values:n},t,e)=>hg(n,t*2,e/1e3),V1=({values:n},t,e)=>hg(n,t*2,e),W1=({values:n},t,e)=>S2(n,t*2,e),Y1=({values:n},t,e)=>A2(n,t*2,e),M2=(n,t,e)=>{switch(n.type.unit){case yn.SECOND:return j1(n,t,e);case yn.MILLISECOND:return V1(n,t,e);case yn.MICROSECOND:return W1(n,t,e);case yn.NANOSECOND:return Y1(n,t,e)}},H1=({values:n},t,e)=>{n[t]=e},X1=({values:n},t,e)=>{n[t]=e},q1=({values:n},t,e)=>{n[t]=e},Z1=({values:n},t,e)=>{n[t]=e},L2=(n,t,e)=>{switch(n.type.unit){case yn.SECOND:return H1(n,t,e);case yn.MILLISECOND:return X1(n,t,e);case yn.MICROSECOND:return q1(n,t,e);case yn.NANOSECOND:return Z1(n,t,e)}},N2=({values:n,stride:t},e,r)=>{n.set(r.subarray(0,t),t*e)},D2=(n,t,e)=>{const r=n.children[0],a=n.valueOffsets,o=$i.getVisitFn(r);if(Array.isArray(e))for(let f=-1,c=a[t],l=a[t+1];c<l;)o(r,c++,e[++f]);else for(let f=-1,c=a[t],l=a[t+1];c<l;)o(r,c++,e.get(++f))},F2=(n,t,e)=>{const r=n.children[0],{valueOffsets:a}=n,o=$i.getVisitFn(r);let{[t]:f,[t+1]:c}=a;const l=e instanceof Map?e.entries():Object.entries(e);for(const _ of l)if(o(r,f,_),++f>=c)break},C2=(n,t)=>(e,r,a,o)=>r&&e(r,n,t[o]),k2=(n,t)=>(e,r,a,o)=>r&&e(r,n,t.get(o)),P2=(n,t)=>(e,r,a,o)=>r&&e(r,n,t.get(a.name)),z2=(n,t)=>(e,r,a,o)=>r&&e(r,n,t[a.name]),U2=(n,t,e)=>{const r=n.type.children.map(o=>$i.getVisitFn(o.type)),a=e instanceof Map?P2(t,e):e instanceof Ne?k2(t,e):Array.isArray(e)?C2(t,e):z2(t,e);n.type.children.forEach((o,f)=>a(r[f],n.children[f],o,f))},G2=(n,t,e)=>{n.type.mode===_a.Dense?K1(n,t,e):J1(n,t,e)},K1=(n,t,e)=>{const r=n.type.typeIdToChildIndex[n.typeIds[t]],a=n.children[r];$i.visit(a,n.valueOffsets[t],e)},J1=(n,t,e)=>{const r=n.type.typeIdToChildIndex[n.typeIds[t]],a=n.children[r];$i.visit(a,t,e)},$2=(n,t,e)=>{var r;(r=n.dictionary)===null||r===void 0||r.set(n.values[t],e)},j2=(n,t,e)=>{n.type.unit===Yo.DAY_TIME?Q1(n,t,e):tw(n,t,e)},Q1=({values:n},t,e)=>{n.set(e.subarray(0,2),2*t)},tw=({values:n},t,e)=>{n[t]=e[0]*12+e[1]%12},V2=(n,t,e)=>{const{stride:r}=n,a=n.children[0],o=$i.getVisitFn(a);if(Array.isArray(e))for(let f=-1,c=t*r;++f<r;)o(a,c+f,e[f]);else for(let f=-1,c=t*r;++f<r;)o(a,c+f,e.get(f))};Ue.prototype.visitBool=Ve(E2);Ue.prototype.visitInt=Ve(ro);Ue.prototype.visitInt8=Ve(ro);Ue.prototype.visitInt16=Ve(ro);Ue.prototype.visitInt32=Ve(ro);Ue.prototype.visitInt64=Ve(ro);Ue.prototype.visitUint8=Ve(ro);Ue.prototype.visitUint16=Ve(ro);Ue.prototype.visitUint32=Ve(ro);Ue.prototype.visitUint64=Ve(ro);Ue.prototype.visitFloat=Ve(T2);Ue.prototype.visitFloat16=Ve(U1);Ue.prototype.visitFloat32=Ve(dg);Ue.prototype.visitFloat64=Ve(dg);Ue.prototype.visitUtf8=Ve(B2);Ue.prototype.visitBinary=Ve(O2);Ue.prototype.visitFixedSizeBinary=Ve(I2);Ue.prototype.visitDate=Ve(R2);Ue.prototype.visitDateDay=Ve(G1);Ue.prototype.visitDateMillisecond=Ve($1);Ue.prototype.visitTimestamp=Ve(M2);Ue.prototype.visitTimestampSecond=Ve(j1);Ue.prototype.visitTimestampMillisecond=Ve(V1);Ue.prototype.visitTimestampMicrosecond=Ve(W1);Ue.prototype.visitTimestampNanosecond=Ve(Y1);Ue.prototype.visitTime=Ve(L2);Ue.prototype.visitTimeSecond=Ve(H1);Ue.prototype.visitTimeMillisecond=Ve(X1);Ue.prototype.visitTimeMicrosecond=Ve(q1);Ue.prototype.visitTimeNanosecond=Ve(Z1);Ue.prototype.visitDecimal=Ve(N2);Ue.prototype.visitList=Ve(D2);Ue.prototype.visitStruct=Ve(U2);Ue.prototype.visitUnion=Ve(G2);Ue.prototype.visitDenseUnion=Ve(K1);Ue.prototype.visitSparseUnion=Ve(J1);Ue.prototype.visitDictionary=Ve($2);Ue.prototype.visitInterval=Ve(j2);Ue.prototype.visitIntervalDayTime=Ve(Q1);Ue.prototype.visitIntervalYearMonth=Ve(tw);Ue.prototype.visitFixedSizeList=Ve(V2);Ue.prototype.visitMap=Ve(F2);const $i=new Ue,oa=Symbol.for("parent"),Mc=Symbol.for("rowIndex");class _g{constructor(t,e){return this[oa]=t,this[Mc]=e,new Proxy(this,new Y2)}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[Mc],e=this[oa],r=e.type.children,a={};for(let o=-1,f=r.length;++o<f;)a[r[o].name]=ii.visit(e.children[o],t);return a}toString(){return`{${[...this].map(([t,e])=>`${Gh(t)}: ${Gh(e)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new W2(this[oa],this[Mc])}}class W2{constructor(t,e){this.childIndex=0,this.children=t.children,this.rowIndex=e,this.childFields=t.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const t=this.childIndex;return t<this.numChildren?(this.childIndex=t+1,{done:!1,value:[this.childFields[t].name,ii.visit(this.children[t],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(_g.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[oa]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Mc]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class Y2{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[oa].type.children.map(e=>e.name)}has(t,e){return t[oa].type.children.findIndex(r=>r.name===e)!==-1}getOwnPropertyDescriptor(t,e){if(t[oa].type.children.findIndex(r=>r.name===e)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const r=t[oa].type.children.findIndex(a=>a.name===e);if(r!==-1){const a=ii.visit(t[oa].children[r],t[Mc]);return Reflect.set(t,e,a),a}}set(t,e,r){const a=t[oa].type.children.findIndex(o=>o.name===e);return a!==-1?($i.visit(t[oa].children[a],t[Mc],r),Reflect.set(t,e,r)):Reflect.has(t,e)||typeof e=="symbol"?Reflect.set(t,e,r):!1}}class De extends dn{}function Ge(n){return(t,e)=>t.getValid(e)?n(t,e):null}const H2=(n,t)=>864e5*n[t],pg=(n,t)=>4294967296*n[t+1]+(n[t]>>>0),X2=(n,t)=>4294967296*(n[t+1]/1e3)+(n[t]>>>0)/1e3,q2=(n,t)=>4294967296*(n[t+1]/1e6)+(n[t]>>>0)/1e6,ew=n=>new Date(n),Z2=(n,t)=>ew(H2(n,t)),K2=(n,t)=>ew(pg(n,t)),J2=(n,t)=>null,nw=(n,t,e)=>{if(e+1>=t.length)return null;const r=t[e],a=t[e+1];return n.subarray(r,a)},Q2=({offset:n,values:t},e)=>{const r=n+e;return(t[r>>3]&1<<r%8)!==0},rw=({values:n},t)=>Z2(n,t),iw=({values:n},t)=>K2(n,t*2),Ko=({stride:n,values:t},e)=>t[n*e],tI=({stride:n,values:t},e)=>P1(t[n*e]),aw=({values:n},t)=>n[t],eI=({stride:n,values:t},e)=>t.subarray(n*e,n*(e+1)),nI=({values:n,valueOffsets:t},e)=>nw(n,t,e),rI=({values:n,valueOffsets:t},e)=>{const r=nw(n,t,e);return r!==null?A0(r):null},iI=({values:n},t)=>n[t],aI=({type:n,values:t},e)=>n.precision!==Fr.HALF?t[e]:P1(t[e]),sI=(n,t)=>n.type.unit===eo.DAY?rw(n,t):iw(n,t),sw=({values:n},t)=>1e3*pg(n,t*2),ow=({values:n},t)=>pg(n,t*2),fw=({values:n},t)=>X2(n,t*2),uw=({values:n},t)=>q2(n,t*2),oI=(n,t)=>{switch(n.type.unit){case yn.SECOND:return sw(n,t);case yn.MILLISECOND:return ow(n,t);case yn.MICROSECOND:return fw(n,t);case yn.NANOSECOND:return uw(n,t)}},cw=({values:n},t)=>n[t],lw=({values:n},t)=>n[t],hw=({values:n},t)=>n[t],dw=({values:n},t)=>n[t],fI=(n,t)=>{switch(n.type.unit){case yn.SECOND:return cw(n,t);case yn.MILLISECOND:return lw(n,t);case yn.MICROSECOND:return hw(n,t);case yn.NANOSECOND:return dw(n,t)}},uI=({values:n,stride:t},e)=>lg.decimal(n.subarray(t*e,t*(e+1))),cI=(n,t)=>{const{valueOffsets:e,stride:r,children:a}=n,{[t*r]:o,[t*r+1]:f}=e,l=a[0].slice(o,f-o);return new Ne([l])},lI=(n,t)=>{const{valueOffsets:e,children:r}=n,{[t]:a,[t+1]:o}=e,f=r[0];return new mg(f.slice(a,o-a))},hI=(n,t)=>new _g(n,t),dI=(n,t)=>n.type.mode===_a.Dense?_w(n,t):pw(n,t),_w=(n,t)=>{const e=n.type.typeIdToChildIndex[n.typeIds[t]],r=n.children[e];return ii.visit(r,n.valueOffsets[t])},pw=(n,t)=>{const e=n.type.typeIdToChildIndex[n.typeIds[t]],r=n.children[e];return ii.visit(r,t)},_I=(n,t)=>{var e;return(e=n.dictionary)===null||e===void 0?void 0:e.get(n.values[t])},pI=(n,t)=>n.type.unit===Yo.DAY_TIME?mw(n,t):gw(n,t),mw=({values:n},t)=>n.subarray(2*t,2*(t+1)),gw=({values:n},t)=>{const e=n[t],r=new Int32Array(2);return r[0]=Math.trunc(e/12),r[1]=Math.trunc(e%12),r},mI=(n,t)=>{const{stride:e,children:r}=n,o=r[0].slice(t*e,e);return new Ne([o])};De.prototype.visitNull=Ge(J2);De.prototype.visitBool=Ge(Q2);De.prototype.visitInt=Ge(iI);De.prototype.visitInt8=Ge(Ko);De.prototype.visitInt16=Ge(Ko);De.prototype.visitInt32=Ge(Ko);De.prototype.visitInt64=Ge(aw);De.prototype.visitUint8=Ge(Ko);De.prototype.visitUint16=Ge(Ko);De.prototype.visitUint32=Ge(Ko);De.prototype.visitUint64=Ge(aw);De.prototype.visitFloat=Ge(aI);De.prototype.visitFloat16=Ge(tI);De.prototype.visitFloat32=Ge(Ko);De.prototype.visitFloat64=Ge(Ko);De.prototype.visitUtf8=Ge(rI);De.prototype.visitBinary=Ge(nI);De.prototype.visitFixedSizeBinary=Ge(eI);De.prototype.visitDate=Ge(sI);De.prototype.visitDateDay=Ge(rw);De.prototype.visitDateMillisecond=Ge(iw);De.prototype.visitTimestamp=Ge(oI);De.prototype.visitTimestampSecond=Ge(sw);De.prototype.visitTimestampMillisecond=Ge(ow);De.prototype.visitTimestampMicrosecond=Ge(fw);De.prototype.visitTimestampNanosecond=Ge(uw);De.prototype.visitTime=Ge(fI);De.prototype.visitTimeSecond=Ge(cw);De.prototype.visitTimeMillisecond=Ge(lw);De.prototype.visitTimeMicrosecond=Ge(hw);De.prototype.visitTimeNanosecond=Ge(dw);De.prototype.visitDecimal=Ge(uI);De.prototype.visitList=Ge(cI);De.prototype.visitStruct=Ge(hI);De.prototype.visitUnion=Ge(dI);De.prototype.visitDenseUnion=Ge(_w);De.prototype.visitSparseUnion=Ge(pw);De.prototype.visitDictionary=Ge(_I);De.prototype.visitInterval=Ge(pI);De.prototype.visitIntervalDayTime=Ge(mw);De.prototype.visitIntervalYearMonth=Ge(gw);De.prototype.visitFixedSizeList=Ge(mI);De.prototype.visitMap=Ge(lI);const ii=new De,Wa=Symbol.for("keys"),Lc=Symbol.for("vals");class mg{constructor(t){return this[Wa]=new Ne([t.children[0]]).memoize(),this[Lc]=t.children[1],new Proxy(this,new bI)}[Symbol.iterator](){return new gI(this[Wa],this[Lc])}get size(){return this[Wa].length}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[Wa],e=this[Lc],r={};for(let a=-1,o=t.length;++a<o;)r[t.get(a)]=ii.visit(e,a);return r}toString(){return`{${[...this].map(([t,e])=>`${Gh(t)}: ${Gh(e)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class gI{constructor(t,e){this.keys=t,this.vals=e,this.keyIndex=0,this.numKeys=t.length}[Symbol.iterator](){return this}next(){const t=this.keyIndex;return t===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(t),ii.visit(this.vals,t)]})}}class bI{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[Wa].toArray().map(String)}has(t,e){return t[Wa].includes(e)}getOwnPropertyDescriptor(t,e){if(t[Wa].indexOf(e)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const r=t[Wa].indexOf(e);if(r!==-1){const a=ii.visit(Reflect.get(t,Lc),r);return Reflect.set(t,e,a),a}}set(t,e,r){const a=t[Wa].indexOf(e);return a!==-1?($i.visit(Reflect.get(t,Lc),a,r),Reflect.set(t,e,r)):Reflect.has(t,e)?Reflect.set(t,e,r):!1}}Object.defineProperties(mg.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Wa]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Lc]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let ry;function bw(n,t,e,r){const{length:a=0}=n;let o=typeof t!="number"?0:t,f=typeof e!="number"?a:e;return o<0&&(o=(o%a+a)%a),f<0&&(f=(f%a+a)%a),f<o&&(ry=o,o=f,f=ry),f>a&&(f=a),r?r(n,o,f):[o,f]}const iy=n=>n!==n;function Kc(n){if(typeof n!=="object"||n===null)return iy(n)?iy:e=>e===n;if(n instanceof Date){const e=n.valueOf();return r=>r instanceof Date?r.valueOf()===e:!1}return ArrayBuffer.isView(n)?e=>e?l2(n,e):!1:n instanceof Map?vI(n):Array.isArray(n)?yI(n):n instanceof Ne?wI(n):xI(n,!0)}function yI(n){const t=[];for(let e=-1,r=n.length;++e<r;)t[e]=Kc(n[e]);return Op(t)}function vI(n){let t=-1;const e=[];for(const r of n.values())e[++t]=Kc(r);return Op(e)}function wI(n){const t=[];for(let e=-1,r=n.length;++e<r;)t[e]=Kc(n.get(e));return Op(t)}function xI(n,t=!1){const e=Object.keys(n);if(!t&&e.length===0)return()=>!1;const r=[];for(let a=-1,o=e.length;++a<o;)r[a]=Kc(n[e[a]]);return Op(r,e)}function Op(n,t){return e=>{if(!e||typeof e!="object")return!1;switch(e.constructor){case Array:return SI(n,e);case Map:return ay(n,e,e.keys());case mg:case _g:case Object:case void 0:return ay(n,e,t||Object.keys(e))}return e instanceof Ne?AI(n,e):!1}}function SI(n,t){const e=n.length;if(t.length!==e)return!1;for(let r=-1;++r<e;)if(!n[r](t[r]))return!1;return!0}function AI(n,t){const e=n.length;if(t.length!==e)return!1;for(let r=-1;++r<e;)if(!n[r](t.get(r)))return!1;return!0}function ay(n,t,e){const r=e[Symbol.iterator](),a=t instanceof Map?t.keys():Object.keys(t)[Symbol.iterator](),o=t instanceof Map?t.values():Object.values(t)[Symbol.iterator]();let f=0;const c=n.length;let l=o.next(),_=r.next(),m=a.next();for(;f<c&&!_.done&&!m.done&&!l.done&&!(_.value!==m.value||!n[f](l.value));++f,_=r.next(),m=a.next(),l=o.next());return f===c&&_.done&&m.done&&l.done?!0:(r.return&&r.return(),a.return&&a.return(),o.return&&o.return(),!1)}function yw(n,t,e,r){return(e&1<<r)!==0}function EI(n,t,e,r){return(e&1<<r)>>r}function TI(n,t,e){const r=e.byteLength+7&-8;if(n>0||e.byteLength<r){const a=new Uint8Array(r);return a.set(n%8===0?e.subarray(n>>3):O0(new gg(e,n,t,null,yw)).subarray(0,r)),a}return e}function O0(n){const t=[];let e=0,r=0,a=0;for(const f of n)f&&(a|=1<<r),++r===8&&(t[e++]=a,a=r=0);(e===0||r>0)&&(t[e++]=a);const o=new Uint8Array(t.length+7&-8);return o.set(t),o}class gg{constructor(t,e,r,a,o){this.bytes=t,this.length=r,this.context=a,this.get=o,this.bit=e%8,this.byteIndex=e>>3,this.byte=t[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function B0(n,t,e){if(e-t<=0)return 0;if(e-t<8){let o=0;for(const f of new gg(n,t,e-t,n,EI))o+=f;return o}const r=e>>3<<3,a=t+(t%8===0?0:8-t%8);return B0(n,t,a)+B0(n,r,e)+II(n,a>>3,r-a>>3)}function II(n,t,e){let r=0,a=Math.trunc(t);const o=new DataView(n.buffer,n.byteOffset,n.byteLength),f=e===void 0?n.byteLength:a+e;for(;f-a>=4;)r+=Vm(o.getUint32(a)),a+=4;for(;f-a>=2;)r+=Vm(o.getUint16(a)),a+=2;for(;f-a>=1;)r+=Vm(o.getUint8(a)),a+=1;return r}function Vm(n){let t=Math.trunc(n);return t=t-(t>>>1&1431655765),t=(t&858993459)+(t>>>2&858993459),(t+(t>>>4)&252645135)*16843009>>>24}const OI=-1;class On{constructor(t,e,r,a,o,f=[],c){this.type=t,this.children=f,this.dictionary=c,this.offset=Math.floor(Math.max(e||0,0)),this.length=Math.floor(Math.max(r||0,0)),this._nullCount=Math.floor(Math.max(a||0,-1));let l;o instanceof On?(this.stride=o.stride,this.values=o.values,this.typeIds=o.typeIds,this.nullBitmap=o.nullBitmap,this.valueOffsets=o.valueOffsets):(this.stride=Ws(t),o&&((l=o[0])&&(this.valueOffsets=l),(l=o[1])&&(this.values=l),(l=o[2])&&(this.nullBitmap=l),(l=o[3])&&(this.typeIds=l))),this.nullable=this._nullCount!==0&&this.nullBitmap&&this.nullBitmap.byteLength>0}get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get byteLength(){let t=0;const{valueOffsets:e,values:r,nullBitmap:a,typeIds:o}=this;return e&&(t+=e.byteLength),r&&(t+=r.byteLength),a&&(t+=a.byteLength),o&&(t+=o.byteLength),this.children.reduce((f,c)=>f+c.byteLength,t)}get nullCount(){let t=this._nullCount,e;return t<=OI&&(e=this.nullBitmap)&&(this._nullCount=t=this.length-B0(e,this.offset,this.offset+this.length)),t}getValid(t){if(this.nullable&&this.nullCount>0){const e=this.offset+t;return(this.nullBitmap[e>>3]&1<<e%8)!==0}return!0}setValid(t,e){if(!this.nullable)return e;if(!this.nullBitmap||this.nullBitmap.byteLength<=t>>3){const{nullBitmap:l}=this._changeLengthAndBackfillNullBitmap(this.length);Object.assign(this,{nullBitmap:l,_nullCount:0})}const{nullBitmap:r,offset:a}=this,o=a+t>>3,f=(a+t)%8,c=r[o]>>f&1;return e?c===0&&(r[o]|=1<<f,this._nullCount=this.nullCount+1):c===1&&(r[o]&=~(1<<f),this._nullCount=this.nullCount-1),e}clone(t=this.type,e=this.offset,r=this.length,a=this._nullCount,o=this,f=this.children){return new On(t,e,r,a,o,f,this.dictionary)}slice(t,e){const{stride:r,typeId:a,children:o}=this,f=+(this._nullCount===0)-1,c=a===16?r:1,l=this._sliceBuffers(t,e,r,a);return this.clone(this.type,this.offset+t,e,f,l,o.length===0||this.valueOffsets?o:this._sliceChildren(o,c*t,c*e))}_changeLengthAndBackfillNullBitmap(t){if(this.typeId===et.Null)return this.clone(this.type,0,t,0);const{length:e,nullCount:r}=this,a=new Uint8Array((t+63&-64)>>3).fill(255,0,e>>3);a[e>>3]=(1<<e-(e&-8))-1,r>0&&a.set(TI(this.offset,e,this.nullBitmap),0);const o=this.buffers;return o[Vs.VALIDITY]=a,this.clone(this.type,0,t,r+(t-e),o)}_sliceBuffers(t,e,r,a){let o;const{buffers:f}=this;return(o=f[Vs.TYPE])&&(f[Vs.TYPE]=o.subarray(t,t+e)),(o=f[Vs.OFFSET])&&(f[Vs.OFFSET]=o.subarray(t,t+e+1))||(o=f[Vs.DATA])&&(f[Vs.DATA]=a===6?o:o.subarray(r*t,r*(t+e))),f}_sliceChildren(t,e,r){return t.map(a=>a.slice(e,r))}}On.prototype.children=Object.freeze([]);class Mh extends dn{visit(t){return this.getVisitFn(t.type).call(this,t)}visitNull(t){const{["type"]:e,["offset"]:r=0,["length"]:a=0}=t;return new On(e,r,a,0)}visitBool(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.nullBitmap),o=Rn(e.ArrayType,t.data),{["length"]:f=o.length>>3,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,a])}visitInt(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.nullBitmap),o=Rn(e.ArrayType,t.data),{["length"]:f=o.length,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,a])}visitFloat(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.nullBitmap),o=Rn(e.ArrayType,t.data),{["length"]:f=o.length,["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,a])}visitUtf8(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.data),o=xn(t.nullBitmap),f=vh(t.valueOffsets),{["length"]:c=f.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new On(e,r,c,l,[f,a,o])}visitBinary(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.data),o=xn(t.nullBitmap),f=vh(t.valueOffsets),{["length"]:c=f.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new On(e,r,c,l,[f,a,o])}visitFixedSizeBinary(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.nullBitmap),o=Rn(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,a])}visitDate(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.nullBitmap),o=Rn(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,a])}visitTimestamp(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.nullBitmap),o=Rn(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,a])}visitTime(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.nullBitmap),o=Rn(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,a])}visitDecimal(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.nullBitmap),o=Rn(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,a])}visitList(t){const{["type"]:e,["offset"]:r=0,["child"]:a}=t,o=xn(t.nullBitmap),f=vh(t.valueOffsets),{["length"]:c=f.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new On(e,r,c,l,[f,void 0,o],[a])}visitStruct(t){const{["type"]:e,["offset"]:r=0,["children"]:a=[]}=t,o=xn(t.nullBitmap),{length:f=a.reduce((l,{length:_})=>Math.max(l,_),0),nullCount:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,void 0,o],a)}visitUnion(t){const{["type"]:e,["offset"]:r=0,["children"]:a=[]}=t,o=xn(t.nullBitmap),f=Rn(e.ArrayType,t.typeIds),{["length"]:c=f.length,["nullCount"]:l=t.nullBitmap?-1:0}=t;if(ze.isSparseUnion(e))return new On(e,r,c,l,[void 0,void 0,o,f],a);const _=vh(t.valueOffsets);return new On(e,r,c,l,[_,void 0,o,f],a)}visitDictionary(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.nullBitmap),o=Rn(e.indices.ArrayType,t.data),{["dictionary"]:f=new Ne([new Mh().visit({type:e.dictionary})])}=t,{["length"]:c=o.length,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new On(e,r,c,l,[void 0,o,a],[],f)}visitInterval(t){const{["type"]:e,["offset"]:r=0}=t,a=xn(t.nullBitmap),o=Rn(e.ArrayType,t.data),{["length"]:f=o.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,o,a])}visitFixedSizeList(t){const{["type"]:e,["offset"]:r=0,["child"]:a=new Mh().visit({type:e.valueType})}=t,o=xn(t.nullBitmap),{["length"]:f=a.length/Ws(e),["nullCount"]:c=t.nullBitmap?-1:0}=t;return new On(e,r,f,c,[void 0,void 0,o],[a])}visitMap(t){const{["type"]:e,["offset"]:r=0,["child"]:a=new Mh().visit({type:e.childType})}=t,o=xn(t.nullBitmap),f=vh(t.valueOffsets),{["length"]:c=f.length-1,["nullCount"]:l=t.nullBitmap?-1:0}=t;return new On(e,r,c,l,[f,void 0,o],[a])}}function Re(n){return new Mh().visit(n)}class sy{constructor(t=0,e){this.numChunks=t,this.getChunkIterator=e,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const t=this.chunkIterator.next();if(!t.done)return t;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function vw(n){return n.reduce((t,e)=>t+e.nullCount,0)}function ww(n){return n.reduce((t,e,r)=>(t[r+1]=t[r]+e.length,t),new Uint32Array(n.length+1))}function xw(n,t,e,r){const a=[];for(let o=-1,f=n.length;++o<f;){const c=n[o],l=t[o],{length:_}=c;if(l>=r)break;if(e>=l+_)continue;if(l>=e&&l+_<=r){a.push(c);continue}const m=Math.max(0,e-l),A=Math.min(r-l,_);a.push(c.slice(m,A-m))}return a.length===0&&a.push(n[0].slice(0,0)),a}function bg(n,t,e,r){let a=0,o=0,f=t.length-1;do{if(a>=f-1)return e<t[f]?r(n,a,e-t[a]):null;o=a+Math.trunc((f-a)*.5),e<t[o]?f=o:a=o}while(a<f)}function yg(n,t){return n.getValid(t)}function Nc(n){function t(e,r,a){return n(e[r],a)}return function(e){const r=this.data;return bg(r,this._offsets,e,t)}}function Sw(n){let t;function e(r,a,o){return n(r[a],o,t)}return function(r,a){const o=this.data;t=a;const f=bg(o,this._offsets,r,e);return t=void 0,f}}function Aw(n){let t;function e(r,a,o){let f=o,c=0,l=0;for(let _=a-1,m=r.length;++_<m;){const A=r[_];if(~(c=n(A,t,f)))return l+c;f=0,l+=A.length}return-1}return function(r,a){t=r;const o=this.data,f=typeof a!="number"?e(o,0,0):bg(o,this._offsets,a,e);return t=void 0,f}}class Fe extends dn{}function BI(n,t){return t===null&&n.length>0?0:-1}function RI(n,t){const{nullBitmap:e}=n;if(!e||n.nullCount<=0)return-1;let r=0;for(const a of new gg(e,n.offset+(t||0),n.length,e,yw)){if(!a)return r;++r}return-1}function Qe(n,t,e){if(t===void 0)return-1;if(t===null)return RI(n,e);const r=ii.getVisitFn(n),a=Kc(t);for(let o=(e||0)-1,f=n.length;++o<f;)if(a(r(n,o)))return o;return-1}function Ew(n,t,e){const r=ii.getVisitFn(n),a=Kc(t);for(let o=(e||0)-1,f=n.length;++o<f;)if(a(r(n,o)))return o;return-1}Fe.prototype.visitNull=BI;Fe.prototype.visitBool=Qe;Fe.prototype.visitInt=Qe;Fe.prototype.visitInt8=Qe;Fe.prototype.visitInt16=Qe;Fe.prototype.visitInt32=Qe;Fe.prototype.visitInt64=Qe;Fe.prototype.visitUint8=Qe;Fe.prototype.visitUint16=Qe;Fe.prototype.visitUint32=Qe;Fe.prototype.visitUint64=Qe;Fe.prototype.visitFloat=Qe;Fe.prototype.visitFloat16=Qe;Fe.prototype.visitFloat32=Qe;Fe.prototype.visitFloat64=Qe;Fe.prototype.visitUtf8=Qe;Fe.prototype.visitBinary=Qe;Fe.prototype.visitFixedSizeBinary=Qe;Fe.prototype.visitDate=Qe;Fe.prototype.visitDateDay=Qe;Fe.prototype.visitDateMillisecond=Qe;Fe.prototype.visitTimestamp=Qe;Fe.prototype.visitTimestampSecond=Qe;Fe.prototype.visitTimestampMillisecond=Qe;Fe.prototype.visitTimestampMicrosecond=Qe;Fe.prototype.visitTimestampNanosecond=Qe;Fe.prototype.visitTime=Qe;Fe.prototype.visitTimeSecond=Qe;Fe.prototype.visitTimeMillisecond=Qe;Fe.prototype.visitTimeMicrosecond=Qe;Fe.prototype.visitTimeNanosecond=Qe;Fe.prototype.visitDecimal=Qe;Fe.prototype.visitList=Qe;Fe.prototype.visitStruct=Qe;Fe.prototype.visitUnion=Qe;Fe.prototype.visitDenseUnion=Ew;Fe.prototype.visitSparseUnion=Ew;Fe.prototype.visitDictionary=Qe;Fe.prototype.visitInterval=Qe;Fe.prototype.visitIntervalDayTime=Qe;Fe.prototype.visitIntervalYearMonth=Qe;Fe.prototype.visitFixedSizeList=Qe;Fe.prototype.visitMap=Qe;const K_=new Fe;class Ce extends dn{}function $e(n){const{type:t}=n;if(n.nullCount===0&&n.stride===1&&(t.typeId===et.Timestamp||t instanceof Wr&&t.bitWidth!==64||t instanceof jh&&t.bitWidth!==64||t instanceof cu&&t.precision!==Fr.HALF))return new sy(n.data.length,r=>{const a=n.data[r];return a.values.subarray(0,a.length)[Symbol.iterator]()});let e=0;return new sy(n.data.length,r=>{const o=n.data[r].length,f=n.slice(e,e+o);return e+=o,new MI(f)})}class MI{constructor(t){this.vector=t,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}Ce.prototype.visitNull=$e;Ce.prototype.visitBool=$e;Ce.prototype.visitInt=$e;Ce.prototype.visitInt8=$e;Ce.prototype.visitInt16=$e;Ce.prototype.visitInt32=$e;Ce.prototype.visitInt64=$e;Ce.prototype.visitUint8=$e;Ce.prototype.visitUint16=$e;Ce.prototype.visitUint32=$e;Ce.prototype.visitUint64=$e;Ce.prototype.visitFloat=$e;Ce.prototype.visitFloat16=$e;Ce.prototype.visitFloat32=$e;Ce.prototype.visitFloat64=$e;Ce.prototype.visitUtf8=$e;Ce.prototype.visitBinary=$e;Ce.prototype.visitFixedSizeBinary=$e;Ce.prototype.visitDate=$e;Ce.prototype.visitDateDay=$e;Ce.prototype.visitDateMillisecond=$e;Ce.prototype.visitTimestamp=$e;Ce.prototype.visitTimestampSecond=$e;Ce.prototype.visitTimestampMillisecond=$e;Ce.prototype.visitTimestampMicrosecond=$e;Ce.prototype.visitTimestampNanosecond=$e;Ce.prototype.visitTime=$e;Ce.prototype.visitTimeSecond=$e;Ce.prototype.visitTimeMillisecond=$e;Ce.prototype.visitTimeMicrosecond=$e;Ce.prototype.visitTimeNanosecond=$e;Ce.prototype.visitDecimal=$e;Ce.prototype.visitList=$e;Ce.prototype.visitStruct=$e;Ce.prototype.visitUnion=$e;Ce.prototype.visitDenseUnion=$e;Ce.prototype.visitSparseUnion=$e;Ce.prototype.visitDictionary=$e;Ce.prototype.visitInterval=$e;Ce.prototype.visitIntervalDayTime=$e;Ce.prototype.visitIntervalYearMonth=$e;Ce.prototype.visitFixedSizeList=$e;Ce.prototype.visitMap=$e;const vg=new Ce,LI=(n,t)=>n+t;class Jo extends dn{visitNull(t,e){return 0}visitInt(t,e){return t.type.bitWidth/8}visitFloat(t,e){return t.type.ArrayType.BYTES_PER_ELEMENT}visitBool(t,e){return 1/8}visitDecimal(t,e){return t.type.bitWidth/8}visitDate(t,e){return(t.type.unit+1)*4}visitTime(t,e){return t.type.bitWidth/8}visitTimestamp(t,e){return t.type.unit===yn.SECOND?4:8}visitInterval(t,e){return(t.type.unit+1)*4}visitStruct(t,e){return t.children.reduce((r,a)=>r+es.visit(a,e),0)}visitFixedSizeBinary(t,e){return t.type.byteWidth}visitMap(t,e){return 8+t.children.reduce((r,a)=>r+es.visit(a,e),0)}visitDictionary(t,e){var r;return t.type.indices.bitWidth/8+(((r=t.dictionary)===null||r===void 0?void 0:r.getByteLength(t.values[e]))||0)}}const NI=({valueOffsets:n},t)=>8+(n[t+1]-n[t]),DI=({valueOffsets:n},t)=>8+(n[t+1]-n[t]),FI=({valueOffsets:n,stride:t,children:e},r)=>{const a=e[0],{[r*t]:o}=n,{[r*t+1]:f}=n,c=es.getVisitFn(a.type),l=a.slice(o,f-o);let _=8;for(let m=-1,A=f-o;++m<A;)_+=c(l,m);return _},CI=({stride:n,children:t},e)=>{const r=t[0],a=r.slice(e*n,n),o=es.getVisitFn(r.type);let f=0;for(let c=-1,l=a.length;++c<l;)f+=o(a,c);return f},kI=(n,t)=>n.type.mode===_a.Dense?Tw(n,t):Iw(n,t),Tw=({type:n,children:t,typeIds:e,valueOffsets:r},a)=>{const o=n.typeIdToChildIndex[e[a]];return 8+es.visit(t[o],r[a])},Iw=({children:n},t)=>4+es.visitMany(n,n.map(()=>t)).reduce(LI,0);Jo.prototype.visitUtf8=NI;Jo.prototype.visitBinary=DI;Jo.prototype.visitList=FI;Jo.prototype.visitFixedSizeList=CI;Jo.prototype.visitUnion=kI;Jo.prototype.visitDenseUnion=Tw;Jo.prototype.visitSparseUnion=Iw;const es=new Jo;var Ow;const Bw={},Rw={};class Ne{constructor(t){var e,r,a;const o=t[0]instanceof Ne?t.flatMap(c=>c.data):t;if(o.length===0||o.some(c=>!(c instanceof On)))throw new TypeError("Vector constructor expects an Array of Data instances.");const f=(e=o[0])===null||e===void 0?void 0:e.type;switch(o.length){case 0:this._offsets=[0];break;case 1:{const{get:c,set:l,indexOf:_,byteLength:m}=Bw[f.typeId],A=o[0];this.isValid=R=>yg(A,R),this.get=R=>c(A,R),this.set=(R,C)=>l(A,R,C),this.indexOf=R=>_(A,R),this.getByteLength=R=>m(A,R),this._offsets=[0,A.length];break}default:Object.setPrototypeOf(this,Rw[f.typeId]),this._offsets=ww(o);break}this.data=o,this.type=f,this.stride=Ws(f),this.numChildren=(a=(r=f.children)===null||r===void 0?void 0:r.length)!==null&&a!==void 0?a:0,this.length=this._offsets[this._offsets.length-1]}get byteLength(){return this._byteLength===-1&&(this._byteLength=this.data.reduce((t,e)=>t+e.byteLength,0)),this._byteLength}get nullCount(){return this._nullCount===-1&&(this._nullCount=vw(this.data)),this._nullCount}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${et[this.type.typeId]}Vector`}isValid(t){return!1}get(t){return null}set(t,e){}indexOf(t,e){return-1}includes(t,e){return this.indexOf(t,e)>0}getByteLength(t){return 0}[Symbol.iterator](){return vg.visit(this)}concat(...t){return new Ne(this.data.concat(t.flatMap(e=>e.data).flat(Number.POSITIVE_INFINITY)))}slice(t,e){return new Ne(bw(this,t,e,({data:r,_offsets:a},o,f)=>xw(r,a,o,f)))}toJSON(){return[...this]}toArray(){const{type:t,data:e,length:r,stride:a,ArrayType:o}=this;switch(t.typeId){case et.Int:case et.Float:case et.Decimal:case et.Time:case et.Timestamp:switch(e.length){case 0:return new o;case 1:return e[0].values.subarray(0,r*a);default:return e.reduce((f,{values:c,length:l})=>(f.array.set(c.subarray(0,l*a),f.offset),f.offset+=l*a,f),{array:new o(r*a),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(t){var e;return this.getChildAt((e=this.type.children)===null||e===void 0?void 0:e.findIndex(r=>r.name===t))}getChildAt(t){return t>-1&&t<this.numChildren?new Ne(this.data.map(({children:e})=>e[t])):null}get isMemoized(){return ze.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(ze.isDictionary(this.type)){const t=new J_(this.data[0].dictionary),e=this.data.map(r=>{const a=r.clone();return a.dictionary=t,a});return new Ne(e)}return new J_(this)}unmemoize(){if(ze.isDictionary(this.type)&&this.isMemoized){const t=this.data[0].dictionary.unmemoize(),e=this.data.map(r=>{const a=r.clone();return a.dictionary=t,a});return new Ne(e)}return this}}Ow=Symbol.toStringTag;Ne[Ow]=(n=>{n.type=ze.prototype,n.data=[],n.length=0,n.stride=1,n.numChildren=0,n._nullCount=-1,n._byteLength=-1,n._offsets=new Uint32Array([0]),n[Symbol.isConcatSpreadable]=!0;const t=Object.keys(et).map(e=>et[e]).filter(e=>typeof e=="number"&&e!==et.NONE);for(const e of t){const r=ii.getVisitFnByTypeId(e),a=$i.getVisitFnByTypeId(e),o=K_.getVisitFnByTypeId(e),f=es.getVisitFnByTypeId(e);Bw[e]={get:r,set:a,indexOf:o,byteLength:f},Rw[e]=Object.create(n,{isValid:{value:Nc(yg)},get:{value:Nc(ii.getVisitFnByTypeId(e))},set:{value:Sw($i.getVisitFnByTypeId(e))},indexOf:{value:Aw(K_.getVisitFnByTypeId(e))},getByteLength:{value:Nc(es.getVisitFnByTypeId(e))}})}return"Vector"})(Ne.prototype);class J_ extends Ne{constructor(t){super(t.data);const e=this.get,r=this.set,a=this.slice,o=new Array(this.length);Object.defineProperty(this,"get",{value(f){const c=o[f];if(c!==void 0)return c;const l=e.call(this,f);return o[f]=l,l}}),Object.defineProperty(this,"set",{value(f,c){r.call(this,f,c),o[f]=c}}),Object.defineProperty(this,"slice",{value:(f,c)=>new J_(a.call(this,f,c))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new Ne(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}function Mw(n){if(n){if(n instanceof On)return new Ne([n]);if(n instanceof Ne)return new Ne(n.data);if(n.type instanceof ze)return new Ne([Re(n)]);if(Array.isArray(n))return new Ne(n.flatMap(t=>PI(t)));if(ArrayBuffer.isView(n)){n instanceof DataView&&(n=new Uint8Array(n.buffer));const t={offset:0,length:n.length,nullCount:0,data:n};if(n instanceof Int8Array)return new Ne([Re(Object.assign(Object.assign({},t),{type:new O1}))]);if(n instanceof Int16Array)return new Ne([Re(Object.assign(Object.assign({},t),{type:new B1}))]);if(n instanceof Int32Array)return new Ne([Re(Object.assign(Object.assign({},t),{type:new Uc}))]);if(n instanceof qo)return new Ne([Re(Object.assign(Object.assign({},t),{type:new R1}))]);if(n instanceof Uint8Array||n instanceof Uint8ClampedArray)return new Ne([Re(Object.assign(Object.assign({},t),{type:new M1}))]);if(n instanceof Uint16Array)return new Ne([Re(Object.assign(Object.assign({},t),{type:new L1}))]);if(n instanceof Uint32Array)return new Ne([Re(Object.assign(Object.assign({},t),{type:new N1}))]);if(n instanceof Zo)return new Ne([Re(Object.assign(Object.assign({},t),{type:new D1}))]);if(n instanceof Float32Array)return new Ne([Re(Object.assign(Object.assign({},t),{type:new F1}))]);if(n instanceof Float64Array)return new Ne([Re(Object.assign(Object.assign({},t),{type:new C1}))]);throw new Error("Unrecognized input")}}throw new Error("Unrecognized input")}function PI(n){return n instanceof On?[n]:n instanceof Ne?n.data:Mw(n).data}class R0{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,e,r,a){return t.prep(8,24),t.writeInt64(a),t.pad(4),t.writeInt32(r),t.writeInt64(e),t.offset()}}const Wm=2,Ya=4,Hs=4,Ln=4,jo=new Int32Array(2),oy=new Float32Array(jo.buffer),fy=new Float64Array(jo.buffer),r_=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;let Ks=class M0{constructor(t,e){this.low=t|0,this.high=e|0}static create(t,e){return t==0&&e==0?M0.ZERO:new M0(t,e)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(t){return this.low==t.low&&this.high==t.high}};Ks.ZERO=new Ks(0,0);var L0;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(L0||(L0={}));let $c=class Lw{constructor(t){this.bytes_=t,this.position_=0}static allocate(t){return new Lw(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return new Ks(this.readInt32(t),this.readInt32(t+4))}readUint64(t){return new Ks(this.readUint32(t),this.readUint32(t+4))}readFloat32(t){return jo[0]=this.readInt32(t),oy[0]}readFloat64(t){return jo[r_?0:1]=this.readInt32(t),jo[r_?1:0]=this.readInt32(t+4),fy[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,e.low),this.writeInt32(t+4,e.high)}writeUint64(t,e){this.writeUint32(t,e.low),this.writeUint32(t+4,e.high)}writeFloat32(t,e){oy[0]=e,this.writeInt32(t,jo[0])}writeFloat64(t,e){fy[0]=e,this.writeInt32(t,jo[r_?0:1]),this.writeInt32(t+4,jo[r_?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Ya+Hs)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<Hs;e++)t+=String.fromCharCode(this.readInt8(this.position_+Ya+e));return t}__offset(t,e){const r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const r=this.readInt32(t);let a="",o=0;if(t+=Ya,e===L0.UTF8_BYTES)return this.bytes_.subarray(t,t+r);for(;o<r;){let f;const c=this.readUint8(t+o++);if(c<192)f=c;else{const l=this.readUint8(t+o++);if(c<224)f=(c&31)<<6|l&63;else{const _=this.readUint8(t+o++);if(c<240)f=(c&15)<<12|(l&63)<<6|_&63;else{const m=this.readUint8(t+o++);f=(c&7)<<18|(l&63)<<12|(_&63)<<6|m&63}}}f<65536?a+=String.fromCharCode(f):(f-=65536,a+=String.fromCharCode((f>>10)+55296,(f&1024-1)+56320))}return a}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+Ya}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=Hs)throw new Error("FlatBuffers: file identifier must be length "+Hs);for(let e=0;e<Hs;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+Ya+e))return!1;return!0}createLong(t,e){return Ks.create(t,e)}createScalarList(t,e){const r=[];for(let a=0;a<e;++a)t(a)!==null&&r.push(t(a));return r}createObjList(t,e){const r=[];for(let a=0;a<e;++a){const o=t(a);o!==null&&r.push(o.unpack())}return r}},Nw=class Dw{constructor(t){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let e;t?e=t:e=1024,this.bb=$c.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const r=~(this.bb.capacity()-this.space+e)+1&t-1;for(;this.space<r+t+e;){const a=this.bb.capacity();this.bb=Dw.growByteBuffer(this.bb),this.space+=this.bb.capacity()-a}this.pad(r)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,r){(this.force_defaults||e!=r)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,r){(this.force_defaults||e!=r)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,r){(this.force_defaults||e!=r)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,r){(this.force_defaults||!e.equals(r))&&(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,r){(this.force_defaults||e!=r)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,r){e!=r&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(e&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const r=e<<1,a=$c.allocate(r);return a.setPosition(r-e),a.bytes().set(t.bytes(),r-e),a}addOffset(t){this.prep(Ya,0),this.writeInt32(this.offset()-t+Ya)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&this.vtable[e]==0;e--);const r=e+1;for(;e>=0;e--)this.addInt16(this.vtable[e]!=0?t-this.vtable[e]:0);const a=2;this.addInt16(t-this.object_start);const o=(r+a)*Wm;this.addInt16(o);let f=0;const c=this.space;t:for(e=0;e<this.vtables.length;e++){const l=this.bb.capacity()-this.vtables[e];if(o==this.bb.readInt16(l)){for(let _=Wm;_<o;_+=Wm)if(this.bb.readInt16(c+_)!=this.bb.readInt16(l+_))continue t;f=this.vtables[e];break}}return f?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,f-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,r){const a=r?Ln:0;if(e){const o=e;if(this.prep(this.minalign,Ya+Hs+a),o.length!=Hs)throw new Error("FlatBuffers: file identifier must be length "+Hs);for(let f=Hs-1;f>=0;f--)this.writeInt8(o.charCodeAt(f))}this.prep(this.minalign,Ya+a),this.addOffset(t),a&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const r=this.bb.capacity()-t,a=r-this.bb.readInt32(r);if(!(this.bb.readInt16(a+e)!=0))throw new Error("FlatBuffers: field "+e+" must be set")}startVector(t,e,r){this.notNested(),this.vector_num_elems=e,this.prep(Ya,t*e),this.prep(r,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(!t)return 0;let e;if(t instanceof Uint8Array)e=t;else{e=[];let r=0;for(;r<t.length;){let a;const o=t.charCodeAt(r++);if(o<55296||o>=56320)a=o;else{const f=t.charCodeAt(r++);a=(o<<10)+f+(65536-56623104-56320)}a<128?e.push(a):(a<2048?e.push(a>>6&31|192):(a<65536?e.push(a>>12&15|224):e.push(a>>18&7|240,a>>12&63|128),e.push(a>>6&63|128)),e.push(a&63|128))}}this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);for(let r=0,a=this.space,o=this.bb.bytes();r<e.length;r++)o[a++]=e[r];return this.endVector()}createLong(t,e){return Ks.create(t,e)}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let r=0;r<t.length;++r){const a=t[r];if(a!==null)e.push(this.createObjectOffset(a));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t),this.endVector()}};class gr{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsKeyValue(t,e){return(e||new gr).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,e){return t.setPosition(t.position()+Ln),(e||new gr).__init(t.readInt32(t.position())+t.position(),t)}key(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}value(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,e){t.addFieldOffset(0,e,0)}static addValue(t,e){t.addFieldOffset(1,e,0)}static endKeyValue(t){return t.endObject()}static createKeyValue(t,e,r){return gr.startKeyValue(t),gr.addKey(t,e),gr.addValue(t,r),gr.endKeyValue(t)}}var jc;(function(n){n[n.V1=0]="V1",n[n.V2=1]="V2",n[n.V3=2]="V3",n[n.V4=3]="V4",n[n.V5=4]="V5"})(jc||(jc={}));var Vc;(function(n){n[n.Little=0]="Little",n[n.Big=1]="Big"})(Vc||(Vc={}));var Q_;(function(n){n[n.DenseArray=0]="DenseArray"})(Q_||(Q_={}));class wi{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInt(t,e){return(e||new wi).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,e){return t.setPosition(t.position()+Ln),(e||new wi).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startInt(t){t.startObject(2)}static addBitWidth(t,e){t.addFieldInt32(0,e,0)}static addIsSigned(t,e){t.addFieldInt8(1,+e,0)}static endInt(t){return t.endObject()}static createInt(t,e,r){return wi.startInt(t),wi.addBitWidth(t,e),wi.addIsSigned(t,r),wi.endInt(t)}}class Xs{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryEncoding(t,e){return(e||new Xs).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,e){return t.setPosition(t.position()+Ln),(e||new Xs).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}indexType(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new wi).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isOrdered(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}dictionaryKind(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):Q_.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,e){t.addFieldInt64(0,e,t.createLong(0,0))}static addIndexType(t,e){t.addFieldOffset(1,e,0)}static addIsOrdered(t,e){t.addFieldInt8(2,+e,0)}static addDictionaryKind(t,e){t.addFieldInt16(3,e,Q_.DenseArray)}static endDictionaryEncoding(t){return t.endObject()}}class Zf{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBinary(t,e){return(e||new Zf).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,e){return t.setPosition(t.position()+Ln),(e||new Zf).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){return t.endObject()}static createBinary(t){return Zf.startBinary(t),Zf.endBinary(t)}}class Kf{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBool(t,e){return(e||new Kf).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,e){return t.setPosition(t.position()+Ln),(e||new Kf).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){return t.endObject()}static createBool(t){return Kf.startBool(t),Kf.endBool(t)}}var tp;(function(n){n[n.DAY=0]="DAY",n[n.MILLISECOND=1]="MILLISECOND"})(tp||(tp={}));let h_=class gc{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDate(t,e){return(e||new gc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,e){return t.setPosition(t.position()+Ln),(e||new gc).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):tp.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,tp.MILLISECOND)}static endDate(t){return t.endObject()}static createDate(t,e){return gc.startDate(t),gc.addUnit(t,e),gc.endDate(t)}};class ni{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDecimal(t,e){return(e||new ni).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,e){return t.setPosition(t.position()+Ln),(e||new ni).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,e){t.addFieldInt32(0,e,0)}static addScale(t,e){t.addFieldInt32(1,e,0)}static addBitWidth(t,e){t.addFieldInt32(2,e,128)}static endDecimal(t){return t.endObject()}static createDecimal(t,e,r,a){return ni.startDecimal(t),ni.addPrecision(t,e),ni.addScale(t,r),ni.addBitWidth(t,a),ni.endDecimal(t)}}var Wc;(function(n){n[n.SECOND=0]="SECOND",n[n.MILLISECOND=1]="MILLISECOND",n[n.MICROSECOND=2]="MICROSECOND",n[n.NANOSECOND=3]="NANOSECOND"})(Wc||(Wc={}));class Ha{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeBinary(t,e){return(e||new Ha).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,e){return t.setPosition(t.position()+Ln),(e||new Ha).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeBinary(t){return t.endObject()}static createFixedSizeBinary(t,e){return Ha.startFixedSizeBinary(t),Ha.addByteWidth(t,e),Ha.endFixedSizeBinary(t)}}class Xa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeList(t,e){return(e||new Xa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,e){return t.setPosition(t.position()+Ln),(e||new Xa).__init(t.readInt32(t.position())+t.position(),t)}listSize(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeList(t){return t.endObject()}static createFixedSizeList(t,e){return Xa.startFixedSizeList(t),Xa.addListSize(t,e),Xa.endFixedSizeList(t)}}var ep;(function(n){n[n.HALF=0]="HALF",n[n.SINGLE=1]="SINGLE",n[n.DOUBLE=2]="DOUBLE"})(ep||(ep={}));class qa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFloatingPoint(t,e){return(e||new qa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,e){return t.setPosition(t.position()+Ln),(e||new qa).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ep.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,e){t.addFieldInt16(0,e,ep.HALF)}static endFloatingPoint(t){return t.endObject()}static createFloatingPoint(t,e){return qa.startFloatingPoint(t),qa.addPrecision(t,e),qa.endFloatingPoint(t)}}var np;(function(n){n[n.YEAR_MONTH=0]="YEAR_MONTH",n[n.DAY_TIME=1]="DAY_TIME",n[n.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(np||(np={}));class Za{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInterval(t,e){return(e||new Za).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,e){return t.setPosition(t.position()+Ln),(e||new Za).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):np.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,np.YEAR_MONTH)}static endInterval(t){return t.endObject()}static createInterval(t,e){return Za.startInterval(t),Za.addUnit(t,e),Za.endInterval(t)}}class Jf{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsList(t,e){return(e||new Jf).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,e){return t.setPosition(t.position()+Ln),(e||new Jf).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){return t.endObject()}static createList(t){return Jf.startList(t),Jf.endList(t)}}let d_=class bc{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMap(t,e){return(e||new bc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,e){return t.setPosition(t.position()+Ln),(e||new bc).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){const t=this.bb.__offset(this.bb_pos,4);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startMap(t){t.startObject(1)}static addKeysSorted(t,e){t.addFieldInt8(0,+e,0)}static endMap(t){return t.endObject()}static createMap(t,e){return bc.startMap(t),bc.addKeysSorted(t,e),bc.endMap(t)}};class Qf{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsNull(t,e){return(e||new Qf).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,e){return t.setPosition(t.position()+Ln),(e||new Qf).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){return t.endObject()}static createNull(t){return Qf.startNull(t),Qf.endNull(t)}}class tu{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsStruct_(t,e){return(e||new tu).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,e){return t.setPosition(t.position()+Ln),(e||new tu).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){return t.endObject()}static createStruct_(t){return tu.startStruct_(t),tu.endStruct_(t)}}class Ci{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTime(t,e){return(e||new Ci).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,e){return t.setPosition(t.position()+Ln),(e||new Ci).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Wc.MILLISECOND}bitWidth(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,Wc.MILLISECOND)}static addBitWidth(t,e){t.addFieldInt32(1,e,32)}static endTime(t){return t.endObject()}static createTime(t,e,r){return Ci.startTime(t),Ci.addUnit(t,e),Ci.addBitWidth(t,r),Ci.endTime(t)}}class ki{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTimestamp(t,e){return(e||new ki).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,e){return t.setPosition(t.position()+Ln),(e||new ki).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Wc.SECOND}timezone(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,Wc.SECOND)}static addTimezone(t,e){t.addFieldOffset(1,e,0)}static endTimestamp(t){return t.endObject()}static createTimestamp(t,e,r){return ki.startTimestamp(t),ki.addUnit(t,e),ki.addTimezone(t,r),ki.endTimestamp(t)}}var rp;(function(n){n[n.Sparse=0]="Sparse",n[n.Dense=1]="Dense"})(rp||(rp={}));class ri{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUnion(t,e){return(e||new ri).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,e){return t.setPosition(t.position()+Ln),(e||new ri).__init(t.readInt32(t.position())+t.position(),t)}mode(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):rp.Sparse}typeIds(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+t*4):0}typeIdsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,e){t.addFieldInt16(0,e,rp.Sparse)}static addTypeIds(t,e){t.addFieldOffset(1,e,0)}static createTypeIdsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()}static startTypeIdsVector(t,e){t.startVector(4,e,4)}static endUnion(t){return t.endObject()}static createUnion(t,e,r){return ri.startUnion(t),ri.addMode(t,e),ri.addTypeIds(t,r),ri.endUnion(t)}}class eu{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUtf8(t,e){return(e||new eu).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,e){return t.setPosition(t.position()+Ln),(e||new eu).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){return t.endObject()}static createUtf8(t){return eu.startUtf8(t),eu.endUtf8(t)}}var Xn;(function(n){n[n.NONE=0]="NONE",n[n.Null=1]="Null",n[n.Int=2]="Int",n[n.FloatingPoint=3]="FloatingPoint",n[n.Binary=4]="Binary",n[n.Utf8=5]="Utf8",n[n.Bool=6]="Bool",n[n.Decimal=7]="Decimal",n[n.Date=8]="Date",n[n.Time=9]="Time",n[n.Timestamp=10]="Timestamp",n[n.Interval=11]="Interval",n[n.List=12]="List",n[n.Struct_=13]="Struct_",n[n.Union=14]="Union",n[n.FixedSizeBinary=15]="FixedSizeBinary",n[n.FixedSizeList=16]="FixedSizeList",n[n.Map=17]="Map",n[n.Duration=18]="Duration",n[n.LargeBinary=19]="LargeBinary",n[n.LargeUtf8=20]="LargeUtf8",n[n.LargeList=21]="LargeList"})(Xn||(Xn={}));let Di=class __{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsField(t,e){return(e||new __).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,e){return t.setPosition(t.position()+Ln),(e||new __).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}nullable(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}typeType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):Xn.NONE}type(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__union(t,this.bb_pos+e):null}dictionary(t){const e=this.bb.__offset(this.bb_pos,12);return e?(t||new Xs).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}children(t,e){const r=this.bb.__offset(this.bb_pos,14);return r?(e||new __).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const r=this.bb.__offset(this.bb_pos,16);return r?(e||new gr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,e){t.addFieldOffset(0,e,0)}static addNullable(t,e){t.addFieldInt8(1,+e,0)}static addTypeType(t,e){t.addFieldInt8(2,e,Xn.NONE)}static addType(t,e){t.addFieldOffset(3,e,0)}static addDictionary(t,e){t.addFieldOffset(4,e,0)}static addChildren(t,e){t.addFieldOffset(5,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(6,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endField(t){return t.endObject()}},Ua=class $s{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSchema(t,e){return(e||new $s).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,e){return t.setPosition(t.position()+Ln),(e||new $s).__init(t.readInt32(t.position())+t.position(),t)}endianness(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Vc.Little}fields(t,e){const r=this.bb.__offset(this.bb_pos,6);return r?(e||new Di).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}fieldsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const r=this.bb.__offset(this.bb_pos,8);return r?(e||new gr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb.__vector(this.bb_pos+e)+t*8):this.bb.createLong(0,0)}featuresLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,e){t.addFieldInt16(0,e,Vc.Little)}static addFields(t,e){t.addFieldOffset(1,e,0)}static createFieldsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startFieldsVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(2,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static addFeatures(t,e){t.addFieldOffset(3,e,0)}static createFeaturesVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}static startFeaturesVector(t,e){t.startVector(8,e,8)}static endSchema(t){return t.endObject()}static finishSchemaBuffer(t,e){t.finish(e)}static finishSizePrefixedSchemaBuffer(t,e){t.finish(e,void 0,!0)}static createSchema(t,e,r,a,o){return $s.startSchema(t),$s.addEndianness(t,e),$s.addFields(t,r),$s.addCustomMetadata(t,a),$s.addFeatures(t,o),$s.endSchema(t)}};class vi{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFooter(t,e){return(e||new vi).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,e){return t.setPosition(t.position()+Ln),(e||new vi).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):jc.V1}schema(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new Ua).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}dictionaries(t,e){const r=this.bb.__offset(this.bb_pos,8);return r?(e||new R0).__init(this.bb.__vector(this.bb_pos+r)+t*24,this.bb):null}dictionariesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,e){const r=this.bb.__offset(this.bb_pos,10);return r?(e||new R0).__init(this.bb.__vector(this.bb_pos+r)+t*24,this.bb):null}recordBatchesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const r=this.bb.__offset(this.bb_pos,12);return r?(e||new gr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,jc.V1)}static addSchema(t,e){t.addFieldOffset(1,e,0)}static addDictionaries(t,e){t.addFieldOffset(2,e,0)}static startDictionariesVector(t,e){t.startVector(24,e,8)}static addRecordBatches(t,e){t.addFieldOffset(3,e,0)}static startRecordBatchesVector(t,e){t.startVector(24,e,8)}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endFooter(t){return t.endObject()}static finishFooterBuffer(t,e){t.finish(e)}static finishSizePrefixedFooterBuffer(t,e){t.finish(e,void 0,!0)}}class Sn{constructor(t=[],e,r){this.fields=t||[],this.metadata=e||new Map,r||(r=N0(t)),this.dictionaries=r}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(t=>t.name)}toString(){return`Schema<{ ${this.fields.map((t,e)=>`${e}: ${t}`).join(", ")} }>`}select(t){const e=new Set(t),r=this.fields.filter(a=>e.has(a.name));return new Sn(r,this.metadata)}selectAt(t){const e=t.map(r=>this.fields[r]).filter(Boolean);return new Sn(e,this.metadata)}assign(...t){const e=t[0]instanceof Sn?t[0]:Array.isArray(t[0])?new Sn(t[0]):new Sn(t),r=[...this.fields],a=i_(i_(new Map,this.metadata),e.metadata),o=e.fields.filter(c=>{const l=r.findIndex(_=>_.name===c.name);return~l?(r[l]=c.clone({metadata:i_(i_(new Map,r[l].metadata),c.metadata)}))&&!1:!0}),f=N0(o,new Map);return new Sn([...r,...o],a,new Map([...this.dictionaries,...f]))}}Sn.prototype.fields=null;Sn.prototype.metadata=null;Sn.prototype.dictionaries=null;class Gn{constructor(t,e,r=!1,a){this.name=t,this.type=e,this.nullable=r,this.metadata=a||new Map}static new(...t){let[e,r,a,o]=t;return t[0]&&typeof t[0]=="object"&&({name:e}=t[0],r===void 0&&(r=t[0].type),a===void 0&&(a=t[0].nullable),o===void 0&&(o=t[0].metadata)),new Gn(`${e}`,r,a,o)}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...t){let[e,r,a,o]=t;return!t[0]||typeof t[0]!="object"?[e=this.name,r=this.type,a=this.nullable,o=this.metadata]=t:{name:e=this.name,type:r=this.type,nullable:a=this.nullable,metadata:o=this.metadata}=t[0],Gn.new(e,r,a,o)}}Gn.prototype.type=null;Gn.prototype.name=null;Gn.prototype.nullable=null;Gn.prototype.metadata=null;function i_(n,t){return new Map([...n||new Map,...t||new Map])}function N0(n,t=new Map){for(let e=-1,r=n.length;++e<r;){const o=n[e].type;if(ze.isDictionary(o)){if(!t.has(o.id))t.set(o.id,o.dictionary);else if(t.get(o.id)!==o.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}o.children&&o.children.length>0&&N0(o.children,t)}return t}var uy=Ks,zI=Nw,UI=$c;class wg{constructor(t,e=zi.V4,r,a){this.schema=t,this.version=e,r&&(this._recordBatches=r),a&&(this._dictionaryBatches=a)}static decode(t){t=new UI(xn(t));const e=vi.getRootAsFooter(t),r=Sn.decode(e.schema());return new GI(r,e)}static encode(t){const e=new zI,r=Sn.encode(e,t.schema);vi.startRecordBatchesVector(e,t.numRecordBatches);for(const f of[...t.recordBatches()].slice().reverse())Yc.encode(e,f);const a=e.endVector();vi.startDictionariesVector(e,t.numDictionaries);for(const f of[...t.dictionaryBatches()].slice().reverse())Yc.encode(e,f);const o=e.endVector();return vi.startFooter(e),vi.addSchema(e,r),vi.addVersion(e,zi.V4),vi.addRecordBatches(e,a),vi.addDictionaries(e,o),vi.finishFooterBuffer(e,vi.endFooter(e)),e.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}*recordBatches(){for(let t,e=-1,r=this.numRecordBatches;++e<r;)(t=this.getRecordBatch(e))&&(yield t)}*dictionaryBatches(){for(let t,e=-1,r=this.numDictionaries;++e<r;)(t=this.getDictionaryBatch(e))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}}class GI extends wg{constructor(t,e){super(t,e.version()),this._footer=e}get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){const e=this._footer.recordBatches(t);if(e)return Yc.decode(e)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){const e=this._footer.dictionaries(t);if(e)return Yc.decode(e)}return null}}class Yc{constructor(t,e,r){this.metaDataLength=t,this.offset=typeof r=="number"?r:r.low,this.bodyLength=typeof e=="number"?e:e.low}static decode(t){return new Yc(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,e){const{metaDataLength:r}=e,a=new uy(e.offset,0),o=new uy(e.bodyLength,0);return R0.createBlock(t,a,r,o)}}const qn=Object.freeze({done:!0,value:void 0});class cy{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class Fw{tee(){return this._getDOMStream().tee()}pipe(t,e){return this._getNodeStream().pipe(t,e)}pipeTo(t,e){return this._getDOMStream().pipeTo(t,e)}pipeThrough(t,e){return this._getDOMStream().pipeThrough(t,e)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class $I extends Fw{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}get closed(){return this._closedPromise}cancel(t){return Me(this,void 0,void 0,function*(){yield this.return(t)})}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){const{resolvers:t}=this;for(;t.length>0;)t.shift().resolve(qn);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return Fi.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return Fi.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return Me(this,void 0,void 0,function*(){return yield this.abort(t),qn})}return(t){return Me(this,void 0,void 0,function*(){return yield this.close(),qn})}read(t){return Me(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return Me(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((e,r)=>{this.resolvers.push({resolve:e,reject:r})}):Promise.resolve(qn)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class jI extends $I{write(t){if((t=xn(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?A0(this.toUint8Array(!0)):this.toUint8Array(!1).then(A0)}toUint8Array(t=!1){return t?ts(this._values)[0]:(()=>Me(this,void 0,void 0,function*(){var e,r;const a=[];let o=0;try{for(var f=Oc(this),c;c=yield f.next(),!c.done;){const l=c.value;a.push(l),o+=l.byteLength}}catch(l){e={error:l}}finally{try{c&&!c.done&&(r=f.return)&&(yield r.call(f))}finally{if(e)throw e.error}}return ts(a,o)[0]}))()}}class ip{constructor(t){t&&(this.source=new VI(Fi.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class Hc{constructor(t){t instanceof Hc?this.source=t.source:t instanceof jI?this.source=new Xf(Fi.fromAsyncIterable(t)):s1(t)?this.source=new Xf(Fi.fromNodeStream(t)):ug(t)?this.source=new Xf(Fi.fromDOMStream(t)):i1(t)?this.source=new Xf(Fi.fromDOMStream(t.body)):Ip(t)?this.source=new Xf(Fi.fromIterable(t)):Uh(t)?this.source=new Xf(Fi.fromAsyncIterable(t)):fg(t)&&(this.source=new Xf(Fi.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class VI{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,e="read"){return this.source.next({cmd:e,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||qn)}return(t){return Object.create(this.source.return&&this.source.return(t)||qn)}}class Xf{constructor(t){this.source=t,this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}cancel(t){return Me(this,void 0,void 0,function*(){yield this.return(t)})}get closed(){return this._closedPromise}read(t){return Me(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return Me(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(t,e="read"){return Me(this,void 0,void 0,function*(){return yield this.source.next({cmd:e,size:t})})}throw(t){return Me(this,void 0,void 0,function*(){const e=this.source.throw&&(yield this.source.throw(t))||qn;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)})}return(t){return Me(this,void 0,void 0,function*(){const e=this.source.return&&(yield this.source.return(t))||qn;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)})}}class ly extends ip{constructor(t,e){super(),this.position=0,this.buffer=xn(t),this.size=typeof e>"u"?this.buffer.byteLength:e}readInt32(t){const{buffer:e,byteOffset:r}=this.readAt(t,4);return new DataView(e,r).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){const{buffer:e,size:r,position:a}=this;return e&&a<r?(typeof t!="number"&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(r,a+Math.min(r-a,t)),e.subarray(a,this.position)):null}readAt(t,e){const r=this.buffer,a=Math.min(this.size,t+e);return r?r.subarray(t,a):new Uint8Array(e)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}}class ap extends Hc{constructor(t,e){super(),this.position=0,this._handle=t,typeof e=="number"?this.size=e:this._pending=(()=>Me(this,void 0,void 0,function*(){this.size=(yield t.stat()).size,delete this._pending}))()}readInt32(t){return Me(this,void 0,void 0,function*(){const{buffer:e,byteOffset:r}=yield this.readAt(t,4);return new DataView(e,r).getInt32(0,!0)})}seek(t){return Me(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size})}read(t){return Me(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:e,size:r,position:a}=this;if(e&&a<r){typeof t!="number"&&(t=Number.POSITIVE_INFINITY);let o=a,f=0,c=0;const l=Math.min(r,o+Math.min(r-o,t)),_=new Uint8Array(Math.max(0,(this.position=l)-o));for(;(o+=c)<l&&(f+=c)<_.byteLength;)({bytesRead:c}=yield e.read(_,f,_.byteLength-f,o));return _}return null})}readAt(t,e){return Me(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:r,size:a}=this;if(r&&t+e<a){const o=Math.min(a,t+e),f=new Uint8Array(o-t);return(yield r.read(f,0,e,t)).buffer}return new Uint8Array(e)})}close(){return Me(this,void 0,void 0,function*(){const t=this._handle;this._handle=null,t&&(yield t.close())})}throw(t){return Me(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}return(t){return Me(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}}const WI=65536;function wc(n){return n<0&&(n=4294967295+n+1),`0x${n.toString(16)}`}const Xc=8,xg=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class Cw{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){const e=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),r=new Uint32Array([t.buffer[1]>>>16,t.buffer[1]&65535,t.buffer[0]>>>16,t.buffer[0]&65535]);let a=e[3]*r[3];this.buffer[0]=a&65535;let o=a>>>16;return a=e[2]*r[3],o+=a,a=e[3]*r[2]>>>0,o+=a,this.buffer[0]+=o<<16,this.buffer[1]=o>>>0<a?WI:0,this.buffer[1]+=o>>>16,this.buffer[1]+=e[1]*r[3]+e[2]*r[2]+e[3]*r[1],this.buffer[1]+=e[0]*r[3]+e[1]*r[2]+e[2]*r[1]+e[3]*r[0]<<16,this}_plus(t){const e=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],e<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=e}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${wc(this.buffer[1])} ${wc(this.buffer[0])}`}}class Tn extends Cw{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,e=new Uint32Array(2)){return Tn.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return Tn.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const r=t.length,a=new Tn(e);for(let o=0;o<r;){const f=Xc<r-o?Xc:r-o,c=new Tn(new Uint32Array([Number.parseInt(t.slice(o,o+f),10),0])),l=new Tn(new Uint32Array([xg[f],0]));a.times(l),a.plus(c),o+=f}return a}static convertArray(t){const e=new Uint32Array(t.length*2);for(let r=-1,a=t.length;++r<a;)Tn.from(t[r],new Uint32Array(e.buffer,e.byteOffset+2*r*4,2));return e}static multiply(t,e){return new Tn(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new Tn(new Uint32Array(t.buffer)).plus(e)}}class ei extends Cw{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){const e=this.buffer[1]<<0,r=t.buffer[1]<<0;return e<r||e===r&&this.buffer[0]<t.buffer[0]}static from(t,e=new Uint32Array(2)){return ei.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return ei.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const r=t.startsWith("-"),a=t.length,o=new ei(e);for(let f=r?1:0;f<a;){const c=Xc<a-f?Xc:a-f,l=new ei(new Uint32Array([Number.parseInt(t.slice(f,f+c),10),0])),_=new ei(new Uint32Array([xg[c],0]));o.times(_),o.plus(l),f+=c}return r?o.negate():o}static convertArray(t){const e=new Uint32Array(t.length*2);for(let r=-1,a=t.length;++r<a;)ei.from(t[r],new Uint32Array(e.buffer,e.byteOffset+2*r*4,2));return e}static multiply(t,e){return new ei(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new ei(new Uint32Array(t.buffer)).plus(e)}}class Ga{constructor(t){this.buffer=t}high(){return new ei(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new ei(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(t){const e=new Tn(new Uint32Array([this.buffer[3],0])),r=new Tn(new Uint32Array([this.buffer[2],0])),a=new Tn(new Uint32Array([this.buffer[1],0])),o=new Tn(new Uint32Array([this.buffer[0],0])),f=new Tn(new Uint32Array([t.buffer[3],0])),c=new Tn(new Uint32Array([t.buffer[2],0])),l=new Tn(new Uint32Array([t.buffer[1],0])),_=new Tn(new Uint32Array([t.buffer[0],0]));let m=Tn.multiply(o,_);this.buffer[0]=m.low();const A=new Tn(new Uint32Array([m.high(),0]));return m=Tn.multiply(a,_),A.plus(m),m=Tn.multiply(o,l),A.plus(m),this.buffer[1]=A.low(),this.buffer[3]=A.lessThan(m)?1:0,this.buffer[2]=A.high(),new Tn(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(Tn.multiply(r,_)).plus(Tn.multiply(a,l)).plus(Tn.multiply(o,c)),this.buffer[3]+=Tn.multiply(e,_).plus(Tn.multiply(r,l)).plus(Tn.multiply(a,c)).plus(Tn.multiply(o,f)).low(),this}plus(t){const e=new Uint32Array(4);return e[3]=this.buffer[3]+t.buffer[3]>>>0,e[2]=this.buffer[2]+t.buffer[2]>>>0,e[1]=this.buffer[1]+t.buffer[1]>>>0,e[0]=this.buffer[0]+t.buffer[0]>>>0,e[0]<this.buffer[0]>>>0&&++e[1],e[1]<this.buffer[1]>>>0&&++e[2],e[2]<this.buffer[2]>>>0&&++e[3],this.buffer[3]=e[3],this.buffer[2]=e[2],this.buffer[1]=e[1],this.buffer[0]=e[0],this}hex(){return`${wc(this.buffer[3])} ${wc(this.buffer[2])} ${wc(this.buffer[1])} ${wc(this.buffer[0])}`}static multiply(t,e){return new Ga(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new Ga(new Uint32Array(t.buffer)).plus(e)}static from(t,e=new Uint32Array(4)){return Ga.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(4)){return Ga.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(4)){const r=t.startsWith("-"),a=t.length,o=new Ga(e);for(let f=r?1:0;f<a;){const c=Xc<a-f?Xc:a-f,l=new Ga(new Uint32Array([Number.parseInt(t.slice(f,f+c),10),0,0,0])),_=new Ga(new Uint32Array([xg[c],0,0,0]));o.times(_),o.plus(l),f+=c}return r?o.negate():o}static convertArray(t){const e=new Uint32Array(t.length*4);for(let r=-1,a=t.length;++r<a;)Ga.from(t[r],new Uint32Array(e.buffer,e.byteOffset+4*4*r,4));return e}}class kw extends dn{constructor(t,e,r,a){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=e,this.buffers=r,this.dictionaries=a}visit(t){return super.visit(t instanceof Gn?t.type:t)}visitNull(t,{length:e}=this.nextFieldNode()){return Re({type:t,length:e})}visitBool(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitInt(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitFloat(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitUtf8(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitDate(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitTimestamp(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitTime(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitDecimal(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitList(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),children:this.visitMany(t.children)})}visitUnion(t){return t.mode===_a.Sparse?this.visitSparseUnion(t):this.visitDenseUnion(t)}visitDenseUnion(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),data:this.readData(t)})}visitFixedSizeList(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),child:this.visit(t.children[0])})}visitMap(t,{length:e,nullCount:r}=this.nextFieldNode()){return Re({type:t,length:e,nullCount:r,nullBitmap:this.readNullBitmap(t,r),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,e,r=this.nextBufferRange()){return e>0&&this.readData(t,r)||new Uint8Array(0)}readOffsets(t,e){return this.readData(t,e)}readTypeIds(t,e){return this.readData(t,e)}readData(t,{length:e,offset:r}=this.nextBufferRange()){return this.bytes.subarray(r,r+e)}readDictionary(t){return this.dictionaries.get(t.id)}}class YI extends kw{constructor(t,e,r,a){super(new Uint8Array(0),e,r,a),this.sources=t}readNullBitmap(t,e,{offset:r}=this.nextBufferRange()){return e<=0?new Uint8Array(0):O0(this.sources[r])}readOffsets(t,{offset:e}=this.nextBufferRange()){return Rn(Uint8Array,Rn(Int32Array,this.sources[e]))}readTypeIds(t,{offset:e}=this.nextBufferRange()){return Rn(Uint8Array,Rn(t.ArrayType,this.sources[e]))}readData(t,{offset:e}=this.nextBufferRange()){const{sources:r}=this;return ze.isTimestamp(t)||(ze.isInt(t)||ze.isTime(t))&&t.bitWidth===64||ze.isDate(t)&&t.unit===eo.MILLISECOND?Rn(Uint8Array,ei.convertArray(r[e])):ze.isDecimal(t)?Rn(Uint8Array,Ga.convertArray(r[e])):ze.isBinary(t)||ze.isFixedSizeBinary(t)?HI(r[e]):ze.isBool(t)?O0(r[e]):ze.isUtf8(t)?og(r[e].join("")):Rn(Uint8Array,Rn(t.ArrayType,r[e].map(a=>+a)))}}function HI(n){const t=n.join(""),e=new Uint8Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r>>1]=Number.parseInt(t.slice(r,r+2),16);return e}class ke extends dn{compareSchemas(t,e){return t===e||e instanceof t.constructor&&this.compareManyFields(t.fields,e.fields)}compareManyFields(t,e){return t===e||Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((r,a)=>this.compareFields(r,e[a]))}compareFields(t,e){return t===e||e instanceof t.constructor&&t.name===e.name&&t.nullable===e.nullable&&this.visit(t.type,e.type)}}function ai(n,t){return t instanceof n.constructor}function Yh(n,t){return n===t||ai(n,t)}function io(n,t){return n===t||ai(n,t)&&n.bitWidth===t.bitWidth&&n.isSigned===t.isSigned}function Bp(n,t){return n===t||ai(n,t)&&n.precision===t.precision}function XI(n,t){return n===t||ai(n,t)&&n.byteWidth===t.byteWidth}function Sg(n,t){return n===t||ai(n,t)&&n.unit===t.unit}function Hh(n,t){return n===t||ai(n,t)&&n.unit===t.unit&&n.timezone===t.timezone}function Xh(n,t){return n===t||ai(n,t)&&n.unit===t.unit&&n.bitWidth===t.bitWidth}function qI(n,t){return n===t||ai(n,t)&&n.children.length===t.children.length&&Xo.compareManyFields(n.children,t.children)}function ZI(n,t){return n===t||ai(n,t)&&n.children.length===t.children.length&&Xo.compareManyFields(n.children,t.children)}function Ag(n,t){return n===t||ai(n,t)&&n.mode===t.mode&&n.typeIds.every((e,r)=>e===t.typeIds[r])&&Xo.compareManyFields(n.children,t.children)}function KI(n,t){return n===t||ai(n,t)&&n.id===t.id&&n.isOrdered===t.isOrdered&&Xo.visit(n.indices,t.indices)&&Xo.visit(n.dictionary,t.dictionary)}function Eg(n,t){return n===t||ai(n,t)&&n.unit===t.unit}function JI(n,t){return n===t||ai(n,t)&&n.listSize===t.listSize&&n.children.length===t.children.length&&Xo.compareManyFields(n.children,t.children)}function QI(n,t){return n===t||ai(n,t)&&n.keysSorted===t.keysSorted&&n.children.length===t.children.length&&Xo.compareManyFields(n.children,t.children)}ke.prototype.visitNull=Yh;ke.prototype.visitBool=Yh;ke.prototype.visitInt=io;ke.prototype.visitInt8=io;ke.prototype.visitInt16=io;ke.prototype.visitInt32=io;ke.prototype.visitInt64=io;ke.prototype.visitUint8=io;ke.prototype.visitUint16=io;ke.prototype.visitUint32=io;ke.prototype.visitUint64=io;ke.prototype.visitFloat=Bp;ke.prototype.visitFloat16=Bp;ke.prototype.visitFloat32=Bp;ke.prototype.visitFloat64=Bp;ke.prototype.visitUtf8=Yh;ke.prototype.visitBinary=Yh;ke.prototype.visitFixedSizeBinary=XI;ke.prototype.visitDate=Sg;ke.prototype.visitDateDay=Sg;ke.prototype.visitDateMillisecond=Sg;ke.prototype.visitTimestamp=Hh;ke.prototype.visitTimestampSecond=Hh;ke.prototype.visitTimestampMillisecond=Hh;ke.prototype.visitTimestampMicrosecond=Hh;ke.prototype.visitTimestampNanosecond=Hh;ke.prototype.visitTime=Xh;ke.prototype.visitTimeSecond=Xh;ke.prototype.visitTimeMillisecond=Xh;ke.prototype.visitTimeMicrosecond=Xh;ke.prototype.visitTimeNanosecond=Xh;ke.prototype.visitDecimal=Yh;ke.prototype.visitList=qI;ke.prototype.visitStruct=ZI;ke.prototype.visitUnion=Ag;ke.prototype.visitDenseUnion=Ag;ke.prototype.visitSparseUnion=Ag;ke.prototype.visitDictionary=KI;ke.prototype.visitInterval=Eg;ke.prototype.visitIntervalDayTime=Eg;ke.prototype.visitIntervalYearMonth=Eg;ke.prototype.visitFixedSizeList=JI;ke.prototype.visitMap=QI;const Xo=new ke;function t7(n,t){return Xo.compareSchemas(n,t)}function Ym(n,t){return e7(n,t.map(e=>e.data.concat()))}function e7(n,t){const e=[...n.fields],r=[],a={numBatches:t.reduce((A,R)=>Math.max(A,R.length),0)};let o=0,f=0,c=-1;const l=t.length;let _,m=[];for(;a.numBatches-- >0;){for(f=Number.POSITIVE_INFINITY,c=-1;++c<l;)m[c]=_=t[c].shift(),f=Math.min(f,_?_.length:f);Number.isFinite(f)&&(m=n7(e,f,m,t,a),f>0&&(r[o++]=Re({type:new Vr(e),length:f,nullCount:0,children:m.slice()})))}return[n=n.assign(e),r.map(A=>new Pi(n,A))]}function n7(n,t,e,r,a){var o;const f=(t+63&-64)>>3;for(let c=-1,l=r.length;++c<l;){const _=e[c],m=_==null?void 0:_.length;if(m>=t)m===t?e[c]=_:(e[c]=_.slice(0,t),a.numBatches=Math.max(a.numBatches,r[c].unshift(_.slice(t,m-t))));else{const A=n[c];n[c]=A.clone({nullable:!0}),e[c]=(o=_==null?void 0:_._changeLengthAndBackfillNullBitmap(t))!==null&&o!==void 0?o:Re({type:A.type,length:t,nullCount:t,nullBitmap:new Uint8Array(f)})}}return e}var Pw;class xi{constructor(...t){var e,r;if(t.length===0)return this.batches=[],this.schema=new Sn([]),this._offsets=[0],this;let a,o;t[0]instanceof Sn&&(a=t.shift()),t[t.length-1]instanceof Uint32Array&&(o=t.pop());const f=l=>{if(l){if(l instanceof Pi)return[l];if(l instanceof xi)return l.batches;if(l instanceof On){if(l.type instanceof Vr)return[new Pi(new Sn(l.type.children),l)]}else{if(Array.isArray(l))return l.flatMap(_=>f(_));if(typeof l[Symbol.iterator]=="function")return[...l].flatMap(_=>f(_));if(typeof l=="object"){const _=Object.keys(l),m=_.map(C=>new Ne([l[C]])),A=new Sn(_.map((C,G)=>new Gn(String(C),m[G].type))),[,R]=Ym(A,m);return R.length===0?[new Pi(l)]:R}}}return[]},c=t.flatMap(l=>f(l));if(a=(r=a??((e=c[0])===null||e===void 0?void 0:e.schema))!==null&&r!==void 0?r:new Sn([]),!(a instanceof Sn))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const l of c){if(!(l instanceof Pi))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!t7(a,l.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=a,this.batches=c,this._offsets=o??ww(this.data)}get data(){return this.batches.map(({data:t})=>t)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((t,e)=>t+e.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=vw(this.data)),this._nullCount}isValid(t){return!1}get(t){return null}set(t,e){}indexOf(t,e){return-1}getByteLength(t){return 0}[Symbol.iterator](){return this.batches.length>0?vg.visit(new Ne(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...t){const e=this.schema,r=this.data.concat(t.flatMap(({data:a})=>a));return new xi(e,r.map(a=>new Pi(e,a)))}slice(t,e){const r=this.schema;[t,e]=bw({length:this.numRows},t,e);const a=xw(this.data,this._offsets,t,e);return new xi(r,a.map(o=>new Pi(r,o)))}getChild(t){return this.getChildAt(this.schema.fields.findIndex(e=>e.name===t))}getChildAt(t){if(t>-1&&t<this.schema.fields.length){const e=this.data.map(r=>r.children[t]);if(e.length===0){const{type:r}=this.schema.fields[t],a=Re({type:r,length:0,nullCount:0});e.push(a._changeLengthAndBackfillNullBitmap(this.numRows))}return new Ne(e)}return null}setChild(t,e){var r;return this.setChildAt((r=this.schema.fields)===null||r===void 0?void 0:r.findIndex(a=>a.name===t),e)}setChildAt(t,e){let r=this.schema,a=[...this.batches];if(t>-1&&t<this.numCols){e||(e=new Ne([Re({type:new Ho,length:this.numRows})]));const o=r.fields.slice(),f=o[t].clone({type:e.type}),c=this.schema.fields.map((l,_)=>this.getChildAt(_));[o[t],c[t]]=[f,e],[r,a]=Ym(r,c)}return new xi(r,a)}select(t){const e=this.schema.fields.reduce((r,a,o)=>r.set(a.name,o),new Map);return this.selectAt(t.map(r=>e.get(r)).filter(r=>r>-1))}selectAt(t){const e=this.schema.selectAt(t),r=this.batches.map(a=>a.selectAt(t));return new xi(e,r)}assign(t){const e=this.schema.fields,[r,a]=t.schema.fields.reduce((c,l,_)=>{const[m,A]=c,R=e.findIndex(C=>C.name===l.name);return~R?A[R]=_:m.push(_),c},[[],[]]),o=this.schema.assign(t.schema),f=[...e.map((c,l)=>[l,a[l]]).map(([c,l])=>l===void 0?this.getChildAt(c):t.getChildAt(l)),...r.map(c=>t.getChildAt(c))].filter(Boolean);return new xi(...Ym(o,f))}}Pw=Symbol.toStringTag;xi[Pw]=(n=>(n.schema=null,n.batches=[],n._offsets=new Uint32Array([0]),n._nullCount=-1,n[Symbol.isConcatSpreadable]=!0,n.isValid=Nc(yg),n.get=Nc(ii.getVisitFn(et.Struct)),n.set=Sw($i.getVisitFn(et.Struct)),n.indexOf=Aw(K_.getVisitFn(et.Struct)),n.getByteLength=Nc(es.getVisitFn(et.Struct)),"Table"))(xi.prototype);var zw;let Pi=class Bh{constructor(...t){switch(t.length){case 2:{if([this.schema]=t,!(this.schema instanceof Sn))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=Re({nullCount:0,type:new Vr(this.schema.fields),children:this.schema.fields.map(e=>Re({type:e.type,nullCount:0}))})]=t,!(this.data instanceof On))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=hy(this.schema,this.data.children);break}case 1:{const[e]=t,{fields:r,children:a,length:o}=Object.keys(e).reduce((l,_,m)=>(l.children[m]=e[_],l.length=Math.max(l.length,e[_].length),l.fields[m]=Gn.new({name:_,type:e[_].type,nullable:!0}),l),{length:0,fields:new Array,children:new Array}),f=new Sn(r),c=Re({type:new Vr(r),length:o,children:a,nullCount:0});[this.schema,this.data]=hy(f,c.children,o);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=Uw(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(t){return this.data.getValid(t)}get(t){return ii.visit(this.data,t)}set(t,e){return $i.visit(this.data,t,e)}indexOf(t,e){return K_.visit(this.data,t,e)}getByteLength(t){return es.visit(this.data,t)}[Symbol.iterator](){return vg.visit(new Ne([this.data]))}toArray(){return[...this]}concat(...t){return new xi(this.schema,[this,...t])}slice(t,e){const[r]=new Ne([this.data]).slice(t,e).data;return new Bh(this.schema,r)}getChild(t){var e;return this.getChildAt((e=this.schema.fields)===null||e===void 0?void 0:e.findIndex(r=>r.name===t))}getChildAt(t){return t>-1&&t<this.schema.fields.length?new Ne([this.data.children[t]]):null}setChild(t,e){var r;return this.setChildAt((r=this.schema.fields)===null||r===void 0?void 0:r.findIndex(a=>a.name===t),e)}setChildAt(t,e){let r=this.schema,a=this.data;if(t>-1&&t<this.numCols){e||(e=new Ne([Re({type:new Ho,length:this.numRows})]));const o=r.fields.slice(),f=a.children.slice(),c=o[t].clone({type:e.type});[o[t],f[t]]=[c,e.data[0]],r=new Sn(o,new Map(this.schema.metadata)),a=Re({type:new Vr(o),children:f})}return new Bh(r,a)}select(t){const e=this.schema.select(t),r=new Vr(e.fields),a=[];for(const o of t){const f=this.schema.fields.findIndex(c=>c.name===o);~f&&(a[f]=this.data.children[f])}return new Bh(e,Re({type:r,length:this.numRows,children:a}))}selectAt(t){const e=this.schema.selectAt(t),r=t.map(o=>this.data.children[o]).filter(Boolean),a=Re({type:new Vr(e.fields),length:this.numRows,children:r});return new Bh(e,a)}};zw=Symbol.toStringTag;Pi[zw]=(n=>(n._nullCount=-1,n[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(Pi.prototype);function hy(n,t,e=t.reduce((r,a)=>Math.max(r,a.length),0)){var r;const a=[...n.fields],o=[...t],f=(e+63&-64)>>3;for(const[c,l]of n.fields.entries()){const _=t[c];(!_||_.length!==e)&&(a[c]=l.clone({nullable:!0}),o[c]=(r=_==null?void 0:_._changeLengthAndBackfillNullBitmap(e))!==null&&r!==void 0?r:Re({type:l.type,length:e,nullCount:e,nullBitmap:new Uint8Array(f)}))}return[n.assign(a),Re({type:new Vr(a),length:e,children:o})]}function Uw(n,t,e=new Map){for(let r=-1,a=n.length;++r<a;){const f=n[r].type,c=t[r];if(ze.isDictionary(f)){if(!e.has(f.id))c.dictionary&&e.set(f.id,c.dictionary);else if(e.get(f.id)!==c.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}f.children&&f.children.length>0&&Uw(f.children,c.children,e)}return e}class Gw extends Pi{constructor(t){const e=t.fields.map(a=>Re({type:a.type})),r=Re({type:new Vr(t.fields),nullCount:0,children:e});super(t,r)}}var sp;(function(n){n[n.BUFFER=0]="BUFFER"})(sp||(sp={}));var op;(function(n){n[n.LZ4_FRAME=0]="LZ4_FRAME",n[n.ZSTD=1]="ZSTD"})(op||(op={}));class Vo{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBodyCompression(t,e){return(e||new Vo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,e){return t.setPosition(t.position()+Ln),(e||new Vo).__init(t.readInt32(t.position())+t.position(),t)}codec(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):op.LZ4_FRAME}method(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):sp.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,e){t.addFieldInt8(0,e,op.LZ4_FRAME)}static addMethod(t,e){t.addFieldInt8(1,e,sp.BUFFER)}static endBodyCompression(t){return t.endObject()}static createBodyCompression(t,e,r){return Vo.startBodyCompression(t),Vo.addCodec(t,e),Vo.addMethod(t,r),Vo.endBodyCompression(t)}}class $w{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,e,r){return t.prep(8,16),t.writeInt64(r),t.writeInt64(e),t.offset()}}let jw=class{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,e,r){return t.prep(8,16),t.writeInt64(r),t.writeInt64(e),t.offset()}},Ys=class D0{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRecordBatch(t,e){return(e||new D0).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,e){return t.setPosition(t.position()+Ln),(e||new D0).__init(t.readInt32(t.position())+t.position(),t)}length(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}nodes(t,e){const r=this.bb.__offset(this.bb_pos,6);return r?(e||new jw).__init(this.bb.__vector(this.bb_pos+r)+t*16,this.bb):null}nodesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,e){const r=this.bb.__offset(this.bb_pos,8);return r?(e||new $w).__init(this.bb.__vector(this.bb_pos+r)+t*16,this.bb):null}buffersLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){const e=this.bb.__offset(this.bb_pos,10);return e?(t||new Vo).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,e){t.addFieldInt64(0,e,t.createLong(0,0))}static addNodes(t,e){t.addFieldOffset(1,e,0)}static startNodesVector(t,e){t.startVector(16,e,8)}static addBuffers(t,e){t.addFieldOffset(2,e,0)}static startBuffersVector(t,e){t.startVector(16,e,8)}static addCompression(t,e){t.addFieldOffset(3,e,0)}static endRecordBatch(t){return t.endObject()}},yc=class F0{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryBatch(t,e){return(e||new F0).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,e){return t.setPosition(t.position()+Ln),(e||new F0).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}data(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new Ys).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isDelta(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startDictionaryBatch(t){t.startObject(3)}static addId(t,e){t.addFieldInt64(0,e,t.createLong(0,0))}static addData(t,e){t.addFieldOffset(1,e,0)}static addIsDelta(t,e){t.addFieldInt8(2,+e,0)}static endDictionaryBatch(t){return t.endObject()}};var fp;(function(n){n[n.NONE=0]="NONE",n[n.Schema=1]="Schema",n[n.DictionaryBatch=2]="DictionaryBatch",n[n.RecordBatch=3]="RecordBatch",n[n.Tensor=4]="Tensor",n[n.SparseTensor=5]="SparseTensor"})(fp||(fp={}));let $o=class za{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMessage(t,e){return(e||new za).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,e){return t.setPosition(t.position()+Ln),(e||new za).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):jc.V1}headerType(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):fp.NONE}header(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__union(t,this.bb_pos+e):null}bodyLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}customMetadata(t,e){const r=this.bb.__offset(this.bb_pos,12);return r?(e||new gr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,jc.V1)}static addHeaderType(t,e){t.addFieldInt8(1,e,fp.NONE)}static addHeader(t,e){t.addFieldOffset(2,e,0)}static addBodyLength(t,e){t.addFieldInt64(3,e,t.createLong(0,0))}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endMessage(t){return t.endObject()}static finishMessageBuffer(t,e){t.finish(e)}static finishSizePrefixedMessageBuffer(t,e){t.finish(e,void 0,!0)}static createMessage(t,e,r,a,o,f){return za.startMessage(t),za.addVersion(t,e),za.addHeaderType(t,r),za.addHeader(t,a),za.addBodyLength(t,o),za.addCustomMetadata(t,f),za.endMessage(t)}};var r7=Ks;class i7 extends dn{visit(t,e){return t==null||e==null?void 0:super.visit(t,e)}visitNull(t,e){return Qf.startNull(e),Qf.endNull(e)}visitInt(t,e){return wi.startInt(e),wi.addBitWidth(e,t.bitWidth),wi.addIsSigned(e,t.isSigned),wi.endInt(e)}visitFloat(t,e){return qa.startFloatingPoint(e),qa.addPrecision(e,t.precision),qa.endFloatingPoint(e)}visitBinary(t,e){return Zf.startBinary(e),Zf.endBinary(e)}visitBool(t,e){return Kf.startBool(e),Kf.endBool(e)}visitUtf8(t,e){return eu.startUtf8(e),eu.endUtf8(e)}visitDecimal(t,e){return ni.startDecimal(e),ni.addScale(e,t.scale),ni.addPrecision(e,t.precision),ni.addBitWidth(e,t.bitWidth),ni.endDecimal(e)}visitDate(t,e){return h_.startDate(e),h_.addUnit(e,t.unit),h_.endDate(e)}visitTime(t,e){return Ci.startTime(e),Ci.addUnit(e,t.unit),Ci.addBitWidth(e,t.bitWidth),Ci.endTime(e)}visitTimestamp(t,e){const r=t.timezone&&e.createString(t.timezone)||void 0;return ki.startTimestamp(e),ki.addUnit(e,t.unit),r!==void 0&&ki.addTimezone(e,r),ki.endTimestamp(e)}visitInterval(t,e){return Za.startInterval(e),Za.addUnit(e,t.unit),Za.endInterval(e)}visitList(t,e){return Jf.startList(e),Jf.endList(e)}visitStruct(t,e){return tu.startStruct_(e),tu.endStruct_(e)}visitUnion(t,e){ri.startTypeIdsVector(e,t.typeIds.length);const r=ri.createTypeIdsVector(e,t.typeIds);return ri.startUnion(e),ri.addMode(e,t.mode),ri.addTypeIds(e,r),ri.endUnion(e)}visitDictionary(t,e){const r=this.visit(t.indices,e);return Xs.startDictionaryEncoding(e),Xs.addId(e,new r7(t.id,0)),Xs.addIsOrdered(e,t.isOrdered),r!==void 0&&Xs.addIndexType(e,r),Xs.endDictionaryEncoding(e)}visitFixedSizeBinary(t,e){return Ha.startFixedSizeBinary(e),Ha.addByteWidth(e,t.byteWidth),Ha.endFixedSizeBinary(e)}visitFixedSizeList(t,e){return Xa.startFixedSizeList(e),Xa.addListSize(e,t.listSize),Xa.endFixedSizeList(e)}visitMap(t,e){return d_.startMap(e),d_.addKeysSorted(e,t.keysSorted),d_.endMap(e)}}const Hm=new i7;function a7(n,t=new Map){return new Sn(o7(n,t),p_(n.customMetadata),t)}function Vw(n){return new pa(n.count,Ww(n.columns),Yw(n.columns))}function s7(n){return new no(Vw(n.data),n.id,n.isDelta)}function o7(n,t){return(n.fields||[]).filter(Boolean).map(e=>Gn.fromJSON(e,t))}function dy(n,t){return(n.children||[]).filter(Boolean).map(e=>Gn.fromJSON(e,t))}function Ww(n){return(n||[]).reduce((t,e)=>[...t,new Jc(e.count,f7(e.VALIDITY)),...Ww(e.children)],[])}function Yw(n,t=[]){for(let e=-1,r=(n||[]).length;++e<r;){const a=n[e];a.VALIDITY&&t.push(new Zs(t.length,a.VALIDITY.length)),a.TYPE&&t.push(new Zs(t.length,a.TYPE.length)),a.OFFSET&&t.push(new Zs(t.length,a.OFFSET.length)),a.DATA&&t.push(new Zs(t.length,a.DATA.length)),t=Yw(a.children,t)}return t}function f7(n){return(n||[]).reduce((t,e)=>t+ +(e===0),0)}function u7(n,t){let e,r,a,o,f,c;return!t||!(o=n.dictionary)?(f=py(n,dy(n,t)),a=new Gn(n.name,f,n.nullable,p_(n.customMetadata))):t.has(e=o.id)?(r=(r=o.indexType)?_y(r):new Uc,c=new Gc(t.get(e),r,e,o.isOrdered),a=new Gn(n.name,c,n.nullable,p_(n.customMetadata))):(r=(r=o.indexType)?_y(r):new Uc,t.set(e,f=py(n,dy(n,t))),c=new Gc(f,r,e,o.isOrdered),a=new Gn(n.name,c,n.nullable,p_(n.customMetadata))),a||null}function p_(n){return new Map(Object.entries(n||{}))}function _y(n){return new Wr(n.isSigned,n.bitWidth)}function py(n,t){const e=n.type.name;switch(e){case"NONE":return new Ho;case"null":return new Ho;case"binary":return new z_;case"utf8":return new U_;case"bool":return new G_;case"list":return new Y_((t||[])[0]);case"struct":return new Vr(t||[]);case"struct_":return new Vr(t||[])}switch(e){case"int":{const r=n.type;return new Wr(r.isSigned,r.bitWidth)}case"floatingpoint":{const r=n.type;return new cu(Fr[r.precision])}case"decimal":{const r=n.type;return new $_(r.scale,r.precision,r.bitWidth)}case"date":{const r=n.type;return new j_(eo[r.unit])}case"time":{const r=n.type;return new jh(yn[r.unit],r.bitWidth)}case"timestamp":{const r=n.type;return new V_(yn[r.unit],r.timezone)}case"interval":{const r=n.type;return new W_(Yo[r.unit])}case"union":{const r=n.type;return new H_(_a[r.mode],r.typeIds||[],t||[])}case"fixedsizebinary":{const r=n.type;return new X_(r.byteWidth)}case"fixedsizelist":{const r=n.type;return new q_(r.listSize,(t||[])[0])}case"map":{const r=n.type;return new Z_((t||[])[0],r.keysSorted)}}throw new Error(`Unrecognized type: "${e}"`)}var lu=Ks,c7=Nw,l7=$c;class ha{constructor(t,e,r,a){this._version=e,this._headerType=r,this.body=new Uint8Array(0),a&&(this._createHeader=()=>a),this._bodyLength=typeof t=="number"?t:t.low}static fromJSON(t,e){const r=new ha(0,zi.V4,e);return r._createHeader=h7(t,e),r}static decode(t){t=new l7(xn(t));const e=$o.getRootAsMessage(t),r=e.bodyLength(),a=e.version(),o=e.headerType(),f=new ha(r,a,o);return f._createHeader=d7(e,o),f}static encode(t){const e=new c7;let r=-1;return t.isSchema()?r=Sn.encode(e,t.header()):t.isRecordBatch()?r=pa.encode(e,t.header()):t.isDictionaryBatch()&&(r=no.encode(e,t.header())),$o.startMessage(e),$o.addVersion(e,zi.V4),$o.addHeader(e,r),$o.addHeaderType(e,t.headerType),$o.addBodyLength(e,new lu(t.bodyLength,0)),$o.finishMessageBuffer(e,$o.endMessage(e)),e.asUint8Array()}static from(t,e=0){if(t instanceof Sn)return new ha(0,zi.V4,Bn.Schema,t);if(t instanceof pa)return new ha(e,zi.V4,Bn.RecordBatch,t);if(t instanceof no)return new ha(e,zi.V4,Bn.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===Bn.Schema}isRecordBatch(){return this.headerType===Bn.RecordBatch}isDictionaryBatch(){return this.headerType===Bn.DictionaryBatch}}class pa{constructor(t,e,r){this._nodes=e,this._buffers=r,this._length=typeof t=="number"?t:t.low}get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}}class no{constructor(t,e,r=!1){this._data=t,this._isDelta=r,this._id=typeof e=="number"?e:e.low}get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}}class Zs{constructor(t,e){this.offset=typeof t=="number"?t:t.low,this.length=typeof e=="number"?e:e.low}}class Jc{constructor(t,e){this.length=typeof t=="number"?t:t.low,this.nullCount=typeof e=="number"?e:e.low}}function h7(n,t){return()=>{switch(t){case Bn.Schema:return Sn.fromJSON(n);case Bn.RecordBatch:return pa.fromJSON(n);case Bn.DictionaryBatch:return no.fromJSON(n)}throw new Error(`Unrecognized Message type: { name: ${Bn[t]}, type: ${t} }`)}}function d7(n,t){return()=>{switch(t){case Bn.Schema:return Sn.decode(n.header(new Ua));case Bn.RecordBatch:return pa.decode(n.header(new Ys),n.version());case Bn.DictionaryBatch:return no.decode(n.header(new yc),n.version())}throw new Error(`Unrecognized Message type: { name: ${Bn[t]}, type: ${t} }`)}}Gn.encode=A7;Gn.decode=x7;Gn.fromJSON=u7;Sn.encode=S7;Sn.decode=_7;Sn.fromJSON=a7;pa.encode=E7;pa.decode=p7;pa.fromJSON=Vw;no.encode=T7;no.decode=m7;no.fromJSON=s7;Jc.encode=I7;Jc.decode=b7;Zs.encode=O7;Zs.decode=g7;function _7(n,t=new Map){const e=w7(n,t);return new Sn(e,m_(n),t)}function p7(n,t=zi.V4){if(n.compression()!==null)throw new Error("Record batch compression not implemented");return new pa(n.length(),y7(n),v7(n,t))}function m7(n,t=zi.V4){return new no(pa.decode(n.data(),t),n.id(),n.isDelta())}function g7(n){return new Zs(n.offset(),n.length())}function b7(n){return new Jc(n.length(),n.nullCount())}function y7(n){const t=[];for(let e,r=-1,a=-1,o=n.nodesLength();++r<o;)(e=n.nodes(r))&&(t[++a]=Jc.decode(e));return t}function v7(n,t){const e=[];for(let r,a=-1,o=-1,f=n.buffersLength();++a<f;)(r=n.buffers(a))&&(t<zi.V4&&(r.bb_pos+=8*(a+1)),e[++o]=Zs.decode(r));return e}function w7(n,t){const e=[];for(let r,a=-1,o=-1,f=n.fieldsLength();++a<f;)(r=n.fields(a))&&(e[++o]=Gn.decode(r,t));return e}function my(n,t){const e=[];for(let r,a=-1,o=-1,f=n.childrenLength();++a<f;)(r=n.children(a))&&(e[++o]=Gn.decode(r,t));return e}function x7(n,t){let e,r,a,o,f,c;return!t||!(c=n.dictionary())?(a=by(n,my(n,t)),r=new Gn(n.name(),a,n.nullable(),m_(n))):t.has(e=c.id().low)?(o=(o=c.indexType())?gy(o):new Uc,f=new Gc(t.get(e),o,e,c.isOrdered()),r=new Gn(n.name(),f,n.nullable(),m_(n))):(o=(o=c.indexType())?gy(o):new Uc,t.set(e,a=by(n,my(n,t))),f=new Gc(a,o,e,c.isOrdered()),r=new Gn(n.name(),f,n.nullable(),m_(n))),r||null}function m_(n){const t=new Map;if(n)for(let e,r,a=-1,o=Math.trunc(n.customMetadataLength());++a<o;)(e=n.customMetadata(a))&&(r=e.key())!=null&&t.set(r,e.value());return t}function gy(n){return new Wr(n.isSigned(),n.bitWidth())}function by(n,t){const e=n.typeType();switch(e){case Xn.NONE:return new Ho;case Xn.Null:return new Ho;case Xn.Binary:return new z_;case Xn.Utf8:return new U_;case Xn.Bool:return new G_;case Xn.List:return new Y_((t||[])[0]);case Xn.Struct_:return new Vr(t||[])}switch(e){case Xn.Int:{const r=n.type(new wi);return new Wr(r.isSigned(),r.bitWidth())}case Xn.FloatingPoint:{const r=n.type(new qa);return new cu(r.precision())}case Xn.Decimal:{const r=n.type(new ni);return new $_(r.scale(),r.precision(),r.bitWidth())}case Xn.Date:{const r=n.type(new h_);return new j_(r.unit())}case Xn.Time:{const r=n.type(new Ci);return new jh(r.unit(),r.bitWidth())}case Xn.Timestamp:{const r=n.type(new ki);return new V_(r.unit(),r.timezone())}case Xn.Interval:{const r=n.type(new Za);return new W_(r.unit())}case Xn.Union:{const r=n.type(new ri);return new H_(r.mode(),r.typeIdsArray()||[],t||[])}case Xn.FixedSizeBinary:{const r=n.type(new Ha);return new X_(r.byteWidth())}case Xn.FixedSizeList:{const r=n.type(new Xa);return new q_(r.listSize(),(t||[])[0])}case Xn.Map:{const r=n.type(new d_);return new Z_((t||[])[0],r.keysSorted())}}throw new Error(`Unrecognized type: "${Xn[e]}" (${e})`)}function S7(n,t){const e=t.fields.map(o=>Gn.encode(n,o));Ua.startFieldsVector(n,e.length);const r=Ua.createFieldsVector(n,e),a=t.metadata&&t.metadata.size>0?Ua.createCustomMetadataVector(n,[...t.metadata].map(([o,f])=>{const c=n.createString(`${o}`),l=n.createString(`${f}`);return gr.startKeyValue(n),gr.addKey(n,c),gr.addValue(n,l),gr.endKeyValue(n)})):-1;return Ua.startSchema(n),Ua.addFields(n,r),Ua.addEndianness(n,B7?Vc.Little:Vc.Big),a!==-1&&Ua.addCustomMetadata(n,a),Ua.endSchema(n)}function A7(n,t){let e=-1,r=-1,a=-1;const o=t.type;let f=t.typeId;ze.isDictionary(o)?(f=o.dictionary.typeId,a=Hm.visit(o,n),r=Hm.visit(o.dictionary,n)):r=Hm.visit(o,n);const c=(o.children||[]).map(m=>Gn.encode(n,m)),l=Di.createChildrenVector(n,c),_=t.metadata&&t.metadata.size>0?Di.createCustomMetadataVector(n,[...t.metadata].map(([m,A])=>{const R=n.createString(`${m}`),C=n.createString(`${A}`);return gr.startKeyValue(n),gr.addKey(n,R),gr.addValue(n,C),gr.endKeyValue(n)})):-1;return t.name&&(e=n.createString(t.name)),Di.startField(n),Di.addType(n,r),Di.addTypeType(n,f),Di.addChildren(n,l),Di.addNullable(n,!!t.nullable),e!==-1&&Di.addName(n,e),a!==-1&&Di.addDictionary(n,a),_!==-1&&Di.addCustomMetadata(n,_),Di.endField(n)}function E7(n,t){const e=t.nodes||[],r=t.buffers||[];Ys.startNodesVector(n,e.length);for(const f of e.slice().reverse())Jc.encode(n,f);const a=n.endVector();Ys.startBuffersVector(n,r.length);for(const f of r.slice().reverse())Zs.encode(n,f);const o=n.endVector();return Ys.startRecordBatch(n),Ys.addLength(n,new lu(t.length,0)),Ys.addNodes(n,a),Ys.addBuffers(n,o),Ys.endRecordBatch(n)}function T7(n,t){const e=pa.encode(n,t.data);return yc.startDictionaryBatch(n),yc.addId(n,new lu(t.id,0)),yc.addIsDelta(n,t.isDelta),yc.addData(n,e),yc.endDictionaryBatch(n)}function I7(n,t){return jw.createFieldNode(n,new lu(t.length,0),new lu(t.nullCount,0))}function O7(n,t){return $w.createBuffer(n,new lu(t.offset,0),new lu(t.length,0))}const B7=(()=>{const n=new ArrayBuffer(2);return new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256})(),Tg=n=>`Expected ${Bn[n]} Message in stream, but was null or length 0.`,Ig=n=>`Header pointer of flatbuffer-encoded ${Bn[n]} Message is null or length 0.`,Hw=(n,t)=>`Expected to read ${n} metadata bytes, but only read ${t}.`,Xw=(n,t)=>`Expected to read ${n} bytes for message body, but only read ${t}.`;class qw{constructor(t){this.source=t instanceof ip?t:new ip(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done||t.value===-1&&(t=this.readMetadataLength()).done||(t=this.readMetadata(t.value)).done?qn:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let e;if((e=this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(Tg(t));return e.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);const e=xn(this.source.read(t));if(e.byteLength<t)throw new Error(Xw(t,e.byteLength));return e.byteOffset%8===0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()}readSchema(t=!1){const e=Bn.Schema,r=this.readMessage(e),a=r==null?void 0:r.header();if(t&&!a)throw new Error(Ig(e));return a}readMetadataLength(){const t=this.source.read(Rp),e=t&&new $c(t),r=(e==null?void 0:e.readInt32(0))||0;return{done:r===0,value:r}}readMetadata(t){const e=this.source.read(t);if(!e)return qn;if(e.byteLength<t)throw new Error(Hw(t,e.byteLength));return{done:!1,value:ha.decode(e)}}}class R7{constructor(t,e){this.source=t instanceof Hc?t:r1(t)?new ap(t,e):new Hc(t)}[Symbol.asyncIterator](){return this}next(){return Me(this,void 0,void 0,function*(){let t;return(t=yield this.readMetadataLength()).done||t.value===-1&&(t=yield this.readMetadataLength()).done||(t=yield this.readMetadata(t.value)).done?qn:t})}throw(t){return Me(this,void 0,void 0,function*(){return yield this.source.throw(t)})}return(t){return Me(this,void 0,void 0,function*(){return yield this.source.return(t)})}readMessage(t){return Me(this,void 0,void 0,function*(){let e;if((e=yield this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(Tg(t));return e.value})}readMessageBody(t){return Me(this,void 0,void 0,function*(){if(t<=0)return new Uint8Array(0);const e=xn(yield this.source.read(t));if(e.byteLength<t)throw new Error(Xw(t,e.byteLength));return e.byteOffset%8===0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()})}readSchema(t=!1){return Me(this,void 0,void 0,function*(){const e=Bn.Schema,r=yield this.readMessage(e),a=r==null?void 0:r.header();if(t&&!a)throw new Error(Ig(e));return a})}readMetadataLength(){return Me(this,void 0,void 0,function*(){const t=yield this.source.read(Rp),e=t&&new $c(t),r=(e==null?void 0:e.readInt32(0))||0;return{done:r===0,value:r}})}readMetadata(t){return Me(this,void 0,void 0,function*(){const e=yield this.source.read(t);if(!e)return qn;if(e.byteLength<t)throw new Error(Hw(t,e.byteLength));return{done:!1,value:ha.decode(e)}})}}class M7 extends qw{constructor(t){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof cy?t:new cy(t)}next(){const{_json:t}=this;if(!this._schema)return this._schema=!0,{done:!1,value:ha.fromJSON(t.schema,Bn.Schema)};if(this._dictionaryIndex<t.dictionaries.length){const e=t.dictionaries[this._dictionaryIndex++];return this._body=e.data.columns,{done:!1,value:ha.fromJSON(e,Bn.DictionaryBatch)}}if(this._batchIndex<t.batches.length){const e=t.batches[this._batchIndex++];return this._body=e.columns,{done:!1,value:ha.fromJSON(e,Bn.RecordBatch)}}return this._body=[],qn}readMessageBody(t){return e(this._body);function e(r){return(r||[]).reduce((a,o)=>[...a,...o.VALIDITY&&[o.VALIDITY]||[],...o.TYPE&&[o.TYPE]||[],...o.OFFSET&&[o.OFFSET]||[],...o.DATA&&[o.DATA]||[],...e(o.children)],[])}}readMessage(t){let e;if((e=this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(Tg(t));return e.value}readSchema(){const t=Bn.Schema,e=this.readMessage(t),r=e==null?void 0:e.header();if(!e||!r)throw new Error(Ig(t));return r}}const Rp=4,C0="ARROW1",up=new Uint8Array(C0.length);for(let n=0;n<C0.length;n+=1)up[n]=C0.codePointAt(n);function Og(n,t=0){for(let e=-1,r=up.length;++e<r;)if(up[e]!==n[t+e])return!1;return!0}const qh=up.length,Zw=qh+Rp,L7=qh*2+Rp;class Js extends Fw{constructor(t){super(),this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){const e=this._impl.open(t);return Uh(e)?e.then(()=>this):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return Fi.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return Fi.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,e){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof Js?t:E0(t)?C7(t):r1(t)?z7(t):Uh(t)?(()=>Me(this,void 0,void 0,function*(){return yield Js.from(yield t)}))():i1(t)||ug(t)||s1(t)||fg(t)?P7(new Hc(t)):k7(new ip(t))}static readAll(t){return t instanceof Js?t.isSync()?yy(t):vy(t):E0(t)||ArrayBuffer.isView(t)||Ip(t)||n1(t)?yy(t):vy(t)}}class cp extends Js{constructor(t){super(t),this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return Ka(this,arguments,function*(){yield Xe(yield*l_(Oc(this[Symbol.iterator]())))})}}class lp extends Js{constructor(t){super(t),this._impl=t}readAll(){var t,e;return Me(this,void 0,void 0,function*(){const r=new Array;try{for(var a=Oc(this),o;o=yield a.next(),!o.done;){const f=o.value;r.push(f)}}catch(f){t={error:f}}finally{try{o&&!o.done&&(e=a.return)&&(yield e.call(a))}finally{if(t)throw t.error}}return r})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class Kw extends cp{constructor(t){super(t),this._impl=t}}class N7 extends lp{constructor(t){super(t),this._impl=t}}class Jw{constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,e){const r=this._loadVectors(t,e,this.schema.fields),a=Re({type:new Vr(this.schema.fields),length:t.length,children:r});return new Pi(this.schema,a)}_loadDictionaryBatch(t,e){const{id:r,isDelta:a}=t,{dictionaries:o,schema:f}=this,c=o.get(r);if(a||!c){const l=f.dictionaries.get(r),_=this._loadVectors(t.data,e,[l]);return(c&&a?c.concat(new Ne(_)):new Ne(_)).memoize()}return c.memoize()}_loadVectors(t,e,r){return new kw(e,t.nodes,t.buffers,this.dictionaries).visitMany(r)}}class hp extends Jw{constructor(t,e){super(e),this._reader=E0(t)?new M7(this._handle=t):new qw(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=tx(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):qn}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):qn}next(){if(this.closed)return qn;let t;const{_reader:e}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;const r=t.header(),a=e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(r,a)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;const r=t.header(),a=e.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(r,a);this.dictionaries.set(r.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Gw(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}}class dp extends Jw{constructor(t,e){super(e),this._reader=new R7(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return Me(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(t){return Me(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=tx(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(t){return Me(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):qn})}return(t){return Me(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):qn})}next(){return Me(this,void 0,void 0,function*(){if(this.closed)return qn;let t;const{_reader:e}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;const r=t.header(),a=yield e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(r,a)}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;const r=t.header(),a=yield e.readMessageBody(t.bodyLength),o=this._loadDictionaryBatch(r,a);this.dictionaries.set(r.id,o)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new Gw(this.schema)}):yield this.return()})}_readNextMessageAndValidate(t){return Me(this,void 0,void 0,function*(){return yield this._reader.readMessage(t)})}}class Qw extends hp{constructor(t,e){super(t instanceof ly?t:new ly(t),e)}get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const e of this._footer.dictionaryBatches())e&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var e;if(this.closed)return null;this._footer||this.open();const r=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(t);if(r&&this._handle.seek(r.offset)){const a=this._reader.readMessage(Bn.RecordBatch);if(a!=null&&a.isRecordBatch()){const o=a.header(),f=this._reader.readMessageBody(a.bodyLength);return this._loadRecordBatch(o,f)}}return null}_readDictionaryBatch(t){var e;const r=(e=this._footer)===null||e===void 0?void 0:e.getDictionaryBatch(t);if(r&&this._handle.seek(r.offset)){const a=this._reader.readMessage(Bn.DictionaryBatch);if(a!=null&&a.isDictionaryBatch()){const o=a.header(),f=this._reader.readMessageBody(a.bodyLength),c=this._loadDictionaryBatch(o,f);this.dictionaries.set(o.id,c)}}}_readFooter(){const{_handle:t}=this,e=t.size-Zw,r=t.readInt32(e),a=t.readAt(e-r,r);return wg.decode(a)}_readNextMessageAndValidate(t){var e;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const r=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(this._recordBatchIndex);if(r&&this._handle.seek(r.offset))return this._reader.readMessage(t)}return null}}class D7 extends dp{constructor(t,...e){const r=typeof e[0]!="number"?e.shift():void 0,a=e[0]instanceof Map?e.shift():void 0;super(t instanceof ap?t:new ap(t,r),a)}get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}isFile(){return!0}isAsync(){return!0}open(t){const e=Object.create(null,{open:{get:()=>super.open}});return Me(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const r of this._footer.dictionaryBatches())r&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield e.open.call(this,t)})}readRecordBatch(t){var e;return Me(this,void 0,void 0,function*(){if(this.closed)return null;this._footer||(yield this.open());const r=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(t);if(r&&(yield this._handle.seek(r.offset))){const a=yield this._reader.readMessage(Bn.RecordBatch);if(a!=null&&a.isRecordBatch()){const o=a.header(),f=yield this._reader.readMessageBody(a.bodyLength);return this._loadRecordBatch(o,f)}}return null})}_readDictionaryBatch(t){var e;return Me(this,void 0,void 0,function*(){const r=(e=this._footer)===null||e===void 0?void 0:e.getDictionaryBatch(t);if(r&&(yield this._handle.seek(r.offset))){const a=yield this._reader.readMessage(Bn.DictionaryBatch);if(a!=null&&a.isDictionaryBatch()){const o=a.header(),f=yield this._reader.readMessageBody(a.bodyLength),c=this._loadDictionaryBatch(o,f);this.dictionaries.set(o.id,c)}}})}_readFooter(){return Me(this,void 0,void 0,function*(){const{_handle:t}=this;t._pending&&(yield t._pending);const e=t.size-Zw,r=yield t.readInt32(e),a=yield t.readAt(e-r,r);return wg.decode(a)})}_readNextMessageAndValidate(t){return Me(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const e=this._footer.getRecordBatch(this._recordBatchIndex);if(e&&(yield this._handle.seek(e.offset)))return yield this._reader.readMessage(t)}return null})}}class F7 extends hp{constructor(t,e){super(t,e)}_loadVectors(t,e,r){return new YI(e,t.nodes,t.buffers,this.dictionaries).visitMany(r)}}function tx(n,t){return t&&typeof t.autoDestroy=="boolean"?t.autoDestroy:n.autoDestroy}function*yy(n){const t=Js.from(n);try{if(!t.open({autoDestroy:!1}).closed)do yield t;while(!t.reset().open().closed)}finally{t.cancel()}}function vy(n){return Ka(this,arguments,function*(){const e=yield Xe(Js.from(n));try{if(!(yield Xe(e.open({autoDestroy:!1}))).closed)do yield yield Xe(e);while(!(yield Xe(e.reset().open())).closed)}finally{yield Xe(e.cancel())}})}function C7(n){return new cp(new F7(n))}function k7(n){const t=n.peek(qh+7&-8);return t&&t.byteLength>=4?Og(t)?new Kw(new Qw(n.read())):new cp(new hp(n)):new cp(new hp(function*(){}()))}function P7(n){return Me(this,void 0,void 0,function*(){const t=yield n.peek(qh+7&-8);return t&&t.byteLength>=4?Og(t)?new Kw(new Qw(yield n.read())):new lp(new dp(n)):new lp(new dp(function(){return Ka(this,arguments,function*(){})}()))})}function z7(n){return Me(this,void 0,void 0,function*(){const{size:t}=yield n.stat(),e=new ap(n,t);return t>=L7&&Og(yield e.readAt(0,qh+7&-8))?new N7(new D7(e)):new lp(new dp(e))})}function qc(n){const t=Js.from(n);return Uh(t)?t.then(e=>qc(e)):t.isAsync()?t.readAll().then(e=>new xi(e)):new xi(t.readAll())}let U7=0;class ex{constructor(t){if(this.max_ix=-1,this._children=[],this.promise=Promise.resolve(),this.download_state="Unattempted",this.key=String(Math.random()),this.parent=null,this.dataset=t,t===void 0)throw new Error("No dataset provided");this.numeric_id=U7++}get children(){return this._children}get dictionary_lookups(){return this.dataset.dictionary_lookups}download(){throw new Error("Not implemented")}delete_column_if_exists(t){var e;this._batch&&((e=this._buffer_manager)==null||e.release(t),this._batch=g_(this.record_batch,t,null))}async apply_transformation(t){const e=this.dataset.transformations[t];if(e===void 0)throw new Error(`Transformation ${t} is not defined`);const r=await e(this);if(r===void 0)throw new Error(`Transformation ${t} failed`);this._batch=g_(this.record_batch,t,r)}add_column(t,e){return this._batch=g_(this.record_batch,t,e),this._batch}is_visible(t,e){if(this.min_ix===void 0||this.min_ix>t)return!1;if(e===void 0)return!0;const r=this.extent;return!(r.x[0]>e.x[1]||r.x[1]<e.x[0]||r.y[0]>e.y[1]||r.y[1]<e.y[0])}*points(t,e=!1){for(const r of this)k0([r.x,r.y],t)&&(yield r);if(e===!1){for(const r of this.children)if(r.ready&&!(t&&!r.is_visible(1e100,t)))for(const a of r.points(t,e))k0([a.x,a.y],t)&&(yield a)}else{let r=this.children.map(a=>{const o={t:a,iterator:a.points(t,e),next:void 0};return o.next=o.iterator.next(),o});for(r=r.filter(a=>{var o;return(o=a==null?void 0:a.next)==null?void 0:o.value});r.length>0;){let a=0;for(let o=1;o<r.length;o++)r[o].next.value.ix<r[a].next.value.ix&&(a=o);yield r[a].next.value,r[a].next=r[a].iterator.next(),r[a].next.done&&(r=r.splice(a,1))}}}forEach(t){for(const e of this.points(void 0,!1))e!==void 0&&t(e)}set highest_known_ix(t){(this._highest_known_ix==null||this._highest_known_ix<t)&&(this._highest_known_ix=t,this.parent&&(this.parent.highest_known_ix=t))}get highest_known_ix(){return this._highest_known_ix||-1}get record_batch(){if(this._batch)return this._batch;if(this._table_buffer&&this._table_buffer.byteLength>0)return this._batch=qc(this._table_buffer).batches[0];throw new Error("Attempted to access table on tile without table buffer.")}get min_ix(){return this._min_ix!==void 0?this._min_ix:this.parent?this.parent.max_ix+1:0}async schema(){return await this.download(),this._schema}extend_promise(t){return this.promise=this.promise.then(()=>t()),this.promise}get ready(){return this._table_buffer!==void 0&&this._table_buffer.byteLength>0}get _schema(){if(this.__schema)return this.__schema;const t=[];for(const e of this.record_batch.schema.fields){const{name:r,type:a}=e;if((a==null?void 0:a.typeId)==5&&t.push({name:r,type:"string",extent:[]}),a&&a.dictionary&&t.push({name:r,type:"dictionary",keys:this.record_batch.getChild(r).data[0].dictionary.toArray(),extent:[-2047,this.record_batch.getChild(r).data[0].dictionary.length-2047]}),a&&a.typeId==8&&t.push({name:r,type:"date",extent:Lh(this.record_batch.getChild(r).data[0].values)}),(a==null?void 0:a.typeId)===10)return[10,100];a&&a.typeId==3&&t.push({name:r,type:"float",extent:Lh(this.record_batch.getChild(r).data[0].values)})}return this.__schema=t,t}*yielder(){for(const t of this.record_batch)t&&(yield t)}get extent(){return this._extent?this._extent:{x:[Number.MIN_VALUE,Number.MAX_VALUE],y:[Number.MIN_VALUE,Number.MAX_VALUE]}}[Symbol.iterator](){return this.yielder()}get root_extent(){return this.parent===null?{x:[Number.MIN_VALUE,Number.MAX_VALUE],y:[Number.MIN_VALUE,Number.MAX_VALUE]}:this.parent.root_extent}}class G7 extends ex{constructor(t,e,r,a){super(a),this._children=[],this._already_called=!1,this.child_locations=[],this.url=t,this.parent=r,this.key=e;const[o,f,c]=e.split("/").map(l=>Number.parseInt(l));this.codes=[o,f,c]}get extent(){return this._extent?this._extent:this.theoretical_extent}async download_to_depth(t){await this.download();let e=[];this.max_ix<t&&(e=this.children.map(r=>r.download_to_depth(t))),await Promise.all(e)}async get_arrow(t=void 0){let e=`${this.url}/${this.key}.feather`,r={};window.localStorage.getItem("isLoggedIn")==="true"&&(e=e.replace("/public",""),r={credentials:"include"}),t&&(e=e.replace(".feather",`.${t}.feather`));const a={method:"GET",...r},f=await(await fetch(e,a)).arrayBuffer(),c=qc(f);c.batches.length>1&&console.warn(`More than one record batch at ${e}; all but first batch will be ignored.`);const l=c.batches[0];return t===void 0&&(this.download_state="Complete",this._table_buffer=f,this._batch=qc(f).batches[0]),l}async download(){if(this._download)return this._download;if(this._already_called)throw"Illegally attempting to download twice";return this._already_called=!0,this.download_state="In progress",this._download=this.get_arrow().then(t=>{const e=t.schema.metadata,r=e.get("extent");r&&(this._extent=JSON.parse(r));const a=e.get("children");a&&(this.child_locations=JSON.parse(a));const o=t.getChild("ix");if(o===null)throw"No ix column in table";this._min_ix=Number(o.get(0)),this.max_ix=Number(o.get(o.length-1)),this._min_ix>this.max_ix&&(this.max_ix=this._min_ix+1e5,this._min_ix=0),this.highest_known_ix=this.max_ix}).catch(t=>{throw this.download_state="Failed",console.error(`Error: Remote Tile at ${this.url}/${this.key}.feather not found.
        `),console.warn(t),t}),this._download}get macrotile(){return nx(this.key)}get macro_siblings(){return $7(this.key)}get children(){if(this.download_state!=="Complete")return[];const t=this.constructor;if(this._children.length<this.child_locations.length)for(const e of this.child_locations){const r=new t(this.url,e,this,this.dataset);this._children.push(r)}return this._children}get theoretical_extent(){const t=this.dataset.extent,[e,r,a]=this.codes,f=(t.x[1]-t.x[0])/2**e,l=(t.y[1]-t.y[0])/2**e;return{x:[t.x[0]+r*f,t.x[0]+(r+1)*f],y:[t.y[0]+a*l,t.y[0]+(a+1)*l]}}}class Bg extends ex{constructor(t,e,r,a=null){if(super(e),this.full_tab=t,this._batch=t.batches[r],this.download_state="Complete",this.batch_num=r,this._batch.getChild("ix")===null){console.warn("Manually setting ix");const c=this._batch,l=new Float32Array(c.numRows),_=this.dataset._ix_seed;this.dataset._ix_seed+=c.numRows;for(let m=0;m<c.numRows;m++)l[m]=m+_;this._min_ix=_,this._max_ix=_+c.numRows,this.highest_known_ix=this._max_ix,this._batch=g_(this.record_batch,"ix",l)}this._extent={x:Lh(this._batch.getChild("x")),y:Lh(this._batch.getChild("y"))},this.parent=a;const o=this._batch.get(this._batch.numRows-1);if(o===null)throw"No rows in table";this.max_ix=Number(o.ix),this.highest_known_ix=Number(this.max_ix);const f=this._batch.get(0);if(f===null)throw"No rows in table";this._min_ix=Number(f.ix),this.highest_known_ix=Number(this.max_ix),this.create_children()}create_children(){let t=this.batch_num*4;for(;++t<=this.batch_num*4+4;)t<this.full_tab.batches.length&&this._children.push(new Bg(this.full_tab,this.dataset,t,this));for(const e of this._children)for(const r of["x","y"])this._extent[r][0]=Math.min(this._extent[r][0],e._extent[r][0]),this._extent[r][1]=Math.max(this._extent[r][1],e._extent[r][1])}download(){return Promise.resolve(this._batch)}get ready(){return!0}}function k0(n,t){return t===void 0?!0:n[0]<t.x[1]&&n[0]>t.x[0]&&n[1]<t.y[1]&&n[1]>t.y[0]}function nx(n,t=2,e=2){let[r,a,o]=n.split("/").map(c=>parseInt(c)),f=0;for(;!(f>=e&&r%t==0);)a=Math.floor(a/2),o=Math.floor(o/2),r=r-1,f++;return`${r}/${a}/${o}`}function $7(n,t=2,e=2){return j7(nx(n,t,e),t,e)}const Xm=new Map;function j7(n,t=2,e=2){if(Xm.has(n))return Xm.get(n);const r=[[n]];for(;r.length<e;)r.unshift(r[0].map(qm).flat());const a=[r[0].map(qm).flat()];for(;a.length<t;)a.unshift(a[0].map(qm).flat());a.reverse();const o=a.flat();return Xm.set(n,o),o}function qm(n){const[t,e,r]=n.split("/").map(o=>parseInt(o)),a=[];for(let o=0;o<4;o++)a.push(`${t+1}/${e*2+o%2}/${r*2+Math.floor(o/2)}`);return a}function V7(){}class _p{constructor(t){this.transformations={},this.extents={},this._ix_seed=0,this.plot=t}get highest_known_ix(){return this.root_tile.highest_known_ix}get table(){return new xi(this.map(t=>t).filter(t=>t.ready).map(t=>t.record_batch))}static from_quadfeather(t,e,r){return new Y7(t,e,r)}static from_arrow_table(t,e,r){return new W7(t,e,r)}delete_column_if_exists(t){this.map(e=>e.delete_column_if_exists(t)),delete this.transformations[t]}domain(t,e=1e6){var r;if(this.extents[t])return this.extents[t];const a=(r=this._schema)==null?void 0:r.fields.find(o=>o.name===t);if(a!==void 0){let o,f;const c=a.metadata.get("extent");c&&([o,f]=JSON.parse(c));const l=a.metadata.get("min");l&&(o=JSON.parse(l));const _=a.metadata.get("max");if(_&&(f=JSON.parse(_)),a.type.typeId==10&&typeof o=="string"&&(o=Number(new Date(o))),a.type.typeId==10&&typeof f=="string"&&(f=Number(new Date(f))),typeof f=="string")throw new Error("Failed to parse min-max as numbers");if(o!==void 0)return this.extents[t]=[o,f]}return this.extents[t]=Lh([...this.table.getChild(t)])}*points(t,e=1e99){const r=[this.root_tile];let a;for(;a=r.shift();)if(a.download_state=="Complete"&&(t===void 0||a.is_visible(e,t))){for(const o of a)k0([o.x,o.y],t)&&o.ix<=e&&(yield o);r.push(...a.children)}}map(t,e=!1){const r=[];return this.visit(a=>{r.push(t(a))},e),r}visit(t,e=!1,r=a=>!0){const a=[this.root_tile],o=[];let f;for(;f=a.shift();)e?o.push(f):t(f),r(f)&&f.download_state=="Complete"&&a.push(...f.children);if(e)for(;f=o.pop();)t(f)}async schema(){return await this.ready,this._schema?this._schema:(this._schema=this.root_tile.record_batch.schema,this.root_tile.record_batch.schema)}add_tiled_column(t,e){const r=qc(e),a={};for(const o of r.batches){const f=o.getChild("data").data[0].valueOffsets,c=o.getChild("data").data[0].children[0];for(let l=0;l<o.data.length;l++){const _=o.getChild("_tile").get(l);a[_]=c.values.slice(f[l],f[l+1])}}this.transformations[t]=function(o){const{key:f}=o;return a[f]}}add_sparse_identifiers(t,e){this.transformations[t]=function(r){var a;const{key:o}=r,f=r.record_batch.numRows,c=new Float32Array(f),l=(a=e.values[o])!=null?a:[];for(const[_,m]of Object.entries(l))c[Number.parseInt(_)]=m;return c}}add_label_identifiers(t,e,r="_id"){if(this.transformations[e])throw new Error(`Can't overwrite existing transformation for ${e}`);this.transformations[e]=function(a){return X7(a.record_batch,t,e,r)}}findPoint(t){const e=[];return this.visit(r=>{if(!(r.ready&&r.record_batch&&r.min_ix<=t&&r.max_ix>=t))return;const a=a4([...r.record_batch.getChild("ix").data[0].values],t),o=r.record_batch.get(a);o.ix===t&&e.push(o)}),e}}class W7 extends _p{constructor(t,e,r){super(r),this.promise=Promise.resolve(),this.root_tile=new Bg(t,this,0,r)}get extent(){return this.root_tile.extent}get ready(){return Promise.resolve()}download_most_needed_tiles(t,e,r){}}class Y7 extends _p{constructor(t,e,r){super(r),this._download_queue=new Set,this.promise=new Promise(V7),this.root_tile=new G7(t,"0/0/0",null,this,e),this.promise=this.root_tile.download().then(a=>{const o=this.root_tile.record_batch.schema;if(o.metadata.has("sidecars"))for(const[f,c]of Object.entries(JSON.parse(o.metadata.get("sidecars"))))this.transformations[f]=async function(l){const _=await l.get_arrow(c),m=_.getChild(f);if(m===null)throw new Error(`No column named ${f} in sidecar tile ${_.schema.fields.map(A=>A.name)}`);return m}})}get ready(){return this.root_tile.download()}get extent(){return this.root_tile.extent}async download_to_depth(t){await this.root_tile.download_to_depth(t)}download_most_needed_tiles(t,e,r=4){const a=this._download_queue;if(a.size>=r)return;const o=[];function f(c){if(t===void 0)return 1/c.codes[0];if(c.download_state==="Unattempted"){const l=H7(c,t);o.push([l,c,t])}}for(this.visit(f),o.sort((c,l)=>Number(c[0])-Number(l[0]));o.length>0&&a.size<r;){const c=o.pop();if(c===void 0)throw new Error("Ran out of tiles unexpectedly");const[l,_,m]=c;_.min_ix&&_.min_ix>e||l<=0||(a.add(_.key),_.download().then(()=>a.delete(_.key)).catch(A=>{throw console.warn("Error on",_.key),a.delete(_.key),A}))}}add_macrotiled_column(t,e){const r={},a={};async function o(f){const{key:c,macrotile:l}=f;return r[l]!==void 0?await r[l]:(r[l]=e(f.macro_siblings).then(_=>{const m=qc(_);for(const A of m.batches){const R=A.getChild("data").data[0].valueOffsets,C=A.getChild("data").data[0].children[0];for(let G=0;G<A.data.length;G++){const $t=A.getChild("_tile").get(G);a[$t]=C.values.slice(R[G],R[G+1])}}}),r[l])}this.transformations[t]=async function(f){return await o(f),a[f.key]}}}function wy(n){return(n.x[1]-n.x[0])*(n.y[1]-n.y[0])}function H7(n,t){const e=n.extent;if(e.x[0]>t.x[1]||e.x[1]<t.x[0]||e.y[0]>t.y[1]||e.y[1]<t.y[0])return 0;const r={x:[t0([t.x[0],e.x[0]]),e0([t.x[1],e.x[1]])],y:[t0([t.y[0],e.y[0]]),e0([t.y[1],e.y[1]])]},{x:a,y:o}=r;let f=0;return a[0]>a[1]&&(f-=1),o[0]>o[1]&&(f-=2),f<0?f:wy(r)/wy(t)}function g_(n,t,e){const r={};for(const o of n.schema.fields){if(o.name===t){if(e===null)continue;throw new Error(`Name ${o.name} already exists, can't add.`)}r[o.name]=n.getChild(o.name).data[0]}if(e===void 0)throw new Error("Must pass data to bind_column");e!==null&&(e instanceof Float32Array||e instanceof BigInt64Array?r[t]=Mw(e).data[0]:r[t]=e.data[0]);const a=new Pi(r);for(const[o,f]of n.schema.metadata)a.schema.metadata.set(o,f);for(const o of n.schema.fields){const f=a.schema.fields.find(c=>c.name===o.name);if(f!==void 0)for(const[c,l]of o.metadata)f.metadata.set(c,l);else if(e!==null)throw new Error("Error!")}if(e!==null){const o=a.schema.fields.find(f=>f.name===t);o==null||o.metadata.set("created by deepscatter",new Date().toISOString())}return a}function X7(n,t,e,r="_id"){var a;const o=new Float32Array(n.numRows),f=n.getChild(r);if(f===null)throw new Error(`Field ${r} not found in batch`);let c="string";if(((a=f==null?void 0:f.type)==null?void 0:a.typeId)===2&&(c="bigint"),c==="bigint"){for(let A=0;A<n.numRows;A++){const R=t[String(f.get(A))];R!==void 0&&(o[A]=R)}return o}const l=new Set;for(const A of Object.keys(t)){const R=[0,1,2,3].map(C=>A.charCodeAt(C)||"").join("");l.add(R)}const _=f.data[0].valueOffsets,m=f.data[0].values;for(let A=0;A<n.numRows;A++){const R=m.slice(_[A],_[A+1]),C=R.slice(0,4).join("");if(l.has(C)){const G=String.fromCharCode(...R);t[G]!==void 0&&(o[A]=t[G])}}return o}var rx={},P0={},q7={get exports(){return P0},set exports(n){P0=n}};(function(n,t){(function(e,r){n.exports=r()})(ca,function(){function e(f,c,l,_,m){r(f,c,l||0,_||f.length-1,m||o)}function r(f,c,l,_,m){for(;_>l;){if(_-l>600){var A=_-l+1,R=c-l+1,C=Math.log(A),G=.5*Math.exp(2*C/3),$t=.5*Math.sqrt(C*G*(A-G)/A)*(R-A/2<0?-1:1),Kt=Math.max(l,Math.floor(c-R*G/A+$t)),Mt=Math.min(_,Math.floor(c+(A-R)*G/A+$t));r(f,c,Kt,Mt,m)}var ie=f[c],Xt=l,it=_;for(a(f,l,c),m(f[_],ie)>0&&a(f,l,_);Xt<it;){for(a(f,Xt,it),Xt++,it--;m(f[Xt],ie)<0;)Xt++;for(;m(f[it],ie)>0;)it--}m(f[l],ie)===0?a(f,l,it):(it++,a(f,it,_)),it<=c&&(l=it+1),c<=it&&(_=it-1)}}function a(f,c,l){var _=f[c];f[c]=f[l],f[l]=_}function o(f,c){return f<c?-1:f>c?1:0}return e})})(q7);(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=P0,e=[],r=function(st){return e.push(st)},a=function(st){st&&(r(st),_(st)||st.children.forEach(a))},o=function(st){var Y=e.pop();return Y?(Y.children=st,Y.height=1,Y.leaf=!0,Y.minX=1/0,Y.minY=1/0,Y.minZ=1/0,Y.maxX=-1/0,Y.maxY=-1/0,Y.maxZ=-1/0):Y={children:st,height:1,leaf:!0,minX:1/0,minY:1/0,minZ:1/0,maxX:-1/0,maxY:-1/0,maxZ:-1/0},Y},f=[],c=function(st){return f.push(st)},l=function(st,Y){var rt=f.pop();return rt?(rt.dist=st,rt.node=Y):rt={dist:st,node:Y},rt},_=function(st){return st.leaf},m=function(st,Y){return st.leaf},A=function(st,Y,rt){if(!rt)return Y.indexOf(st);for(var Bt=0;Bt<Y.length;Bt++)if(rt(st,Y[Bt]))return Bt;return-1},R=function(st){C(st,0,st.children.length,st)},C=function(st,Y,rt,Bt){var Dt=Bt;Dt?(Dt.minX=1/0,Dt.minY=1/0,Dt.minZ=1/0,Dt.maxX=-1/0,Dt.maxY=-1/0,Dt.maxZ=-1/0):Dt=o([]);for(var F=Y,ft=void 0;F<rt;F++)ft=st.children[F],G(Dt,ft);return Dt},G=function(st,Y){return st.minX=Math.min(st.minX,Y.minX),st.minY=Math.min(st.minY,Y.minY),st.minZ=Math.min(st.minZ,Y.minZ),st.maxX=Math.max(st.maxX,Y.maxX),st.maxY=Math.max(st.maxY,Y.maxY),st.maxZ=Math.max(st.maxZ,Y.maxZ),st},$t=function(st){return(st.maxX-st.minX)*(st.maxY-st.minY)*(st.maxZ-st.minZ)},Kt=function(st){return st.maxX-st.minX+(st.maxY-st.minY)+(st.maxZ-st.minZ)},Mt=function(st,Y){var rt=Math.min(st.minX,Y.minX),Bt=Math.min(st.minY,Y.minY),Dt=Math.min(st.minZ,Y.minZ),F=Math.max(st.maxX,Y.maxX),ft=Math.max(st.maxY,Y.maxY),H=Math.max(st.maxZ,Y.maxZ);return(F-rt)*(ft-Bt)*(H-Dt)},ie=function(st,Y){var rt=Math.max(st.minX,Y.minX),Bt=Math.max(st.minY,Y.minY),Dt=Math.max(st.minZ,Y.minZ),F=Math.min(st.maxX,Y.maxX),ft=Math.min(st.maxY,Y.maxY),H=Math.min(st.maxZ,Y.maxZ);return Math.max(0,F-rt)*Math.max(0,ft-Bt)*Math.max(0,H-Dt)},Xt=function(st,Y){return st.minX<=Y.minX&&st.minY<=Y.minY&&st.minZ<=Y.minZ&&Y.maxX<=st.maxX&&Y.maxY<=st.maxY&&Y.maxZ<=st.maxZ};n.intersects=function(st,Y){return Y.minX<=st.maxX&&Y.minY<=st.maxY&&Y.minZ<=st.maxZ&&Y.maxX>=st.minX&&Y.maxY>=st.minY&&Y.maxZ>=st.minZ},n.boxRayIntersects=function(st,Y,rt,Bt,Dt,F,ft){var H=(st.minX-Y)*Dt,bt=(st.maxX-Y)*Dt,Lt=(st.minY-rt)*F,Jt=(st.maxY-rt)*F,ee=(st.minZ-Bt)*ft,de=(st.maxZ-Bt)*ft,Te=Math.min(ee,de),ye=Math.max(ee,de),Ze=Math.min(Lt,Jt),on=Math.max(Lt,Jt),An=Math.min(H,bt),Nn=Math.max(H,bt),ln=Math.max(0,An,Ze,Te),Dn=Math.min(Nn,on,ye);return Dn>=ln?ln:1/0};var it=function(st,Y,rt,Bt,Dt){for(var F=[Y,rt],ft;F.length;)rt=F.pop(),Y=F.pop(),!(rt-Y<=Bt)&&(ft=Y+Math.ceil((rt-Y)/Bt/2)*Bt,t(st,ft,Y,rt,Dt),F.push(Y,ft,ft,rt))},Ct=function(st,Y){return st.minX-Y.minX},fe=function(st,Y){return st.minY-Y.minY},be=function(st,Y){return st.minZ-Y.minZ},sn=function(){function st(Y){Y===void 0&&(Y=16),this.maxEntries=Math.max(Y,8),this.minEntries=Math.max(4,Math.ceil(this.maxEntries*.4)),this.clear()}return st.alloc=function(){return this.pool.pop()||new this},st.free=function(Y){Y.clear(),this.pool.push(Y)},st.prototype.search=function(Y){var rt=this.data,Bt=[];if(!n.intersects(Y,rt))return Bt;for(var Dt=[];rt;){for(var F=0,ft=rt.children.length;F<ft;F++){var H=rt.children[F];n.intersects(Y,H)&&(m(rt)?Bt.push(H):Xt(Y,H)?this._all(H,Bt):Dt.push(H))}rt=Dt.pop()}return Bt},st.prototype.collides=function(Y){var rt=this.data;if(!n.intersects(Y,rt))return!1;for(var Bt=[];rt;){for(var Dt=0,F=rt.children.length;Dt<F;Dt++){var ft=rt.children[Dt];if(n.intersects(Y,ft)){if(m(rt)||Xt(Y,ft))return!0;Bt.push(ft)}}rt=Bt.pop()}return!1},st.prototype.raycastInv=function(Y,rt,Bt,Dt,F,ft,H){H===void 0&&(H=1/0);var bt=this.data;if(Dt===1/0&&F===1/0&&ft===1/0||n.boxRayIntersects(bt,Y,rt,Bt,Dt,F,ft)===1/0)return l(1/0,void 0);for(var Lt=[l(0,bt)],Jt=function(ln,Dn){var ir=Lt[ln];Lt[ln]=Lt[Dn],Lt[Dn]=ir},ee=function(){var ln=Lt[0],Dn=Lt.length-1;Lt[0]=Lt[Dn],Lt.length=Dn;for(var ir=0;;){var Kn=ir<<1|1;if(Kn>=Dn)break;var Yr=Kn+1;if(Yr<Dn&&Lt[Yr].dist<Lt[Kn].dist&&(Kn=Yr),Lt[ir].dist<Lt[Kn].dist)break;Jt(ir,Kn),ir=Kn}return c(ln),ln.node},de=function(ln,Dn){var ir=Lt.length;for(Lt.push(l(ln,Dn));ir>0;){var Kn=ir-1>>1;if(Lt[Kn].dist<=Lt[ir].dist)break;Jt(ir,Kn),ir=Kn}},Te=H,ye;Lt.length&&Lt[0].dist<Te;){bt=ee();for(var Ze=0,on=bt.children.length;Ze<on;Ze++){var An=bt.children[Ze],Nn=n.boxRayIntersects(An,Y,rt,Bt,Dt,F,ft);if(!m(bt))de(Nn,An);else if(Nn<Te){if(Nn===0)return l(Nn,An);Te=Nn,ye=An}}}return l(Te<H?Te:1/0,ye)},st.prototype.raycast=function(Y,rt,Bt,Dt,F,ft,H){return H===void 0&&(H=1/0),this.raycastInv(Y,rt,Bt,1/Dt,1/F,1/ft,H)},st.prototype.all=function(){return this._all(this.data,[])},st.prototype.load=function(Y){if(!(Y&&Y.length))return this;if(Y.length<this.minEntries){for(var rt=0,Bt=Y.length;rt<Bt;rt++)this.insert(Y[rt]);return this}var Dt=this.build(Y.slice(),0,Y.length-1,0);if(!this.data.children.length)this.data=Dt;else if(this.data.height===Dt.height)this.splitRoot(this.data,Dt);else{if(this.data.height<Dt.height){var F=this.data;this.data=Dt,Dt=F}this._insert(Dt,this.data.height-Dt.height-1,!0)}return this},st.prototype.insert=function(Y){return Y&&this._insert(Y,this.data.height-1),this},st.prototype.clear=function(){return this.data&&a(this.data),this.data=o([]),this},st.prototype.remove=function(Y,rt){if(!Y)return this;for(var Bt=this.data,Dt=0,F=!1,ft,H,bt=[],Lt=[];Bt||bt.length;){if(Bt||(Bt=bt.pop(),Dt=Lt.pop(),H=bt[bt.length-1],F=!0),_(Bt)&&(ft=A(Y,Bt.children,rt),ft!==-1))return Bt.children.splice(ft,1),bt.push(Bt),this.condense(bt),this;!F&&!_(Bt)&&Xt(Bt,Y)?(bt.push(Bt),Lt.push(Dt),Dt=0,H=Bt,Bt=Bt.children[0]):H?(Dt++,Bt=H.children[Dt],F=!1):Bt=void 0}return this},st.prototype.toJSON=function(){return this.data},st.prototype.fromJSON=function(Y){return a(this.data),this.data=Y,this},st.prototype.build=function(Y,rt,Bt,Dt){var F=Bt-rt+1,ft=this.maxEntries,H;if(F<=ft)return H=o(Y.slice(rt,Bt+1)),R(H),H;Dt||(Dt=Math.ceil(Math.log(F)/Math.log(ft)),ft=Math.ceil(F/Math.pow(ft,Dt-1))),H=o([]),H.leaf=!1,H.height=Dt;var bt=Math.ceil(F/ft),Lt=bt*Math.ceil(Math.pow(ft,2/3)),Jt=bt*Math.ceil(Math.pow(ft,1/3));it(Y,rt,Bt,Jt,Ct);for(var ee=rt;ee<=Bt;ee+=Jt){var de=Math.min(ee+Jt-1,Bt);it(Y,ee,de,Lt,fe);for(var Te=ee;Te<=de;Te+=Lt){var ye=Math.min(Te+Lt-1,de);it(Y,Te,ye,bt,be);for(var Ze=Te;Ze<=ye;Ze+=bt){var on=Math.min(Ze+bt-1,ye);H.children.push(this.build(Y,Ze,on,Dt-1))}}}return R(H),H},st.prototype._all=function(Y,rt){for(var Bt=[];Y;)_(Y)?rt.push.apply(rt,Y.children):Bt.push.apply(Bt,Y.children),Y=Bt.pop();return rt},st.prototype.chooseSubtree=function(Y,rt,Bt,Dt){for(var F,ft,H;Dt.push(rt),!(_(rt)||Dt.length-1===Bt);){F=ft=1/0;for(var bt=0,Lt=rt.children.length;bt<Lt;bt++){var Jt=rt.children[bt],ee=$t(Jt),de=Mt(Y,Jt)-ee;de<ft?(ft=de,F=ee<F?ee:F,H=Jt):de===ft&&ee<F&&(F=ee,H=Jt)}rt=H||rt.children[0]}return rt},st.prototype.split=function(Y,rt){var Bt=Y[rt],Dt=Bt.children.length,F=this.minEntries;this.chooseSplitAxis(Bt,F,Dt);var ft=this.chooseSplitIndex(Bt,F,Dt),H=o(Bt.children.splice(ft,Bt.children.length-ft));H.height=Bt.height,H.leaf=Bt.leaf,R(Bt),R(H),rt?Y[rt-1].children.push(H):this.splitRoot(Bt,H)},st.prototype.splitRoot=function(Y,rt){this.data=o([Y,rt]),this.data.height=Y.height+1,this.data.leaf=!1,R(this.data)},st.prototype.chooseSplitIndex=function(Y,rt,Bt){for(var Dt=1/0,F=1/0,ft,H=rt;H<=Bt-rt;H++){var bt=C(Y,0,H),Lt=C(Y,H,Bt),Jt=ie(bt,Lt),ee=$t(bt)+$t(Lt);Jt<Dt?(Dt=Jt,ft=H,F=ee<F?ee:F):Jt===Dt&&ee<F&&(F=ee,ft=H)}return ft},st.prototype.chooseSplitAxis=function(Y,rt,Bt){var Dt=this.allDistMargin(Y,rt,Bt,Ct),F=this.allDistMargin(Y,rt,Bt,fe),ft=this.allDistMargin(Y,rt,Bt,be);Dt<F&&Dt<ft?Y.children.sort(Ct):F<Dt&&F<ft&&Y.children.sort(fe)},st.prototype.allDistMargin=function(Y,rt,Bt,Dt){Y.children.sort(Dt);for(var F=C(Y,0,rt),ft=C(Y,Bt-rt,Bt),H=Kt(F)+Kt(ft),bt=rt;bt<Bt-rt;bt++){var Lt=Y.children[bt];G(F,Lt),H+=Kt(F)}for(var bt=Bt-rt-1;bt>=rt;bt--){var Lt=Y.children[bt];G(ft,Lt),H+=Kt(ft)}return H},st.prototype.adjustParentBBoxes=function(Y,rt,Bt){for(var Dt=Bt;Dt>=0;Dt--)G(rt[Dt],Y)},st.prototype.condense=function(Y){for(var rt=Y.length-1,Bt=void 0;rt>=0;rt--)Y[rt].children.length===0?rt>0?(Bt=Y[rt-1].children,Bt.splice(Bt.indexOf(Y[rt]),1),r(Y[rt])):this.clear():R(Y[rt])},st.prototype._insert=function(Y,rt,Bt){var Dt=[],F=this.chooseSubtree(Y,this.data,rt,Dt);for(F.children.push(Y),G(F,Y);rt>=0&&Dt[rt].children.length>this.maxEntries;)this.split(Dt,rt),rt--;this.adjustParentBBoxes(Y,Dt,rt)},st.pool=[],st}();n.RBush3D=sn})(rx);const Zm=i5();function Z7(n){const[t,e]=n._zoom.scales().x.range(),[r,a]=n._zoom.scales().x.domain();return(e-t)/(a-r)}const xy=0;class K7 extends xv{constructor(t,e,r={}){super(t.div.node(),t._root,t),this.layers=[],this.options={},this.options=r,this.canvas=t.elements[2].selectAll("canvas").node();const a=t.elements[3].selectAll("svg").node(),o=e.replace(/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~]/g,"---"),f=a.querySelectorAll(`#${o}`);if(f.length===0?this.labelgroup=Wn(a).select("#labelrects").append("g").attr("id",o).node():this.labelgroup=f[1],this.canvas===void 0)throw new Error("WTF?");this.ctx=this.canvas.getContext("2d"),this.tree=new tO(this.ctx,Z7(t),.5,[.5,1e6],r.margin===void 0?30:r.margin),this.bind_zoom(t._renderer.zoom)}start(t=1e9){this.timer&&this.timer.stop(),Wn(this.labelgroup).attr("display","inline"),this.timer=Wh(()=>{this.render(),t-=1,t<=0&&this.stop()})}delete(){Wn(this.labelgroup).remove()}stop(){this.timer&&(this.timer.stop(),Wn(this.labelgroup).attr("display","none"),this.ctx.clearRect(0,0,4096,4096),this.timer=void 0)}update(t,e,r){var a;this.label_key=e;for(const o of t.features){const{properties:f,geometry:c}=o;if(f!==null&&c.type==="Point"){const l=(a=f[r])!=null?a:16;let _="";f[e]!==void 0&&f[e]!==null&&(_=f[e]);const m={x:c.coordinates[0]+Math.random()*.1,y:c.coordinates[1]+Math.random()*.1,text:_,height:l,properties:f};this.tree.insert_point(m)}}}render(){const t=this.ctx,{x_:e,y_:r}=this.zoom.scales(),{transform:a}=this.zoom,{width:o,height:f}=this;t.clearRect(0,0,o,f),t.textAlign="center",t.textBaseline="middle",t.globalAlpha=1;const c=1,l=this.zoom.current_corners(),_=this.tree.search({minX:l.x[0],minY:l.y[0],minZ:a.k,maxX:l.x[1],maxY:l.y[1],maxZ:a.k});t.clearRect(0,0,4096,4096);const m=this.scatterplot.dim("color"),A=Wn(this.labelgroup).selectAll("rect.labelbbox").data(_,C=>""+C.minZ+C.minX).join(C=>C.append("rect").attr("class","labellbox").style("opacity",xy)),R=5;for(const C of _){const G=C.data,$t=e(G.x),Kt=r(G.y);t.globalAlpha=1,t.fillStyle="white";let Mt=!1;for(const Xt of[this.scatterplot.dim("filter"),this.scatterplot.dim("filter2")])G.properties[Xt.field]&&(Xt.apply(G.properties)||(Mt=!0));if(Mt){G.properties.__display="none";continue}else G.properties.__display="inline";this.options.useColorScale===!1||this.options.useColorScale===void 0?(t.shadowColor="#71797E",t.strokeStyle="#71797E"):G.properties[m.field]?m.scale.domain().indexOf(G.properties[m.field])>-1?(t.shadowColor=m.scale(G.properties[m.field]),t.strokeStyle=m.scale(G.properties[m.field])):(t.shadowColor="gray",t.strokeStyle="gray"):t.shadowColor="black";let ie=0;this.hovered===""+C.minZ+C.minX&&(ie+=2),t.font=`${G.height*c+ie}pt verdana`,t.shadowBlur=12+ie*3,t.lineWidth=3+ie,t.strokeText(G.text,$t,Kt),t.shadowBlur=0,t.lineWidth=4+ie,t.fillStyle="white",t.fillText(G.text,$t,Kt)}A.attr("class","labelbbox").attr("x",C=>e(C.data.x)-C.data.pixel_width*this.tree.pixel_ratio/2).attr("y",C=>r(C.data.y)-C.data.pixel_height*this.tree.pixel_ratio/2-R).attr("width",C=>C.data.pixel_width*this.tree.pixel_ratio).attr("stroke","red").attr("height",C=>C.data.pixel_height*this.tree.pixel_ratio+R*2).attr("display",C=>C.data.properties.__display||"inline").on("mouseover",(C,G)=>{Wn(C.target).style("opacity",xy),this.hovered=""+G.minZ+G.minX,C.stopPropagation()}).on("mousemove",function(C,G){C.stopPropagation()}).on("click",(C,G)=>{this.scatterplot.label_click(G.data,this.scatterplot,this)}).on("mouseout",(C,G)=>{this.hovered=void 0,C.stopPropagation()}),this.options.draggable_labels&&(Zm.on("drag",(C,G)=>{G.data.x=e.invert(C.x),G.data.y=r.invert(C.y)}),Zm.on("end",(C,G)=>{console.log({text:G.data.text,x:G.data.x,y:G.data.y})}),A.call(Zm)),t.shadowColor="black",t.strokeStyle="black"}}let a_=null;function J7(){if(a_!==null)return a_;const n=document.createElement("canvas");return n.width=500,n.height=400,a_=n.getContext("2d"),a_}function Q7(n,t,e){const r=J7();if(r.font=`${n.height}pt verdana`,n.text==="")return null;const a=r.measureText(n.text);let{actualBoundingBoxLeft:o,actualBoundingBoxRight:f,actualBoundingBoxAscent:c,actualBoundingBoxDescent:l}=a;return(Number.isNaN(o)||o===void 0)&&(o=0,f=a.width,c=n.height,l=0),{pixel_height:(c-l)/t+e/t,pixel_width:(f-o)/t+e/t}}class tO extends rx.RBush3D{constructor(t,e,r=.5,a=[.1,1e3],o=10){super(),this._accessor=f=>[f.x,f.y],this.scale_factor=r,this.mindepth=a[0],this.maxdepth=a[1],this.context=t,this.pixel_ratio=e,this.margin=o}max_collision_depth(t,e){const[r,a]=this._accessor(t),[o,f]=this._accessor(e),c=Math.abs(r-o),_=(t.pixel_width+e.pixel_width)/2/c,m=Math.abs(a-f),R=(t.pixel_height+e.pixel_height)/2/m;return Math.min(_,R)}set accessor(t){this._accessor=t}get accessor(){return this._accessor}to3d(t,e=1,r){const[a,o]=this.accessor(t),{pixel_height:f,pixel_width:c}=t,l={minX:a-c/e/2,maxX:a+c/e/2,minY:o-f/e/2,maxY:o+f/e/2,minZ:e,maxZ:r||this.maxdepth,data:t};if(Number.isNaN(a)||Number.isNaN(o))throw"Missing position"+JSON.stringify(t);if(Number.isNaN(c))throw"Missing Aspect Ratio"+JSON.stringify(t);return l}insert_point(t,e=1/4){if(t.text===void 0||t.text==="")return;let r;t.pixel_width===void 0?r={...t,...Q7(t,this.pixel_ratio,this.margin)}:r=t;const a=this.to3d(r,e,this.maxdepth);this.collides(a)?this.insert_after_collisions(a):e<=this.mindepth?this.insert(a):this.insert_point(t,e/2)}insert_after_collisions(t){let e=-1,r;for(const a of this.search(t)){const o=this.max_collision_depth(t.data,a.data);o>e&&(e=o,r=a)}if(r&&e<this.maxdepth){const a=r.data,o=r.minZ,f=r.maxZ;if(o<e){this.remove(r);const l=this.to3d(a,o,e);this.insert(l);const _=this.to3d(a,e,f);this.insert(_)}const c=this.to3d(t.data,e,this.maxdepth);this.insert(c)}}}const eO={color:"gray",opacity:[.2,1],size:[.66,1],mouseover:!1},nO={zoom_balance:.35,duration:1e3,max_points:1e3,encoding:{},point_size:1,alpha:40,background_options:eO,zoom_align:"center"},rO=[{id:"canvas-2d-background",nodetype:"canvas"},{id:"webgl-canvas",nodetype:"canvas"},{id:"canvas-2d",nodetype:"canvas"},{id:"deepscatter-svg",nodetype:"svg"}];class wO{constructor(t,e,r){this.secondary_renderers={},this.plot_queue=Promise.resolve(0),this.hooks={},this.mark_ready=function(){},this.bound=!1,t!==void 0&&this.bind(t,e,r),this.width=e,this.height=r,this.ready=new Promise((a,o)=>{this.mark_ready=a}),this.click_handler=new aO(this),this.tooltip_handler=new sO(this),this.label_click_handler=new iO(this),this.prefs={...nO}}bind(t,e,r){if(this.div=Wn(t).selectAll("div.deepscatter_container").data([1]).join("div").attr("class","deepscatter_container").style("position","absolute"),this.div.empty())throw console.error(t),"Must pass a valid div selector";this.elements=[];for(const a of rO){const o=this.div.append("div").attr("id",`container-for-${a.id}`).style("position","absolute").style("top",0).style("left",0).style("pointer-events",a.id==="deepscatter-svg"?"auto":"none"),f=o.append(a.nodetype).attr("id",a.id).attr("width",e||window.innerWidth).attr("height",r||window.innerHeight);a.nodetype==="svg"&&(f.append("g").attr("id","mousepoints"),f.append("g").attr("id","labelrects")),this.elements.push(o)}this.bound=!0}add_identifier_column(t,e,r){const a=Array.isArray(e)?Object.fromEntries(e.map(o=>[o,1])):e;this._root.add_label_identifiers(a,t,r)}async add_labels_from_url(t,e,r,a,o){return await this.ready,await this._root.promise,fetch(t).then(async f=>{const c=await f.json();this.add_labels(c,e,r,a,o)}).catch(f=>{console.warn(f),console.error("Broken addition of ",e)})}add_labels(t,e,r,a,o={}){const f=new K7(this,e,o);f.update(t,r,a),this.secondary_renderers[e]=f,this.secondary_renderers[e].start()}add_api_label(t){const e={type:"FeatureCollection",features:t.labels.map(r=>({type:"Feature",geometry:{type:"Point",coordinates:[r.x,r.y]},properties:{text:r.text,size:r.size||void 0}}))};this.add_labels(e,t.name,"text","size",t.options||{})}async reinitialize(){const{prefs:t}=this;if(t.source_url!==void 0)this._root=_p.from_quadfeather(t.source_url,t,this);else if(t.arrow_table!==void 0)this._root=_p.from_arrow_table(t.arrow_table,t,this);else throw new Error("No source_url or arrow_table specified");await this._root.ready,this._renderer=new QT("#container-for-webgl-canvas",this._root,this),this._zoom=new IE("#deepscatter-svg",this.prefs,this),this._zoom.attach_tiles(this._root),this._zoom.attach_renderer("regl",this._renderer),this._zoom.initialize_zoom();const r=Wn("#container-for-canvas-2d-background").select("canvas").node().getContext("2d");return r.fillStyle=t.background_color||"rgba(133, 133, 111, .8)",r.fillRect(0,0,window.innerWidth*2,window.innerHeight*2),this._renderer.initialize(),this._root.promise.then(()=>this.mark_ready()),this.ready}visualize_tiles(){const t=this,e=t.elements[2].selectAll("canvas").node().getContext("2d");e.clearRect(0,0,1e4,1e4);const{x_:r,y_:a}=t._zoom.scales();e.strokeStyle="#888888";const o=t._root.map(f=>f);for(const f of nu(13))setTimeout(()=>{for(const c of o){if(c.codes[0]!=f||!c.extent)continue;const[l,_]=c.extent.x.map(C=>r(C)),[m,A]=c.extent.y.map(C=>a(C)),R=c.codes[0];e.lineWidth=8/Math.sqrt(R),e.globalAlpha=.33,e.strokeRect(l,m,_-l,A-m),c.download_state!=="Unattempted"&&e.fillRect(l,m,_-l,A-m),e.globalAlpha=1}},f*400);setTimeout(()=>e.clearRect(0,0,1e4,1e4),17*400)}async make_big_png(t=3,e=1e7,r=100){await this._root.download_to_depth(e);const{width:a,height:o}=this._renderer;this.plotAPI({duration:0});const f=document.createElement("canvas");f.setAttribute("width",(t*a).toString()),f.setAttribute("height",(t*o).toString());const c=f.getContext("2d"),l=this._zoom.current_corners();this._zoom.transform.k;const _=(l.x[1]-l.x[0])/t,m=(l.y[1]-l.y[0])/t;new Promise((R,C)=>{for(let G=0;G<t;G++)for(let $t=0;$t<t;$t++)setTimeout(()=>{this._zoom.zoom_to_bbox({x:[l.x[0]+_*G,l.x[0]+_*(G+1)],y:[l.y[0]+m*$t,l.y[0]+m*($t+1)]},r/5,1),setTimeout(()=>{this._renderer.fbos.colorpicker.use(()=>{this._renderer.render_all(this._renderer.props);const Kt=this._renderer.regl.read(0,0,a,o),Mt=o/2|0,ie=a*4;for(var Xt=new Uint8Array(a*4),it=0;it<Mt;++it){var Ct=it*ie,fe=(o-it-1)*ie;Xt.set(Kt.subarray(Ct,Ct+ie)),Kt.copyWithin(Ct,fe,fe+ie),Kt.set(Xt,fe)}const be=new ImageData(new Uint8ClampedArray(Kt),a);c.putImageData(be,a*G,o*$t)}),G==t-1&&$t===t-1&&R()},r/2)},G*r*t+$t*r)}).then(()=>{const R=f.toDataURL(),C=document.createElement("a");C.href=R,C.style="position:fixed;top:40vh;left:40vw;z-index:999;",C.download="deepscatter",C.click(),C.remove()})}destroy(){var t,e,r;(e=(t=this._renderer)==null?void 0:t.regl)==null||e.destroy(),(r=this.div)==null||r.node().parentElement.replaceChildren()}update_prefs(t){if(this.prefs.encoding&&t.encoding)for(const e of Object.keys(this.prefs.encoding))t.encoding[e]!==void 0&&(this.prefs.encoding[e]=t.encoding[e]);O_(this.prefs,t)}add_hook(t,e,r=!1){if(this.hooks[t]!==void 0&&!r)throw new Error(`Hook ${t} already exists`);this.hooks[t]=e}remove_hook(t,e=!1){if(this.hooks[t]===void 0){if(e)return;throw new Error(`Hook ${t} does not exist`)}delete this.hooks[t]}stop_labellers(){console.log("Stopping labels");for(const[t,e]of Object.entries(this.secondary_renderers))e&&e.label_key!==void 0&&(this.secondary_renderers[t].stop(),this.secondary_renderers[t].delete(),this.secondary_renderers[t]=void 0)}dim(t){return this._renderer.aes.dim(t).current}set tooltip_html(t){this.tooltip_handler.f=t}get tooltip_html(){return this.tooltip_handler.f}set label_click(t){this.label_click_handler.f=t}get label_click(){return this.label_click_handler.f.bind(this.label_click_handler)}set click_function(t){this.click_handler.f=t}get click_function(){return this.click_handler.f}async plotAPI(t){if(t!==void 0){await this.plot_queue,t&&await this.start_transformations(t),this.plot_queue=this.unsafe_plotAPI(t),await this.plot_queue;for(const[e,r]of Object.entries(this.hooks))r()}}async start_transformations(t,e=110){return new Promise(r=>{this.prefs.duration<e&&(e=this.prefs.duration);const a=new Set;t.encoding||r();for(const[o,f]of Object.entries(t.encoding))f&&typeof f!="string"&&f.field!==void 0&&a.add(f.field);if(this._renderer){const o=[],f=[];for(const c of this._renderer.visible_tiles()){const l=c._buffer_manager;if(l!==void 0&&l.ready())for(const _ of a){const{ready:m,promise:A}=l.ready_or_not_here_it_comes(_);m||A!==null&&(o.push(A),c.key==="0/0/0"&&f.push(A))}}if(o.length===0)r();else{const c=Date.now();Promise.all(f).then(()=>{const _=Date.now()-c;_<e?setTimeout(()=>{r()},e-_):r()})}}else r()})}async unsafe_plotAPI(t){var e;if(t===null)return;t.click_function&&(this.click_function=Function("datum",t.click_function)),t.tooltip_html&&(this.tooltip_html=Function("datum",t.tooltip_html)),t.background_options&&(t.background_options.opacity&&typeof t.background_options.opacity=="number"&&(t.background_options.opacity=[t.background_options.opacity,1]),t.background_options.size&&typeof t.background_options.size=="number"&&(t.background_options.size=[t.background_options.size,1])),this.update_prefs(t),this._root===void 0&&await this.reinitialize(),t.basemap_gleofeather&&(t.polygons=[{file:t.basemap_gleofeather}]),await this._root.promise,this._renderer.render_props.apply_prefs(this.prefs);const{width:r,height:a}=this;if(this.update_prefs(t),t.zoom!==void 0&&(t.zoom===null?(this._zoom.zoom_to(1,r/2,a/2),t.zoom=void 0):(e=t.zoom)!=null&&e.bbox&&this._zoom.zoom_to_bbox(t.zoom.bbox,t.duration)),this._renderer.most_recent_restart=Date.now(),this._renderer.aes.apply_encoding(t.encoding),this._renderer.apply_webgl_scale&&this._renderer.apply_webgl_scale(t),this._renderer.reglframe&&(this._renderer.reglframe.cancel(),this._renderer.reglframe=void 0),this._renderer.reglframe=this._renderer.regl.frame(()=>{this._renderer.tick("Basic")}),t.labels!==void 0)if(kE(t.labels)){const{url:o,label_field:f,size_field:c}=t.labels,l=t.labels.name||o;this.secondary_renderers[l]||(this.stop_labellers(),this.add_labels_from_url(o,l,f,c).catch(_=>{console.error("Label addition failed."),console.error(_)}))}else if(PE(t.labels)){if(!t.labels.name)throw new Error("API field `labels` must have a name.");this.stop_labellers(),this.add_api_label(t.labels)}else if(t.labels===null)this.stop_labellers();else throw new Error("API field `labels` format not recognized.");this._zoom.restart_timer(6e4)}async root_table(){return this._root?this._root.record_batch:!1}get query(){const t=JSON.parse(JSON.stringify(this.prefs));return t.zoom={bbox:this._renderer.zoom.current_corners()},t}drawContours(t,e){const o=(e||Wn("body")).select("#canvas-2d").node().getContext("2d");for(const f of t){o.fillStyle="rgba(25, 25, 29, 1)",o.fillRect(0,0,window.innerWidth*2,window.innerHeight*2),o.strokeStyle="#8a0303",o.fillStyle="rgba(30, 30, 34, 1)",o.lineWidth=t0([.45,.25*Math.exp(Math.log(this._zoom.transform.k/2))]);const c=z4(V4().scale(this._zoom.transform.k).translate([this._zoom.transform.x,this._zoom.transform.y]),o);o.beginPath(),c(f),o.fill()}}sample_points(t=10){const e=[];for(const r of this._root.points(this._zoom.current_corners()))if(e.push({...r}),e.length>=t*3)break;return e.sort((r,a)=>Number(r.ix)-Number(a.ix)),e.slice(0,t)}contours(t){const e=this._renderer.calculate_contours(t),{x:r,y:a,x_:o,y_:f}=this._zoom.scales();function c(l){if(l){if(l.coordinates)return c(l.coordinates);if(l.length!==0){if(l[0].length>0)return l.map(c);l[0]=r(o.invert(l[0])),l[1]=a(f.invert(l[1]))}}}c(e),this.drawContours(e)}}class Rg{constructor(t){this.string_rep="",this.plot=t}get f(){return this._f===void 0?this.default:this._f}set f(t){typeof t=="string"?this.string_rep!==t&&(this.string_rep=t,this._f=Function("datum","plot",t)):this._f=t}}class iO extends Rg{default(t,e=void 0,r=void 0){let a;t!==null&&(t.__activated==!0?(a=null,t.__activated=void 0):(t.__activated=!0,a={field:r.label_key,lambda:`d => d === '${t.properties[r.label_key]}'`}),this.plot.plotAPI({encoding:{filter:a}}))}}class aO extends Rg{default(t,e=void 0){console.log({...t})}}class sO extends Rg{default(t,e=void 0){let r="<dl>";const a=new Set(["x","y","ix",null,"tile_key"]);for(const[o,f]of t)f!==null&&(a.has(o)||f!==""&&(r+=` <dt>${String(o)}</dt>
`,r+=`   <dd>${String(f)}<dd>
`));return`${r}</dl>
`}}export{wO as default};
